[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Statistical Report on OTIS",
    "section": "",
    "text": "Preface\nThis scientific project is actively being developed for investigating OTIS Data.1",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#footnotes",
    "href": "index.html#footnotes",
    "title": "Statistical Report on OTIS",
    "section": "",
    "text": "Service Management and Oversight Branch’s detailed data collection of restrictive confinement placements (A01RCDD) in Ontario’s Adult Correctional System is maintained by the Business Intelligence and Insights Branch of the Ministry of the Solicitor General. For the partial MECA Bundle, see https://vanshsinghruhela-statistical-report-on-restrictive-confinement.share.connect.posit.cloud.↩︎",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "intro.html",
    "href": "intro.html",
    "title": "1  Introduction",
    "section": "",
    "text": "1.0.1 A01-RC Detailed Dataset\n\n\n\nOntario Restrictive Confinement Dataframe (2023-2025)\n\n\nx1a\nx1b\nx1c\nx1d\nx1e\nx1f\nx1g\nx1h\nx1i\n\n\n\n\n2023\nToronto\nToronto\nMale\n25 to 49\nNo\nYes\nNo\n8\n\n\n2023\nToronto\nToronto\nMale\n25 to 49\nNo\nNo\nNo\n26\n\n\n2023\nNorthern\nNorthern\nMale\n50+\nNo\nNo\nNo\n20\n\n\n2023\nEastern\nEastern\nMale\n25 to 49\nYes\nYes\nNo\n9\n\n\n2023\nWestern\nWestern\nMale\n25 to 49\nNo\nYes\nNo\n11\n\n\n2023\nEastern\nEastern\nMale\n50+\nNo\nNo\nNo\n8\n\n\n2023\nEastern\nEastern\nMale\n50+\nNo\nNo\nNo\n8\n\n\n2023\nCentral\nCentral\nMale\n25 to 49\nNo\nNo\nNo\n10\n\n\n2023\nNorthern\nNorthern\nMale\n50+\nNo\nNo\nNo\n3\n\n\n2023\nWestern\nWestern\nMale\n25 to 49\nNo\nNo\nNo\n11",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "descriptives.html",
    "href": "descriptives.html",
    "title": "2  Descriptive Statistics",
    "section": "",
    "text": "(ecdf_age)\n\n\nac1a\nf\nn\np\npct\nrate\necdf\n\n\n\n\n1\n11977\n10139\n0.15\n15.49\n1548.72\n0.15\n\n\n2\n56518\n47857\n0.73\n73.10\n7310.10\n0.88\n\n\n3\n8439\n7471\n0.11\n11.41\n1141.19\n0.99\n\n\n\n\n\n\n(df.counts).\n\n\n\n\n\n\n\n\n\n\nregion_at_time_of_placement\nf\ncount\np\npct\nrate\n\n\n\n\nCentral\n22643\n20066\n0.2943783\n29.43783\n2943.783\n\n\nEastern\n20349\n17811\n0.2612963\n26.12963\n2612.963\n\n\nNorthern\n9110\n7891\n0.1157649\n11.57649\n1157.649\n\n\nToronto\n12602\n11213\n0.1645003\n16.45003\n1645.003\n\n\nWestern\n12230\n11183\n0.1640602\n16.40602\n1640.602\n\n\n\n\n\n\n(df.counts_year)\n\n\n\n\n\n\n\n\n\n\n\nend_fiscal_year\nregion_at_time_of_placement\nf\ncount\np\npct\nrate\n\n\n\n\n2023\nCentral\n7663\n6784\n0.3174841\n31.748409\n3174.8409\n\n\n2023\nEastern\n5811\n5079\n0.2376919\n23.769188\n2376.9188\n\n\n2023\nNorthern\n3422\n3031\n0.1418476\n14.184762\n1418.4762\n\n\n2023\nToronto\n3455\n2999\n0.1403501\n14.035006\n1403.5006\n\n\n2023\nWestern\n3772\n3475\n0.1626264\n16.262636\n1626.2636\n\n\n2024\nCentral\n5949\n5228\n0.2569926\n25.699258\n2569.9258\n\n\n2024\nEastern\n7416\n6569\n0.3229121\n32.291206\n3229.1206\n\n\n2024\nNorthern\n2852\n2417\n0.1188124\n11.881237\n1188.1237\n\n\n2024\nToronto\n2874\n2575\n0.1265792\n12.657917\n1265.7917\n\n\n2024\nWestern\n3904\n3554\n0.1747038\n17.470383\n1747.0383\n\n\n2025\nCentral\n9031\n8054\n0.3044645\n30.446452\n3044.6452\n\n\n2025\nEastern\n7122\n6163\n0.2329792\n23.297925\n2329.7925\n\n\n2025\nNorthern\n2836\n2443\n0.0923525\n9.235247\n923.5247\n\n\n2025\nToronto\n6273\n5639\n0.2131705\n21.317053\n2131.7053\n\n\n2025\nWestern\n4554\n4154\n0.1570332\n15.703323\n1570.3323\n\n\n\n\n\n\n(df_overall)\n\n\n\n\n\n\n\n\n\n\n\nvariable\nlevel\nf\ncount\np\npct\nrate\n\n\n\n\nage_category\n18 to 24\n11977\n10139\n0.1548719\n15.487192\n1548.7192\n\n\nage_category\n25 to 49\n56518\n47857\n0.7310095\n73.100952\n7310.0952\n\n\nage_category\n50+\n8439\n7471\n0.1141186\n11.411856\n1141.1856\n\n\ngender\nFemale\n7242\n6256\n0.0955596\n9.555960\n955.5959\n\n\ngender\nMale\n69692\n59211\n0.9044404\n90.444040\n9044.4041\n\n\nmental_health_alert\nNo\n55837\n50900\n0.7774909\n77.749095\n7774.9095\n\n\nmental_health_alert\nYes\n21097\n17661\n0.2697695\n26.976950\n2697.6950\n\n\nregion_at_time_of_placement\nCentral\n22643\n20066\n0.3065056\n30.650557\n3065.0557\n\n\nregion_at_time_of_placement\nEastern\n20349\n17811\n0.2720607\n27.206073\n2720.6073\n\n\nregion_at_time_of_placement\nNorthern\n9110\n7891\n0.1205340\n12.053401\n1205.3401\n\n\nregion_at_time_of_placement\nToronto\n12602\n11213\n0.1712771\n17.127713\n1712.7713\n\n\nregion_at_time_of_placement\nWestern\n12230\n11183\n0.1708189\n17.081889\n1708.1889\n\n\nregion_most_recent_placement\nCentral\n22577\n19207\n0.2933845\n29.338445\n2933.8445\n\n\nregion_most_recent_placement\nEastern\n20263\n17237\n0.2632930\n26.329296\n2632.9296\n\n\nregion_most_recent_placement\nNorthern\n9080\n7696\n0.1175554\n11.755541\n1175.5541\n\n\nregion_most_recent_placement\nToronto\n12743\n10558\n0.1612721\n16.127209\n1612.7209\n\n\nregion_most_recent_placement\nWestern\n12271\n10769\n0.1644951\n16.449509\n1644.9509\n\n\nsuicide_risk_alert\nNo\n63229\n58447\n0.8927704\n89.277040\n8927.7040\n\n\nsuicide_risk_alert\nYes\n13705\n11328\n0.1730337\n17.303374\n1730.3374\n\n\nsuicide_watch_alert\nNo\n71715\n64433\n0.9842058\n98.420578\n9842.0578\n\n\nsuicide_watch_alert\nYes\n5219\n4921\n0.0751676\n7.516764\n751.6764\n\n\n\n\n\n\n(df.counts_ac_year)\n\n\n\n\n\n\n\n\n\n\n\n\nend_fiscal_year\nvariable\nlevel\nf\ncount\np\npct\nrate\n\n\n\n\n2023\nage_category\n18 to 24\n4062\n3507\n0.1687599\n16.875992\n1687.5992\n\n\n2023\nage_category\n25 to 49\n17437\n14930\n0.7184447\n71.844473\n7184.4473\n\n\n2023\nage_category\n50+\n2624\n2344\n0.1127953\n11.279534\n1127.9534\n\n\n2023\ngender\nFemale\n1712\n1511\n0.0727106\n7.271065\n727.1065\n\n\n2023\ngender\nMale\n22411\n19270\n0.9272894\n92.728935\n9272.8935\n\n\n2023\nmental_health_alert\nNo\n17726\n16399\n0.7487786\n74.877859\n7487.7859\n\n\n2023\nmental_health_alert\nYes\n6397\n5502\n0.2512214\n25.122141\n2512.2141\n\n\n2023\nregion_at_time_of_placement\nCentral\n7663\n6784\n0.3174841\n31.748409\n3174.8409\n\n\n2023\nregion_at_time_of_placement\nEastern\n5811\n5079\n0.2376919\n23.769188\n2376.9188\n\n\n2023\nregion_at_time_of_placement\nNorthern\n3422\n3031\n0.1418476\n14.184762\n1418.4762\n\n\n2023\nregion_at_time_of_placement\nToronto\n3455\n2999\n0.1403501\n14.035006\n1403.5006\n\n\n2023\nregion_at_time_of_placement\nWestern\n3772\n3475\n0.1626264\n16.262636\n1626.2636\n\n\n2023\nregion_most_recent_placement\nCentral\n7647\n6581\n0.3166835\n31.668351\n3166.8351\n\n\n2023\nregion_most_recent_placement\nEastern\n5841\n4987\n0.2399788\n23.997883\n2399.7883\n\n\n2023\nregion_most_recent_placement\nNorthern\n3422\n2988\n0.1437852\n14.378519\n1437.8519\n\n\n2023\nregion_most_recent_placement\nToronto\n3425\n2826\n0.1359896\n13.598961\n1359.8961\n\n\n2023\nregion_most_recent_placement\nWestern\n3788\n3399\n0.1635629\n16.356287\n1635.6287\n\n\n2023\nsuicide_risk_alert\nNo\n20380\n18942\n0.8549377\n85.493771\n8549.3771\n\n\n2023\nsuicide_risk_alert\nYes\n3743\n3214\n0.1450623\n14.506229\n1450.6229\n\n\n2023\nsuicide_watch_alert\nNo\n23057\n20621\n0.9531756\n95.317556\n9531.7556\n\n\n2023\nsuicide_watch_alert\nYes\n1066\n1013\n0.0468244\n4.682444\n468.2444\n\n\n2024\nage_category\n18 to 24\n3486\n2944\n0.1498905\n14.989054\n1498.9054\n\n\n2024\nage_category\n25 to 49\n16959\n14445\n0.7354514\n73.545135\n7354.5135\n\n\n2024\nage_category\n50+\n2550\n2252\n0.1146581\n11.465811\n1146.5811\n\n\n2024\ngender\nFemale\n2219\n1924\n0.0979584\n9.795835\n979.5835\n\n\n2024\ngender\nMale\n20776\n17717\n0.9020416\n90.204165\n9020.4165\n\n\n2024\nmental_health_alert\nNo\n16562\n15146\n0.7372469\n73.724688\n7372.4688\n\n\n2024\nmental_health_alert\nYes\n6433\n5398\n0.2627531\n26.275312\n2627.5312\n\n\n2024\nregion_at_time_of_placement\nCentral\n5949\n5228\n0.2569926\n25.699258\n2569.9258\n\n\n2024\nregion_at_time_of_placement\nEastern\n7416\n6569\n0.3229121\n32.291206\n3229.1206\n\n\n2024\nregion_at_time_of_placement\nNorthern\n2852\n2417\n0.1188124\n11.881237\n1188.1237\n\n\n2024\nregion_at_time_of_placement\nToronto\n2874\n2575\n0.1265792\n12.657917\n1265.7917\n\n\n2024\nregion_at_time_of_placement\nWestern\n3904\n3554\n0.1747038\n17.470383\n1747.0383\n\n\n2024\nregion_most_recent_placement\nCentral\n5969\n5035\n0.2563515\n25.635151\n2563.5151\n\n\n2024\nregion_most_recent_placement\nEastern\n7400\n6382\n0.3249325\n32.493254\n3249.3254\n\n\n2024\nregion_most_recent_placement\nNorthern\n2860\n2376\n0.1209714\n12.097144\n1209.7144\n\n\n2024\nregion_most_recent_placement\nToronto\n2896\n2408\n0.1226007\n12.260068\n1226.0068\n\n\n2024\nregion_most_recent_placement\nWestern\n3870\n3440\n0.1751438\n17.514383\n1751.4383\n\n\n2024\nsuicide_risk_alert\nNo\n18616\n17315\n0.8272419\n82.724189\n8272.4189\n\n\n2024\nsuicide_risk_alert\nYes\n4379\n3616\n0.1727581\n17.275811\n1727.5811\n\n\n2024\nsuicide_watch_alert\nNo\n21198\n19259\n0.9190208\n91.902080\n9190.2081\n\n\n2024\nsuicide_watch_alert\nYes\n1797\n1697\n0.0809792\n8.097919\n809.7919\n\n\n2025\nage_category\n18 to 24\n4429\n3688\n0.1472549\n14.725494\n1472.5494\n\n\n2025\nage_category\n25 to 49\n22122\n18482\n0.7379517\n73.795169\n7379.5169\n\n\n2025\nage_category\n50+\n3265\n2875\n0.1147934\n11.479337\n1147.9337\n\n\n2025\ngender\nFemale\n3311\n2821\n0.1126373\n11.263725\n1126.3725\n\n\n2025\ngender\nMale\n26505\n22224\n0.8873627\n88.736275\n8873.6275\n\n\n2025\nmental_health_alert\nNo\n21549\n19355\n0.7411166\n74.111656\n7411.1656\n\n\n2025\nmental_health_alert\nYes\n8267\n6761\n0.2588834\n25.888344\n2588.8344\n\n\n2025\nregion_at_time_of_placement\nCentral\n9031\n8054\n0.3044645\n30.446452\n3044.6452\n\n\n2025\nregion_at_time_of_placement\nEastern\n7122\n6163\n0.2329792\n23.297925\n2329.7925\n\n\n2025\nregion_at_time_of_placement\nNorthern\n2836\n2443\n0.0923525\n9.235247\n923.5247\n\n\n2025\nregion_at_time_of_placement\nToronto\n6273\n5639\n0.2131705\n21.317053\n2131.7053\n\n\n2025\nregion_at_time_of_placement\nWestern\n4554\n4154\n0.1570332\n15.703323\n1570.3323\n\n\n2025\nregion_most_recent_placement\nCentral\n8961\n7591\n0.3030944\n30.309443\n3030.9443\n\n\n2025\nregion_most_recent_placement\nEastern\n7022\n5868\n0.2342983\n23.429826\n2342.9826\n\n\n2025\nregion_most_recent_placement\nNorthern\n2798\n2332\n0.0931124\n9.311240\n931.1240\n\n\n2025\nregion_most_recent_placement\nToronto\n6422\n5324\n0.2125774\n21.257736\n2125.7736\n\n\n2025\nregion_most_recent_placement\nWestern\n4613\n3930\n0.1569175\n15.691755\n1569.1755\n\n\n2025\nsuicide_risk_alert\nNo\n24233\n22190\n0.8314598\n83.145983\n8314.5983\n\n\n2025\nsuicide_risk_alert\nYes\n5583\n4498\n0.1685402\n16.854017\n1685.4017\n\n\n2025\nsuicide_watch_alert\nNo\n27460\n24553\n0.9173890\n91.738903\n9173.8903\n\n\n2025\nsuicide_watch_alert\nYes\n2356\n2211\n0.0826110\n8.261097\n826.1097",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Descriptive Statistics</span>"
    ]
  },
  {
    "objectID": "results.html",
    "href": "results.html",
    "title": "3  DML",
    "section": "",
    "text": "Pooled IRM DoubleML (2023–2025)\n\n\n\n\n\n\n\n\n\n\n\n\ngroup\nestimand\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\nPooled 2023-25\nATE\n0.1605\n0.0063\n25.5418\n0\n0.1481\n0.1728\n\n\nPooled 2023-25\nATTE\n0.1557\n0.0061\n25.6923\n0\n0.1438\n0.1676\n\n\n\n\n\n\n\n\nIRM DoubleML (2023/2024/2025)\n\n\ngroup\nestimand\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\n2023\nATE\n0.1342\n0.0099\n13.6093\n0\n0.1149\n0.1535\n\n\n2023\nATTE\n0.1272\n0.0103\n12.3080\n0\n0.1070\n0.1475\n\n\n2024\nATE\n0.1591\n0.0117\n13.6359\n0\n0.1362\n0.1820\n\n\n2024\nATTE\n0.1550\n0.0114\n13.5809\n0\n0.1326\n0.1774\n\n\n2025\nATE\n0.1737\n0.0103\n16.8639\n0\n0.1535\n0.1939\n\n\n2025\nATTE\n0.1704\n0.0097\n17.6296\n0\n0.1514\n0.1893\n\n\n\n\n\n\n\n\nMulti-way Regional Clustering Variations\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nregion_contrast\nclustering\nestimand\nn\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\nToronto vs others\n0-way\nATE\n76934\n0.1958\n0.0035\n55.9040\n0\n0.1889\n0.2026\n\n\nToronto vs others\n0-way\nATTE\n76934\n0.1941\n0.0035\n55.2631\n0\n0.1872\n0.2010\n\n\nToronto vs others\ncluster_id\nATE\n76934\n0.1958\n0.0035\n56.6119\n0\n0.1890\n0.2026\n\n\nToronto vs others\ncluster_id\nATTE\n76934\n0.1938\n0.0035\n55.7208\n0\n0.1870\n0.2006\n\n\nToronto vs others\ncluster_id + cluster_region\nATE\n76934\n0.2010\n0.0183\n11.0060\n0\n0.1652\n0.2368\n\n\nToronto vs others\ncluster_id + cluster_region\nATTE\n76934\n0.2013\n0.0182\n11.0566\n0\n0.1656\n0.2370\n\n\nEastern vs others\n0-way\nATE\n76934\n0.1979\n0.0035\n56.0164\n0\n0.1910\n0.2048\n\n\nEastern vs others\n0-way\nATTE\n76934\n0.1935\n0.0035\n54.8684\n0\n0.1866\n0.2004\n\n\nEastern vs others\ncluster_id\nATE\n76934\n0.1980\n0.0035\n56.8639\n0\n0.1912\n0.2048\n\n\nEastern vs others\ncluster_id\nATTE\n76934\n0.1932\n0.0035\n55.2683\n0\n0.1863\n0.2000\n\n\nEastern vs others\ncluster_id + cluster_region\nATE\n76934\n0.1998\n0.0182\n10.9762\n0\n0.1641\n0.2355\n\n\nEastern vs others\ncluster_id + cluster_region\nATTE\n76934\n0.1956\n0.0185\n10.5605\n0\n0.1593\n0.2319\n\n\nWestern vs others\n0-way\nATE\n76934\n0.1971\n0.0035\n55.9721\n0\n0.1902\n0.2040\n\n\nWestern vs others\n0-way\nATTE\n76934\n0.1946\n0.0035\n55.2772\n0\n0.1877\n0.2015\n\n\nWestern vs others\ncluster_id\nATE\n76934\n0.1973\n0.0035\n56.6810\n0\n0.1905\n0.2041\n\n\nWestern vs others\ncluster_id\nATTE\n76934\n0.1944\n0.0035\n55.7063\n0\n0.1876\n0.2013\n\n\nWestern vs others\ncluster_id + cluster_region\nATE\n76934\n0.1969\n0.0178\n11.0717\n0\n0.1621\n0.2318\n\n\nWestern vs others\ncluster_id + cluster_region\nATTE\n76934\n0.1974\n0.0190\n10.3743\n0\n0.1601\n0.2347\n\n\nCentral vs others\n0-way\nATE\n76934\n0.1981\n0.0035\n56.0529\n0\n0.1912\n0.2050\n\n\nCentral vs others\n0-way\nATTE\n76934\n0.1940\n0.0035\n54.9521\n0\n0.1871\n0.2009\n\n\nCentral vs others\ncluster_id\nATE\n76934\n0.1982\n0.0035\n56.9820\n0\n0.1913\n0.2050\n\n\nCentral vs others\ncluster_id\nATTE\n76934\n0.1940\n0.0035\n55.3884\n0\n0.1871\n0.2008\n\n\nCentral vs others\ncluster_id + cluster_region\nATE\n76934\n0.1989\n0.0175\n11.3633\n0\n0.1646\n0.2332\n\n\nCentral vs others\ncluster_id + cluster_region\nATTE\n76934\n0.1971\n0.0181\n10.9061\n0\n0.1617\n0.2325\n\n\nNorthern vs others\n0-way\nATE\n76934\n0.1990\n0.0035\n56.6860\n0\n0.1921\n0.2059\n\n\nNorthern vs others\n0-way\nATTE\n76934\n0.1958\n0.0035\n55.9774\n0\n0.1889\n0.2027\n\n\nNorthern vs others\ncluster_id\nATE\n76934\n0.1991\n0.0035\n57.5614\n0\n0.1924\n0.2059\n\n\nNorthern vs others\ncluster_id\nATTE\n76934\n0.1955\n0.0035\n56.4823\n0\n0.1887\n0.2023\n\n\nNorthern vs others\ncluster_id + cluster_region\nATE\n76934\n0.1997\n0.0181\n11.0579\n0\n0.1643\n0.2351\n\n\nNorthern vs others\ncluster_id + cluster_region\nATTE\n76934\n0.1979\n0.0192\n10.2894\n0\n0.1602\n0.2356",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>DML</span>"
    ]
  },
  {
    "objectID": "notez1a.html",
    "href": "notez1a.html",
    "title": "4  Logic Notebook",
    "section": "",
    "text": "suppressWarnings(suppressPackageStartupMessages({\n  library(data.table)\n  library(tidyverse)\n  library(tidymodels)\n  library(naniar)\n  library(readxl)\n  library(janitor)\n  library(rmarkdown)\n  library(knitr)\n  library(kableExtra)\n  library(modelsummary)\n  library(DoubleML)\n  library(mlr3)\n  library(broom)\n  library(sandwich)\n  library(lmtest)\n  library(mlr3learners)\n  library(readr)\n  library(MatchIt)\n  library(ggplot2)\n  library(dplyr)\n  library(summarytools)\n  library(DataExplorer)\n  library(mlr3learners)\n  library(mlr3measures)\n  library(mlr3resampling)\n}))\nset.seed(5824769)\noptions(warn = -1)\noptions(device.ask.default = FALSE)\ndata010a &lt;- rnorm(1000000)\nhist(\n  data010a,\n  labels = TRUE,\n  col = \"grey\",\n  breaks = 100,\n  main = \"Histogram of Random Data\",\n  xlab = \"Value\",\n  ylab = \"Frequency\"\n)\n\n\n\n\n\n\n\nrdx = rnorm(1000)\nrdy = as.numeric(rdx &gt; 0)\nrdix = sample(1:1000, 100)\nrdy[rdix] = 1 - rdy[rdix]\nrdf = data.frame(rdx, rdy)\nplot(rdf$rdx, rdf$rdy)\nm &lt;- glm(rdy ~ rdx, data = rdf, family = binomial())\nxs &lt;- seq(min(rdf$rdx), max(rdf$rdx), length.out = 300)\nlines(\n  xs,\n  predict(m, newdata = data.frame(rdx = xs), type = \"response\"),\n  lwd = 2\n)\n\n\n\n\n\n\n\nload(\"correctional_stats_report_environment1b.RData\")\n\ndataframe_original &lt;- df\ncols_to_rename &lt;- setdiff(names(dataframe_original), \"unique_individual_id\")\nnum_to_letters &lt;- function(n) {\n  sapply(n, function(i) {\n    out &lt;- \"\"\n    while (i &gt; 0) {\n      i &lt;- i - 1\n      out &lt;- paste0(letters[(i %% 26) + 1], out)\n      i &lt;- i %/% 26\n    }\n    out\n  })\n}\nnew_names &lt;- paste0(\"x1\", num_to_letters(seq_along(cols_to_rename)))\nnames(dataframe_original)[match(\n  cols_to_rename,\n  names(dataframe_original)\n)] &lt;- new_names\nknitr::kable(\n  head(\n    dataframe_original[, setdiff(\n      names(dataframe_original),\n      \"unique_individual_id\"\n    )],\n    10\n  ),\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = \"Ontario Restrictive Confinement Dataframe (2023-2025)\"\n)\n\n\nOntario Restrictive Confinement Dataframe (2023-2025)\n\n\nx1a\nx1b\nx1c\nx1d\nx1e\nx1f\nx1g\nx1h\nx1i\n\n\n\n\n2023\nToronto\nToronto\nMale\n25 to 49\nNo\nYes\nNo\n8\n\n\n2023\nToronto\nToronto\nMale\n25 to 49\nNo\nNo\nNo\n26\n\n\n2023\nNorthern\nNorthern\nMale\n50+\nNo\nNo\nNo\n20\n\n\n2023\nEastern\nEastern\nMale\n25 to 49\nYes\nYes\nNo\n9\n\n\n2023\nWestern\nWestern\nMale\n25 to 49\nNo\nYes\nNo\n11\n\n\n2023\nEastern\nEastern\nMale\n50+\nNo\nNo\nNo\n8\n\n\n2023\nEastern\nEastern\nMale\n50+\nNo\nNo\nNo\n8\n\n\n2023\nCentral\nCentral\nMale\n25 to 49\nNo\nNo\nNo\n10\n\n\n2023\nNorthern\nNorthern\nMale\n50+\nNo\nNo\nNo\n3\n\n\n2023\nWestern\nWestern\nMale\n25 to 49\nNo\nNo\nNo\n11\n\n\n\n\nregion_names &lt;- c(\"Central\", \"Eastern\", \"Northern\", \"Toronto\", \"Western\")\nage_levels &lt;- c(\"18 to 24\", \"25 to 49\", \"50+\")\nsex_levels &lt;- c(\"Male\", \"Female\")\nyears &lt;- 2023:2025\ndataframe_original1b &lt;- copy(dataframe_original)\ndf_rc &lt;- as.data.table(df)\ndf_rc[, end_fiscal_year := as.integer(end_fiscal_year)]\ndf_rc[, age_category := factor(age_category, levels = age_levels)]\ndf_rc[, gender := factor(gender, levels = sex_levels)]\ndf_rc[,\n  region_at_time_of_placement := factor(\n    region_at_time_of_placement,\n    levels = region_names\n  )\n]\nget_region_by_age &lt;- function(D, yr, sex = NULL) {\n  tmp &lt;- D[\n    end_fiscal_year == yr &\n      !is.na(age_category) &\n      !is.na(region_at_time_of_placement)\n  ]\n  if (!is.null(sex)) {\n    tmp &lt;- tmp[gender == sex]\n  }\n  tab &lt;- tmp[,\n    .(n = uniqueN(unique_individual_id)),\n    by = .(age_category, region_at_time_of_placement)\n  ]\n  grid &lt;- CJ(\n    age_category = age_levels,\n    region_at_time_of_placement = region_names,\n    unique = TRUE\n  )\n  tab &lt;- merge(\n    grid,\n    tab,\n    by = c(\"age_category\", \"region_at_time_of_placement\"),\n    all.x = TRUE\n  )\n  tab[is.na(n), n := 0L]\n  wide &lt;- dcast(\n    tab,\n    age_category ~ region_at_time_of_placement,\n    value.var = \"n\"\n  )\n  S &lt;- as.matrix(wide[, -1])\n  rownames(S) &lt;- wide$age_category\n  den &lt;- rowSums(S)\n  P &lt;- sweep(S, 1, den, \"/\")\n  P[den == 0, ] &lt;- NA_real_\n  list(S = S, P = P)\n}\nP_year &lt;- list()\nS_year &lt;- list()\nfor (yr in years) {\n  out_all &lt;- get_region_by_age(df_rc, yr)\n  P &lt;- out_all$P\n  S_year[[as.character(yr)]] &lt;- out_all$S\n  P_year[[as.character(yr)]] &lt;- P\n  cols &lt;- seq_len(ncol(P))\n  matplot(\n    P,\n    type = \"l\",\n    lwd = 2,\n    lty = 1,\n    col = cols,\n    xaxt = \"n\",\n    xlab = \"Age Group\",\n    ylab = \"Proportion\",\n    main = paste0(yr, \" Region at Time of Placement by Age Group\")\n  )\n  axis(1, at = seq_len(nrow(P)), labels = rownames(P))\n  legend(\n    \"topright\",\n    legend = colnames(P),\n    col = cols,\n    lty = 1,\n    lwd = 2,\n    bty = \"n\"\n  )\n  par(mfrow = c(1, 2), mar = c(4, 4, 3, 1))\n  for (sex in c(\"Male\", \"Female\")) {\n    out_sex &lt;- get_region_by_age(df_rc, yr, sex = sex)\n    Psex &lt;- out_sex$P\n    cols &lt;- seq_len(ncol(Psex))\n    matplot(\n      Psex,\n      type = \"l\",\n      lwd = 2,\n      lty = 1,\n      col = cols,\n      xaxt = \"n\",\n      xlab = \"Age Group\",\n      ylab = \"Proportion\",\n      main = paste0(yr, \" RTP (\", sex, \")\")\n    )\n    axis(1, at = seq_len(nrow(Psex)), labels = rownames(Psex))\n    legend(\n      \"topright\",\n      legend = colnames(Psex),\n      col = cols,\n      lty = 1,\n      lwd = 2,\n      bty = \"n\"\n    )\n  }\n  par(mfrow = c(1, 1))\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nac1b &lt;- df |&gt;\n  mutate(\n    ac1a = factor(\n      dplyr::recode(\n        as.character(age_category),\n        \"18 to 24\" = \"1\",\n        \"25 to 49\" = \"2\",\n        \"50+\" = \"3\"\n      ),\n      levels = c(\"1\", \"2\", \"3\"),\n      ordered = TRUE\n    )\n  ) |&gt;\n  group_by(ac1a) |&gt;\n  summarise(\n    f = dplyr::n(),\n    n = dplyr::n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |&gt;\n  arrange(ac1a) |&gt;\n  mutate(\n    p = round(n / sum(n), 2),\n    pct = round(100 * n / sum(n), 2),\n    rate = round(10000 * n / sum(n), 2)\n  )\nvars &lt;- c(\n  \"gender\",\n  \"age_category\",\n  \"region_at_time_of_placement\",\n  \"region_most_recent_placement\",\n  \"mental_health_alert\",\n  \"suicide_watch_alert\",\n  \"suicide_risk_alert\"\n)\ndf.counts &lt;- df |&gt;\n  group_by(region_at_time_of_placement) |&gt;\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |&gt;\n  mutate(p = count / sum(count), pct = p * 100, rate = p * 10000)\ndf.counts_ac_year &lt;- df |&gt;\n  pivot_longer(all_of(vars), names_to = \"variable\", values_to = \"level\") |&gt;\n  group_by(end_fiscal_year, variable, level) |&gt;\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |&gt;\n  group_by(end_fiscal_year, variable) |&gt;\n  mutate(p = count / sum(count), pct = 100 * p, rate = 10000 * p) |&gt;\n  ungroup()\ndf.counts_year &lt;- df |&gt;\n  group_by(end_fiscal_year, region_at_time_of_placement) |&gt;\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |&gt;\n  group_by(end_fiscal_year) |&gt;\n  mutate(p = count / sum(count), pct = 100 * p, rate = 10000 * p) |&gt;\n  ungroup()\ndf.person_freq_year &lt;- df |&gt;\n  group_by(\n    end_fiscal_year,\n    region_at_time_of_placement,\n    unique_individual_id\n  ) |&gt;\n  summarise(freq = n(), .groups = \"drop\")\necdf_age &lt;- ac1b |&gt;\n  arrange(ac1a) |&gt;\n  mutate(ecdf = cumsum(p))\nevents_per_person &lt;- df |&gt;\n  count(unique_individual_id, name = \"n_events\") |&gt;\n  pull(n_events)\ntotal_people &lt;- df |&gt;\n  summarise(N = n_distinct(unique_individual_id)) |&gt;\n  pull(N)\ndf_overall &lt;- df |&gt;\n  select(unique_individual_id, all_of(vars)) |&gt;\n  pivot_longer(all_of(vars), names_to = \"variable\", values_to = \"level\") |&gt;\n  group_by(variable, level) |&gt;\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |&gt;\n  mutate(\n    p = count / total_people,\n    pct = 100 * p,\n    rate = 10000 * p\n  )\n\nknitr::kable(\n  ecdf_age,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`ecdf_age`)'\n)\n\n\n(ecdf_age)\n\n\nac1a\nf\nn\np\npct\nrate\necdf\n\n\n\n\n1\n11977\n10139\n0.15\n15.49\n1548.72\n0.15\n\n\n2\n56518\n47857\n0.73\n73.10\n7310.10\n0.88\n\n\n3\n8439\n7471\n0.11\n11.41\n1141.19\n0.99\n\n\n\n\nknitr::kable(\n  df.counts,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df.counts`).'\n)\n\n\n(df.counts).\n\n\n\n\n\n\n\n\n\n\nregion_at_time_of_placement\nf\ncount\np\npct\nrate\n\n\n\n\nCentral\n22643\n20066\n0.2943783\n29.43783\n2943.783\n\n\nEastern\n20349\n17811\n0.2612963\n26.12963\n2612.963\n\n\nNorthern\n9110\n7891\n0.1157649\n11.57649\n1157.649\n\n\nToronto\n12602\n11213\n0.1645003\n16.45003\n1645.003\n\n\nWestern\n12230\n11183\n0.1640602\n16.40602\n1640.602\n\n\n\n\nknitr::kable(\n  df.counts_year,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df.counts_year`)'\n)\n\n\n(df.counts_year)\n\n\n\n\n\n\n\n\n\n\n\nend_fiscal_year\nregion_at_time_of_placement\nf\ncount\np\npct\nrate\n\n\n\n\n2023\nCentral\n7663\n6784\n0.3174841\n31.748409\n3174.8409\n\n\n2023\nEastern\n5811\n5079\n0.2376919\n23.769188\n2376.9188\n\n\n2023\nNorthern\n3422\n3031\n0.1418476\n14.184762\n1418.4762\n\n\n2023\nToronto\n3455\n2999\n0.1403501\n14.035006\n1403.5006\n\n\n2023\nWestern\n3772\n3475\n0.1626264\n16.262636\n1626.2636\n\n\n2024\nCentral\n5949\n5228\n0.2569926\n25.699258\n2569.9258\n\n\n2024\nEastern\n7416\n6569\n0.3229121\n32.291206\n3229.1206\n\n\n2024\nNorthern\n2852\n2417\n0.1188124\n11.881237\n1188.1237\n\n\n2024\nToronto\n2874\n2575\n0.1265792\n12.657917\n1265.7917\n\n\n2024\nWestern\n3904\n3554\n0.1747038\n17.470383\n1747.0383\n\n\n2025\nCentral\n9031\n8054\n0.3044645\n30.446452\n3044.6452\n\n\n2025\nEastern\n7122\n6163\n0.2329792\n23.297925\n2329.7925\n\n\n2025\nNorthern\n2836\n2443\n0.0923525\n9.235247\n923.5247\n\n\n2025\nToronto\n6273\n5639\n0.2131705\n21.317053\n2131.7053\n\n\n2025\nWestern\n4554\n4154\n0.1570332\n15.703323\n1570.3323\n\n\n\n\nknitr::kable(\n  df_overall,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df_overall`)'\n)\n\n\n(df_overall)\n\n\n\n\n\n\n\n\n\n\n\nvariable\nlevel\nf\ncount\np\npct\nrate\n\n\n\n\nage_category\n18 to 24\n11977\n10139\n0.1548719\n15.487192\n1548.7192\n\n\nage_category\n25 to 49\n56518\n47857\n0.7310095\n73.100952\n7310.0952\n\n\nage_category\n50+\n8439\n7471\n0.1141186\n11.411856\n1141.1856\n\n\ngender\nFemale\n7242\n6256\n0.0955596\n9.555960\n955.5959\n\n\ngender\nMale\n69692\n59211\n0.9044404\n90.444040\n9044.4041\n\n\nmental_health_alert\nNo\n55837\n50900\n0.7774909\n77.749095\n7774.9095\n\n\nmental_health_alert\nYes\n21097\n17661\n0.2697695\n26.976950\n2697.6950\n\n\nregion_at_time_of_placement\nCentral\n22643\n20066\n0.3065056\n30.650557\n3065.0557\n\n\nregion_at_time_of_placement\nEastern\n20349\n17811\n0.2720607\n27.206073\n2720.6073\n\n\nregion_at_time_of_placement\nNorthern\n9110\n7891\n0.1205340\n12.053401\n1205.3401\n\n\nregion_at_time_of_placement\nToronto\n12602\n11213\n0.1712771\n17.127713\n1712.7713\n\n\nregion_at_time_of_placement\nWestern\n12230\n11183\n0.1708189\n17.081889\n1708.1889\n\n\nregion_most_recent_placement\nCentral\n22577\n19207\n0.2933845\n29.338445\n2933.8445\n\n\nregion_most_recent_placement\nEastern\n20263\n17237\n0.2632930\n26.329296\n2632.9296\n\n\nregion_most_recent_placement\nNorthern\n9080\n7696\n0.1175554\n11.755541\n1175.5541\n\n\nregion_most_recent_placement\nToronto\n12743\n10558\n0.1612721\n16.127209\n1612.7209\n\n\nregion_most_recent_placement\nWestern\n12271\n10769\n0.1644951\n16.449509\n1644.9509\n\n\nsuicide_risk_alert\nNo\n63229\n58447\n0.8927704\n89.277040\n8927.7040\n\n\nsuicide_risk_alert\nYes\n13705\n11328\n0.1730337\n17.303374\n1730.3374\n\n\nsuicide_watch_alert\nNo\n71715\n64433\n0.9842058\n98.420578\n9842.0578\n\n\nsuicide_watch_alert\nYes\n5219\n4921\n0.0751676\n7.516764\n751.6764\n\n\n\n\nknitr::kable(\n  df.counts_ac_year,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df.counts_ac_year`)'\n)\n\n\n(df.counts_ac_year)\n\n\n\n\n\n\n\n\n\n\n\n\nend_fiscal_year\nvariable\nlevel\nf\ncount\np\npct\nrate\n\n\n\n\n2023\nage_category\n18 to 24\n4062\n3507\n0.1687599\n16.875992\n1687.5992\n\n\n2023\nage_category\n25 to 49\n17437\n14930\n0.7184447\n71.844473\n7184.4473\n\n\n2023\nage_category\n50+\n2624\n2344\n0.1127953\n11.279534\n1127.9534\n\n\n2023\ngender\nFemale\n1712\n1511\n0.0727106\n7.271065\n727.1065\n\n\n2023\ngender\nMale\n22411\n19270\n0.9272894\n92.728935\n9272.8935\n\n\n2023\nmental_health_alert\nNo\n17726\n16399\n0.7487786\n74.877859\n7487.7859\n\n\n2023\nmental_health_alert\nYes\n6397\n5502\n0.2512214\n25.122141\n2512.2141\n\n\n2023\nregion_at_time_of_placement\nCentral\n7663\n6784\n0.3174841\n31.748409\n3174.8409\n\n\n2023\nregion_at_time_of_placement\nEastern\n5811\n5079\n0.2376919\n23.769188\n2376.9188\n\n\n2023\nregion_at_time_of_placement\nNorthern\n3422\n3031\n0.1418476\n14.184762\n1418.4762\n\n\n2023\nregion_at_time_of_placement\nToronto\n3455\n2999\n0.1403501\n14.035006\n1403.5006\n\n\n2023\nregion_at_time_of_placement\nWestern\n3772\n3475\n0.1626264\n16.262636\n1626.2636\n\n\n2023\nregion_most_recent_placement\nCentral\n7647\n6581\n0.3166835\n31.668351\n3166.8351\n\n\n2023\nregion_most_recent_placement\nEastern\n5841\n4987\n0.2399788\n23.997883\n2399.7883\n\n\n2023\nregion_most_recent_placement\nNorthern\n3422\n2988\n0.1437852\n14.378519\n1437.8519\n\n\n2023\nregion_most_recent_placement\nToronto\n3425\n2826\n0.1359896\n13.598961\n1359.8961\n\n\n2023\nregion_most_recent_placement\nWestern\n3788\n3399\n0.1635629\n16.356287\n1635.6287\n\n\n2023\nsuicide_risk_alert\nNo\n20380\n18942\n0.8549377\n85.493771\n8549.3771\n\n\n2023\nsuicide_risk_alert\nYes\n3743\n3214\n0.1450623\n14.506229\n1450.6229\n\n\n2023\nsuicide_watch_alert\nNo\n23057\n20621\n0.9531756\n95.317556\n9531.7556\n\n\n2023\nsuicide_watch_alert\nYes\n1066\n1013\n0.0468244\n4.682444\n468.2444\n\n\n2024\nage_category\n18 to 24\n3486\n2944\n0.1498905\n14.989054\n1498.9054\n\n\n2024\nage_category\n25 to 49\n16959\n14445\n0.7354514\n73.545135\n7354.5135\n\n\n2024\nage_category\n50+\n2550\n2252\n0.1146581\n11.465811\n1146.5811\n\n\n2024\ngender\nFemale\n2219\n1924\n0.0979584\n9.795835\n979.5835\n\n\n2024\ngender\nMale\n20776\n17717\n0.9020416\n90.204165\n9020.4165\n\n\n2024\nmental_health_alert\nNo\n16562\n15146\n0.7372469\n73.724688\n7372.4688\n\n\n2024\nmental_health_alert\nYes\n6433\n5398\n0.2627531\n26.275312\n2627.5312\n\n\n2024\nregion_at_time_of_placement\nCentral\n5949\n5228\n0.2569926\n25.699258\n2569.9258\n\n\n2024\nregion_at_time_of_placement\nEastern\n7416\n6569\n0.3229121\n32.291206\n3229.1206\n\n\n2024\nregion_at_time_of_placement\nNorthern\n2852\n2417\n0.1188124\n11.881237\n1188.1237\n\n\n2024\nregion_at_time_of_placement\nToronto\n2874\n2575\n0.1265792\n12.657917\n1265.7917\n\n\n2024\nregion_at_time_of_placement\nWestern\n3904\n3554\n0.1747038\n17.470383\n1747.0383\n\n\n2024\nregion_most_recent_placement\nCentral\n5969\n5035\n0.2563515\n25.635151\n2563.5151\n\n\n2024\nregion_most_recent_placement\nEastern\n7400\n6382\n0.3249325\n32.493254\n3249.3254\n\n\n2024\nregion_most_recent_placement\nNorthern\n2860\n2376\n0.1209714\n12.097144\n1209.7144\n\n\n2024\nregion_most_recent_placement\nToronto\n2896\n2408\n0.1226007\n12.260068\n1226.0068\n\n\n2024\nregion_most_recent_placement\nWestern\n3870\n3440\n0.1751438\n17.514383\n1751.4383\n\n\n2024\nsuicide_risk_alert\nNo\n18616\n17315\n0.8272419\n82.724189\n8272.4189\n\n\n2024\nsuicide_risk_alert\nYes\n4379\n3616\n0.1727581\n17.275811\n1727.5811\n\n\n2024\nsuicide_watch_alert\nNo\n21198\n19259\n0.9190208\n91.902080\n9190.2081\n\n\n2024\nsuicide_watch_alert\nYes\n1797\n1697\n0.0809792\n8.097919\n809.7919\n\n\n2025\nage_category\n18 to 24\n4429\n3688\n0.1472549\n14.725494\n1472.5494\n\n\n2025\nage_category\n25 to 49\n22122\n18482\n0.7379517\n73.795169\n7379.5169\n\n\n2025\nage_category\n50+\n3265\n2875\n0.1147934\n11.479337\n1147.9337\n\n\n2025\ngender\nFemale\n3311\n2821\n0.1126373\n11.263725\n1126.3725\n\n\n2025\ngender\nMale\n26505\n22224\n0.8873627\n88.736275\n8873.6275\n\n\n2025\nmental_health_alert\nNo\n21549\n19355\n0.7411166\n74.111656\n7411.1656\n\n\n2025\nmental_health_alert\nYes\n8267\n6761\n0.2588834\n25.888344\n2588.8344\n\n\n2025\nregion_at_time_of_placement\nCentral\n9031\n8054\n0.3044645\n30.446452\n3044.6452\n\n\n2025\nregion_at_time_of_placement\nEastern\n7122\n6163\n0.2329792\n23.297925\n2329.7925\n\n\n2025\nregion_at_time_of_placement\nNorthern\n2836\n2443\n0.0923525\n9.235247\n923.5247\n\n\n2025\nregion_at_time_of_placement\nToronto\n6273\n5639\n0.2131705\n21.317053\n2131.7053\n\n\n2025\nregion_at_time_of_placement\nWestern\n4554\n4154\n0.1570332\n15.703323\n1570.3323\n\n\n2025\nregion_most_recent_placement\nCentral\n8961\n7591\n0.3030944\n30.309443\n3030.9443\n\n\n2025\nregion_most_recent_placement\nEastern\n7022\n5868\n0.2342983\n23.429826\n2342.9826\n\n\n2025\nregion_most_recent_placement\nNorthern\n2798\n2332\n0.0931124\n9.311240\n931.1240\n\n\n2025\nregion_most_recent_placement\nToronto\n6422\n5324\n0.2125774\n21.257736\n2125.7736\n\n\n2025\nregion_most_recent_placement\nWestern\n4613\n3930\n0.1569175\n15.691755\n1569.1755\n\n\n2025\nsuicide_risk_alert\nNo\n24233\n22190\n0.8314598\n83.145983\n8314.5983\n\n\n2025\nsuicide_risk_alert\nYes\n5583\n4498\n0.1685402\n16.854017\n1685.4017\n\n\n2025\nsuicide_watch_alert\nNo\n27460\n24553\n0.9173890\n91.738903\n9173.8903\n\n\n2025\nsuicide_watch_alert\nYes\n2356\n2211\n0.0826110\n8.261097\n826.1097\n\n\n\n\nlibrary(DoubleML)\nlibrary(mlr3)\nlibrary(mlr3learners)\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(parallel)\nlgr::get_logger(\"mlr3\")$set_threshold(\"warn\")\n# \"regr.lm\" instead of \"regr.ranger\" utilized (disclaimer)\n# \"classif.log_reg\", predict_type = \"prob\" instead of classif.ranger\n# cores &lt;- max(1L, parallel::detectCores() - 1L)\n# yn_cols &lt;- c(\"mental_health_alert\", \"suicide_risk_alert\", \"suicide_watch_alert\")\n# dfn &lt;- dfn %&gt;%\n#   mutate(across(\n#     all_of(yn_cols),\n#     ~ factor(dplyr::if_else(.x == \"Yes\", 1L, 0L), levels = c(0, 1))\n#   ))\n# dt &lt;- as.data.table(dfn)\n# dt[, number_of_placements := as.integer(number_of_placements)]\n# dt &lt;- dt[!is.na(number_of_placements) & number_of_placements &gt; 0L]\n# N_expanded &lt;- sum(dt$number_of_placements)\n# message(\"Expanded N = \", format(N_expanded, big.mark = \",\"))\n# dt &lt;- dt[rep.int(seq_len(.N), number_of_placements)]\n# dt[, Y := as.integer(suicide_risk_alert) - 1L]\n# dt[, D := as.integer(mental_health_alert) - 1L]\n# stopifnot(identical(sort(unique(dt$D)), c(0L, 1L)))\n# dt[, cluster_id := as.factor(unique_individual_id)]\n# ml_g &lt;- lrn(\"regr.lm\")\n# ml_m &lt;- lrn(\"classif.log_reg\", predict_type = \"prob\")\n# fit_irm_ate_atte &lt;- function(dsub, x_cols, tag) {\n#   dml_data &lt;- DoubleMLClusterData$new(\n#     data = dsub,\n#     y_col = \"Y\",\n#     d_cols = \"D\",\n#     x_cols = x_cols,\n#     cluster_cols = \"cluster_id\"\n#   )\n#   set.seed(1111111111)\n#   obj_ate &lt;- DoubleMLIRM$new(\n#     dml_data,\n#     ml_g = ml_g,\n#     ml_m = ml_m,\n#     n_folds = 3,\n#     n_rep = 1,\n#     score = \"ATE\"\n#   )\n#   obj_ate$fit()\n#   set.seed(1111111111)\n#   obj_atte &lt;- DoubleMLIRM$new(\n#     dml_data,\n#     ml_g = ml_g,\n#     ml_m = ml_m,\n#     n_folds = 3,\n#     n_rep = 1,\n#     score = \"ATTE\"\n#   )\n#   obj_atte$fit()\n#   mk &lt;- function(obj, estimand) {\n#     ci &lt;- obj$confint(level = 0.95)\n#     data.table(\n#       group = tag,\n#       estimand = estimand,\n#       effect = as.numeric(obj$coef),\n#       se = as.numeric(obj$se),\n#       t_value = as.numeric(obj$t_stat),\n#       p_value = as.numeric(obj$pval),\n#       ci_low = as.numeric(ci[1, 1]),\n#       ci_high = as.numeric(ci[1, 2])\n#     )\n#   }\n#   rbind(mk(obj_ate, \"ATE\"), mk(obj_atte, \"ATTE\"))\n# }\n# x_cols_pool &lt;- c(\n#   \"gender\",\n#   \"age_category\",\n#   \"region_at_time_of_placement\",\n#   \"region_most_recent_placement\",\n#   \"end_fiscal_year\"\n# )\n# dt[, (x_cols_pool) := lapply(.SD, as.factor), .SDcols = x_cols_pool]\n# keep_pool &lt;- complete.cases(dt[,\n#   c(\"Y\", \"D\", \"cluster_id\", x_cols_pool),\n#   with = FALSE\n# ])\n# dsub_pool &lt;- dt[keep_pool, c(\"Y\", \"D\", \"cluster_id\", x_cols_pool), with = FALSE]\n# res_pool &lt;- fit_irm_ate_atte(dsub_pool, x_cols_pool, tag = \"Pooled 2023-25\")\n# years &lt;- sort(unique(dt$end_fiscal_year))\n# x_cols_year &lt;- c(\n#   \"gender\",\n#   \"age_category\",\n#   \"region_at_time_of_placement\",\n#   \"region_most_recent_placement\"\n# )\n# res_by_year &lt;- rbindlist(lapply(years, function(yy) {\n#   sub &lt;- dt[end_fiscal_year == yy]\n#   sub[, (x_cols_year) := lapply(.SD, as.factor), .SDcols = x_cols_year]\n#   keep_y &lt;- complete.cases(sub[,\n#     c(\"Y\", \"D\", \"cluster_id\", x_cols_year),\n#     with = FALSE\n#   ])\n#   dsub_y &lt;- sub[keep_y, c(\"Y\", \"D\", \"cluster_id\", x_cols_year), with = FALSE]\n#   fit_irm_ate_atte(dsub_y, x_cols_year, tag = as.character(yy))\n# }))\n\nsetHook(packageEvent(\"graphics\", \"onLoad\"), function(...) par(ask = FALSE))\nsetnames(\n  dataframe_original,\n  old = c(\n    \"x1a\",\n    \"unique_individual_id\",\n    \"x1b\",\n    \"x1c\",\n    \"x1d\",\n    \"x1f\",\n    \"x1g\",\n    \"x1h\",\n    \"x1i\"\n  ),\n  new = c(\"year\", \"id\", \"regA\", \"regB\", \"sex\", \"binA\", \"binB\", \"binC\", \"np\")\n)\n\ndt1b &lt;- as.data.table(dataframe_original)\nplacement_dist &lt;- dt1b[,\n  .(\n    total_placements = sum(np),\n    unique_status_rows = .N\n  ),\n  by = .(id, year)\n]\n\nsummary_report &lt;- placement_dist[,\n  .(\n    total_unique_people = .N,\n    avg_placements_per_person = mean(total_placements),\n    median_placements = median(total_placements),\n    max_placements = max(total_placements),\n    avg_status_changes = mean(unique_status_rows),\n    max_status_changes = max(unique_status_rows)\n  ),\n  by = year\n][order(year)]\n\n# Summary of Placement Distribution by Year\nknitr::kable(\n  summary_report,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`summary_report`)'\n)\n\n\n(summary_report)\n\n\n\n\n\n\n\n\n\n\n\nyear\ntotal_unique_people\navg_placements_per_person\nmedian_placements\nmax_placements\navg_status_changes\nmax_status_changes\n\n\n\n\n2023\n20781\n21.25749\n10\n362\n1.160820\n7\n\n\n2024\n19641\n27.88183\n8\n366\n1.170765\n8\n\n\n2025\n25045\n37.69008\n8\n364\n1.190497\n8\n\n\n\n\n# Frequency of Status Combinations per Person\nas.data.frame(table(placement_dist$unique_status_rows))\n\n  Var1  Freq\n1    1 56367\n2    2  7300\n3    3  1397\n4    4   286\n5    5    83\n6    6    25\n7    7     5\n8    8     4\n\nplacement_rows &lt;- as.data.frame(table(placement_dist$unique_status_rows))\nknitr::kable(\n  placement_rows,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`placement_rows`)'\n)\n\n\n(placement_rows)\n\n\nVar1\nFreq\n\n\n\n\n1\n56367\n\n\n2\n7300\n\n\n3\n1397\n\n\n4\n286\n\n\n5\n83\n\n\n6\n25\n\n\n7\n5\n\n\n8\n4\n\n\n\n\ntop_rows &lt;- placement_dist[order(-unique_status_rows)][1:10]\nknitr::kable(\n  top_rows,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`top_rows`)'\n)\n\n\n(top_rows)\n\n\nid\nyear\ntotal_placements\nunique_status_rows\n\n\n\n\n2024-09049-RC\n2024\n91\n8\n\n\n2025-01080-RC\n2025\n83\n8\n\n\n2025-10704-RC\n2025\n181\n8\n\n\n2025-11914-RC\n2025\n122\n8\n\n\n2023-06822-RC\n2023\n94\n7\n\n\n2023-15226-RC\n2023\n30\n7\n\n\n2024-03863-RC\n2024\n27\n7\n\n\n2025-18531-RC\n2025\n108\n7\n\n\n2025-20049-RC\n2025\n83\n7\n\n\n2023-03600-RC\n2023\n48\n6\n\n\n\n\nrow_counts_summary &lt;- placement_dist[,\n  .(count_of_people = .N),\n  by = unique_status_rows\n][order(unique_status_rows)]\n# how many people have 1, 2,...n rows ?:!\nknitr::kable(\n  row_counts_summary,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`row_counts_summary`)'\n)\n\n\n(row_counts_summary)\n\n\nunique_status_rows\ncount_of_people\n\n\n\n\n1\n56367\n\n\n2\n7300\n\n\n3\n1397\n\n\n4\n286\n\n\n5\n83\n\n\n6\n25\n\n\n7\n5\n\n\n8\n4\n\n\n\n\nsetnames(dt1b, \"x1e\", \"age\")\nbin_cols &lt;- c(\"binA\", \"binB\", \"binC\")\ndt1b[,\n  (bin_cols) := lapply(.SD, function(x) ifelse(x == \"Yes\", 1L, 0L)),\n  .SDcols = bin_cols\n]\ndt1b[age == \"18 to 24\", `:=`(age_num = 21, age_order = 1L)]\ndt1b[age == \"25 to 49\", `:=`(age_num = 42, age_order = 2L)]\ndt1b[age == \"50+\", `:=`(age_num = 57.5, age_order = 3L)]\ndt1b[,\n  age_factor := factor(\n    age,\n    levels = c(\"A\", \"B\", \"C\"),\n    ordered = TRUE\n  )\n]\ncat_cols &lt;- c(\"regA\", \"regB\", \"sex\")\ndt1b[, (cat_cols) := lapply(.SD, as.factor), .SDcols = cat_cols]\n\ndt1b[, a1 := as.integer(binA == 1 & binB == 0 & binC == 0)] # 1,0,0\ndt1b[, a2 := as.integer(binA == 0 & binB == 1 & binC == 0)] # 0,1,0\ndt1b[, a3 := as.integer(binA == 0 & binB == 0 & binC == 1)] # 0,0,1\ndt1b[, a4 := as.integer(binA == 1 & binB == 1 & binC == 0)] # 1,1,0\ndt1b[, a5 := as.integer(binA == 0 & binB == 1 & binC == 1)] # 0,1,1\ndt1b[, a6 := as.integer(binA == 1 & binB == 0 & binC == 1)] # 1,0,1\ndt1b[, a7 := as.integer(binA == 1 & binB == 1 & binC == 1)] # 1,1,1\ndt1b[, a8 := as.integer(binA == 0 & binB == 0 & binC == 0)] # 0,0,0\n\ndt_unbiased &lt;- dt1b[,\n  .(\n    a1 = sum(a1 * np),\n    a2 = sum(a2 * np),\n    a3 = sum(a3 * np),\n    a4 = sum(a4 * np),\n    a5 = sum(a5 * np),\n    a6 = sum(a6 * np),\n    a7 = sum(a7 * np),\n    a8 = sum(a8 * np),\n    Y = sum(binB * np) / sum(np),\n    D = sum(binA * np) / sum(np),\n    total_np = sum(np),\n    age_val = first(age_num),\n    sex = first(sex),\n    regA = first(regA)\n  ),\n  by = .(id, year)\n]\n\nstate_cols &lt;- paste0(\"a\", 1:8)\ndt_unbiased[, combo_count := rowSums(.SD &gt; 0), .SDcols = state_cols]\ndt_8 &lt;- dt_unbiased[combo_count == 8]\ndt_7 &lt;- dt_unbiased[combo_count == 7]\ndt_6 &lt;- dt_unbiased[combo_count == 6]\ndt_5 &lt;- dt_unbiased[combo_count == 5]\ndt_4 &lt;- dt_unbiased[combo_count == 4]\ndt_3 &lt;- dt_unbiased[combo_count == 3]\ndt_2 &lt;- dt_unbiased[combo_count == 2]\ndt_1 &lt;- dt_unbiased[combo_count == 1]\ndt_2plus &lt;- dt_unbiased[combo_count &gt;= 2]\n\nsubset_summary &lt;- dt_unbiased[, .(n_persons = .N), by = combo_count][order(\n  -combo_count\n)]\nknitr::kable(\n  subset_summary,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`subset_summary`)'\n)\n\n\n(subset_summary)\n\n\ncombo_count\nn_persons\n\n\n\n\n6\n12\n\n\n5\n35\n\n\n4\n163\n\n\n3\n1092\n\n\n2\n5958\n\n\n1\n58207\n\n\n\n\nprint(paste(\n  \"Number of rows with NA combo_count:\",\n  sum(is.na(dt_unbiased$combo_count))\n))\n\n[1] \"Number of rows with NA combo_count: 0\"\n\nalert_stats &lt;- summary(dt_unbiased[, .(a1, a2, a3, a4, a5, a6, a7, a8)])\nknitr::kable(\n  alert_stats,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`alert_stats`)'\n)\n\n\n(alert_stats)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\na1\na2\na3\na4\na5\na6\na7\na8\n\n\n\n\n\nMin. : 0.000\nMin. : 0.000\nMin. :0\nMin. : 0.000\nMin. : 0.0000\nMin. :0\nMin. : 0.0000\nMin. : 0.00\n\n\n\n1st Qu.: 0.000\n1st Qu.: 0.000\n1st Qu.:0\n1st Qu.: 0.000\n1st Qu.: 0.0000\n1st Qu.:0\n1st Qu.: 0.0000\n1st Qu.: 0.00\n\n\n\nMedian : 0.000\nMedian : 0.000\nMedian :0\nMedian : 0.000\nMedian : 0.0000\nMedian :0\nMedian : 0.0000\nMedian : 3.00\n\n\n\nMean : 6.995\nMean : 1.294\nMean :0\nMean : 1.841\nMean : 0.3006\nMean :0\nMean : 0.3485\nMean : 18.75\n\n\n\n3rd Qu.: 0.000\n3rd Qu.: 0.000\n3rd Qu.:0\n3rd Qu.: 0.000\n3rd Qu.: 0.0000\n3rd Qu.:0\n3rd Qu.: 0.0000\n3rd Qu.: 14.00\n\n\n\nMax. :364.000\nMax. :357.000\nMax. :0\nMax. :364.000\nMax. :340.0000\nMax. :0\nMax. :293.0000\nMax. :366.00\n\n\n\n\ndt_unbiased[,\n  combo_count_robust := rowSums(.SD &gt; 0, na.rm = TRUE),\n  .SDcols = state_cols\n]\n\nalert_stats1a &lt;- as.data.frame(table(dt_unbiased$combo_count_robust)) \n\n# Then pass it to kable\nknitr::kable(\n  alert_stats1a,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`alert_stats1a`)'\n)\n\n\n(alert_stats1a)\n\n\nVar1\nFreq\n\n\n\n\n1\n58207\n\n\n2\n5958\n\n\n3\n1092\n\n\n4\n163\n\n\n5\n35\n\n\n6\n12\n\n\n\n\ntop_ids &lt;- placement_dist[unique_status_rows &gt;= 7, id]\ncomplex_moves &lt;- dt_unbiased[id %in% top_ids]\nprint(complex_moves[, .(id, combo_count, total_np, a1, a2, a4, a5, a7, a8)])\n\n              id combo_count total_np    a1    a2    a4    a5    a7    a8\n          &lt;char&gt;       &lt;num&gt;    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n1: 2023-06822-RC           5       94     9    27     1    12     0    45\n2: 2023-15226-RC           4       30    20     0     0     3     1     6\n3: 2024-03863-RC           3       27    10     0     0     1     0    16\n4: 2024-09049-RC           4       91    40     0     2     0     4    45\n5: 2025-01080-RC           6       83    12    20     3     4    39     5\n6: 2025-10704-RC           3      181     0     8     0     5     0   168\n7: 2025-11914-RC           6      122    35     2     3    10    32    40\n8: 2025-18531-RC           3      108     0     2     0     4     0   102\n9: 2025-20049-RC           5       83    20     0    31     2     6    24\n\nknitr::kable(\n  complex_moves[, .(id, combo_count, total_np, a1, a2, a4, a5, a7, a8)],\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_moves`)'\n)\n\n\n(complex_moves)\n\n\nid\ncombo_count\ntotal_np\na1\na2\na4\na5\na7\na8\n\n\n\n\n2023-06822-RC\n5\n94\n9\n27\n1\n12\n0\n45\n\n\n2023-15226-RC\n4\n30\n20\n0\n0\n3\n1\n6\n\n\n2024-03863-RC\n3\n27\n10\n0\n0\n1\n0\n16\n\n\n2024-09049-RC\n4\n91\n40\n0\n2\n0\n4\n45\n\n\n2025-01080-RC\n6\n83\n12\n20\n3\n4\n39\n5\n\n\n2025-10704-RC\n3\n181\n0\n8\n0\n5\n0\n168\n\n\n2025-11914-RC\n6\n122\n35\n2\n3\n10\n32\n40\n\n\n2025-18531-RC\n3\n108\n0\n2\n0\n4\n0\n102\n\n\n2025-20049-RC\n5\n83\n20\n0\n31\n2\n6\n24\n\n\n\n\nregion_profile &lt;- dcast(\n  dt1b[id %in% top_ids],\n  id + year ~ regA,\n  value.var = \"np\",\n  fun.aggregate = sum\n)\n\ncomplex_subset &lt;- merge(\n  dt_unbiased[\n    id %in% top_ids,\n    .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)\n  ],\n  region_profile,\n  by = c(\"id\", \"year\")\n)\nknitr::kable(\n  complex_subset,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_subset`)'\n)\n\n\n(complex_subset)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nyear\ncombo_count\ntotal_np\na1\na2\na4\na5\na7\na8\nCentral\nEastern\nToronto\nWestern\n\n\n\n\n2023-06822-RC\n2023\n5\n94\n9\n27\n1\n12\n0\n45\n0\n49\n45\n0\n\n\n2023-15226-RC\n2023\n4\n30\n20\n0\n0\n3\n1\n6\n25\n2\n3\n0\n\n\n2024-03863-RC\n2024\n3\n27\n10\n0\n0\n1\n0\n16\n4\n6\n15\n2\n\n\n2024-09049-RC\n2024\n4\n91\n40\n0\n2\n0\n4\n45\n19\n18\n47\n7\n\n\n2025-01080-RC\n2025\n6\n83\n12\n20\n3\n4\n39\n5\n7\n64\n12\n0\n\n\n2025-10704-RC\n2025\n3\n181\n0\n8\n0\n5\n0\n168\n29\n0\n137\n15\n\n\n2025-11914-RC\n2025\n6\n122\n35\n2\n3\n10\n32\n40\n24\n98\n0\n0\n\n\n2025-18531-RC\n2025\n3\n108\n0\n2\n0\n4\n0\n102\n81\n17\n3\n7\n\n\n2025-20049-RC\n2025\n5\n83\n20\n0\n31\n2\n6\n24\n36\n0\n47\n0\n\n\n\n\ndt_complex_raw &lt;- dt1b[id %in% top_ids]\nregA_counts &lt;- dcast(\n  dt_complex_raw,\n  id + year ~ regA,\n  value.var = \"np\",\n  fun.aggregate = sum\n)\nsetnames(\n  regA_counts,\n  old = setdiff(names(regA_counts), c(\"id\", \"year\")),\n  new = paste0(setdiff(names(regA_counts), c(\"id\", \"year\")), \"_A\")\n)\n\nregB_counts &lt;- dcast(\n  dt_complex_raw,\n  id + year ~ regB,\n  value.var = \"np\",\n  fun.aggregate = sum\n)\nsetnames(\n  regB_counts,\n  old = setdiff(names(regB_counts), c(\"id\", \"year\")),\n  new = paste0(setdiff(names(regB_counts), c(\"id\", \"year\")), \"_B\")\n)\n\ncomplex_subset &lt;- merge(\n  dt_unbiased[\n    id %in% top_ids,\n    .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)\n  ],\n  regA_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\ncomplex_subset &lt;- merge(\n  complex_subset,\n  regB_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\n\ncomplex_subset[is.na(complex_subset)] &lt;- as.double(0)\n\nknitr::kable(\n  complex_subset,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_subset`)'\n)\n\n\n(complex_subset)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nyear\ncombo_count\ntotal_np\na1\na2\na4\na5\na7\na8\nCentral_A\nEastern_A\nToronto_A\nWestern_A\nEastern_B\nToronto_B\nWestern_B\n\n\n\n\n2023-06822-RC\n2023\n5\n94\n9\n27\n1\n12\n0\n45\n0\n49\n45\n0\n94\n0\n0\n\n\n2023-15226-RC\n2023\n4\n30\n20\n0\n0\n3\n1\n6\n25\n2\n3\n0\n0\n30\n0\n\n\n2024-03863-RC\n2024\n3\n27\n10\n0\n0\n1\n0\n16\n4\n6\n15\n2\n27\n0\n0\n\n\n2024-09049-RC\n2024\n4\n91\n40\n0\n2\n0\n4\n45\n19\n18\n47\n7\n0\n91\n0\n\n\n2025-01080-RC\n2025\n6\n83\n12\n20\n3\n4\n39\n5\n7\n64\n12\n0\n0\n83\n0\n\n\n2025-10704-RC\n2025\n3\n181\n0\n8\n0\n5\n0\n168\n29\n0\n137\n15\n0\n0\n181\n\n\n2025-11914-RC\n2025\n6\n122\n35\n2\n3\n10\n32\n40\n24\n98\n0\n0\n122\n0\n0\n\n\n2025-18531-RC\n2025\n3\n108\n0\n2\n0\n4\n0\n102\n81\n17\n3\n7\n0\n108\n0\n\n\n2025-20049-RC\n2025\n5\n83\n20\n0\n31\n2\n6\n24\n36\n0\n47\n0\n0\n83\n0\n\n\n\n\nall_regions &lt;- c(\"Toronto\", \"Central\", \"Eastern\", \"Western\", \"Northern\")\ndt_complex_raw &lt;- dt1b[id %in% top_ids]\ndt_complex_raw[, regA := factor(regA, levels = all_regions)]\ndt_complex_raw[, regB := factor(regB, levels = all_regions)]\n\nregA_counts &lt;- dcast(\n  dt_complex_raw,\n  id + year ~ regA,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  drop = FALSE\n)\n\nsetnames(regA_counts, old = all_regions, new = paste0(all_regions, \"_A\"))\n\nregB_counts &lt;- dcast(\n  dt_complex_raw,\n  id + year ~ regB,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  drop = FALSE\n)\n\nsetnames(regB_counts, old = all_regions, new = paste0(all_regions, \"_B\"))\n\ncomplex_subset &lt;- dt_unbiased[\n  id %in% top_ids,\n  .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)\n]\n\ncomplex_subset &lt;- merge(\n  complex_subset,\n  regA_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\ncomplex_subset &lt;- merge(\n  complex_subset,\n  regB_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\n\ncols_to_fix &lt;- c(paste0(all_regions, \"_A\"), paste0(all_regions, \"_B\"))\ncomplex_subset[,\n  (cols_to_fix) := lapply(.SD, function(x) ifelse(is.na(x), 0, x)),\n  .SDcols = cols_to_fix\n]\n\n# Complex Cases (10 Regional Columns + Possible Alert Status Combinations)\nknitr::kable(\n  complex_subset,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_subset`)'\n)\n\n\n(complex_subset)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nyear\ncombo_count\ntotal_np\na1\na2\na4\na5\na7\na8\nToronto_A\nCentral_A\nEastern_A\nWestern_A\nNorthern_A\nToronto_B\nCentral_B\nEastern_B\nWestern_B\nNorthern_B\n\n\n\n\n2023-06822-RC\n2023\n5\n94\n9\n27\n1\n12\n0\n45\n45\n0\n49\n0\n0\n0\n0\n94\n0\n0\n\n\n2023-15226-RC\n2023\n4\n30\n20\n0\n0\n3\n1\n6\n3\n25\n2\n0\n0\n30\n0\n0\n0\n0\n\n\n2024-03863-RC\n2024\n3\n27\n10\n0\n0\n1\n0\n16\n15\n4\n6\n2\n0\n0\n0\n27\n0\n0\n\n\n2024-09049-RC\n2024\n4\n91\n40\n0\n2\n0\n4\n45\n47\n19\n18\n7\n0\n91\n0\n0\n0\n0\n\n\n2025-01080-RC\n2025\n6\n83\n12\n20\n3\n4\n39\n5\n12\n7\n64\n0\n0\n83\n0\n0\n0\n0\n\n\n2025-10704-RC\n2025\n3\n181\n0\n8\n0\n5\n0\n168\n137\n29\n0\n15\n0\n0\n0\n0\n181\n0\n\n\n2025-11914-RC\n2025\n6\n122\n35\n2\n3\n10\n32\n40\n0\n24\n98\n0\n0\n0\n0\n122\n0\n0\n\n\n2025-18531-RC\n2025\n3\n108\n0\n2\n0\n4\n0\n102\n3\n81\n17\n7\n0\n108\n0\n0\n0\n0\n\n\n2025-20049-RC\n2025\n5\n83\n20\n0\n31\n2\n6\n24\n47\n36\n0\n0\n0\n83\n0\n0\n0\n0\n\n\n\n\ndt_moves_corrected &lt;- dt1b[\n  order(id, year),\n  .(\n    id,\n    year,\n    internal_move = as.integer(regA != regB),\n    external_move = as.integer(regA != shift(regA, type = \"lag\"))\n  ),\n  by = .(id, year)\n]\nregional_volatility &lt;- dt_moves_corrected[,\n  .(\n    total_regional_changes = sum(\n      internal_move == 1 | (external_move == 1 & !is.na(external_move))\n    )\n  ),\n  by = .(id, year)\n]\ndt_unbiased &lt;- merge(\n  dt_unbiased,\n  regional_volatility,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\nmove_summary &lt;- dt_unbiased[,\n  .(n_persons = .N),\n  by = total_regional_changes\n][order(total_regional_changes)]\nprint(move_summary)\n\n   total_regional_changes n_persons\n                    &lt;int&gt;     &lt;int&gt;\n1:                      0     62901\n2:                      1       362\n3:                      2      1800\n4:                      3       315\n5:                      4        64\n6:                      5        18\n7:                      6         2\n8:                      7         4\n9:                      8         1\n\nregion_counts_per_id &lt;- dt1b[,\n  .(\n    unique_regions = list(unique(c(regA, regB)))\n  ),\n  by = .(id, year)\n]\nregion_counts_per_id[, n_regions := sapply(unique_regions, length)]\nmulti_region_ids &lt;- region_counts_per_id[n_regions &gt; 1]\ntotal_multi_region_persons &lt;- nrow(multi_region_ids)\ntotal_unique_persons &lt;- nrow(region_counts_per_id)\n\nprint(paste(\"Total Unique Person-IDs in dataset:\", total_unique_persons))\n\n[1] \"Total Unique Person-IDs in dataset: 65467\"\n\nprint(paste(\"Number of Person-IDs with &gt;1 region:\", total_multi_region_persons))\n\n[1] \"Number of Person-IDs with &gt;1 region: 2566\"\n\nprint(paste(\n  \"Percentage of population moving regions:\",\n  round((total_multi_region_persons / total_unique_persons) * 100, 2),\n  \"%\"\n))\n\n[1] \"Percentage of population moving regions: 3.92 %\"\n\nreg_count_id &lt;- table(region_counts_per_id$n_regions)\nknitr::kable(\n  reg_count_id,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`reg_count_id`)'\n)\n\n\n(reg_count_id)\n\n\nVar1\nFreq\n\n\n\n\n1\n62901\n\n\n2\n2425\n\n\n3\n137\n\n\n4\n4\n\n\n\n\ndt1b[,\n  status_combo := case_when(\n    binA == 1 & binB == 0 & binC == 0 ~ \"a1\",\n    binA == 0 & binB == 1 & binC == 0 ~ \"a2\",\n    binA == 0 & binB == 0 & binC == 1 ~ \"a3\",\n    binA == 1 & binB == 1 & binC == 0 ~ \"a4\",\n    binA == 0 & binB == 1 & binC == 1 ~ \"a5\",\n    binA == 1 & binB == 0 & binC == 1 ~ \"a6\",\n    binA == 1 & binB == 1 & binC == 1 ~ \"a7\",\n    binA == 0 & binB == 0 & binC == 0 ~ \"a8\"\n  )\n]\n\ndt1b[, reg_status_key := paste0(regA, \"_\", status_combo)]\ndt_40state &lt;- dcast(\n  dt1b,\n  id + year + sex + age_num + age_order ~ reg_status_key,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  fill = 0\n)\n\nprint(paste(\"Number of columns in the new state-space:\", ncol(dt_40state)))\n\n[1] \"Number of columns in the new state-space: 35\"\n\nhead(dt_40state)\n\nKey: &lt;id, year, sex, age_num, age_order&gt;\n              id  year    sex age_num age_order Central_a1 Central_a2\n          &lt;char&gt; &lt;num&gt; &lt;fctr&gt;   &lt;num&gt;     &lt;int&gt;      &lt;num&gt;      &lt;num&gt;\n1: 2023-00001-RC  2023   Male    42.0         2          0          0\n2: 2023-00002-RC  2023   Male    57.5         3          0          0\n3: 2023-00003-RC  2023   Male    42.0         2          0          0\n4: 2023-00004-RC  2023   Male    42.0         2          0          0\n5: 2023-00005-RC  2023   Male    57.5         3          0          0\n6: 2023-00006-RC  2023   Male    57.5         3          0          0\n   Central_a4 Central_a5 Central_a7 Central_a8 Eastern_a1 Eastern_a2 Eastern_a4\n        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1:          0          0          0          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          0          9\n4:          0          0          0          0          0          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Eastern_a5 Eastern_a7 Eastern_a8 Northern_a1 Northern_a2 Northern_a4\n        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;\n1:          0          0          0           0           0           0\n2:          0          0          0           0           0           0\n3:          0          0          0           0           0           0\n4:          0          0          0           0           0           0\n5:          0          0          8           0           0           0\n6:          0          0          8           0           0           0\n   Northern_a5 Northern_a7 Northern_a8 Toronto_a1 Toronto_a2 Toronto_a4\n         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1:           0           0           0          0          8          0\n2:           0           0          20          0          0          0\n3:           0           0           0          0          0          0\n4:           0           0           0          0          0          0\n5:           0           0           0          0          0          0\n6:           0           0           0          0          0          0\n   Toronto_a5 Toronto_a7 Toronto_a8 Western_a1 Western_a2 Western_a4 Western_a5\n        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1:          0          0         26          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          0          0\n4:          0          0          0          0         11          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Western_a7 Western_a8\n        &lt;num&gt;      &lt;num&gt;\n1:          0          0\n2:          0          0\n3:          0          0\n4:          0          0\n5:          0          0\n6:          0          0\n\nstate_totals &lt;- colSums(dt_40state[, .SD, .SDcols = patterns(\"_a[1-8]\")])\n\nstate_summary &lt;- data.table(\n  state = names(state_totals),\n  total_placements = state_totals\n)[order(-total_placements)]\n\nprint(\"Top Ten Empirical Region-Status combinations:\")\n\n[1] \"Top Ten Empirical Region-Status combinations:\"\n\nprint(head(state_summary, 10))\n\n          state total_placements\n         &lt;char&gt;            &lt;num&gt;\n 1:  Central_a8           440242\n 2:  Eastern_a8           421376\n 3:  Toronto_a8           197025\n 4:  Eastern_a1           196748\n 5:  Central_a1           105275\n 6:  Western_a8            94102\n 7:  Toronto_a1            93729\n 8: Northern_a8            74921\n 9:  Eastern_a4            55094\n10:  Western_a1            36830\n\nid_counts &lt;- dt_40state[,\n  lapply(.SD, function(x) sum(x &gt; 0)),\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nid_counts_t &lt;- data.table(\n  state = names(id_counts),\n  count_of_people = as.numeric(id_counts)\n)[order(-count_of_people)]\n\nprint(\"Number of unique individuals who entered each state:\")\n\n[1] \"Number of unique individuals who entered each state:\"\n\nprint(id_counts_t)\n\n          state count_of_people\n         &lt;char&gt;           &lt;num&gt;\n 1:  Central_a8           15267\n 2:  Eastern_a8           12161\n 3:  Toronto_a8            8670\n 4:  Western_a8            7473\n 5: Northern_a8            5344\n 6:  Eastern_a1            4449\n 7:  Central_a1            3818\n 8:  Toronto_a1            2453\n 9:  Western_a1            2335\n10:  Eastern_a4            1283\n11: Northern_a1            1259\n12:  Eastern_a2            1177\n13: Northern_a2            1035\n14:  Central_a5            1023\n15:  Central_a4             921\n16:  Western_a4             919\n17:  Central_a7             870\n18: Northern_a4             788\n19:  Central_a2             744\n20:  Eastern_a5             695\n21:  Western_a2             655\n22:  Eastern_a7             584\n23:  Toronto_a2             498\n24:  Toronto_a4             466\n25:  Western_a5             438\n26:  Western_a7             410\n27: Northern_a5             363\n28: Northern_a7             321\n29:  Toronto_a5             294\n30:  Toronto_a7             221\n          state count_of_people\n         &lt;char&gt;           &lt;num&gt;\n\ndt_40state[, states_visited := rowSums(.SD &gt; 0), .SDcols = patterns(\"_a[1-8]\")]\n\ncomplexity_dist &lt;- dt_40state[, .(n_people = .N), by = states_visited][order(\n  states_visited\n)]\n\nprint(\"How many unique Region-Status states did people visit?\")\n\n[1] \"How many unique Region-Status states did people visit?\"\n\nprint(complexity_dist)\n\n   states_visited n_people\n            &lt;num&gt;    &lt;int&gt;\n1:              1    56367\n2:              2     7300\n3:              3     1397\n4:              4      286\n5:              5       83\n6:              6       25\n7:              7        5\n8:              8        4\n\ndt1b[,\n  status_combo := case_when(\n    binA == 1 & binB == 0 & binC == 0 ~ \"a1\",\n    binA == 0 & binB == 1 & binC == 0 ~ \"a2\",\n    binA == 0 & binB == 0 & binC == 1 ~ \"a3\",\n    binA == 1 & binB == 1 & binC == 0 ~ \"a4\",\n    binA == 0 & binB == 1 & binC == 1 ~ \"a5\",\n    binA == 1 & binB == 0 & binC == 1 ~ \"a6\",\n    binA == 1 & binB == 1 & binC == 1 ~ \"a7\",\n    binA == 0 & binB == 0 & binC == 0 ~ \"a8\"\n  )\n]\n\ndt1b[, reg_status_key := paste0(regA, \"_\", status_combo)]\ndt_40state_yearly &lt;- dcast(\n  dt1b,\n  id + year + sex + age_num ~ reg_status_key,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  fill = 0\n)\n\nyearly_stats &lt;- dt_40state_yearly[,\n  .(\n    unique_ids = uniqueN(id),\n    total_placements = sum(.SD, na.rm = TRUE)\n  ),\n  by = year,\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nprint(yearly_stats)\n\n    year unique_ids total_placements\n   &lt;num&gt;      &lt;int&gt;            &lt;num&gt;\n1:  2023      20781           441752\n2:  2024      19641           547627\n3:  2025      25045           943948\n\nsplit_summary &lt;- dt_40state_yearly[,\n  lapply(.SD, sum),\n  by = year,\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nprint(\"First few rows of 2023 data:\")\n\n[1] \"First few rows of 2023 data:\"\n\nhead(dt_40state_yearly[year == 2023])\n\nKey: &lt;id, year, sex, age_num&gt;\n              id  year    sex age_num Central_a1 Central_a2 Central_a4\n          &lt;char&gt; &lt;num&gt; &lt;fctr&gt;   &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1: 2023-00001-RC  2023   Male    42.0          0          0          0\n2: 2023-00002-RC  2023   Male    57.5          0          0          0\n3: 2023-00003-RC  2023   Male    42.0          0          0          0\n4: 2023-00004-RC  2023   Male    42.0          0          0          0\n5: 2023-00005-RC  2023   Male    57.5          0          0          0\n6: 2023-00006-RC  2023   Male    57.5          0          0          0\n   Central_a5 Central_a7 Central_a8 Eastern_a1 Eastern_a2 Eastern_a4 Eastern_a5\n        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1:          0          0          0          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          9          0\n4:          0          0          0          0          0          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Eastern_a7 Eastern_a8 Northern_a1 Northern_a2 Northern_a4 Northern_a5\n        &lt;num&gt;      &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;\n1:          0          0           0           0           0           0\n2:          0          0           0           0           0           0\n3:          0          0           0           0           0           0\n4:          0          0           0           0           0           0\n5:          0          8           0           0           0           0\n6:          0          8           0           0           0           0\n   Northern_a7 Northern_a8 Toronto_a1 Toronto_a2 Toronto_a4 Toronto_a5\n         &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1:           0           0          0          8          0          0\n2:           0          20          0          0          0          0\n3:           0           0          0          0          0          0\n4:           0           0          0          0          0          0\n5:           0           0          0          0          0          0\n6:           0           0          0          0          0          0\n   Toronto_a7 Toronto_a8 Western_a1 Western_a2 Western_a4 Western_a5 Western_a7\n        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;\n1:          0         26          0          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          0          0\n4:          0          0          0         11          0          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Western_a8\n        &lt;num&gt;\n1:          0\n2:          0\n3:          0\n4:          0\n5:          0\n6:          0\n\ndt_40state_yearly[,\n  combinations_this_year := rowSums(.SD &gt; 0),\n  .SDcols = patterns(\"_a[1-8]\")\n]\ntable(dt_40state_yearly$year, dt_40state_yearly$combinations_this_year)\n\n      \n           1     2     3     4     5     6     7     8\n  2023 18098  2175   394    85    23     4     2     0\n  2024 16992  2120   404    88    26     9     1     1\n  2025 21277  3005   599   113    34    12     2     3\n\nid_counts_yearly &lt;- dt_40state_yearly[,\n  lapply(.SD, function(x) sum(x &gt; 0)),\n  by = year,\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nid_counts_long &lt;- melt(\n  id_counts_yearly,\n  id.vars = \"year\",\n  variable.name = \"state\",\n  value.name = \"person_count\"\n)\n\nid_counts_long &lt;- id_counts_long[order(year, -person_count)]\nprint(\"Top 5 most frequent Region-Status states per year:\")\n\n[1] \"Top 5 most frequent Region-Status states per year:\"\n\nprint(id_counts_long[, head(.SD, 5), by = year])\n\n     year       state person_count\n    &lt;num&gt;      &lt;fctr&gt;        &lt;int&gt;\n 1:  2023  Central_a8         5473\n 2:  2023  Eastern_a8         3336\n 3:  2023  Western_a8         2464\n 4:  2023  Toronto_a8         2265\n 5:  2023 Northern_a8         2250\n 6:  2024  Eastern_a8         4609\n 7:  2024  Central_a8         3791\n 8:  2024  Western_a8         2361\n 9:  2024  Toronto_a8         1904\n10:  2024 Northern_a8         1627\n11:  2025  Central_a8         6003\n12:  2025  Toronto_a8         4501\n13:  2025  Eastern_a8         4216\n14:  2025  Western_a8         2648\n15:  2025  Central_a1         1490\n\nempty_states &lt;- id_counts_long[,\n  .(total_across_years = sum(person_count)),\n  by = state\n][total_across_years == 0]\n\nprint(\"States with zero occupancy (these won't help the DoubleML):\")\n\n[1] \"States with zero occupancy (these won't help the DoubleML):\"\n\nprint(empty_states$state)\n\nfactor()\n30 Levels: Central_a1 Central_a2 Central_a4 Central_a5 ... Western_a8\n\nreg_summary &lt;- dt1b[,\n  .(\n    reg_count = uniqueN(c(regA, regB)),\n    regC = paste(sort(unique(c(regA, regB))), collapse = \" + \")\n  ),\n  by = .(id, year)\n]\n\nstatus_summary &lt;- dcast(\n  dt1b,\n  id + year ~ status_combo,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  fill = 0\n)\n\ndt_final_complex &lt;- merge(status_summary, reg_summary, by = c(\"id\", \"year\"))\n\ndemo_info &lt;- dt1b[,\n  .(\n    sex = first(sex),\n    age_num = first(age_num)\n  ),\n  by = .(id, year)\n]\n\ndt_final_complex &lt;- merge(dt_final_complex, demo_info, by = c(\"id\", \"year\"))\n\nprint(head(dt_final_complex))\n\nKey: &lt;id, year&gt;\n              id  year    a1    a2    a4    a5    a7    a8 reg_count     regC\n          &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;int&gt;   &lt;char&gt;\n1: 2023-00001-RC  2023     0     8     0     0     0    26         1  Toronto\n2: 2023-00002-RC  2023     0     0     0     0     0    20         1 Northern\n3: 2023-00003-RC  2023     0     0     9     0     0     0         1  Eastern\n4: 2023-00004-RC  2023     0    11     0     0     0     0         1  Western\n5: 2023-00005-RC  2023     0     0     0     0     0     8         1  Eastern\n6: 2023-00006-RC  2023     0     0     0     0     0     8         1  Eastern\n      sex age_num\n   &lt;fctr&gt;   &lt;num&gt;\n1:   Male    42.0\n2:   Male    57.5\n3:   Male    42.0\n4:   Male    42.0\n5:   Male    57.5\n6:   Male    57.5\n\nregC_stats &lt;- dt_final_complex[, .(n_persons = .N), by = regC][order(\n  -n_persons\n)]\nprint(regC_stats)\n\n                                      regC n_persons\n                                    &lt;char&gt;     &lt;int&gt;\n 1:                                Central     18403\n 2:                                Eastern     16765\n 3:                                Western     10374\n 4:                                Toronto      9829\n 5:                               Northern      7530\n 6:                      Central + Toronto       662\n 7:                      Central + Western       443\n 8:                      Eastern + Toronto       398\n 9:                      Central + Eastern       381\n10:                     Northern + Toronto       124\n11:                      Eastern + Western       116\n12:                      Toronto + Western        95\n13:                     Northern + Western        84\n14:                     Central + Northern        66\n15:                     Eastern + Northern        56\n16:            Central + Eastern + Toronto        54\n17:            Central + Toronto + Western        21\n18:            Central + Eastern + Western        19\n19:            Eastern + Toronto + Western        13\n20:           Central + Northern + Western        11\n21:           Central + Northern + Toronto         8\n22:           Eastern + Northern + Toronto         5\n23:           Northern + Toronto + Western         4\n24:  Central + Eastern + Toronto + Western         3\n25:           Eastern + Northern + Western         2\n26: Eastern + Northern + Toronto + Western         1\n                                      regC n_persons\n                                    &lt;char&gt;     &lt;int&gt;\n\nregC_yearly_counts &lt;- dt_final_complex[, .(n = .N), by = .(regC, year)]\n\nregC_stats_wide &lt;- dcast(\n  regC_yearly_counts,\n  regC ~ year,\n  value.var = \"n\",\n  fill = 0\n)\n\nyear_cols &lt;- setdiff(names(regC_stats_wide), \"regC\")\nnew_t_names &lt;- paste0(\"t\", seq_along(year_cols))\nsetnames(regC_stats_wide, old = year_cols, new = new_t_names)\n\nregC_stats_wide[, n_persons := rowSums(.SD), .SDcols = new_t_names]\n\nsetcolorder(regC_stats_wide, c(\"regC\", \"n_persons\", new_t_names))\nregC_stats_wide &lt;- regC_stats_wide[order(-n_persons)]\n\nprint(regC_stats_wide)\n\n                                      regC n_persons    t1    t2    t3\n                                    &lt;char&gt;     &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;\n 1:                                Central     18403  6391  4839  7173\n 2:                                Eastern     16765  4869  6215  5681\n 3:                                Western     10374  3316  3363  3695\n 4:                                Toronto      9829  2687  2237  4905\n 5:                               Northern      7530  2949  2324  2257\n 6:                      Central + Toronto       662   178   144   340\n 7:                      Central + Western       443   107    75   261\n 8:                      Eastern + Toronto       398    91   133   174\n 9:                      Central + Eastern       381    66   123   192\n10:                     Northern + Toronto       124    17    19    88\n11:                      Eastern + Western       116    19    48    49\n12:                      Toronto + Western        95    14    16    65\n13:                     Northern + Western        84     9    32    43\n14:                     Central + Northern        66    27    17    22\n15:                     Eastern + Northern        56    23    19    14\n16:            Central + Eastern + Toronto        54     5    14    35\n17:            Central + Toronto + Western        21     3     3    15\n18:            Central + Eastern + Western        19     4     8     7\n19:            Eastern + Toronto + Western        13     0     4     9\n20:           Central + Northern + Western        11     2     2     7\n21:           Central + Northern + Toronto         8     1     1     6\n22:           Eastern + Northern + Toronto         5     2     2     1\n23:           Northern + Toronto + Western         4     1     0     3\n24:  Central + Eastern + Toronto + Western         3     0     2     1\n25:           Eastern + Northern + Western         2     0     1     1\n26: Eastern + Northern + Toronto + Western         1     0     0     1\n                                      regC n_persons    t1    t2    t3\n                                    &lt;char&gt;     &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;\n\ndemog_counts &lt;- dt_final_complex[, .(n = .N), by = .(regC, year, sex)]\n\ndemog_wide &lt;- dcast(demog_counts, regC ~ year + sex, value.var = \"n\", fill = 0)\n\nunique_years &lt;- sort(unique(demog_counts$year))\n\nfor (i in seq_along(unique_years)) {\n  year_val &lt;- unique_years[i]\n  suffix &lt;- letters[i]\n  setnames(\n    demog_wide,\n    old = paste0(year_val, \"_Male\"),\n    new = paste0(\"g1\", suffix),\n    skip_absent = TRUE\n  )\n  setnames(\n    demog_wide,\n    old = paste0(year_val, \"_Female\"),\n    new = paste0(\"g2\", suffix),\n    skip_absent = TRUE\n  )\n}\n\ndemog_wide[, t1 := g1a + g2a]\ndemog_wide[, t2 := g1b + g2b]\ndemog_wide[, t3 := g1c + g2c]\n\ndemog_wide[, n_persons := t1 + t2 + t3]\n\nsetcolorder(\n  demog_wide,\n  c(\n    \"regC\",\n    \"n_persons\",\n    \"t1\",\n    \"t2\",\n    \"t3\",\n    \"g1a\",\n    \"g1b\",\n    \"g1c\",\n    \"g2a\",\n    \"g2b\",\n    \"g2c\"\n  )\n)\nregC_demog_stats &lt;- demog_wide[order(-n_persons)]\n\nprint(regC_demog_stats)\n\n                                      regC n_persons    t1    t2    t3   g1a\n                                    &lt;char&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;\n 1:                                Central     18403  6391  4839  7173  6390\n 2:                                Eastern     16765  4869  6215  5681  4193\n 3:                                Western     10374  3316  3363  3695  2927\n 4:                                Toronto      9829  2687  2237  4905  2673\n 5:                               Northern      7530  2949  2324  2257  2526\n 6:                      Central + Toronto       662   178   144   340   178\n 7:                      Central + Western       443   107    75   261   107\n 8:                      Eastern + Toronto       398    91   133   174    91\n 9:                      Central + Eastern       381    66   123   192    65\n10:                     Northern + Toronto       124    17    19    88    17\n11:                      Eastern + Western       116    19    48    49    16\n12:                      Toronto + Western        95    14    16    65    14\n13:                     Northern + Western        84     9    32    43     8\n14:                     Central + Northern        66    27    17    22    27\n15:                     Eastern + Northern        56    23    19    14    20\n16:            Central + Eastern + Toronto        54     5    14    35     5\n17:            Central + Toronto + Western        21     3     3    15     3\n18:            Central + Eastern + Western        19     4     8     7     4\n19:            Eastern + Toronto + Western        13     0     4     9     0\n20:           Central + Northern + Western        11     2     2     7     2\n21:           Central + Northern + Toronto         8     1     1     6     1\n22:           Eastern + Northern + Toronto         5     2     2     1     2\n23:           Northern + Toronto + Western         4     1     0     3     1\n24:  Central + Eastern + Toronto + Western         3     0     2     1     0\n25:           Eastern + Northern + Western         2     0     1     1     0\n26: Eastern + Northern + Toronto + Western         1     0     0     1     0\n                                      regC n_persons    t1    t2    t3   g1a\n                                    &lt;char&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;\n      g1b   g1c   g2a   g2b   g2c\n    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;\n 1:  4836  6681     1     3   492\n 2:  5275  4542   676   940  1139\n 3:  2843  3137   389   520   558\n 4:  2222  4896    14    15     9\n 5:  1896  1724   423   428   533\n 6:   142   331     0     2     9\n 7:    73   248     0     2    13\n 8:   133   173     0     0     1\n 9:   121   153     1     2    39\n10:    19    87     0     0     1\n11:    42    42     3     6     7\n12:    16    65     0     0     0\n13:    26    37     1     6     6\n14:    17    19     0     0     3\n15:    19    10     3     0     4\n16:    14    34     0     0     1\n17:     3    15     0     0     0\n18:     8     5     0     0     2\n19:     4     9     0     0     0\n20:     2     4     0     0     3\n21:     1     6     0     0     0\n22:     2     1     0     0     0\n23:     0     3     0     0     0\n24:     2     1     0     0     0\n25:     1     0     0     0     1\n26:     0     1     0     0     0\n      g1b   g1c   g2a   g2b   g2c\n    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;\n\nknitr::kable(res_pool, digits = 4, caption = \"Pooled IRM DoubleML (2023–2025)\")\n\n\nPooled IRM DoubleML (2023–2025)\n\n\n\n\n\n\n\n\n\n\n\n\ngroup\nestimand\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\nPooled 2023-25\nATE\n0.1605\n0.0063\n25.5418\n0\n0.1481\n0.1728\n\n\nPooled 2023-25\nATTE\n0.1557\n0.0061\n25.6923\n0\n0.1438\n0.1676\n\n\n\n\nknitr::kable(\n  res_by_year,\n  digits = 4,\n  caption = \"Yearly IRM DoubleML (2023/2024/2025)\"\n)\n\n\nYearly IRM DoubleML (2023/2024/2025)\n\n\ngroup\nestimand\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\n2023\nATE\n0.1342\n0.0099\n13.6093\n0\n0.1149\n0.1535\n\n\n2023\nATTE\n0.1272\n0.0103\n12.3080\n0\n0.1070\n0.1475\n\n\n2024\nATE\n0.1591\n0.0117\n13.6359\n0\n0.1362\n0.1820\n\n\n2024\nATTE\n0.1550\n0.0114\n13.5809\n0\n0.1326\n0.1774\n\n\n2025\nATE\n0.1737\n0.0103\n16.8639\n0\n0.1535\n0.1939\n\n\n2025\nATTE\n0.1704\n0.0097\n17.6296\n0\n0.1514\n0.1893\n\n\n\n\nknitr::kable(\n  res_pool,\n  booktabs = TRUE,\n  longtable = TRUE,\n  digits = 4,\n  caption = \"Pooled IRM DoubleML (2023–2025)\"\n)\n\n\nPooled IRM DoubleML (2023–2025)\n\n\n\n\n\n\n\n\n\n\n\n\ngroup\nestimand\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\nPooled 2023-25\nATE\n0.1605\n0.0063\n25.5418\n0\n0.1481\n0.1728\n\n\nPooled 2023-25\nATTE\n0.1557\n0.0061\n25.6923\n0\n0.1438\n0.1676\n\n\n\n\nknitr::kable(\n  res_by_year,\n  booktabs = TRUE,\n  longtable = TRUE,\n  digits = 4,\n  caption = \"IRM DoubleML (2023/2024/2025)\"\n)\n\n\nIRM DoubleML (2023/2024/2025)\n\n\ngroup\nestimand\neffect\nse\nt_value\np_value\nci_low\nci_high\n\n\n\n\n2023\nATE\n0.1342\n0.0099\n13.6093\n0\n0.1149\n0.1535\n\n\n2023\nATTE\n0.1272\n0.0103\n12.3080\n0\n0.1070\n0.1475\n\n\n2024\nATE\n0.1591\n0.0117\n13.6359\n0\n0.1362\n0.1820\n\n\n2024\nATTE\n0.1550\n0.0114\n13.5809\n0\n0.1326\n0.1774\n\n\n2025\nATE\n0.1737\n0.0103\n16.8639\n0\n0.1535\n0.1939\n\n\n2025\nATTE\n0.1704\n0.0097\n17.6296\n0\n0.1514\n0.1893\n\n\n\n\ndt1c &lt;- as.data.table(dataframe_original1b)\nsetnames(\n  dt1c,\n  old = c(\n    \"x1a\",\n    \"unique_individual_id\",\n    \"x1b\",\n    \"x1c\",\n    \"x1d\",\n    \"x1e\",\n    \"x1f\",\n    \"x1g\",\n    \"x1h\",\n    \"x1i\"\n  ),\n  new = c(\"year\", \"id\", \"regA\", \"regB\", \"sex\", \"age\", \"bA\", \"bB\", \"bC\", \"np\"),\n  skip_absent = TRUE\n)\n\ndt1c[, `:=`(\n  bA = as.integer(bA == \"Yes\"),\n  bB = as.integer(bB == \"Yes\"),\n  bC = as.integer(bC == \"Yes\"),\n  age_n = fcase(\n    age == \"18 to 24\" , 21   ,\n    age == \"25 to 49\" , 42   ,\n    age == \"50+\"      , 57.5\n  )\n)]\n\ndt1c[,\n  combo := fcase(\n    bA == 1 & bB == 0 & bC == 0 , \"a1\" ,\n    bA == 0 & bB == 1 & bC == 0 , \"a2\" ,\n    bA == 1 & bB == 1 & bC == 0 , \"a4\" ,\n    bA == 0 & bB == 1 & bC == 1 , \"a5\" ,\n    bA == 1 & bB == 1 & bC == 1 , \"a7\" ,\n    bA == 0 & bB == 0 & bC == 0 , \"a8\"\n  )\n]\n\n# person-year: alert-state intensity via 2^3 = 8 possible outcomes (a1-a8) where two (a3 and a6) were not observed empirically\norc &lt;- dt1c[,\n  .(\n    a1 = sum((combo == \"a1\") * np, na.rm = TRUE),\n    a2 = sum((combo == \"a2\") * np, na.rm = TRUE),\n    a4 = sum((combo == \"a4\") * np, na.rm = TRUE),\n    a5 = sum((combo == \"a5\") * np, na.rm = TRUE),\n    a7 = sum((combo == \"a7\") * np, na.rm = TRUE),\n    a8 = sum((combo == \"a8\") * np, na.rm = TRUE),\n    np = sum(np),\n    rg = uniqueN(c(regA, regB)),\n    rc = paste(sort(unique(c(regA, regB))), collapse = \" + \"),\n    yr = first(year),\n    sg = first(sex),\n    ag = first(age_n)\n  ),\n  by = id\n]\n\nkeyz &lt;- c(\"a1\", \"a2\", \"a4\", \"a5\", \"a7\", \"a8\")\norc[, ac := rowSums(.SD &gt; 0), .SDcols = keyz]\n\n# 6. VOLATILITY (v_moves): placement transfers/shifts within the person-year sequence for vm\nmoves &lt;- dt1c[\n  order(id),\n  .(\n    vm = sum((regA != regB) | (regA != shift(regA) & !is.na(shift(regA))))\n  ),\n  by = id\n]\n\norc &lt;- merge(orc, moves, by = \"id\")\n\nsetcolorder(\n  orc,\n  c(\n    \"yr\",\n    \"ag\",\n    \"sg\",\n    \"np\",\n    \"ac\",\n    \"rg\",\n    \"vm\",\n    \"a1\",\n    \"a2\",\n    \"a4\",\n    \"a5\",\n    \"a7\",\n    \"a8\",\n    \"id\",\n    \"rc\"\n  )\n)\n\nprint(orc[ac &gt; 3][order(-ac)][1:10])\n\n       yr    ag     sg    np    ac    rg    vm    a1    a2    a4    a5    a7\n    &lt;num&gt; &lt;num&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n 1:  2023  42.0   Male    93     6     1     0    15    22    11     2     3\n 2:  2023  21.0   Male   161     6     1     0   131     3     1     1     1\n 3:  2024  42.0   Male   355     6     1     0    31    66     2     4     3\n 4:  2024  42.0   Male   183     6     1     0    27     6    11    40    12\n 5:  2024  42.0   Male    39     6     1     0    10     2     1     1     1\n 6:  2024  42.0   Male   196     6     1     0   161     8     1     1     3\n 7:  2025  42.0   Male   249     6     1     0    86     7    12     2     6\n 8:  2025  57.5   Male    83     6     3     8    12    20     3     4    39\n 9:  2025  42.0   Male    86     6     1     0    16    37     2    11     4\n10:  2025  42.0   Male   122     6     2     3    35     2     3    10    32\n       a8            id                          rc\n    &lt;num&gt;        &lt;char&gt;                      &lt;char&gt;\n 1:    40 2023-15720-RC                     Eastern\n 2:    24 2023-16285-RC                     Eastern\n 3:   249 2024-00145-RC                     Eastern\n 4:    87 2024-00280-RC                     Eastern\n 5:    24 2024-04490-RC                     Eastern\n 6:    22 2024-10754-RC                     Eastern\n 7:   136 2025-00167-RC                     Eastern\n 8:     5 2025-01080-RC Central + Eastern + Toronto\n 9:    16 2025-05185-RC                     Eastern\n10:    40 2025-11914-RC           Central + Eastern\n\nprint(paste(\"Zero day rows:\", nrow(orc[np == 0])))\n\n[1] \"Zero day rows: 0\"\n\norc[, id := .I]\norc[, sg := ifelse(sg == \"Male\", 1, 2)]\n\n\n# Xbar and SD for complexity and volatility by year and gender\nstatz &lt;- orc[,\n  .(\n    n = .N,\n    xA = round(mean(ac, na.rm = TRUE), 2),\n    sA = round(sd(ac, na.rm = TRUE), 2),\n    xB = round(mean(vm, na.rm = TRUE), 2),\n    sB = round(sd(vm, na.rm = TRUE), 2)\n  ),\n  by = .(yr, sg)\n]\n\nstatz &lt;- statz[order(yr, sg)]\nprint(\"--- Summary Statistics for Methods Section ---\")\n\n[1] \"--- Summary Statistics for Methods Section ---\"\n\nprint(statz)\n\n      yr    sg     n    xA    sA    xB    sB\n   &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n1:  2023     1 19270  1.13  0.42  0.06  0.37\n2:  2023     2  1511  1.13  0.39  0.01  0.13\n3:  2024     1 17717  1.14  0.42  0.08  0.42\n4:  2024     2  1924  1.15  0.43  0.02  0.21\n5:  2025     1 22224  1.13  0.42  0.11  0.49\n6:  2025     2  2821  1.14  0.41  0.06  0.36\n\norc[,\n  agc := fcase(\n    ag == 21 , \"21\" , ag == 42 , \"42\" , ag == 57.5 , \"57.5\"\n  )\n]\n\nlibrary(data.table)\nlibrary(lme4)\nlibrary(glmmTMB)\nlibrary(DHARMa)\nlibrary(cobalt)\nlibrary(DoubleML)\nlibrary(mlr3)\nlibrary(mlr3learners)\nlibrary(Hmisc) # weighted variance/sd\n# weighted mean: sum(value * weight) / sum(weight)\n# weighted sd: sq rt of weighted variance\n\nstatz1a &lt;- orc[,\n  .(\n    n = .N,\n    xA = round(wtd.mean(ac, weights = np), 2),\n    sA = round(sqrt(wtd.var(ac, weights = np)), 2),\n    xB = round(wtd.mean(vm, weights = np), 2),\n    sB = round(sqrt(wtd.var(vm, weights = np)), 2)\n  ),\n  by = .(yr, sg, agc, rc)\n]\nstatz1a[is.na(sA), sA := mean(sB)]\nstatz1a[is.na(sB), sB := mean(sB)]\n\nprint(statz1a[order(yr, agc, sg, n, xA, xB, sA, sB, rc)])\n\n        yr    sg    agc                           rc     n    xA    sA    xB\n     &lt;num&gt; &lt;num&gt; &lt;char&gt;                       &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n  1:  2023     1     21  Central + Eastern + Western     1  1.00  0.00  3.00\n  2:  2023     1     21  Central + Toronto + Western     1  1.00  0.00  3.00\n  3:  2023     1     21 Eastern + Northern + Toronto     1  1.00  0.00  3.00\n  4:  2023     1     21            Toronto + Western     2  3.00  0.00  1.06\n  5:  2023     1     21  Central + Eastern + Toronto     2  3.49  0.50  5.48\n ---                                                                        \n236:  2025     2   57.5            Central + Eastern     3  1.00  0.00  1.11\n237:  2025     2   57.5                     Northern    25  1.04  0.20  0.00\n238:  2025     2   57.5                      Western    33  1.87  0.85  0.00\n239:  2025     2   57.5                      Central    44  1.08  0.28  0.00\n240:  2025     2   57.5                      Eastern    99  1.37  0.65  0.00\n        sB\n     &lt;num&gt;\n  1:  0.00\n  2:  0.00\n  3:  0.00\n  4:  0.24\n  5:  1.51\n ---      \n236:  0.31\n237:  0.00\n238:  0.00\n239:  0.00\n240:  0.00\n\n# year, age, gender, region\nstatz1a &lt;- statz1a[order(yr, agc, sg, n, xA, xB, sA, sB, rc)]\nprint(\"--- Detailed Summary Statistics (By Year, Demographics, and Region) ---\")\n\n[1] \"--- Detailed Summary Statistics (By Year, Demographics, and Region) ---\"\n\nprint(head(statz1a, 30))\n\n       yr    sg    agc                           rc     n    xA    sA    xB\n    &lt;num&gt; &lt;num&gt; &lt;char&gt;                       &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n 1:  2023     1     21  Central + Eastern + Western     1  1.00  0.00  3.00\n 2:  2023     1     21  Central + Toronto + Western     1  1.00  0.00  3.00\n 3:  2023     1     21 Eastern + Northern + Toronto     1  1.00  0.00  3.00\n 4:  2023     1     21            Toronto + Western     2  3.00  0.00  1.06\n 5:  2023     1     21  Central + Eastern + Toronto     2  3.49  0.50  5.48\n 6:  2023     1     21           Northern + Toronto     4  1.27  0.45  2.00\n 7:  2023     1     21           Central + Northern     7  1.00  0.00  1.86\n 8:  2023     1     21           Eastern + Northern     7  1.54  0.69  2.00\n 9:  2023     1     21            Eastern + Toronto     9  1.73  1.14  2.55\n10:  2023     1     21            Central + Eastern    13  1.28  0.59  1.69\n11:  2023     1     21            Central + Western    19  1.38  0.55  1.75\n12:  2023     1     21            Central + Toronto    33  1.90  1.23  2.28\n13:  2023     1     21                      Western   384  1.15  0.45  0.00\n14:  2023     1     21                      Toronto   462  1.21  0.49  0.00\n15:  2023     1     21                     Northern   464  1.40  0.73  0.00\n16:  2023     1     21                      Eastern   722  1.20  0.54  0.00\n17:  2023     1     21                      Central  1147  1.23  0.56  0.00\n18:  2023     2     21                      Central     1  1.00   NaN  0.00\n19:  2023     2     21           Eastern + Northern     1  1.00  0.00  2.00\n20:  2023     2     21            Eastern + Western     1  2.00  0.00  1.00\n21:  2023     2     21                      Toronto     5  1.58  1.20  0.00\n22:  2023     2     21                      Western    42  1.28  0.51  0.00\n23:  2023     2     21                     Northern    85  1.13  0.38  0.00\n24:  2023     2     21                      Eastern    94  1.87  1.06  0.00\n25:  2023     1     42 Central + Northern + Toronto     1  1.00  0.00  3.00\n26:  2023     1     42 Northern + Toronto + Western     1  1.00  0.00  3.00\n27:  2023     1     42 Eastern + Northern + Toronto     1  2.00  0.00  3.00\n28:  2023     1     42 Central + Northern + Western     2  1.62  0.49  3.00\n29:  2023     1     42  Central + Toronto + Western     2  2.00  0.00  4.00\n30:  2023     1     42  Central + Eastern + Toronto     3  1.59  0.49  3.59\n       yr    sg    agc                           rc     n    xA    sA    xB\n    &lt;num&gt; &lt;num&gt; &lt;char&gt;                       &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n       sB\n    &lt;num&gt;\n 1:  0.00\n 2:  0.00\n 3:  0.00\n 4:  0.24\n 5:  1.51\n 6:  0.00\n 7:  0.35\n 8:  0.00\n 9:  0.78\n10:  0.46\n11:  0.43\n12:  0.55\n13:  0.00\n14:  0.00\n15:  0.00\n16:  0.00\n17:  0.00\n18:   NaN\n19:  0.00\n20:  0.00\n21:  0.00\n22:  0.00\n23:  0.00\n24:  0.00\n25:  0.00\n26:  0.00\n27:  0.00\n28:  0.00\n29:  0.00\n30:  0.49\n       sB\n    &lt;num&gt;\n\n# paths by volume per year\nrpvy &lt;- statz1a[, .SD[head(order(-n), 15)], by = yr]\nprint(rpvy)\n\n       yr    sg    agc       rc     n    xA    sA    xB    sB\n    &lt;num&gt; &lt;num&gt; &lt;char&gt;   &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n 1:  2023     1     42  Central  4451  1.25  0.59     0     0\n 2:  2023     1     42  Eastern  2950  1.20  0.50     0     0\n 3:  2023     1     42  Western  2194  1.20  0.48     0     0\n 4:  2023     1     42  Toronto  1902  1.28  0.62     0     0\n 5:  2023     1     42 Northern  1814  1.33  0.67     0     0\n 6:  2023     1     21  Central  1147  1.23  0.56     0     0\n 7:  2023     1   57.5  Central   792  1.25  0.56     0     0\n 8:  2023     1     21  Eastern   722  1.20  0.54     0     0\n 9:  2023     2     42  Eastern   525  1.29  0.58     0     0\n10:  2023     1   57.5  Eastern   521  1.13  0.36     0     0\n11:  2023     1     21 Northern   464  1.40  0.73     0     0\n12:  2023     1     21  Toronto   462  1.21  0.49     0     0\n13:  2023     1     21  Western   384  1.15  0.45     0     0\n14:  2023     1   57.5  Western   349  1.10  0.34     0     0\n15:  2023     2     42  Western   330  1.29  0.55     0     0\n16:  2024     1     42  Eastern  3769  1.20  0.58     0     0\n17:  2024     1     42  Central  3515  1.24  0.53     0     0\n18:  2024     1     42  Western  2143  1.17  0.45     0     0\n19:  2024     1     42  Toronto  1589  1.18  0.46     0     0\n20:  2024     1     42 Northern  1408  1.41  0.69     0     0\n21:  2024     1     21  Eastern   833  1.21  0.59     0     0\n22:  2024     2     42  Eastern   751  1.35  0.78     0     0\n23:  2024     1     21  Central   700  1.22  0.48     0     0\n24:  2024     1   57.5  Eastern   673  1.16  0.49     0     0\n25:  2024     1   57.5  Central   621  1.26  0.59     0     0\n26:  2024     2     42  Western   445  1.24  0.50     0     0\n27:  2024     1     21  Western   373  1.17  0.43     0     0\n28:  2024     1     21  Toronto   361  1.17  0.43     0     0\n29:  2024     1   57.5  Western   327  1.18  0.39     0     0\n30:  2024     2     42 Northern   326  1.31  0.59     0     0\n31:  2025     1     42  Central  4943  1.17  0.45     0     0\n32:  2025     1     42  Toronto  3440  1.25  0.57     0     0\n33:  2025     1     42  Eastern  3267  1.26  0.64     0     0\n34:  2025     1     42  Western  2392  1.17  0.40     0     0\n35:  2025     1     42 Northern  1277  1.35  0.64     0     0\n36:  2025     1     21  Central   981  1.12  0.40     0     0\n37:  2025     2     42  Eastern   918  1.28  0.59     0     0\n38:  2025     1     21  Toronto   793  1.14  0.42     0     0\n39:  2025     1   57.5  Central   757  1.14  0.39     0     0\n40:  2025     1     21  Eastern   663  1.17  0.48     0     0\n41:  2025     1   57.5  Toronto   663  1.20  0.43     0     0\n42:  2025     1   57.5  Eastern   612  1.18  0.49     0     0\n43:  2025     2     42  Western   474  1.28  0.47     0     0\n44:  2025     2     42 Northern   400  1.41  0.71     0     0\n45:  2025     2     42  Central   379  1.16  0.41     0     0\n       yr    sg    agc       rc     n    xA    sA    xB    sB\n    &lt;num&gt; &lt;num&gt; &lt;char&gt;   &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;\n\norc[, agc := NULL]\n\norc[,\n  ag := fcase(\n    ag == 21   , \"21\"   ,\n    ag == 42   , \"42\"   ,\n    ag == 57.5 , \"57.5\"\n  )\n]\n\norc[, rc := as.factor(rc)]\norc[, ag := factor(ag, levels = c(\"21\", \"42\", \"57.5\"), ordered = TRUE)]\norc[, sg := factor(sg, levels = c(1, 2), labels = c(\"M\", \"F\"))]\norc[, yr := factor(yr, levels = sort(unique(yr)), ordered = TRUE)]\n# data types\nstr(orc[, .(yr, ag, sg, rc)])\n\nClasses 'data.table' and 'data.frame':  65467 obs. of  4 variables:\n $ yr: Ord.factor w/ 3 levels \"2023\"&lt;\"2024\"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...\n $ ag: Ord.factor w/ 3 levels \"21\"&lt;\"42\"&lt;\"57.5\": 2 3 2 2 3 3 2 3 2 3 ...\n $ sg: Factor w/ 2 levels \"M\",\"F\": 1 1 1 1 1 1 1 1 1 1 ...\n $ rc: Factor w/ 26 levels \"Central\",\"Central + Eastern\",..: 24 20 12 26 12 12 1 20 26 26 ...\n - attr(*, \".internal.selfref\")=&lt;externalptr&gt; \n\norc[, treat := as.integer(ac &gt;= 2)]\nm.out &lt;- matchit(\n  treat ~ ag + sg + yr,\n  data = orc,\n  method = \"nearest\",\n  distance = \"glm\",\n  weights = orc$np\n)\n\norc_matched &lt;- match.data(m.out)\n\n# fit of weighted poisson GLMM  'weights' (matching weights) via MatchIt\nmodel_final &lt;- glmer(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched,\n  family = poisson(link = \"log\"),\n  weights = weights\n)\n# poisson model fit (matched sample)\nmodel_final &lt;- glmer(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched,\n  family = poisson(link = \"log\"),\n  weights = weights\n)\nsummary(model_final)\n\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: poisson  ( log )\nFormula: vm ~ treat + ag + sg + yr + (1 | rc)\n   Data: orc_matched\nWeights: weights\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n   3039.7    3100.4   -1511.9    3023.7     14512 \n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-1.00219 -0.01331 -0.01131 -0.00979  2.23180 \n\nRandom effects:\n Groups Name        Variance Std.Dev.\n rc     (Intercept) 19.41    4.406   \nNumber of obs: 14520, groups:  rc, 24\n\nFixed effects:\n             Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept) -1.409675   0.912681  -1.545    0.122    \ntreat        0.290601   0.051779   5.612    2e-08 ***\nag.L         0.029770   0.066244   0.449    0.653    \nag.Q         0.017940   0.042570   0.421    0.673    \nsgF         -0.105187   0.102136  -1.030    0.303    \nyr.L        -0.008085   0.037464  -0.216    0.829    \nyr.Q        -0.008459   0.039257  -0.215    0.829    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n      (Intr) treat  ag.L   ag.Q   sgF    yr.L  \ntreat -0.045                                   \nag.L   0.017 -0.046                            \nag.Q   0.027 -0.017  0.351                     \nsgF   -0.009 -0.024  0.056  0.010              \nyr.L  -0.006  0.032  0.023  0.016 -0.116       \nyr.Q  -0.001  0.062  0.025  0.022 -0.058 -0.163\n\n#  effect sizes (Incidence Rate Ratio) from log-odds\nresults_table &lt;- exp(fixef(model_final))\nprint(results_table)\n\n(Intercept)       treat        ag.L        ag.Q         sgF        yr.L \n  0.2442227   1.3372305   1.0302174   1.0181016   0.9001565   0.9919480 \n       yr.Q \n  0.9915767 \n\nlibrary(DHARMa)\nsim_res &lt;- simulateResiduals(model_final)\nplot(sim_res)\n\n\n\n\n\n\n\ntestDispersion(sim_res)\n\n\n\n\n\n\n\n\n\n    DHARMa nonparametric dispersion test via sd of residuals fitted vs.\n    simulated\n\ndata:  simulationOutput\ndispersion = 6.895e-11, p-value &lt; 2.2e-16\nalternative hypothesis: two.sided\n\ntestZeroInflation(sim_res)\n\n\n\n\n\n\n\n\n\n    DHARMa zero-inflation test via comparison to expected zeros with\n    simulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.6609, p-value = 0.016\nalternative hypothesis: two.sided\n\nlibrary(glmmTMB)\nmodel_final_thesis &lt;- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched,\n  family = nbinom2,\n  weights = weights,\n  control = glmmTMBControl(optimizer = optim, optArgs = list(method = \"BFGS\"))\n)\n\nsummary(model_final_thesis)\n\n Family: nbinom2  ( log )\nFormula:          vm ~ treat + ag + sg + yr + (1 | rc)\nData: orc_matched\nWeights: weights\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n   3041.7    3110.0   -1511.9    3023.7     14511 \n\nRandom effects:\n\nConditional model:\n Groups Name        Variance Std.Dev.\n rc     (Intercept) 19.52    4.418   \nNumber of obs: 14520, groups:  rc, 24\n\nDispersion parameter for nbinom2 family (): 2.58e+08 \n\nConditional model:\n             Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept) -1.416375   0.934642  -1.515    0.130    \ntreat        0.290602   0.051777   5.613 1.99e-08 ***\nag.L         0.029777   0.066240   0.450    0.653    \nag.Q         0.017940   0.042567   0.421    0.673    \nsgF         -0.105184   0.102124  -1.030    0.303    \nyr.L        -0.008090   0.037462  -0.216    0.829    \nyr.Q        -0.008458   0.039255  -0.215    0.829    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nfix_eff &lt;- summary(model_final_thesis)$coefficients$cond\n\nresults_final &lt;- data.frame(\n  Variable = rownames(fix_eff),\n  IRR = exp(fix_eff[, \"Estimate\"]),\n  Lower_CI = exp(fix_eff[, \"Estimate\"] - 1.96 * fix_eff[, \"Std. Error\"]),\n  Upper_CI = exp(fix_eff[, \"Estimate\"] + 1.96 * fix_eff[, \"Std. Error\"]),\n  P_Value = fix_eff[, \"Pr(&gt;|z|)\"]\n)\n\nprint(results_final)\n\n               Variable       IRR   Lower_CI Upper_CI      P_Value\n(Intercept) (Intercept) 0.2425918 0.03884119 1.515164 1.296662e-01\ntreat             treat 1.3372328 1.20818531 1.480064 1.993339e-08\nag.L               ag.L 1.0302247 0.90478976 1.173049 6.530468e-01\nag.Q               ag.Q 1.0181020 0.93660717 1.106688 6.734231e-01\nsgF                 sgF 0.9001589 0.73686691 1.099637 3.030295e-01\nyr.L               yr.L 0.9919424 0.92171814 1.067517 8.290195e-01\nyr.Q               yr.Q 0.9915779 0.91814800 1.070880 8.294083e-01\n\nsim_res1b &lt;- simulateResiduals(model_final_thesis, n = 5000)\nplot(sim_res1b)\n\n\n\n\n\n\n\ntestDispersion(sim_res1b)\n\n\n\n\n\n\n\n\n\n    DHARMa nonparametric dispersion test via sd of residuals fitted vs.\n    simulated\n\ndata:  simulationOutput\ndispersion = 4.2272e-11, p-value = 0.0032\nalternative hypothesis: two.sided\n\ntestZeroInflation(sim_res1b)\n\n\n\n\n\n\n\n\n\n    DHARMa zero-inflation test via comparison to expected zeros with\n    simulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.6516, p-value = 0.0268\nalternative hypothesis: two.sided\n\n# naive weighted mean comparison to double-check the 33% increase; close to the IRR ?:!\nlibrary(weights)\nwtd.mean(\n  orc_matched$vm[orc_matched$treat == 1],\n  weights = orc_matched$weights[orc_matched$treat == 1]\n)\n\n[1] 0.2538567\n\nwtd.mean(\n  orc_matched$vm[orc_matched$treat == 0],\n  weights = orc_matched$weights[orc_matched$treat == 0]\n)\n\n[1] 0.06721763\n\nplot(sim_res1b)\n\n\n\n\n\n\n\ntestDispersion(sim_res1b)\n\n\n\n\n\n\n\n\n\n    DHARMa nonparametric dispersion test via sd of residuals fitted vs.\n    simulated\n\ndata:  simulationOutput\ndispersion = 4.2272e-11, p-value = 0.0032\nalternative hypothesis: two.sided\n\ntestZeroInflation(sim_res1b)\n\n\n\n\n\n\n\n\n\n    DHARMa zero-inflation test via comparison to expected zeros with\n    simulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.6516, p-value = 0.0268\nalternative hypothesis: two.sided\n\nlibrary(cobalt)\n\nlove_plot &lt;- love.plot(\n  m.out,\n  binary = \"std\",\n  thresholds = c(m = .1),\n  var.order = \"unadjusted\",\n  abs = TRUE,\n  colors = c(\"red\", \"blue\"),\n  shapes = c(\"circle\", \"triangle\"),\n  sample.names = c(\"Original\", \"Matched\"),\n  stars = \"std\"\n)\n\nprint(love_plot)\n\n\n\n\n\n\n\nbal_table &lt;- bal.tab(m.out, un = TRUE)\nprint(bal_table)\n\nBalance Measures\n             Type Diff.Un Diff.Adj\ndistance Distance  0.0911        0\nag_21      Binary -0.0072        0\nag_42      Binary  0.0314        0\nag_57.5    Binary -0.0242        0\nsg_F       Binary  0.0065        0\nyr_2023    Binary -0.0027        0\nyr_2024    Binary  0.0026        0\nyr_2025    Binary  0.0001        0\n\nSample sizes\n          Control Treated\nAll         58207    7260\nMatched      7260    7260\nUnmatched   50947       0\n\nlove.plot(\n  m.out,\n  binary = \"std\",\n  stats = \"m\",\n  thresholds = c(m = .1),\n  abs = TRUE,\n  line = TRUE,\n  sample.names = c(\"Original (Pre-Match)\", \"Matched (Final Sample)\"),\n  colors = c(\"#d62728\", \"#1f77b4\"),\n  shapes = c(21, 24),\n  title = \"Covariate Balance Across Groups\",\n  xlab = \"Absolute Standardized Mean Differences\",\n)\n\n\n\n\n\n\n\ndml_data &lt;- as.data.frame(orc_matched)\ndml_data$sg &lt;- as.numeric(dml_data$sg)\ndml_data$ag &lt;- as.numeric(dml_data$ag)\ndml_data$yr &lt;- as.numeric(dml_data$yr)\n\ndata_dml_obj = double_ml_data_from_data_frame(\n  dml_data,\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\")\n)\n\nl_ranger = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\n\ndml_model = DoubleMLPLR$new(\n  data_dml_obj,\n  ml_l = l_ranger,\n  ml_m = l_ranger,\n  n_folds = 3\n) #  l = target y learner ; m = treatment d learner\n\ndml_model$fit()\nprint(dml_model$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat   0.18658    0.01048    17.8   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value     Pr(&gt;|t|)\ntreat 0.1865815 0.01048398 17.79682 7.480299e-71\n\ndml_matrix_data &lt;- model.matrix(\n  ~ vm + treat + ag + sg + yr + rc - 1,\n  data = orc_matched\n)\ndml_df &lt;- as.data.frame(dml_matrix_data)\ncolnames(dml_df) &lt;- make.names(colnames(dml_df))\n\ndata_dml_adj = double_ml_data_from_data_frame(\n  dml_df,\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = setdiff(colnames(dml_df), c(\"vm\", \"treat\"))\n)\n\nl_ranger = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\n\ndml_model_adj = DoubleMLPLR$new(\n  data_dml_adj,\n  ml_l = l_ranger,\n  ml_m = l_ranger,\n  n_folds = 3\n)\n\ndml_model_adj$fit(store_predictions = TRUE)\n\ndml_preds_final &lt;- dml_model_adj$predictions$ml_l[, 1, 1]\n\nprint(paste(\"DML Predictions Count:\", length(dml_preds_final)))\n\n[1] \"DML Predictions Count: 14520\"\n\nglmm_preds_final &lt;- predict(model_final_thesis, type = \"response\")\n\nplot_data &lt;- data.frame(\n  Actual = as.numeric(orc_matched$vm),\n  GLMM = as.numeric(glmm_preds_final),\n  DML = as.numeric(dml_preds_final)\n)\n\nggplot(plot_data) +\n  geom_density(aes(x = GLMM, fill = \"GLMM (Parametric)\"), alpha = 0.4) +\n  geom_density(aes(x = DML, fill = \"DML (Machine Learning)\"), alpha = 0.4) +\n  scale_x_log10(labels = scales::comma) +\n  labs(\n    title = \"Comparison of Predicted Values (Log Scale)\",\n    subtitle = \"Revealing the distribution of low-probability GLMM predictions\",\n    x = \"Predicted Moves (Log10 Scale)\",\n    y = \"Density\",\n    fill = \"Model Type\"\n  ) +\n  theme_minimal() # log10 transformation for distribution of very small GLMM values\n\n\n\n\n\n\n\nmse_glmm &lt;- mean((plot_data$Actual - plot_data$GLMM)^2)\nmse_dml &lt;- mean((plot_data$Actual - plot_data$DML)^2)\n\ncat(\"\\n--- Initial Results ---\\n\")\n\n\n--- Initial Results ---\n\nprint(dml_model_adj$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat  0.090705   0.006215   14.59   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       Estimate.  Std. Error t value    Pr(&gt;|t|)\ntreat 0.09070513 0.006215405 14.5936 3.08484e-48\n\ncat(\"GLMM MSE:\", round(mse_glmm, 6), \"\\n\")\n\nGLMM MSE: 0.033648 \n\ncat(\"DML MSE: \", round(mse_dml, 6), \"\\n\")\n\nDML MSE:  0.176137 \n\nsummary(orc_matched$weights)\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n      1       1       1       1       1       1 \n\ncat(\"Matching weight distribution:\\n\")\n\nMatching weight distribution:\n\nprint(table(orc_matched$weights))\n\n\n    1 \n14520 \n\ncat(\"\\nBy treatment group:\\n\")\n\n\nBy treatment group:\n\nprint(aggregate(weights ~ treat, data = orc_matched, FUN = summary))\n\n  treat weights.Min. weights.1st Qu. weights.Median weights.Mean\n1     0            1               1              1            1\n2     1            1               1              1            1\n  weights.3rd Qu. weights.Max.\n1               1            1\n2               1            1\n\ncat(\"\\nSample sizes by treatment:\\n\")\n\n\nSample sizes by treatment:\n\nprint(table(orc_matched$treat))\n\n\n   0    1 \n7260 7260 \n\ndml_data_clustered &lt;- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\", \"rc\"),\n  cluster_cols = \"id\"\n)\n\nset.seed(42569872)\ndml_clustered &lt;- DoubleMLPLR$new(\n  dml_data_clustered,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_clustered$fit()\nprint(dml_clustered$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat  0.078614   0.005167   15.21   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate.  Std. Error  t value     Pr(&gt;|t|)\ntreat 0.0786137 0.005167116 15.21423 2.845424e-52\n\nlibrary(sandwich)\nlibrary(lmtest)\ndml_data_region_clustered &lt;- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\"),\n  cluster_cols = c(\"rc\", \"yr\")\n)\n\nset.seed(2764389)\ndml_region_clustered &lt;- DoubleMLPLR$new(\n  dml_data_region_clustered,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_region_clustered$fit()\nprint(dml_region_clustered$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)\ntreat    0.2091     0.1277   1.638    0.101\n\n      Estimate. Std. Error  t value  Pr(&gt;|t|)\ntreat 0.2091398  0.1276979 1.637769 0.1014698\n\ndml_data_region &lt;- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\"),\n  cluster_cols = \"rc\"\n)\n\nset.seed(6450835)\ndml_region &lt;- DoubleMLPLR$new(\n  dml_data_region,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_region$fit()\nprint(dml_region$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)  \ntreat    0.1943     0.1013   1.919    0.055 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value   Pr(&gt;|t|)\ntreat 0.1943492  0.1012809 1.918914 0.05499526\n\ndml_data_yr &lt;- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"rc\"),\n  cluster_cols = \"yr\"\n)\n\nset.seed(69543)\ndml_yearz &lt;- DoubleMLPLR$new(\n  dml_data_yr,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_yearz$fit()\nprint(dml_yearz$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat   0.13004    0.01491   8.719   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value     Pr(&gt;|t|)\ntreat 0.1300352 0.01491448 8.718722 2.813599e-18\n\ndml_data_yrID &lt;- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"rc\", \"id\"),\n  cluster_cols = \"yr\"\n)\n\nset.seed(2468176)\ndml_yearzID &lt;- DoubleMLPLR$new(\n  dml_data_yrID,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_yearzID$fit()\nprint(dml_yearzID$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat   0.08137    0.01173   6.936 4.04e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       Estimate. Std. Error  t value    Pr(&gt;|t|)\ntreat 0.08137193 0.01173222 6.935764 4.04033e-12\n\ndml_data_IDz &lt;- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\n    \"ag\",\n    \"sg\",\n    \"rc\",\n    \"yr\",\n    \"subclass\",\n    \"id\",\n    \"a1\",\n    \"a2\",\n    \"a4\",\n    \"a5\",\n    \"a7\",\n    \"a8\"\n  ),\n  cluster_cols = \"distance\"\n)\n\nset.seed(4568937)\ndml_IDz &lt;- DoubleMLPLR$new(\n  dml_data_IDz,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_IDz$fit()\nprint(dml_IDz$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat   0.12669    0.01854   6.833 8.29e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error t value     Pr(&gt;|t|)\ntreat 0.1266875 0.01853918  6.8335 8.286776e-12\n\nml_g &lt;- lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\nml_m &lt;- lrn(\"classif.ranger\", num.trees = 500, max.depth = 5)\nx_cols_all &lt;- c(\"ag\", \"sg\", \"rc\", \"yr\", \"a1\", \"a2\", \"a4\", \"a5\", \"a7\", \"a8\")\norc_matched[,\n  (c(\"sg\", \"rc\", \"yr\")) := lapply(.SD, as.factor),\n  .SDcols = c(\"sg\", \"rc\", \"yr\")\n]\n\nrun_dml_analysis &lt;- function(data, x_cols, tag, cluster_var) {\n  dml_data &lt;- DoubleMLClusterData$new(\n    data = as.data.frame(data),\n    y_col = \"vm\",\n    d_cols = \"treat\",\n    x_cols = x_cols,\n    cluster_cols = cluster_var\n  )\n\n  set.seed(117504871)\n  obj_ate &lt;- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATE\"\n  )\n  obj_ate$fit()\n  set.seed(16254911)\n  obj_atte &lt;- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATTE\"\n  )\n  obj_atte$fit()\n\n  extract &lt;- function(obj, est) {\n    ci &lt;- obj$confint(level = 0.95)\n    data.table(\n      method = paste0(\"Clustered by \", cluster_var),\n      group = tag,\n      estimand = est,\n      effect = as.numeric(obj$coef),\n      se = as.numeric(obj$se),\n      p_value = as.numeric(obj$pval),\n      ci_low = as.numeric(ci[1, 1]),\n      ci_high = as.numeric(ci[1, 2])\n    )\n  }\n  return(rbind(extract(obj_ate, \"ATE\"), extract(obj_atte, \"ATTE\")))\n}\n\nres_pool_ID &lt;- run_dml_analysis(orc_matched, x_cols_all, \"Pooled\", \"id\")\n\nyears &lt;- sort(unique(orc_matched$yr))\nx_cols_yearly &lt;- setdiff(x_cols_all, \"yr\")\n\nres_year_ID &lt;- rbindlist(lapply(years, function(yy) {\n  run_dml_analysis(orc_matched[yr == yy], x_cols_yearly, as.character(yy), \"id\")\n}))\nres_pool_SUB &lt;- run_dml_analysis(orc_matched, x_cols_all, \"Pooled\", \"subclass\")\n\nres_year_SUB &lt;- rbindlist(lapply(years, function(yy) {\n  run_dml_analysis(\n    orc_matched[yr == yy],\n    x_cols_yearly,\n    as.character(yy),\n    \"subclass\"\n  )\n}))\n\nfinal_comparison_pool &lt;- rbind(res_pool_ID, res_pool_SUB)\nfinal_comparison_year &lt;- rbind(res_year_ID, res_year_SUB)\n\nknitr::kable(\n  final_comparison_pool,\n  digits = 4,\n  caption = \"Pooled: ID vs Subclass Clustering\"\n)\n\n\nPooled: ID vs Subclass Clustering\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ngroup\nestimand\neffect\nse\np_value\nci_low\nci_high\n\n\n\n\nClustered by id\nPooled\nATE\n0.1166\n0.0049\n0\n0.1070\n0.1262\n\n\nClustered by id\nPooled\nATTE\n0.1477\n0.0081\n0\n0.1319\n0.1635\n\n\nClustered by subclass\nPooled\nATE\n0.1192\n0.0049\n0\n0.1095\n0.1289\n\n\nClustered by subclass\nPooled\nATTE\n0.1474\n0.0081\n0\n0.1316\n0.1632\n\n\n\n\nknitr::kable(\n  final_comparison_year,\n  digits = 4,\n  caption = \"Yearly: ID vs Subclass Clustering\"\n)\n\n\nYearly: ID vs Subclass Clustering\n\n\n\n\n\n\n\n\n\n\n\n\nmethod\ngroup\nestimand\neffect\nse\np_value\nci_low\nci_high\n\n\n\n\nClustered by id\n2023\nATE\n0.0834\n0.0077\n0\n0.0682\n0.0985\n\n\nClustered by id\n2023\nATTE\n0.1087\n0.0129\n0\n0.0835\n0.1340\n\n\nClustered by id\n2024\nATE\n0.1406\n0.0098\n0\n0.1215\n0.1597\n\n\nClustered by id\n2024\nATTE\n0.1876\n0.0165\n0\n0.1553\n0.2198\n\n\nClustered by id\n2025\nATE\n0.1221\n0.0083\n0\n0.1058\n0.1383\n\n\nClustered by id\n2025\nATTE\n0.1578\n0.0137\n0\n0.1311\n0.1846\n\n\nClustered by subclass\n2023\nATE\n0.0839\n0.0077\n0\n0.0687\n0.0991\n\n\nClustered by subclass\n2023\nATTE\n0.1072\n0.0128\n0\n0.0821\n0.1323\n\n\nClustered by subclass\n2024\nATE\n0.1397\n0.0097\n0\n0.1207\n0.1587\n\n\nClustered by subclass\n2024\nATTE\n0.1868\n0.0165\n0\n0.1545\n0.2192\n\n\nClustered by subclass\n2025\nATE\n0.1228\n0.0083\n0\n0.1066\n0.1391\n\n\nClustered by subclass\n2025\nATTE\n0.1564\n0.0136\n0\n0.1297\n0.1830\n\n\n\n\nlibrary(DHARMa)\n\nrun_dml_extended &lt;- function(data, x_cols, tag, cluster_var) {\n  dml_data &lt;- DoubleMLClusterData$new(\n    data = as.data.frame(data),\n    y_col = \"vm\",\n    d_cols = \"treat\",\n    x_cols = x_cols,\n    cluster_cols = cluster_var\n  )\n\n  set.seed(68235576)\n  obj_ate &lt;- DoubleMLIRM$new(dml_data, ml_g = ml_g, ml_m = ml_m, n_folds = 3)\n  obj_ate$fit(store_predictions = TRUE)\n  preds_g0 &lt;- obj_ate$predictions$ml_g0[, 1, 1]\n  preds_g1 &lt;- obj_ate$predictions$ml_g1[, 1, 1]\n  dml_fitted &lt;- ifelse(data$treat == 1, preds_g1, preds_g0)\n  current_mse &lt;- mean((data$vm - dml_fitted)^2)\n\n  set.seed(65196489)\n  sim_response &lt;- replicate(250, rpois(length(dml_fitted), dml_fitted))\n  dharma_res &lt;- createDHARMa(\n    simulatedResponse = sim_response,\n    observedResponse = data$vm,\n    fittedPredictedResponse = dml_fitted,\n    integerResponse = TRUE\n  )\n  ci &lt;- obj_ate$confint(level = 0.95)\n  res_table &lt;- data.table(\n    method = paste0(\"Clustered by \", cluster_var),\n    group = tag,\n    effect = as.numeric(obj_ate$coef),\n    se = as.numeric(obj_ate$se),\n    p_value = as.numeric(obj_ate$pval),\n    mse = current_mse,\n    ci_low = as.numeric(ci[1, 1]),\n    ci_high = as.numeric(ci[1, 2])\n  )\n\n  return(list(table = res_table, dharma = dharma_res, fitted = dml_fitted))\n}\n\nml_g &lt;- lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\nml_m &lt;- lrn(\"classif.ranger\", num.trees = 500, max.depth = 5)\n\npooled_analysis_SUB &lt;- run_dml_extended(\n  orc_matched,\n  x_cols_all,\n  \"Pooled\",\n  \"subclass\"\n)\n\ncat(\"\\n--- DML Model Summary (Clustered by Subclass) ---\\n\")\n\n\n--- DML Model Summary (Clustered by Subclass) ---\n\nprint(pooled_analysis_SUB$table)\n\n                  method  group    effect          se       p_value       mse\n                  &lt;char&gt; &lt;char&gt;     &lt;num&gt;       &lt;num&gt;         &lt;num&gt;     &lt;num&gt;\n1: Clustered by subclass Pooled 0.1173772 0.004912666 3.642154e-126 0.2056631\n      ci_low   ci_high\n       &lt;num&gt;     &lt;num&gt;\n1: 0.1077485 0.1270058\n\ncat(\"\\n--- DHARMa Diagnostics ---\\n\")\n\n\n--- DHARMa Diagnostics ---\n\nplot(pooled_analysis_SUB$dharma)\n\n\n\n\n\n\n\ntestOutliers(pooled_analysis_SUB$dharma, type = \"bootstrap\")\n\n\n\n\n\n\n\n\n\n    DHARMa bootstrapped outlier test\n\ndata:  pooled_analysis_SUB$dharma\noutliers at both margin(s) = 44, observations = 14520, p-value &lt;\n2.2e-16\nalternative hypothesis: two.sided\n percent confidence interval:\n 0.001203512 0.002377755\nsample estimates:\noutlier frequency (expected: 0.00176721763085399 ) \n                                       0.003030303 \n\ntestDispersion(pooled_analysis_SUB$dharma)\n\n\n\n\n\n\n\n\n\n    DHARMa nonparametric dispersion test via sd of residuals fitted vs.\n    simulated\n\ndata:  simulationOutput\ndispersion = 1.2939, p-value &lt; 2.2e-16\nalternative hypothesis: two.sided\n\ntestZeroInflation(pooled_analysis_SUB$dharma)\n\n\n\n\n\n\n\n\n\n    DHARMa zero-inflation test via comparison to expected zeros with\n    simulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.0664, p-value &lt; 2.2e-16\nalternative hypothesis: two.sided\n\ncat(\"\\n--- Model Performance Comparison ---\\n\")\n\n\n--- Model Performance Comparison ---\n\ncat(\"GLMM MSE:\", round(mse_glmm, 6), \"\\n\")\n\nGLMM MSE: 0.033648 \n\ncat(\"DML MSE: \", round(pooled_analysis_SUB$table$mse, 6), \"\\n\")\n\nDML MSE:  0.205663 \n\nml_g &lt;- lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\nml_m &lt;- lrn(\"classif.ranger\", num.trees = 500, max.depth = 5)\nx_cols_all &lt;- c(\"ag\", \"sg\", \"rc\", \"yr\", \"a1\", \"a2\", \"a4\", \"a5\", \"a7\", \"a8\")\nx_cols_with_dist &lt;- c(x_cols_all, \"distance\")\nyears &lt;- sort(unique(orc_matched$yr))\n\nrun_dml_stable &lt;- function(data, x_cols, tag, cluster_var) {\n  dml_data &lt;- DoubleMLClusterData$new(\n    data = as.data.frame(data),\n    y_col = \"vm\",\n    d_cols = \"treat\",\n    x_cols = x_cols,\n    cluster_cols = cluster_var\n  )\n\n  set.seed(54893769)\n  obj_ate &lt;- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATE\"\n  )$fit(store_predictions = TRUE)\n  set.seed(6549875)\n  obj_atte &lt;- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATTE\"\n  )$fit(store_predictions = TRUE)\n\n  # mse\n  preds_g0 &lt;- obj_ate$predictions$ml_g0[, 1, 1]\n  preds_g1 &lt;- obj_ate$predictions$ml_g1[, 1, 1]\n  dml_fitted &lt;- ifelse(data$treat == 1, preds_g1, preds_g0)\n  calc_mse &lt;- mean((data$vm - dml_fitted)^2)\n\n  extract &lt;- function(obj, est) {\n    ci &lt;- obj$confint(level = 0.95)\n    data.table(\n      method = paste0(\"Clustered by \", cluster_var),\n      group = tag,\n      estimand = est,\n      effect = as.numeric(obj$coef),\n      se = as.numeric(obj$se),\n      p_value = as.numeric(obj$pval),\n      mse = calc_mse,\n      ci_low = as.numeric(ci[1, 1]),\n      ci_high = as.numeric(ci[1, 2])\n    )\n  }\n  return(rbind(extract(obj_ate, \"ATE\"), extract(obj_atte, \"ATTE\")))\n}\n\nall_results_list &lt;- list()\n\nfor (yy in years) {\n  x_yearly &lt;- setdiff(x_cols_all, \"yr\")\n  all_results_list[[paste0(\"ID_\", yy)]] &lt;- run_dml_stable(\n    orc_matched[yr == yy],\n    x_yearly,\n    as.character(yy),\n    \"id\"\n  )\n  all_results_list[[paste0(\"SUB_\", yy)]] &lt;- run_dml_stable(\n    orc_matched[yr == yy],\n    x_yearly,\n    as.character(yy),\n    \"subclass\"\n  )\n}\n\nall_results_list[[\"Pool_23_25_ID\"]] &lt;- run_dml_stable(\n  orc_matched,\n  x_cols_all,\n  \"Pool (23-25)\",\n  \"id\"\n)\nall_results_list[[\"Pool_23_25_SUB\"]] &lt;- run_dml_stable(\n  orc_matched,\n  x_cols_all,\n  \"Pool (23-25)\",\n  \"subclass\"\n)\nall_results_list[[\"Pool_23_24_SUB\"]] &lt;- run_dml_stable(\n  orc_matched[yr %in% c(\"2023\", \"2024\")],\n  x_cols_all,\n  \"Pool (23-24)\",\n  \"subclass\"\n)\nall_results_list[[\"Pool_24_25_SUB\"]] &lt;- run_dml_stable(\n  orc_matched[yr %in% c(\"2024\", \"2025\")],\n  x_cols_all,\n  \"Pool (24-25)\",\n  \"subclass\"\n)\n\nall_results_list[[\"Pool_Dist_Adj\"]] &lt;- run_dml_stable(\n  orc_matched,\n  x_cols_with_dist,\n  \"Pool (Dist-Adj)\",\n  \"subclass\"\n)\n\nm_results &lt;- rbindlist(all_results_list, fill = TRUE)\n\nm_results[, t_stat := abs(effect / se)]\nm_results[, df := 1000] # DF for SEs\nm_results[, RV := round(t_stat / sqrt(df), 4)]\nm_results[,\n  sig := cut(\n    p_value,\n    breaks = c(-Inf, 0.01, 0.05, 0.1, Inf),\n    label = c(\"***\", \"**\", \"*\", \"\")\n  )\n]\n\nknitr::kable(\n  m_results[\n    order(group, method),\n    .(group, method, estimand, effect, se, sig, RV, mse)\n  ],\n  digits = 4,\n  caption = \"Final Consolidated DML Results\"\n)\n\n\nFinal Consolidated DML Results\n\n\n\n\n\n\n\n\n\n\n\n\ngroup\nmethod\nestimand\neffect\nse\nsig\nRV\nmse\n\n\n\n\n2023\nClustered by id\nATE\n0.0836\n0.0077\n***\n0.3445\n0.1636\n\n\n2023\nClustered by id\nATTE\n0.1069\n0.0128\n***\n0.2650\n0.1636\n\n\n2023\nClustered by subclass\nATE\n0.0835\n0.0077\n***\n0.3410\n0.1640\n\n\n2023\nClustered by subclass\nATTE\n0.1092\n0.0129\n***\n0.2670\n0.1640\n\n\n2024\nClustered by id\nATE\n0.1373\n0.0095\n***\n0.4550\n0.2288\n\n\n2024\nClustered by id\nATTE\n0.1873\n0.0165\n***\n0.3583\n0.2288\n\n\n2024\nClustered by subclass\nATE\n0.1391\n0.0098\n***\n0.4510\n0.2284\n\n\n2024\nClustered by subclass\nATTE\n0.1871\n0.0165\n***\n0.3579\n0.2284\n\n\n2025\nClustered by id\nATE\n0.1222\n0.0082\n***\n0.4688\n0.2253\n\n\n2025\nClustered by id\nATTE\n0.1546\n0.0136\n***\n0.3584\n0.2253\n\n\n2025\nClustered by subclass\nATE\n0.1227\n0.0081\n***\n0.4761\n0.2252\n\n\n2025\nClustered by subclass\nATTE\n0.1559\n0.0136\n***\n0.3624\n0.2252\n\n\nPool (23-24)\nClustered by subclass\nATE\n0.1143\n0.0063\n***\n0.5749\n0.2081\n\n\nPool (23-24)\nClustered by subclass\nATTE\n0.1398\n0.0100\n***\n0.4410\n0.2081\n\n\nPool (23-25)\nClustered by id\nATE\n0.1173\n0.0049\n***\n0.7550\n0.2067\n\n\nPool (23-25)\nClustered by id\nATTE\n0.1476\n0.0081\n***\n0.5768\n0.2067\n\n\nPool (23-25)\nClustered by subclass\nATE\n0.1183\n0.0050\n***\n0.7545\n0.2081\n\n\nPool (23-25)\nClustered by subclass\nATTE\n0.1481\n0.0081\n***\n0.5786\n0.2081\n\n\nPool (24-25)\nClustered by subclass\nATE\n0.1309\n0.0063\n***\n0.6605\n0.2327\n\n\nPool (24-25)\nClustered by subclass\nATTE\n0.1656\n0.0103\n***\n0.5090\n0.2327\n\n\nPool (Dist-Adj)\nClustered by subclass\nATE\n0.1220\n0.0052\n***\n0.7456\n0.2242\n\n\nPool (Dist-Adj)\nClustered by subclass\nATTE\n0.1514\n0.0083\n***\n0.5787\n0.2242\n\n\n\n\nplot_data1b &lt;- copy(m_results)\nplot_data1b[,\n  group := factor(\n    group,\n    levels = rev(c(\n      as.character(years),\n      \"Pool (23-24)\",\n      \"Pool (24-25)\",\n      \"Pool (23-25)\",\n      \"Pool (Dist-Adj)\"\n    ))\n  )\n]\n\nggplot(plot_data1b, aes(x = effect, y = group, color = method)) +\n  geom_vline(xintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  geom_errorbarh(\n    aes(xmin = ci_low, xmax = ci_high),\n    height = 0.3,\n    position = position_dodge(width = 0.6)\n  ) +\n  geom_point(position = position_dodge(width = 0.6), size = 3) +\n  facet_wrap(~estimand) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(\n    title = \"DMLIRM Effect Stability\",\n    x = \"Average Policy Effects of Treatment Variable\",\n    y = \" Computational Model\"\n  ) +\n  theme_minimal()\n\n\n\n\n\n\n\nset.seed(5469257)\nm.out1a &lt;- matchit(\n  treat ~ ag + sg + yr,\n  data = orc,\n  method = \"nearest\",\n  distance = \"glm\",\n)\n\norc_matched1b &lt;- match.data(m.out1a)\n\nlove_plot1b &lt;- love.plot(\n  m.out1a,\n  binary = \"std\",\n  thresholds = c(m = .1),\n  abs = TRUE,\n  stars = \"std\",\n  line = TRUE,\n  sample.names = c(\"Original (Pre-Match)\", \"Matched (Final Sample)\"),\n  colors = c(\"#d62728\", \"#1f77b4\"),\n  title = \"Covariate Balance\"\n)\nprint(love_plot1b)\n\n\n\n\n\n\n\nmodel_final_thesis1b &lt;- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched1b,\n  family = nbinom2,\n  weights = weights,\n  control = glmmTMBControl(optimizer = optim, optArgs = list(method = \"BFGS\"))\n)\nfix_eff1b &lt;- summary(model_final_thesis1b)$coefficients$cond\nresults_final1b &lt;- data.frame(\n  Variable = rownames(fix_eff1b),\n  IRR = exp(fix_eff1b[, \"Estimate\"]),\n  P_Value = fix_eff1b[, \"Pr(&gt;|z|)\"]\n)\nprint(results_final1b)\n\n               Variable       IRR      P_Value\n(Intercept) (Intercept) 0.2425918 1.296662e-01\ntreat             treat 1.3372328 1.993339e-08\nag.L               ag.L 1.0302247 6.530468e-01\nag.Q               ag.Q 1.0181020 6.734231e-01\nsgF                 sgF 0.9001589 3.030295e-01\nyr.L               yr.L 0.9919424 8.290195e-01\nyr.Q               yr.Q 0.9915779 8.294083e-01\n\n# DML robustness test confirms the GLMM via non-linear RF ?:!\ndml_data1b &lt;- copy(orc_matched1b)\ndml_data1b[, `:=`(\n  sg = as.numeric(sg),\n  ag = as.numeric(ag),\n  yr = as.numeric(yr)\n)]\n\ndata_dml_obj1b = double_ml_data_from_data_frame(\n  as.data.frame(dml_data1b),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\")\n)\n\nl_ranger1b = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5) # nuisance param\ndml_model1b = DoubleMLPLR$new(\n  data_dml_obj1b,\n  ml_l = l_ranger1b,\n  ml_m = l_ranger1b,\n  n_folds = 3\n)\ndml_model1b$fit()\nprint(dml_model1b$summary())\n\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(&gt;|t|)    \ntreat   0.18635    0.01049   17.76   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value     Pr(&gt;|t|)\ntreat 0.1863547 0.01049039 17.76433 1.335209e-70\n\nfit_raw &lt;- glm(vm ~ treat, data = orc, family = poisson()) # baseline\nate_raw &lt;- exp(coef(fit_raw)[\"treat\"])\n# adjusted gcomp log/poisson of outcome via treatment and covariates\nfit_adj &lt;- glm(vm ~ treat + ag + sg + yr + rc, data = orc, family = poisson())\n# ATE of marginality\ndata_t1 &lt;- copy(orc)[, treat := 1]\ndata_t0 &lt;- copy(orc)[, treat := 0]\nate_gcomp &lt;- mean(predict(fit_adj, data_t1, type = \"response\")) /\n  mean(predict(fit_adj, data_t0, type = \"response\"))\n\nm_near &lt;- matchit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"nearest\",\n  distance = \"glm\"\n) # PSM\nd_near &lt;- match.data(m_near)\n# psm subclassification: 'subclass' blocks\nm_sub &lt;- matchit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"subclass\",\n  subclass = 10\n)\nd_sub &lt;- match.data(m_sub)\n\nlibrary(WeightIt)\nlibrary(survey)\n\nw_ipw &lt;- weightit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"ps\",\n  estimand = \"ATE\"\n)\n\nfit_ipw &lt;- glm(\n  vm ~ treat,\n  data = orc,\n  weights = w_ipw$weights,\n  family = poisson()\n)\n\nlibrary(AIPW)\nlibrary(SuperLearner)\nlibrary(glmmTMB)\nlibrary(pscl)\nresults_list &lt;- list()\n\nresults_list[[\"Baseline_Raw\"]] &lt;- exp(coef(glm(\n  vm ~ treat,\n  data = orc,\n  family = poisson\n))[\"treat\"])\n\nfit_adj &lt;- glm(vm ~ treat + ag + sg + yr + rc, data = orc, family = poisson)\nresults_list[[\"Adjusted_GComp\"]] &lt;- exp(coef(fit_adj)[\"treat\"])\n\nm_near &lt;- matchit(treat ~ ag + sg + yr + rc, data = orc, method = \"nearest\")\nd_near &lt;- match.data(m_near)\nresults_list[[\"PSM_Nearest\"]] &lt;- exp(fixef(glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = d_near,\n  family = poisson\n))$cond[\"treat\"])\n\nm_sub &lt;- matchit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"subclass\",\n  subclass = 5\n)\nd_sub &lt;- match.data(m_sub)\nresults_list[[\"PSM_Subclass\"]] &lt;- exp(fixef(glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = d_sub,\n  family = poisson\n))$cond[\"treat\"])\n\nw_ipw &lt;- weightit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"ps\",\n  estimand = \"ATE\"\n)\nresults_list[[\"IPW_Weighted\"]] &lt;- exp(coef(glm(\n  vm ~ treat,\n  data = orc,\n  weights = w_ipw$weights,\n  family = poisson\n))[\"treat\"])\n\n# nb given overdispersion ?:!\nmod_nbin &lt;- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = d_near,\n  family = nbinom2\n)\nresults_list[[\"NegBinomial\"]] &lt;- exp(fixef(mod_nbin)$cond[\"treat\"])\n\n# zinb\nmod_zinb &lt;- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  ziformula = ~1,\n  data = d_near,\n  family = nbinom2\n)\nresults_list[[\"ZINB_Model\"]] &lt;- exp(fixef(mod_zinb)$cond[\"treat\"])\nvalidation_table &lt;- data.frame(\n  Method = names(results_list),\n  IRR_Estimate = unlist(results_list)\n)\nprint(validation_table)\n\n                             Method IRR_Estimate\nBaseline_Raw.treat     Baseline_Raw     4.273060\nAdjusted_GComp.treat Adjusted_GComp     1.338768\nPSM_Nearest.treat       PSM_Nearest     1.349855\nPSM_Subclass.treat     PSM_Subclass     1.339447\nIPW_Weighted.treat     IPW_Weighted     1.338755\nNegBinomial.treat       NegBinomial     1.349856\nZINB_Model.treat         ZINB_Model     1.349856\n\nlibrary(AIPW)\nlibrary(randomForest)\nlibrary(gbm3)\nlibrary(SuperLearner)\nsl_libs &lt;- c(\"SL.glmnet\", \"SL.xgboost\", \"SL.glm\", \"SL.mean\")\ncov &lt;- c(\"ag\", \"sg\", \"yr\", \"rg\")\naipw_obj1a &lt;- AIPW$new(\n  Y = orc_matched$vm,\n  A = orc_matched$treat,\n  W = subset(orc_matched, select = cov),\n  Q.SL.library = sl_libs,\n  g.SL.library = sl_libs,\n  k_split = 10,\n  verbose = TRUE\n)\n\naipw_obj1a$fit()\naipw_obj1a$stratified_fit()\naipw_obj1a$summary()\n\n                    Estimate      SE 95% LCL 95% UCL     N\nMean of Exposure       0.173 0.00580  0.1612  0.1839  7260\nMean of Control        0.128 0.00430  0.1191  0.1360  7260\nMean Difference        0.045 0.00302  0.0390  0.0509 14520\nATT Mean Difference    0.066 0.00461  0.0569  0.0750 14520\nATC Mean Difference    0.024 0.00206  0.0199  0.0280 14520\n\naipw_obj1a$plot.p_score(print.ip_weights = TRUE)\n\n\n\n\n\n\n\naipw_obj1a$plot.ip_weights()\n\n\n\n\n\n\n\norcmatch_temp &lt;- copy(orc_matched1b)\norcmatch_temp[, weights := NULL]\norcmatch_temp[, treat := NULL]\norcmatch_temp[, distance := NULL]\norcmatch_temp[, subclass := NULL]\norcmatch_temp[,\n  ag := fcase(\n    ag == 21   , \"21\"   ,\n    ag == 42   , \"42\"   ,\n    ag == 57.5 , \"57.5\"\n  )\n]\norcmatch_temp[, rc := as.factor(rc)]\norcmatch_temp[,\n  ag := factor(ag, levels = c(\"21\", \"42\", \"57.5\"), ordered = TRUE)\n]\norcmatch_temp[, sg := factor(sg)]\norcmatch_temp[, yr := factor(yr, levels = sort(unique(yr)), ordered = TRUE)]\norcmatch_temp$norm_weights &lt;- orcmatch_temp$np / mean(orcmatch_temp$np)\nstr(orcmatch_temp[, .(yr, norm_weights, ag, sg)])\n\nClasses 'matchdata', 'data.table' and 'data.frame': 14520 obs. of  4 variables:\n $ yr          : Ord.factor w/ 3 levels \"2023\"&lt;\"2024\"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...\n $ norm_weights: num  0.877 0.232 1.058 1.161 0.413 ...\n $ ag          : Ord.factor w/ 3 levels \"21\"&lt;\"42\"&lt;\"57.5\": 2 2 2 2 3 3 3 3 2 2 ...\n $ sg          : Factor w/ 2 levels \"M\",\"F\": 1 1 1 1 1 1 1 1 1 1 ...\n - attr(*, \".internal.selfref\")=&lt;externalptr&gt; \n\norcmatch_temp[, treat := as.numeric(ac &gt;= median(ac))]\nmodout &lt;- matchit(\n  treat ~ ag + sg + yr + rg,\n  data = orcmatch_temp,\n  distance = \"cbps\",\n  estimand = \"ATC\",\n  distance.options = list(method =\"exact\"),\n  replace = FALSE\n)\nmodout$model$coefficients\n\n                 Treated\n(Intercept)  1.074180658\nag.L        -0.023798449\nag.Q        -0.002682600\nsgF         -0.039661234\nyr.L         0.026371435\nyr.Q         0.005070966\nrg          -1.007400078\n\nmodout$model$var\n\n              (Intercept)          ag.L          ag.Q           sgF\n(Intercept)  0.0053016181  1.093081e-04  2.999696e-04 -1.010579e-04\nag.L         0.0001093081  3.349526e-04  1.156739e-04  4.132592e-05\nag.Q         0.0002999696  1.156739e-04  3.644225e-04  2.836486e-05\nsgF         -0.0001010579  4.132592e-05  2.836486e-05  2.739531e-04\nyr.L        -0.0000892365 -2.470722e-05 -6.279140e-06 -5.227314e-05\nyr.Q        -0.0000971804  1.051907e-05  1.750383e-05 -5.736243e-06\nrg          -0.0011899421  1.106198e-05  1.928462e-05  1.161580e-05\n                     yr.L          yr.Q            rg\n(Intercept) -8.923650e-05 -9.718040e-05 -1.189942e-03\nag.L        -2.470722e-05  1.051907e-05  1.106198e-05\nag.Q        -6.279140e-06  1.750383e-05  1.928462e-05\nsgF         -5.227314e-05 -5.736243e-06  1.161580e-05\nyr.L         2.962879e-04 -2.242514e-05  1.438637e-05\nyr.Q        -2.242514e-05  3.020457e-04  2.828130e-05\nrg           1.438637e-05  2.828130e-05  3.080084e-04\n\nmodout$model$deviance\n\n[1] 19886.95\n\nmodout$model$J\n\n[1] 0.0005695698\n\nmodout$model$mle.J\n\n[1] 0.0005744275\n\nmodout$model$method\n\n[1] \"exact\"\n\nmodout$model$terms\n\ntreat ~ ag + sg + yr + rg\nattr(,\"variables\")\nlist(treat, ag, sg, yr, rg)\nattr(,\"factors\")\n      ag sg yr rg\ntreat  0  0  0  0\nag     1  0  0  0\nsg     0  1  0  0\nyr     0  0  1  0\nrg     0  0  0  1\nattr(,\"term.labels\")\n[1] \"ag\" \"sg\" \"yr\" \"rg\"\nattr(,\"order\")\n[1] 1 1 1 1\nattr(,\"intercept\")\n[1] 1\nattr(,\"response\")\n[1] 1\nattr(,\".Environment\")\n&lt;environment: R_GlobalEnv&gt;\nattr(,\"predvars\")\nlist(treat, ag, sg, yr, rg)\nattr(,\"dataClasses\")\n    treat        ag        sg        yr        rg \n\"numeric\" \"ordered\"  \"factor\" \"ordered\" \"numeric\" \n\nmodout$model$formula\n\ntreat ~ ag + sg + yr + rg\n\nmodsum &lt;- summary(modout)\nsummary(modout)\n\n\nCall:\nmatchit(formula = treat ~ ag + sg + yr + rg, data = orcmatch_temp, \n    distance = \"cbps\", distance.options = list(method = \"exact\"), \n    estimand = \"ATC\", replace = FALSE)\n\nSummary of Balance for All Data:\n         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance        0.4921        0.5079         -0.3482     2.7489    0.0295\nag21            0.1485        0.1485          0.0000          .    0.0000\nag42            0.7590        0.7590          0.0000          .    0.0000\nag57.5          0.0926        0.0926          0.0000          .    0.0000\nsgM             0.8986        0.8986          0.0000          .    0.0000\nsgF             0.1014        0.1014          0.0000          .    0.0000\nyr2023          0.3150        0.3150          0.0000          .    0.0000\nyr2024          0.3023        0.3023          0.0000          .    0.0000\nyr2025          0.3826        0.3826          0.0000          .    0.0000\nrg              1.1069        1.0375          0.3536     2.9272    0.0174\n         eCDF Max\ndistance   0.0624\nag21       0.0000\nag42       0.0000\nag57.5     0.0000\nsgM        0.0000\nsgF        0.0000\nyr2023     0.0000\nyr2024     0.0000\nyr2025     0.0000\nrg         0.0624\n\nSummary of Balance for Matched Data:\n         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance        0.4921        0.5079         -0.3482     2.7489    0.0295\nag21            0.1485        0.1485          0.0000          .    0.0000\nag42            0.7590        0.7590          0.0000          .    0.0000\nag57.5          0.0926        0.0926          0.0000          .    0.0000\nsgM             0.8986        0.8986          0.0000          .    0.0000\nsgF             0.1014        0.1014          0.0000          .    0.0000\nyr2023          0.3150        0.3150          0.0000          .    0.0000\nyr2024          0.3023        0.3023          0.0000          .    0.0000\nyr2025          0.3826        0.3826          0.0000          .    0.0000\nrg              1.1069        1.0375          0.3536     2.9272    0.0174\n         eCDF Max Std. Pair Dist.\ndistance   0.0624          0.3675\nag21       0.0000          0.2231\nag42       0.0000          0.1686\nag57.5     0.0000          0.0747\nsgM        0.0000          0.0339\nsgF        0.0000          0.0339\nyr2023     0.0000          0.1135\nyr2024     0.0000          0.1521\nyr2025     0.0000          0.1565\nrg         0.0624          0.3536\n\nSample Sizes:\n          Control Treated\nAll          7260    7260\nMatched      7260    7260\nUnmatched       0       0\nDiscarded       0       0\n\nmodout1a &lt;- matchit(\n  treat ~ ag + sg + yr + rg,\n  data = orcmatch_temp,\n  distance = \"gam\",\n  replace = TRUE\n)\nmodsum1a &lt;- summary(modout1a$model)\nsummary(modout1a$model)\n\n\nFamily: quasibinomial \nLink function: logit \n\nFormula:\ntreat ~ ag + sg + yr + rg\n\nParametric coefficients:\n             Estimate Std. Error t value Pr(&gt;|t|)    \n(Intercept) -1.083370   0.078555 -13.791   &lt;2e-16 ***\nag.L         0.024002   0.049632   0.484    0.629    \nag.Q         0.002706   0.032627   0.083    0.934    \nsgF          0.040001   0.055542   0.720    0.471    \nyr.L        -0.026597   0.028592  -0.930    0.352    \nyr.Q        -0.005114   0.029792  -0.172    0.864    \nrg           1.016018   0.070606  14.390   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nR-sq.(adj) =  0.0155   Deviance explained =  1.2%\nGCV = 1.3709  Scale est. = 1.0005    n = 14520\n\np.score &lt;- fitted(glm(\n  treat ~ ag + sg + yr + norm_weights,\n  data = orcmatch_temp,\n  family = binomial\n))\nmodout1b &lt;- matchit(\n  treat ~ ag + sg + yr + norm_weights,\n  data = orcmatch_temp,\n  distance = p.score\n)\nmodsum1b &lt;- summary(modout1b$model)\nsummary(modout1b$model)\n\nLength  Class   Mode \n     0   NULL   NULL \n\ny1a &lt;- orcmatch_temp[orcmatch_temp$yr == 2023, ]\ny1b &lt;- orcmatch_temp[orcmatch_temp$yr == 2024, ]\ny1c &lt;- orcmatch_temp[orcmatch_temp$yr == 2025, ]\nfull_mod &lt;- lm(vm ~ . - id, data = orcmatch_temp)\nbackstep &lt;- stats::step(full_mod, direction = \"backward\")\n\nStart:  AIC=-47581.54\nvm ~ (yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + id + rc + norm_weights + treat) - id\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + a8 + \n    rc + treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + rc + \n    treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a5     1       0.0  545.2 -47584\n- a2     1       0.0  545.3 -47583\n- yr     2       0.1  545.3 -47583\n- ag     2       0.1  545.3 -47583\n- a7     1       0.0  545.3 -47582\n- sg     1       0.0  545.3 -47582\n- a1     1       0.1  545.3 -47582\n&lt;none&gt;                545.2 -47582\n- np     1       0.2  545.4 -47579\n- a4     1       0.3  545.5 -47576\n- treat  1       8.0  553.2 -47373\n- ac     1      19.5  564.7 -47073\n- rc    23    5109.5 5654.7 -13665\n\nStep:  AIC=-47583.52\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a2     1       0.0  545.3 -47585\n- yr     2       0.1  545.3 -47585\n- ag     2       0.1  545.3 -47585\n- a7     1       0.0  545.3 -47584\n- sg     1       0.0  545.3 -47584\n- a1     1       0.1  545.3 -47584\n&lt;none&gt;                545.2 -47584\n- np     1       0.2  545.4 -47581\n- a4     1       0.3  545.5 -47578\n- treat  1       8.0  553.2 -47375\n- ac     1      19.6  564.8 -47073\n- rc    23    5109.5 5654.7 -13667\n\nStep:  AIC=-47585.1\nvm ~ yr + ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- yr     2       0.1  545.4 -47586\n- ag     2       0.1  545.4 -47586\n- a7     1       0.0  545.3 -47586\n- a1     1       0.0  545.3 -47586\n- sg     1       0.1  545.3 -47586\n&lt;none&gt;                545.3 -47585\n- np     1       0.2  545.4 -47583\n- a4     1       0.3  545.5 -47580\n- treat  1       8.0  553.2 -47377\n- ac     1      19.7  564.9 -47072\n- rc    23    5109.8 5655.0 -13668\n\nStep:  AIC=-47586.25\nvm ~ ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- ag     2       0.1  545.5 -47587\n- a7     1       0.0  545.4 -47587\n- a1     1       0.1  545.4 -47587\n- sg     1       0.1  545.4 -47587\n&lt;none&gt;                545.4 -47586\n- np     1       0.2  545.6 -47583\n- a4     1       0.3  545.6 -47581\n- treat  1       8.0  553.3 -47378\n- ac     1      19.7  565.1 -47073\n- rc    23    5120.1 5665.5 -13645\n\nStep:  AIC=-47587.37\nvm ~ sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a7     1       0.0  545.5 -47588\n- a1     1       0.1  545.5 -47588\n- sg     1       0.1  545.5 -47588\n&lt;none&gt;                545.5 -47587\n- np     1       0.2  545.7 -47584\n- a4     1       0.3  545.7 -47582\n- treat  1       7.9  553.4 -47380\n- ac     1      19.7  565.2 -47074\n- rc    23    5123.0 5668.5 -13642\n\nStep:  AIC=-47588.27\nvm ~ sg + np + ac + a1 + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a1     1       0.1  545.6 -47589\n- sg     1       0.1  545.6 -47588\n&lt;none&gt;                545.5 -47588\n- np     1       0.2  545.7 -47585\n- a4     1       0.3  545.8 -47583\n- treat  1       8.0  553.5 -47380\n- ac     1      20.0  565.5 -47068\n- rc    23    5123.0 5668.5 -13644\n\nStep:  AIC=-47588.87\nvm ~ sg + np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- sg     1       0.1  545.6 -47589\n&lt;none&gt;                545.6 -47589\n- np     1       0.1  545.7 -47587\n- a4     1       0.2  545.8 -47584\n- treat  1       7.9  553.5 -47382\n- ac     1      20.0  565.6 -47067\n- rc    23    5123.4 5668.9 -13644\n\nStep:  AIC=-47589.14\nvm ~ np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n&lt;none&gt;                545.6 -47589\n- np     1       0.1  545.7 -47588\n- a4     1       0.2  545.9 -47585\n- treat  1       7.9  553.6 -47381\n- ac     1      20.1  565.7 -47067\n- rc    23    5130.8 5676.5 -13627\n\nfrontstep &lt;- stats::step(\n  lm(vm ~ 1, data = orcmatch_temp),\n  scope = formula(full_mod),\n  direction = \"forward\"\n)\n\nStart:  AIC=-12930.38\nvm ~ 1\n\n               Df Sum of Sq    RSS    AIC\n+ rc           23    5389.0  569.8 -46968\n+ rg            1    5340.7  618.1 -45831\n+ ac            1     227.6 5731.2 -13494\n+ treat         1     126.4 5832.3 -13240\n+ np            1      89.6 5869.2 -13148\n+ norm_weights  1      89.6 5869.2 -13148\n+ a1            1      45.0 5913.7 -13039\n+ a8            1      18.2 5940.6 -12973\n+ yr            2      15.4 5943.4 -12964\n+ sg            1      11.3 5947.5 -12956\n+ a7            1      11.2 5947.6 -12956\n+ a4            1       8.9 5949.9 -12950\n+ a5            1       8.4 5950.4 -12949\n+ a2            1       3.9 5954.9 -12938\n+ ag            2       2.8 5956.0 -12933\n&lt;none&gt;                      5958.8 -12930\n\nStep:  AIC=-46967.87\nvm ~ rc\n\n               Df Sum of Sq    RSS    AIC\n+ ac            1   15.9938 553.80 -47379\n+ treat         1    3.9094 565.88 -47066\n+ a7            1    0.7024 569.09 -46984\n+ a4            1    0.3932 569.40 -46976\n+ a1            1    0.3331 569.46 -46974\n+ a8            1    0.2641 569.53 -46973\n+ a5            1    0.2088 569.59 -46971\n+ np            1    0.1989 569.60 -46971\n+ norm_weights  1    0.1989 569.60 -46971\n+ a2            1    0.1469 569.65 -46970\n+ sg            1    0.0931 569.70 -46968\n&lt;none&gt;                      569.79 -46968\n+ yr            2    0.1530 569.64 -46968\n+ ag            2    0.0969 569.70 -46966\n\nStep:  AIC=-47379.26\nvm ~ rc + ac\n\n               Df Sum of Sq    RSS    AIC\n+ treat         1    7.8819 545.92 -47585\n+ a8            1    0.1932 553.61 -47382\n+ a4            1    0.0864 553.71 -47380\n+ sg            1    0.0776 553.72 -47379\n+ np            1    0.0770 553.72 -47379\n+ norm_weights  1    0.0770 553.72 -47379\n&lt;none&gt;                      553.80 -47379\n+ yr            2    0.1402 553.66 -47379\n+ a7            1    0.0472 553.75 -47379\n+ ag            2    0.0987 553.70 -47378\n+ a5            1    0.0169 553.78 -47378\n+ a1            1    0.0114 553.79 -47378\n+ a2            1    0.0004 553.80 -47377\n\nStep:  AIC=-47585.4\nvm ~ rc + ac + treat\n\n               Df Sum of Sq    RSS    AIC\n+ a8            1  0.232295 545.69 -47590\n+ a4            1  0.169176 545.75 -47588\n&lt;none&gt;                      545.92 -47585\n+ yr            2  0.140836 545.78 -47585\n+ sg            1  0.054487 545.86 -47585\n+ np            1  0.049841 545.87 -47585\n+ norm_weights  1  0.049841 545.87 -47585\n+ ag            2  0.116231 545.80 -47584\n+ a7            1  0.034851 545.88 -47584\n+ a5            1  0.015094 545.90 -47584\n+ a1            1  0.000607 545.92 -47583\n+ a2            1  0.000040 545.92 -47583\n\nStep:  AIC=-47589.58\nvm ~ rc + ac + treat + a8\n\n               Df Sum of Sq    RSS    AIC\n+ a4            1  0.139125 545.55 -47591\n&lt;none&gt;                      545.69 -47590\n+ sg            1  0.068728 545.62 -47589\n+ ag            2  0.115092 545.57 -47589\n+ yr            2  0.111342 545.57 -47589\n+ a7            1  0.025486 545.66 -47588\n+ np            1  0.016027 545.67 -47588\n+ norm_weights  1  0.016027 545.67 -47588\n+ a5            1  0.009874 545.68 -47588\n+ a1            1  0.004840 545.68 -47588\n+ a2            1  0.000046 545.69 -47588\n\nStep:  AIC=-47591.29\nvm ~ rc + ac + treat + a8 + a4\n\n               Df Sum of Sq    RSS    AIC\n&lt;none&gt;                      545.55 -47591\n+ sg            1  0.065830 545.48 -47591\n+ yr            2  0.117365 545.43 -47590\n+ ag            2  0.116097 545.43 -47590\n+ a7            1  0.016300 545.53 -47590\n+ a5            1  0.007400 545.54 -47589\n+ a1            1  0.002675 545.54 -47589\n+ np            1  0.001634 545.55 -47589\n+ norm_weights  1  0.001634 545.55 -47589\n+ a2            1  0.000120 545.55 -47589\n\nbothstep &lt;- stats::step(full_mod, direction = \"both\")\n\nStart:  AIC=-47581.54\nvm ~ (yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + id + rc + norm_weights + treat) - id\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + a8 + \n    rc + treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + rc + \n    treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a5     1       0.0  545.2 -47584\n- a2     1       0.0  545.3 -47583\n- yr     2       0.1  545.3 -47583\n- ag     2       0.1  545.3 -47583\n- a7     1       0.0  545.3 -47582\n- sg     1       0.0  545.3 -47582\n- a1     1       0.1  545.3 -47582\n&lt;none&gt;                545.2 -47582\n- np     1       0.2  545.4 -47579\n- a4     1       0.3  545.5 -47576\n- treat  1       8.0  553.2 -47373\n- ac     1      19.5  564.7 -47073\n- rc    23    5109.5 5654.7 -13665\n\nStep:  AIC=-47583.52\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a2     1       0.0  545.3 -47585\n- yr     2       0.1  545.3 -47585\n- ag     2       0.1  545.3 -47585\n- a7     1       0.0  545.3 -47584\n- sg     1       0.0  545.3 -47584\n- a1     1       0.1  545.3 -47584\n&lt;none&gt;                545.2 -47584\n+ a5     1       0.0  545.2 -47582\n+ a8     1       0.0  545.2 -47582\n- np     1       0.2  545.4 -47581\n- a4     1       0.3  545.5 -47578\n- treat  1       8.0  553.2 -47375\n- ac     1      19.6  564.8 -47073\n- rc    23    5109.5 5654.7 -13667\n\nStep:  AIC=-47585.1\nvm ~ yr + ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- yr     2       0.1  545.4 -47586\n- ag     2       0.1  545.4 -47586\n- a7     1       0.0  545.3 -47586\n- a1     1       0.0  545.3 -47586\n- sg     1       0.1  545.3 -47586\n&lt;none&gt;                545.3 -47585\n+ a2     1       0.0  545.2 -47584\n+ a8     1       0.0  545.2 -47583\n+ a5     1       0.0  545.3 -47583\n- np     1       0.2  545.4 -47583\n- a4     1       0.3  545.5 -47580\n- treat  1       8.0  553.2 -47377\n- ac     1      19.7  564.9 -47072\n- rc    23    5109.8 5655.0 -13668\n\nStep:  AIC=-47586.25\nvm ~ ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- ag     2       0.1  545.5 -47587\n- a7     1       0.0  545.4 -47587\n- a1     1       0.1  545.4 -47587\n- sg     1       0.1  545.4 -47587\n&lt;none&gt;                545.4 -47586\n+ yr     2       0.1  545.3 -47585\n+ a2     1       0.0  545.3 -47585\n+ a8     1       0.0  545.3 -47585\n+ a5     1       0.0  545.4 -47584\n- np     1       0.2  545.6 -47583\n- a4     1       0.3  545.6 -47581\n- treat  1       8.0  553.3 -47378\n- ac     1      19.7  565.1 -47073\n- rc    23    5120.1 5665.5 -13645\n\nStep:  AIC=-47587.37\nvm ~ sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a7     1       0.0  545.5 -47588\n- a1     1       0.1  545.5 -47588\n- sg     1       0.1  545.5 -47588\n&lt;none&gt;                545.5 -47587\n+ ag     2       0.1  545.4 -47586\n+ yr     2       0.1  545.4 -47586\n+ a2     1       0.0  545.5 -47586\n+ a8     1       0.0  545.5 -47586\n+ a5     1       0.0  545.5 -47585\n- np     1       0.2  545.7 -47584\n- a4     1       0.3  545.7 -47582\n- treat  1       7.9  553.4 -47380\n- ac     1      19.7  565.2 -47074\n- rc    23    5123.0 5668.5 -13642\n\nStep:  AIC=-47588.27\nvm ~ sg + np + ac + a1 + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a1     1       0.1  545.6 -47589\n- sg     1       0.1  545.6 -47588\n&lt;none&gt;                545.5 -47588\n+ a7     1       0.0  545.5 -47587\n+ a8     1       0.0  545.5 -47587\n+ ag     2       0.1  545.4 -47587\n+ yr     2       0.1  545.4 -47587\n+ a2     1       0.0  545.5 -47587\n+ a5     1       0.0  545.5 -47586\n- np     1       0.2  545.7 -47585\n- a4     1       0.3  545.8 -47583\n- treat  1       8.0  553.5 -47380\n- ac     1      20.0  565.5 -47068\n- rc    23    5123.0 5668.5 -13644\n\nStep:  AIC=-47588.87\nvm ~ sg + np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- sg     1       0.1  545.6 -47589\n+ a8     1       0.1  545.5 -47589\n&lt;none&gt;                545.6 -47589\n+ a1     1       0.1  545.5 -47588\n+ a7     1       0.0  545.5 -47588\n+ yr     2       0.1  545.5 -47588\n+ ag     2       0.1  545.5 -47588\n- np     1       0.1  545.7 -47587\n+ a5     1       0.0  545.6 -47587\n+ a2     1       0.0  545.6 -47587\n- a4     1       0.2  545.8 -47584\n- treat  1       7.9  553.5 -47382\n- ac     1      20.0  565.6 -47067\n- rc    23    5123.4 5668.9 -13644\n\nStep:  AIC=-47589.14\nvm ~ np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n+ a8     1       0.1  545.5 -47589\n&lt;none&gt;                545.6 -47589\n+ sg     1       0.1  545.6 -47589\n+ a1     1       0.1  545.6 -47588\n+ yr     2       0.1  545.5 -47588\n+ ag     2       0.1  545.5 -47588\n+ a7     1       0.0  545.6 -47588\n- np     1       0.1  545.7 -47588\n+ a2     1       0.0  545.6 -47587\n+ a5     1       0.0  545.6 -47587\n- a4     1       0.2  545.9 -47585\n- treat  1       7.9  553.6 -47381\n- ac     1      20.1  565.7 -47067\n- rc    23    5130.8 5676.5 -13627\n\nStep:  AIC=-47589.33\nvm ~ np + ac + a4 + rc + treat + a8\n\n        Df Sum of Sq    RSS    AIC\n- np     1       0.0  545.5 -47591\n&lt;none&gt;                545.5 -47589\n- a8     1       0.1  545.6 -47589\n+ sg     1       0.1  545.5 -47589\n+ yr     2       0.1  545.4 -47588\n+ ag     2       0.1  545.4 -47588\n- a4     1       0.1  545.7 -47588\n+ a7     1       0.0  545.5 -47588\n+ a5     1       0.0  545.5 -47588\n+ a1     1       0.0  545.5 -47587\n+ a2     1       0.0  545.5 -47587\n- treat  1       8.0  553.5 -47380\n- ac     1      19.8  565.3 -47075\n- rc    23    5130.8 5676.4 -13625\n\nStep:  AIC=-47591.29\nvm ~ ac + a4 + rc + treat + a8\n\n               Df Sum of Sq    RSS    AIC\n&lt;none&gt;                       545.5 -47591\n+ sg            1       0.1  545.5 -47591\n+ yr            2       0.1  545.4 -47590\n+ ag            2       0.1  545.4 -47590\n+ a7            1       0.0  545.5 -47590\n- a4            1       0.1  545.7 -47590\n+ a5            1       0.0  545.5 -47589\n+ a1            1       0.0  545.5 -47589\n+ np            1       0.0  545.5 -47589\n+ norm_weights  1       0.0  545.5 -47589\n+ a2            1       0.0  545.5 -47589\n- a8            1       0.2  545.7 -47588\n- treat         1       8.0  553.5 -47382\n- ac            1      20.0  565.5 -47072\n- rc           23    5152.2 5697.7 -13573\n\nsummary(backstep)\n\n\nCall:\nlm(formula = vm ~ np + ac + a4 + rc + treat, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4488  0.0016  0.0092  0.0154  3.5834 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)                             -1.168e-01  5.642e-03 -20.696   &lt;2e-16\nnp                                      -5.533e-05  3.079e-05  -1.797   0.0724\nac                                       1.037e-01  4.491e-03  23.082   &lt;2e-16\na4                                       2.232e-04  8.826e-05   2.529   0.0114\nrcCentral + Eastern                      2.184e+00  1.789e-02 122.061   &lt;2e-16\nrcCentral + Eastern + Toronto            4.007e+00  3.751e-02 106.830   &lt;2e-16\nrcCentral + Eastern + Toronto + Western  6.534e+00  1.122e-01  58.231   &lt;2e-16\nrcCentral + Eastern + Western            3.504e+00  5.863e-02  59.751   &lt;2e-16\nrcCentral + Northern                     2.332e+00  3.819e-02  61.048   &lt;2e-16\nrcCentral + Northern + Toronto           2.938e+00  1.121e-01  26.206   &lt;2e-16\nrcCentral + Northern + Western           3.161e+00  8.685e-02  36.391   &lt;2e-16\nrcCentral + Toronto                      2.358e+00  1.248e-02 189.016   &lt;2e-16\nrcCentral + Toronto + Western            4.087e+00  6.480e-02  63.062   &lt;2e-16\nrcCentral + Western                      2.144e+00  1.628e-02 131.673   &lt;2e-16\nrcEastern                               -5.784e-03  4.493e-03  -1.287   0.1980\nrcEastern + Northern                     2.194e+00  4.247e-02  51.658   &lt;2e-16\nrcEastern + Northern + Toronto           3.969e+00  1.121e-01  35.412   &lt;2e-16\nrcEastern + Northern + Western           4.007e+00  1.941e-01  20.645   &lt;2e-16\nrcEastern + Toronto                      2.283e+00  1.495e-02 152.686   &lt;2e-16\nrcEastern + Toronto + Western            3.255e+00  9.710e-02  33.522   &lt;2e-16\nrcEastern + Western                      2.443e+00  2.946e-02  82.920   &lt;2e-16\nrcNorthern                              -3.973e-03  5.530e-03  -0.718   0.4725\nrcNorthern + Toronto                     2.065e+00  2.852e-02  72.397   &lt;2e-16\nrcNorthern + Western                     2.188e+00  3.501e-02  62.497   &lt;2e-16\nrcToronto                                2.635e-05  5.278e-03   0.005   0.9960\nrcToronto + Western                      1.985e+00  3.251e-02  61.066   &lt;2e-16\nrcWestern                                4.298e-03  5.299e-03   0.811   0.4173\ntreat                                   -9.167e-02  6.309e-03 -14.529   &lt;2e-16\n                                           \n(Intercept)                             ***\nnp                                      .  \nac                                      ***\na4                                      *  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto           ***\nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western           ***\nrcCentral + Northern                    ***\nrcCentral + Northern + Toronto          ***\nrcCentral + Northern + Western          ***\nrcCentral + Toronto                     ***\nrcCentral + Toronto + Western           ***\nrcCentral + Western                     ***\nrcEastern                                  \nrcEastern + Northern                    ***\nrcEastern + Northern + Toronto          ***\nrcEastern + Northern + Western          ***\nrcEastern + Toronto                     ***\nrcEastern + Toronto + Western           ***\nrcEastern + Western                     ***\nrcNorthern                                 \nrcNorthern + Toronto                    ***\nrcNorthern + Western                    ***\nrcToronto                                  \nrcToronto + Western                     ***\nrcWestern                                  \ntreat                                   ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.194 on 14492 degrees of freedom\nMultiple R-squared:  0.9084,    Adjusted R-squared:  0.9083 \nF-statistic:  5325 on 27 and 14492 DF,  p-value: &lt; 2.2e-16\n\nsummary(frontstep)\n\n\nCall:\nlm(formula = vm ~ rc + ac + treat + a8 + a4, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4529  0.0017  0.0088  0.0154  3.5834 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)                             -1.157e-01  5.683e-03 -20.361   &lt;2e-16\nrcCentral + Eastern                      2.184e+00  1.789e-02 122.074   &lt;2e-16\nrcCentral + Eastern + Toronto            4.006e+00  3.750e-02 106.817   &lt;2e-16\nrcCentral + Eastern + Toronto + Western  6.536e+00  1.122e-01  58.250   &lt;2e-16\nrcCentral + Eastern + Western            3.503e+00  5.862e-02  59.761   &lt;2e-16\nrcCentral + Northern                     2.331e+00  3.819e-02  61.051   &lt;2e-16\nrcCentral + Northern + Toronto           2.937e+00  1.121e-01  26.200   &lt;2e-16\nrcCentral + Northern + Western           3.160e+00  8.685e-02  36.389   &lt;2e-16\nrcCentral + Toronto                      2.358e+00  1.247e-02 189.137   &lt;2e-16\nrcCentral + Toronto + Western            4.087e+00  6.479e-02  63.083   &lt;2e-16\nrcCentral + Western                      2.144e+00  1.627e-02 131.765   &lt;2e-16\nrcEastern                               -6.046e-03  4.482e-03  -1.349   0.1773\nrcEastern + Northern                     2.193e+00  4.246e-02  51.654   &lt;2e-16\nrcEastern + Northern + Toronto           3.971e+00  1.121e-01  35.429   &lt;2e-16\nrcEastern + Northern + Western           4.010e+00  1.941e-01  20.663   &lt;2e-16\nrcEastern + Toronto                      2.283e+00  1.494e-02 152.755   &lt;2e-16\nrcEastern + Toronto + Western            3.255e+00  9.710e-02  33.524   &lt;2e-16\nrcEastern + Western                      2.442e+00  2.946e-02  82.896   &lt;2e-16\nrcNorthern                              -4.247e-03  5.531e-03  -0.768   0.4426\nrcNorthern + Toronto                     2.065e+00  2.852e-02  72.413   &lt;2e-16\nrcNorthern + Western                     2.188e+00  3.500e-02  62.496   &lt;2e-16\nrcToronto                               -2.079e-04  5.278e-03  -0.039   0.9686\nrcToronto + Western                      1.985e+00  3.251e-02  61.069   &lt;2e-16\nrcWestern                                4.082e-03  5.297e-03   0.771   0.4409\nac                                       1.031e-01  4.477e-03  23.023   &lt;2e-16\ntreat                                   -9.194e-02  6.309e-03 -14.572   &lt;2e-16\na8                                      -9.117e-05  3.933e-05  -2.318   0.0205\na4                                       1.638e-04  8.519e-05   1.922   0.0546\n                                           \n(Intercept)                             ***\nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto           ***\nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western           ***\nrcCentral + Northern                    ***\nrcCentral + Northern + Toronto          ***\nrcCentral + Northern + Western          ***\nrcCentral + Toronto                     ***\nrcCentral + Toronto + Western           ***\nrcCentral + Western                     ***\nrcEastern                                  \nrcEastern + Northern                    ***\nrcEastern + Northern + Toronto          ***\nrcEastern + Northern + Western          ***\nrcEastern + Toronto                     ***\nrcEastern + Toronto + Western           ***\nrcEastern + Western                     ***\nrcNorthern                                 \nrcNorthern + Toronto                    ***\nrcNorthern + Western                    ***\nrcToronto                                  \nrcToronto + Western                     ***\nrcWestern                                  \nac                                      ***\ntreat                                   ***\na8                                      *  \na4                                      .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.194 on 14492 degrees of freedom\nMultiple R-squared:  0.9084,    Adjusted R-squared:  0.9083 \nF-statistic:  5326 on 27 and 14492 DF,  p-value: &lt; 2.2e-16\n\nsummary(bothstep)\n\n\nCall:\nlm(formula = vm ~ ac + a4 + rc + treat + a8, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4529  0.0017  0.0088  0.0154  3.5834 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)                             -1.157e-01  5.683e-03 -20.361   &lt;2e-16\nac                                       1.031e-01  4.477e-03  23.023   &lt;2e-16\na4                                       1.638e-04  8.519e-05   1.922   0.0546\nrcCentral + Eastern                      2.184e+00  1.789e-02 122.074   &lt;2e-16\nrcCentral + Eastern + Toronto            4.006e+00  3.750e-02 106.817   &lt;2e-16\nrcCentral + Eastern + Toronto + Western  6.536e+00  1.122e-01  58.250   &lt;2e-16\nrcCentral + Eastern + Western            3.503e+00  5.862e-02  59.761   &lt;2e-16\nrcCentral + Northern                     2.331e+00  3.819e-02  61.051   &lt;2e-16\nrcCentral + Northern + Toronto           2.937e+00  1.121e-01  26.200   &lt;2e-16\nrcCentral + Northern + Western           3.160e+00  8.685e-02  36.389   &lt;2e-16\nrcCentral + Toronto                      2.358e+00  1.247e-02 189.137   &lt;2e-16\nrcCentral + Toronto + Western            4.087e+00  6.479e-02  63.083   &lt;2e-16\nrcCentral + Western                      2.144e+00  1.627e-02 131.765   &lt;2e-16\nrcEastern                               -6.046e-03  4.482e-03  -1.349   0.1773\nrcEastern + Northern                     2.193e+00  4.246e-02  51.654   &lt;2e-16\nrcEastern + Northern + Toronto           3.971e+00  1.121e-01  35.429   &lt;2e-16\nrcEastern + Northern + Western           4.010e+00  1.941e-01  20.663   &lt;2e-16\nrcEastern + Toronto                      2.283e+00  1.494e-02 152.755   &lt;2e-16\nrcEastern + Toronto + Western            3.255e+00  9.710e-02  33.524   &lt;2e-16\nrcEastern + Western                      2.442e+00  2.946e-02  82.896   &lt;2e-16\nrcNorthern                              -4.247e-03  5.531e-03  -0.768   0.4426\nrcNorthern + Toronto                     2.065e+00  2.852e-02  72.413   &lt;2e-16\nrcNorthern + Western                     2.188e+00  3.500e-02  62.496   &lt;2e-16\nrcToronto                               -2.079e-04  5.278e-03  -0.039   0.9686\nrcToronto + Western                      1.985e+00  3.251e-02  61.069   &lt;2e-16\nrcWestern                                4.082e-03  5.297e-03   0.771   0.4409\ntreat                                   -9.194e-02  6.309e-03 -14.572   &lt;2e-16\na8                                      -9.117e-05  3.933e-05  -2.318   0.0205\n                                           \n(Intercept)                             ***\nac                                      ***\na4                                      .  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto           ***\nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western           ***\nrcCentral + Northern                    ***\nrcCentral + Northern + Toronto          ***\nrcCentral + Northern + Western          ***\nrcCentral + Toronto                     ***\nrcCentral + Toronto + Western           ***\nrcCentral + Western                     ***\nrcEastern                                  \nrcEastern + Northern                    ***\nrcEastern + Northern + Toronto          ***\nrcEastern + Northern + Western          ***\nrcEastern + Toronto                     ***\nrcEastern + Toronto + Western           ***\nrcEastern + Western                     ***\nrcNorthern                                 \nrcNorthern + Toronto                    ***\nrcNorthern + Western                    ***\nrcToronto                                  \nrcToronto + Western                     ***\nrcWestern                                  \ntreat                                   ***\na8                                      *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.194 on 14492 degrees of freedom\nMultiple R-squared:  0.9084,    Adjusted R-squared:  0.9083 \nF-statistic:  5326 on 27 and 14492 DF,  p-value: &lt; 2.2e-16\n\n# plot(bothstep)\nabs_t &lt;- sort(\n  abs(summary(bothstep)$coefficients[, \"t value\"]),\n  decreasing = TRUE\n)\nprint(abs_t)\n\n                    rcCentral + Toronto                     rcEastern + Toronto \n                           189.13684688                            152.75510003 \n                    rcCentral + Western                     rcCentral + Eastern \n                           131.76467803                            122.07365301 \n          rcCentral + Eastern + Toronto                     rcEastern + Western \n                           106.81715727                             82.89618520 \n                   rcNorthern + Toronto           rcCentral + Toronto + Western \n                            72.41282325                             63.08289090 \n                   rcNorthern + Western                     rcToronto + Western \n                            62.49575446                             61.06891525 \n                   rcCentral + Northern           rcCentral + Eastern + Western \n                            61.05089828                             59.76090767 \nrcCentral + Eastern + Toronto + Western                    rcEastern + Northern \n                            58.25037221                             51.65369553 \n         rcCentral + Northern + Western          rcEastern + Northern + Toronto \n                            36.38941150                             35.42944826 \n          rcEastern + Toronto + Western          rcCentral + Northern + Toronto \n                            33.52431600                             26.19996817 \n                                     ac          rcEastern + Northern + Western \n                            23.02250346                             20.66306816 \n                            (Intercept)                                   treat \n                            20.36090376                             14.57178211 \n                                     a8                                      a4 \n                             2.31785814                              1.92243389 \n                              rcEastern                               rcWestern \n                             1.34910662                              0.77074141 \n                             rcNorthern                               rcToronto \n                             0.76786860                              0.03939446 \n\npar(mfrow = c(2, 2))\nplot(bothstep, ask = FALSE, which = 1:4)\n\n\n\n\n\n\n\npar(mfrow = c(1, 1))\nlibrary(sjPlot)\nsjPlot::plot_model(\n  bothstep,\n  title = \"Variables selected in Stepwise Regression Model\",\n  subtitle = \"vm ~ ac + a4 + rc + treatment + a8\"\n)\n\n\n\n\n\n\n\nplot(bothstep, which = 1, main = \"Model Fit\", ask = FALSE)\n\n\n\n\n\n\n\nplot_model(\n  bothstep,\n  title = \"Target Predictors from Stepwise Regression\",\n  sort.est = FALSE,\n  show.values = TRUE,\n  value.offset = 0.4,\n  type = \"std\"\n)\n\n\n\n\n\n\n\nfinal_covariates &lt;- formula(bothstep)\nprint(final_covariates)\n\nvm ~ ac + a4 + rc + treat + a8\n\nset.seed(36825994)\nfmod &lt;- lm(treat ~ . - id - vm, data = orcmatch_temp)\nbstepz &lt;- stats::step(fmod, direction = \"backward\")\n\nStart:  AIC=-39611.14\ntreat ~ (yr + ag + sg + np + ac + rg + vm + a1 + a2 + a4 + a5 + \n    a7 + a8 + id + rc + norm_weights) - id - vm\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- yr    2      0.00  944.2 -39615\n- ag    2      0.10  944.2 -39614\n- a2    1      0.00  944.1 -39613\n- a5    1      0.06  944.2 -39612\n- np    1      0.07  944.2 -39612\n&lt;none&gt;               944.1 -39611\n- a7    1      0.23  944.4 -39610\n- sg    1      0.29  944.4 -39609\n- a1    1      0.93  945.1 -39599\n- a4    1      1.90  946.1 -39584\n- rc   23      5.73  949.9 -39569\n- ac    1   2363.05 3307.2 -21411\n\nStep:  AIC=-39615.06\ntreat ~ ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- ag    2      0.10  944.3 -39618\n- a2    1      0.00  944.2 -39617\n- a5    1      0.06  944.2 -39616\n- np    1      0.07  944.2 -39616\n&lt;none&gt;               944.2 -39615\n- a7    1      0.23  944.4 -39614\n- sg    1      0.28  944.4 -39613\n- a1    1      0.94  945.1 -39603\n- a4    1      1.91  946.1 -39588\n- rc   23      5.74  949.9 -39573\n- ac    1   2366.23 3310.4 -21401\n\nStep:  AIC=-39617.5\ntreat ~ sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a2    1      0.00  944.3 -39619\n- a5    1      0.06  944.3 -39619\n- np    1      0.07  944.3 -39618\n&lt;none&gt;               944.3 -39618\n- a7    1      0.23  944.5 -39616\n- sg    1      0.27  944.5 -39615\n- a1    1      0.94  945.2 -39605\n- a4    1      1.91  946.2 -39590\n- rc   23      5.72  950.0 -39576\n- ac    1   2366.36 3310.6 -21404\n\nStep:  AIC=-39619.49\ntreat ~ sg + np + ac + a1 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a5    1      0.06  944.3 -39621\n- np    1      0.08  944.3 -39620\n&lt;none&gt;               944.3 -39619\n- a7    1      0.23  944.5 -39618\n- sg    1      0.27  944.5 -39617\n- a1    1      0.99  945.2 -39606\n- a4    1      1.93  946.2 -39592\n- rc   23      5.72  950.0 -39578\n- ac    1   2382.55 3326.8 -21335\n\nStep:  AIC=-39620.58\ntreat ~ sg + np + ac + a1 + a4 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- np    1      0.06  944.4 -39622\n&lt;none&gt;               944.3 -39621\n- a7    1      0.24  944.6 -39619\n- sg    1      0.27  944.6 -39618\n- a1    1      0.94  945.3 -39608\n- a4    1      1.88  946.2 -39594\n- rc   23      5.73  950.0 -39579\n- ac    1   2441.60 3385.9 -21082\n\nStep:  AIC=-39621.66\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n&lt;none&gt;               944.4 -39622\n- a7    1      0.27  944.6 -39619\n- sg    1      0.29  944.7 -39619\n- a1    1      1.00  945.4 -39608\n- a4    1      1.87  946.2 -39595\n- rc   23      5.87  950.2 -39578\n- ac    1   2450.06 3394.4 -21047\n\nfstepz &lt;- stats::step(\n  lm(treat ~ 1, data = orcmatch_temp),\n  scope = formula(fmod),\n  direction = \"forward\"\n)\n\nStart:  AIC=-20126.99\ntreat ~ 1\n\n               Df Sum of Sq    RSS    AIC\n+ ac            1   2677.37  952.6 -39549\n+ norm_weights  1    114.94 3515.1 -20592\n+ np            1    114.94 3515.1 -20592\n+ a1            1    104.80 3525.2 -20550\n+ a7            1     63.16 3566.8 -20380\n+ a5            1     62.07 3567.9 -20375\n+ rc           23     70.94 3559.1 -20368\n+ rg            1     56.88 3573.1 -20354\n+ a4            1     35.41 3594.6 -20267\n+ a2            1     23.32 3606.7 -20219\n+ a8            1      0.59 3629.4 -20127\n&lt;none&gt;                      3630.0 -20127\n+ sg            1      0.00 3630.0 -20125\n+ yr            2      0.00 3630.0 -20123\n+ ag            2      0.00 3630.0 -20123\n\nStep:  AIC=-39549.22\ntreat ~ ac\n\n               Df Sum of Sq    RSS    AIC\n+ rc           23    5.1441 947.49 -39582\n+ a4            1    1.3992 951.24 -39569\n+ a1            1    0.5435 952.09 -39556\n+ a8            1    0.3666 952.27 -39553\n&lt;none&gt;                      952.63 -39549\n+ sg            1    0.1257 952.51 -39549\n+ np            1    0.1108 952.52 -39549\n+ norm_weights  1    0.1108 952.52 -39549\n+ a7            1    0.1060 952.53 -39549\n+ rg            1    0.0486 952.59 -39548\n+ a2            1    0.0307 952.60 -39548\n+ a5            1    0.0050 952.63 -39547\n+ ag            2    0.0737 952.56 -39546\n+ yr            2    0.0026 952.63 -39545\n\nStep:  AIC=-39581.84\ntreat ~ ac + rc\n\n               Df Sum of Sq    RSS    AIC\n+ a4            1   1.64733 945.84 -39605\n+ a1            1   0.81461 946.68 -39592\n+ np            1   0.35315 947.14 -39585\n+ norm_weights  1   0.35315 947.14 -39585\n+ sg            1   0.24603 947.24 -39584\n+ a8            1   0.21604 947.27 -39583\n&lt;none&gt;                      947.49 -39582\n+ a7            1   0.11160 947.38 -39582\n+ a2            1   0.01858 947.47 -39580\n+ a5            1   0.00582 947.48 -39580\n+ ag            2   0.08668 947.40 -39579\n+ yr            2   0.00137 947.49 -39578\n\nStep:  AIC=-39605.1\ntreat ~ ac + rc + a4\n\n               Df Sum of Sq    RSS    AIC\n+ a1            1   0.90828 944.94 -39617\n+ sg            1   0.25827 945.59 -39607\n+ a7            1   0.20460 945.64 -39606\n&lt;none&gt;                      945.84 -39605\n+ a8            1   0.12956 945.71 -39605\n+ np            1   0.06411 945.78 -39604\n+ norm_weights  1   0.06411 945.78 -39604\n+ a2            1   0.02345 945.82 -39603\n+ a5            1   0.01620 945.83 -39603\n+ ag            2   0.08950 945.75 -39602\n+ yr            2   0.00113 945.84 -39601\n\nStep:  AIC=-39617.05\ntreat ~ ac + rc + a4 + a1\n\n               Df Sum of Sq    RSS    AIC\n+ sg            1  0.285580 944.65 -39619\n+ a7            1  0.271186 944.66 -39619\n&lt;none&gt;                      944.94 -39617\n+ np            1  0.114428 944.82 -39617\n+ norm_weights  1  0.114428 944.82 -39617\n+ a8            1  0.072427 944.86 -39616\n+ a5            1  0.037751 944.90 -39616\n+ a2            1  0.007321 944.93 -39615\n+ ag            2  0.091240 944.84 -39614\n+ yr            2  0.006384 944.93 -39613\n\nStep:  AIC=-39619.44\ntreat ~ ac + rc + a4 + a1 + sg\n\n               Df Sum of Sq    RSS    AIC\n+ a7            1  0.274550 944.37 -39622\n&lt;none&gt;                      944.65 -39619\n+ np            1  0.091537 944.56 -39619\n+ norm_weights  1  0.091537 944.56 -39619\n+ a8            1  0.055695 944.59 -39618\n+ a5            1  0.040227 944.61 -39618\n+ a2            1  0.004945 944.64 -39618\n+ ag            2  0.106140 944.54 -39617\n+ yr            2  0.014561 944.63 -39616\n\nStep:  AIC=-39621.66\ntreat ~ ac + rc + a4 + a1 + sg + a7\n\n               Df Sum of Sq    RSS    AIC\n&lt;none&gt;                      944.37 -39622\n+ a8            1  0.066835 944.31 -39621\n+ np            1  0.059571 944.32 -39621\n+ norm_weights  1  0.059571 944.32 -39621\n+ a5            1  0.035854 944.34 -39620\n+ a2            1  0.007461 944.37 -39620\n+ ag            2  0.104758 944.27 -39619\n+ yr            2  0.010153 944.36 -39618\n\nbothstepz &lt;- stats::step(fmod, direction = \"both\")\n\nStart:  AIC=-39611.14\ntreat ~ (yr + ag + sg + np + ac + rg + vm + a1 + a2 + a4 + a5 + \n    a7 + a8 + id + rc + norm_weights) - id - vm\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- yr    2      0.00  944.2 -39615\n- ag    2      0.10  944.2 -39614\n- a2    1      0.00  944.1 -39613\n- a5    1      0.06  944.2 -39612\n- np    1      0.07  944.2 -39612\n&lt;none&gt;               944.1 -39611\n- a7    1      0.23  944.4 -39610\n- sg    1      0.29  944.4 -39609\n- a1    1      0.93  945.1 -39599\n- a4    1      1.90  946.1 -39584\n- rc   23      5.73  949.9 -39569\n- ac    1   2363.05 3307.2 -21411\n\nStep:  AIC=-39615.06\ntreat ~ ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- ag    2      0.10  944.3 -39618\n- a2    1      0.00  944.2 -39617\n- a5    1      0.06  944.2 -39616\n- np    1      0.07  944.2 -39616\n&lt;none&gt;               944.2 -39615\n- a7    1      0.23  944.4 -39614\n- sg    1      0.28  944.4 -39613\n+ yr    2      0.00  944.1 -39611\n- a1    1      0.94  945.1 -39603\n- a4    1      1.91  946.1 -39588\n- rc   23      5.74  949.9 -39573\n- ac    1   2366.23 3310.4 -21401\n\nStep:  AIC=-39617.5\ntreat ~ sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a2    1      0.00  944.3 -39619\n- a5    1      0.06  944.3 -39619\n- np    1      0.07  944.3 -39618\n&lt;none&gt;               944.3 -39618\n- a7    1      0.23  944.5 -39616\n- sg    1      0.27  944.5 -39615\n+ ag    2      0.10  944.2 -39615\n+ yr    2      0.01  944.2 -39614\n- a1    1      0.94  945.2 -39605\n- a4    1      1.91  946.2 -39590\n- rc   23      5.72  950.0 -39576\n- ac    1   2366.36 3310.6 -21404\n\nStep:  AIC=-39619.49\ntreat ~ sg + np + ac + a1 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a5    1      0.06  944.3 -39621\n- np    1      0.08  944.3 -39620\n&lt;none&gt;               944.3 -39619\n- a7    1      0.23  944.5 -39618\n+ a2    1      0.00  944.3 -39618\n+ a8    1      0.00  944.3 -39618\n- sg    1      0.27  944.5 -39617\n+ ag    2      0.10  944.2 -39617\n+ yr    2      0.01  944.3 -39616\n- a1    1      0.99  945.2 -39606\n- a4    1      1.93  946.2 -39592\n- rc   23      5.72  950.0 -39578\n- ac    1   2382.55 3326.8 -21335\n\nStep:  AIC=-39620.58\ntreat ~ sg + np + ac + a1 + a4 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- np    1      0.06  944.4 -39622\n&lt;none&gt;               944.3 -39621\n+ a5    1      0.06  944.3 -39619\n- a7    1      0.24  944.6 -39619\n+ a8    1      0.01  944.3 -39619\n+ a2    1      0.00  944.3 -39619\n- sg    1      0.27  944.6 -39618\n+ ag    2      0.10  944.2 -39618\n+ yr    2      0.01  944.3 -39617\n- a1    1      0.94  945.3 -39608\n- a4    1      1.88  946.2 -39594\n- rc   23      5.73  950.0 -39579\n- ac    1   2441.60 3385.9 -21082\n\nStep:  AIC=-39621.66\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\n               Df Sum of Sq    RSS    AIC\n&lt;none&gt;                       944.4 -39622\n+ a8            1      0.07  944.3 -39621\n+ np            1      0.06  944.3 -39621\n+ norm_weights  1      0.06  944.3 -39621\n+ a5            1      0.04  944.3 -39620\n+ a2            1      0.01  944.4 -39620\n- a7            1      0.27  944.6 -39619\n+ ag            2      0.10  944.3 -39619\n- sg            1      0.29  944.7 -39619\n+ yr            2      0.01  944.4 -39618\n- a1            1      1.00  945.4 -39608\n- a4            1      1.87  946.2 -39595\n- rc           23      5.87  950.2 -39578\n- ac            1   2450.06 3394.4 -21047\n\nstepform &lt;- formula(bothstepz)\nprint(stepform)\n\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\nsummary(bstepz)\n\n\nCall:\nlm(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.1814 -0.1378 -0.1044  0.2558  0.4331 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)                             -0.4681377  0.0063124 -74.161  &lt; 2e-16\nsgF                                      0.0153125  0.0072721   2.106 0.035253\nac                                       0.6059280  0.0031250 193.894  &lt; 2e-16\na1                                       0.0002449  0.0000624   3.924 8.74e-05\na4                                       0.0006013  0.0001122   5.360 8.46e-08\na7                                      -0.0006034  0.0002940  -2.053 0.040137\nrcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594\nrcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479\nrcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168\nrcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775\nrcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285\nrcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409\nrcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321\nrcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426\nrcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676\nrcCentral + Western                      0.0307709  0.0213937   1.438 0.150365\nrcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09\nrcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343\nrcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472\nrcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935\nrcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546\nrcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134\nrcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755\nrcNorthern                              -0.0047978  0.0073647  -0.651 0.514756\nrcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573\nrcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769\nrcToronto                               -0.0132884  0.0069503  -1.912 0.055906\nrcToronto + Western                      0.0296455  0.0427685   0.693 0.488219\nrcWestern                                0.0020497  0.0070114   0.292 0.770035\n                                           \n(Intercept)                             ***\nsgF                                     *  \nac                                      ***\na1                                      ***\na4                                      ***\na7                                      *  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto              \nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western              \nrcCentral + Northern                       \nrcCentral + Northern + Toronto          .  \nrcCentral + Northern + Western             \nrcCentral + Toronto                     .  \nrcCentral + Toronto + Western              \nrcCentral + Western                        \nrcEastern                               ***\nrcEastern + Northern                       \nrcEastern + Northern + Toronto             \nrcEastern + Northern + Western             \nrcEastern + Toronto                     .  \nrcEastern + Toronto + Western              \nrcEastern + Western                        \nrcNorthern                                 \nrcNorthern + Toronto                       \nrcNorthern + Western                       \nrcToronto                               .  \nrcToronto + Western                        \nrcWestern                                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2553 on 14491 degrees of freedom\nMultiple R-squared:  0.7398,    Adjusted R-squared:  0.7393 \nF-statistic:  1472 on 28 and 14491 DF,  p-value: &lt; 2.2e-16\n\nsummary(fstepz)\n\n\nCall:\nlm(formula = treat ~ ac + rc + a4 + a1 + sg + a7, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.1814 -0.1378 -0.1044  0.2558  0.4331 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)                             -0.4681377  0.0063124 -74.161  &lt; 2e-16\nac                                       0.6059280  0.0031250 193.894  &lt; 2e-16\nrcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594\nrcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479\nrcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168\nrcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775\nrcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285\nrcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409\nrcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321\nrcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426\nrcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676\nrcCentral + Western                      0.0307709  0.0213937   1.438 0.150365\nrcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09\nrcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343\nrcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472\nrcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935\nrcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546\nrcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134\nrcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755\nrcNorthern                              -0.0047978  0.0073647  -0.651 0.514756\nrcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573\nrcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769\nrcToronto                               -0.0132884  0.0069503  -1.912 0.055906\nrcToronto + Western                      0.0296455  0.0427685   0.693 0.488219\nrcWestern                                0.0020497  0.0070114   0.292 0.770035\na4                                       0.0006013  0.0001122   5.360 8.46e-08\na1                                       0.0002449  0.0000624   3.924 8.74e-05\nsgF                                      0.0153125  0.0072721   2.106 0.035253\na7                                      -0.0006034  0.0002940  -2.053 0.040137\n                                           \n(Intercept)                             ***\nac                                      ***\nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto              \nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western              \nrcCentral + Northern                       \nrcCentral + Northern + Toronto          .  \nrcCentral + Northern + Western             \nrcCentral + Toronto                     .  \nrcCentral + Toronto + Western              \nrcCentral + Western                        \nrcEastern                               ***\nrcEastern + Northern                       \nrcEastern + Northern + Toronto             \nrcEastern + Northern + Western             \nrcEastern + Toronto                     .  \nrcEastern + Toronto + Western              \nrcEastern + Western                        \nrcNorthern                                 \nrcNorthern + Toronto                       \nrcNorthern + Western                       \nrcToronto                               .  \nrcToronto + Western                        \nrcWestern                                  \na4                                      ***\na1                                      ***\nsgF                                     *  \na7                                      *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2553 on 14491 degrees of freedom\nMultiple R-squared:  0.7398,    Adjusted R-squared:  0.7393 \nF-statistic:  1472 on 28 and 14491 DF,  p-value: &lt; 2.2e-16\n\nsummary(bothstepz)\n\n\nCall:\nlm(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.1814 -0.1378 -0.1044  0.2558  0.4331 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(&gt;|t|)\n(Intercept)                             -0.4681377  0.0063124 -74.161  &lt; 2e-16\nsgF                                      0.0153125  0.0072721   2.106 0.035253\nac                                       0.6059280  0.0031250 193.894  &lt; 2e-16\na1                                       0.0002449  0.0000624   3.924 8.74e-05\na4                                       0.0006013  0.0001122   5.360 8.46e-08\na7                                      -0.0006034  0.0002940  -2.053 0.040137\nrcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594\nrcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479\nrcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168\nrcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775\nrcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285\nrcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409\nrcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321\nrcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426\nrcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676\nrcCentral + Western                      0.0307709  0.0213937   1.438 0.150365\nrcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09\nrcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343\nrcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472\nrcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935\nrcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546\nrcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134\nrcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755\nrcNorthern                              -0.0047978  0.0073647  -0.651 0.514756\nrcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573\nrcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769\nrcToronto                               -0.0132884  0.0069503  -1.912 0.055906\nrcToronto + Western                      0.0296455  0.0427685   0.693 0.488219\nrcWestern                                0.0020497  0.0070114   0.292 0.770035\n                                           \n(Intercept)                             ***\nsgF                                     *  \nac                                      ***\na1                                      ***\na4                                      ***\na7                                      *  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto              \nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western              \nrcCentral + Northern                       \nrcCentral + Northern + Toronto          .  \nrcCentral + Northern + Western             \nrcCentral + Toronto                     .  \nrcCentral + Toronto + Western              \nrcCentral + Western                        \nrcEastern                               ***\nrcEastern + Northern                       \nrcEastern + Northern + Toronto             \nrcEastern + Northern + Western             \nrcEastern + Toronto                     .  \nrcEastern + Toronto + Western              \nrcEastern + Western                        \nrcNorthern                                 \nrcNorthern + Toronto                       \nrcNorthern + Western                       \nrcToronto                               .  \nrcToronto + Western                        \nrcWestern                                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2553 on 14491 degrees of freedom\nMultiple R-squared:  0.7398,    Adjusted R-squared:  0.7393 \nF-statistic:  1472 on 28 and 14491 DF,  p-value: &lt; 2.2e-16\n\nfca &lt;- formula(backstep)\nfcb &lt;- formula(frontstep)\nfcc &lt;- formula(bothstep)\nfcd &lt;- formula(bstepz)\nfce &lt;- formula(fstepz)\nfcg &lt;- formula(bothstepz)\nfca\n\nvm ~ np + ac + a4 + rc + treat\n\nfcb\n\nvm ~ rc + ac + treat + a8 + a4\n\nfcc\n\nvm ~ ac + a4 + rc + treat + a8\n\nfcd\n\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\nfce\n\ntreat ~ ac + rc + a4 + a1 + sg + a7\n\nfcg\n\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\n# plot(bothstep, which = 1:4, ask = FALSE)\nabs_t &lt;- sort(\n  abs(summary(bothstepz)$coefficients[, \"t value\"]),\n  decreasing = TRUE\n)\nprint(abs_t)\n\n                                     ac                             (Intercept) \n                           193.89430387                             74.16145718 \n                              rcEastern                                      a4 \n                             5.81222708                              5.35975365 \n                                     a1 rcCentral + Eastern + Toronto + Western \n                             3.92438914                              3.76359743 \n                    rcCentral + Eastern                                     sgF \n                             3.43505680                              2.10564024 \n                                     a7          rcCentral + Northern + Toronto \n                             2.05252052                              1.93992188 \n                              rcToronto                     rcEastern + Toronto \n                             1.91192157                              1.84165356 \n                    rcCentral + Toronto                    rcNorthern + Western \n                             1.81577492                              1.57287823 \n                   rcEastern + Northern                     rcCentral + Western \n                             1.53688722                              1.43832097 \n          rcCentral + Eastern + Western                     rcEastern + Western \n                             1.41949910                              1.22192732 \n         rcEastern + Northern + Western                    rcCentral + Northern \n                             0.93863274                              0.88479013 \n                    rcToronto + Western                              rcNorthern \n                             0.69316137                              0.65146542 \n          rcCentral + Toronto + Western           rcCentral + Eastern + Toronto \n                             0.50199859                              0.39414662 \n         rcEastern + Northern + Toronto                               rcWestern \n                             0.36050841                              0.29233524 \n          rcEastern + Toronto + Western          rcCentral + Northern + Western \n                             0.27654380                              0.03971491 \n                   rcNorthern + Toronto \n                             0.01682979 \n\npar(mfrow = c(2, 2))\nplot(bothstepz, ask = FALSE, which = 1:4)\n\n\n\n\n\n\n\npar(mfrow = c(1, 1))\nlibrary(sjPlot)\nsjPlot::plot_model(\n  bothstepz,\n  title = \"Variables selected in Stepwise Regression Model (treatment ~ sg + ac + a1 + a4 + a7 + rc)\"\n)\n\n\n\n\n\n\n\nmodz &lt;- matchit(\n  treat ~ sg + ac + a1 + a4 + a7 + rc,\n  data = orcmatch_temp,\n  distance = \"cbps\",\n  estimand = \"ATC\",\n  distance.options = list(method = \"exact\"),\n  replace = TRUE\n)\nsummary(modz)\n\n\nCall:\nmatchit(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp, \n    distance = \"cbps\", distance.options = list(method = \"exact\"), \n    estimand = \"ATC\", replace = TRUE)\n\nSummary of Balance for All Data:\n                                        Means Treated Means Control\ndistance                                       0.0000        1.0000\nsgM                                            0.8986        0.8986\nsgF                                            0.1014        0.1014\nac                                             2.2164        1.0000\na1                                            17.9529        6.0704\na4                                             5.4539        1.6624\na7                                             2.1215        0.1784\nrcCentral                                      0.2646        0.2753\nrcCentral + Eastern                            0.0117        0.0051\nrcCentral + Eastern + Toronto                  0.0034        0.0003\nrcCentral + Eastern + Toronto + Western        0.0004        0.0000\nrcCentral + Eastern + Western                  0.0012        0.0003\nrcCentral + Northern                           0.0028        0.0008\nrcCentral + Northern + Toronto                 0.0003        0.0001\nrcCentral + Northern + Western                 0.0007        0.0000\nrcCentral + Toronto                            0.0274        0.0085\nrcCentral + Toronto + Western                  0.0010        0.0003\nrcCentral + Western                            0.0131        0.0073\nrcEastern                                      0.2519        0.2528\nrcEastern + Northern                           0.0019        0.0010\nrcEastern + Northern + Toronto                 0.0004        0.0000\nrcEastern + Northern + Western                 0.0001        0.0000\nrcEastern + Toronto                            0.0174        0.0070\nrcEastern + Toronto + Western                  0.0003        0.0003\nrcEastern + Western                            0.0050        0.0011\nrcNorthern                                     0.1303        0.1204\nrcNorthern + Toronto                           0.0048        0.0017\nrcNorthern + Western                           0.0030        0.0012\nrcToronto                                      0.1321        0.1522\nrcToronto + Western                            0.0037        0.0012\nrcWestern                                      0.1225        0.1631\n                                             Std. Mean Diff.\ndistance                                -10877574058277.4844\nsgM                                                   0.0000\nsgF                                                   0.0000\nac                                                    3.3528\na1                                                    0.4306\na4                                                    0.2616\na7                                                    0.5093\nrcCentral                                            -0.0241\nrcCentral + Eastern                                   0.0928\nrcCentral + Eastern + Toronto                         0.1909\nrcCentral + Eastern + Toronto + Western               0.0288\nrcCentral + Eastern + Western                         0.0581\nrcCentral + Northern                                  0.0671\nrcCentral + Northern + Toronto                        0.0117\nrcCentral + Northern + Western                        0.0371\nrcCentral + Toronto                                   0.2051\nrcCentral + Toronto + Western                         0.0415\nrcCentral + Western                                   0.0680\nrcEastern                                            -0.0019\nrcEastern + Northern                                  0.0311\nrcEastern + Northern + Toronto                        0.0288\nrcEastern + Northern + Western                        0.0166\nrcEastern + Toronto                                   0.1237\nrcEastern + Toronto + Western                         0.0000\nrcEastern + Western                                   0.1162\nrcNorthern                                            0.0305\nrcNorthern + Toronto                                  0.0780\nrcNorthern + Western                                  0.0509\nrcToronto                                            -0.0560\nrcToronto + Western                                   0.0705\nrcWestern                                            -0.1100\n                                                              Var. Ratio\ndistance                                                          0.0000\nsgM                                                                    .\nsgF                                                                    .\nac                                      341692012766349154532196352.0000\na1                                                                2.1188\na4                                                                2.4738\na7                                                                6.3246\nrcCentral                                                              .\nrcCentral + Eastern                                                    .\nrcCentral + Eastern + Toronto                                          .\nrcCentral + Eastern + Toronto + Western                                .\nrcCentral + Eastern + Western                                          .\nrcCentral + Northern                                                   .\nrcCentral + Northern + Toronto                                         .\nrcCentral + Northern + Western                                         .\nrcCentral + Toronto                                                    .\nrcCentral + Toronto + Western                                          .\nrcCentral + Western                                                    .\nrcEastern                                                              .\nrcEastern + Northern                                                   .\nrcEastern + Northern + Toronto                                         .\nrcEastern + Northern + Western                                         .\nrcEastern + Toronto                                                    .\nrcEastern + Toronto + Western                                          .\nrcEastern + Western                                                    .\nrcNorthern                                                             .\nrcNorthern + Toronto                                                   .\nrcNorthern + Western                                                   .\nrcToronto                                                              .\nrcToronto + Western                                                    .\nrcWestern                                                              .\n                                        eCDF Mean eCDF Max\ndistance                                   0.5000   1.0000\nsgM                                        0.0000   0.0000\nsgF                                        0.0000   0.0000\nac                                         0.2027   1.0000\na1                                         0.0434   0.3814\na4                                         0.0188   0.1782\na7                                         0.0189   0.2579\nrcCentral                                  0.0107   0.0107\nrcCentral + Eastern                        0.0066   0.0066\nrcCentral + Eastern + Toronto              0.0032   0.0032\nrcCentral + Eastern + Toronto + Western    0.0004   0.0004\nrcCentral + Eastern + Western              0.0010   0.0010\nrcCentral + Northern                       0.0019   0.0019\nrcCentral + Northern + Toronto             0.0001   0.0001\nrcCentral + Northern + Western             0.0007   0.0007\nrcCentral + Toronto                        0.0189   0.0189\nrcCentral + Toronto + Western              0.0007   0.0007\nrcCentral + Western                        0.0058   0.0058\nrcEastern                                  0.0008   0.0008\nrcEastern + Northern                       0.0010   0.0010\nrcEastern + Northern + Toronto             0.0004   0.0004\nrcEastern + Northern + Western             0.0001   0.0001\nrcEastern + Toronto                        0.0103   0.0103\nrcEastern + Toronto + Western              0.0000   0.0000\nrcEastern + Western                        0.0039   0.0039\nrcNorthern                                 0.0099   0.0099\nrcNorthern + Toronto                       0.0032   0.0032\nrcNorthern + Western                       0.0018   0.0018\nrcToronto                                  0.0201   0.0201\nrcToronto + Western                        0.0025   0.0025\nrcWestern                                  0.0406   0.0406\n\nSummary of Balance for Matched Data:\n                                        Means Treated Means Control\ndistance                                            0        1.0000\nsgM                                                 0        0.8986\nsgF                                                 1        0.1014\nac                                                  2        1.0000\na1                                                  0        6.0704\na4                                                  0        1.6624\na7                                                  0        0.1784\nrcCentral                                           0        0.2753\nrcCentral + Eastern                                 0        0.0051\nrcCentral + Eastern + Toronto                       0        0.0003\nrcCentral + Eastern + Toronto + Western             0        0.0000\nrcCentral + Eastern + Western                       0        0.0003\nrcCentral + Northern                                0        0.0008\nrcCentral + Northern + Toronto                      0        0.0001\nrcCentral + Northern + Western                      0        0.0000\nrcCentral + Toronto                                 0        0.0085\nrcCentral + Toronto + Western                       0        0.0003\nrcCentral + Western                                 0        0.0073\nrcEastern                                           1        0.2528\nrcEastern + Northern                                0        0.0010\nrcEastern + Northern + Toronto                      0        0.0000\nrcEastern + Northern + Western                      0        0.0000\nrcEastern + Toronto                                 0        0.0070\nrcEastern + Toronto + Western                       0        0.0003\nrcEastern + Western                                 0        0.0011\nrcNorthern                                          0        0.1204\nrcNorthern + Toronto                                0        0.0017\nrcNorthern + Western                                0        0.0012\nrcToronto                                           0        0.1522\nrcToronto + Western                                 0        0.0012\nrcWestern                                           0        0.1631\n                                             Std. Mean Diff. Var. Ratio\ndistance                                -10877574058277.4844          .\nsgM                                                  -2.9773          .\nsgF                                                   2.9773          .\nac                                                    2.7563          .\na1                                                   -0.2200          .\na4                                                   -0.1147          .\na7                                                   -0.0467          .\nrcCentral                                            -0.6164          .\nrcCentral + Eastern                                  -0.0716          .\nrcCentral + Eastern + Toronto                        -0.0166          .\nrcCentral + Eastern + Toronto + Western               0.0000          .\nrcCentral + Eastern + Western                        -0.0166          .\nrcCentral + Northern                                 -0.0288          .\nrcCentral + Northern + Toronto                       -0.0117          .\nrcCentral + Northern + Western                        0.0000          .\nrcCentral + Toronto                                  -0.0928          .\nrcCentral + Toronto + Western                        -0.0166          .\nrcCentral + Western                                  -0.0858          .\nrcEastern                                             1.7194          .\nrcEastern + Northern                                 -0.0311          .\nrcEastern + Northern + Toronto                        0.0000          .\nrcEastern + Northern + Western                        0.0000          .\nrcEastern + Toronto                                  -0.0841          .\nrcEastern + Toronto + Western                        -0.0166          .\nrcEastern + Western                                  -0.0332          .\nrcNorthern                                           -0.3699          .\nrcNorthern + Toronto                                 -0.0407          .\nrcNorthern + Western                                 -0.0352          .\nrcToronto                                            -0.4237          .\nrcToronto + Western                                  -0.0352          .\nrcWestern                                            -0.4414          .\n                                        eCDF Mean eCDF Max     Std. Pair Dist.\ndistance                                   0.5000   1.0000 10877574058278.9004\nsgM                                        0.8986   0.8986              2.9773\nsgF                                        0.8986   0.8986              2.9773\nac                                         0.1667   1.0000              2.7563\na1                                         0.0216   0.1682              0.2200\na4                                         0.0078   0.0486              0.1147\na7                                         0.0015   0.0076              0.0467\nrcCentral                                  0.2753   0.2753              0.6164\nrcCentral + Eastern                        0.0051   0.0051              0.0716\nrcCentral + Eastern + Toronto              0.0003   0.0003              0.0166\nrcCentral + Eastern + Toronto + Western    0.0000   0.0000              0.0000\nrcCentral + Eastern + Western              0.0003   0.0003              0.0166\nrcCentral + Northern                       0.0008   0.0008              0.0288\nrcCentral + Northern + Toronto             0.0001   0.0001              0.0117\nrcCentral + Northern + Western             0.0000   0.0000              0.0000\nrcCentral + Toronto                        0.0085   0.0085              0.0928\nrcCentral + Toronto + Western              0.0003   0.0003              0.0166\nrcCentral + Western                        0.0073   0.0073              0.0858\nrcEastern                                  0.7472   0.7472              1.7194\nrcEastern + Northern                       0.0010   0.0010              0.0311\nrcEastern + Northern + Toronto             0.0000   0.0000              0.0000\nrcEastern + Northern + Western             0.0000   0.0000              0.0000\nrcEastern + Toronto                        0.0070   0.0070              0.0841\nrcEastern + Toronto + Western              0.0003   0.0003              0.0166\nrcEastern + Western                        0.0011   0.0011              0.0332\nrcNorthern                                 0.1204   0.1204              0.3699\nrcNorthern + Toronto                       0.0017   0.0017              0.0407\nrcNorthern + Western                       0.0012   0.0012              0.0352\nrcToronto                                  0.1522   0.1522              0.4237\nrcToronto + Western                        0.0012   0.0012              0.0352\nrcWestern                                  0.1631   0.1631              0.4414\n\nSample Sizes:\n          Control Treated\nAll          7260    7260\nMatched      7260       1\nUnmatched       0    7259\nDiscarded       0       0\n\nmodz1a &lt;- match.data(modz)\n\nlibrary(sjmisc)\norcm &lt;- copy(orcmatch_temp)\norcm &lt;- to_factor(orcm, sg, rc, treat)\nmorc &lt;- lm(treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcm)\nsjPlot::plot_model(\n  morc,\n  type = \"pred\",\n  terms = c(\"rc\", \"ac\", \"sg\"),\n  title = \"Stepwise Regression Prediction of Treatment\",\n) +\n  coord_flip() +\n  theme(plot.title = element_text(hjust = 0.5, face = \"bold\"))\n\n\n\n\n\n\n\nsjPlot::plot_model(\n  morc,\n  title = \"Stepwise Regression Prediction of Treatment\",\n  type = \"pred\",\n  terms = c(\"rc\", \"ac\", \"sg\")\n) +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    axis.text.x = element_text(\n      angle = 45, \n      hjust = 1, \n      vjust = 1,  \n      size = 9   \n    )\n  )  \n\n\n\n\n\n\n\nplot(bothstep, which = 1:4, ask = FALSE)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nplot(bothstepz, which = 1:4, ask = FALSE)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Logic Notebook</span>"
    ]
  }
]