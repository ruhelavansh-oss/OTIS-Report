<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>notez1a.knit</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="notez1a.knit_files/libs/clipboard/clipboard.min.js"></script>
<script src="notez1a.knit_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="notez1a.knit_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="notez1a.knit_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="notez1a.knit_files/libs/quarto-html/popper.min.js"></script>
<script src="notez1a.knit_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="notez1a.knit_files/libs/quarto-html/anchor.min.js"></script>
<link href="notez1a.knit_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="notez1a.knit_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="notez1a.knit_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="notez1a.knit_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="notez1a.knit_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="logic-notebook" class="level1">
<h1>Logic Notebook</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidymodels)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(naniar)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(readxl)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(janitor)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(rmarkdown)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(knitr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(kableExtra)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(modelsummary)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(DoubleML)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mlr3)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(broom)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ranger)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(sandwich)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(lmtest)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mlr3learners)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(readr)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(MatchIt)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(summarytools)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(DataExplorer)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mlr3learners)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mlr3measures)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(mlr3resampling)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5824769</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">device.ask.default =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>data010a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000000</span>)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  data010a,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"grey"</span>,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="dv">100</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Random Data"</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Value"</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Frequency"</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rdx <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>rdy <span class="ot">=</span> <span class="fu">as.numeric</span>(rdx <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rdix <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="dv">100</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>rdy[rdix] <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> rdy[rdix]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>rdf <span class="ot">=</span> <span class="fu">data.frame</span>(rdx, rdy)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rdf<span class="sc">$</span>rdx, rdf<span class="sc">$</span>rdy)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(rdy <span class="sc">~</span> rdx, <span class="at">data =</span> rdf, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>xs <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(rdf<span class="sc">$</span>rdx), <span class="fu">max</span>(rdf<span class="sc">$</span>rdx), <span class="at">length.out =</span> <span class="dv">300</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  xs,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(m, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">rdx =</span> xs), <span class="at">type =</span> <span class="st">"response"</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"correctional_stats_report_environment1b.RData"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dataframe_original <span class="ot">&lt;-</span> df</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cols_to_rename <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(dataframe_original), <span class="st">"unique_individual_id"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>num_to_letters <span class="ot">&lt;-</span> <span class="cf">function</span>(n) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(n, <span class="cf">function</span>(i) {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (i <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(letters[(i <span class="sc">%%</span> <span class="dv">26</span>) <span class="sc">+</span> <span class="dv">1</span>], out)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">%/%</span> <span class="dv">26</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    out</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"x1"</span>, <span class="fu">num_to_letters</span>(<span class="fu">seq_along</span>(cols_to_rename)))</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dataframe_original)[<span class="fu">match</span>(</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  cols_to_rename,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dataframe_original)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>)] <span class="ot">&lt;-</span> new_names</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    dataframe_original[, <span class="fu">setdiff</span>(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(dataframe_original),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"unique_individual_id"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    )],</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Ontario Restrictive Confinement Dataframe (2023-2025)"</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Ontario Restrictive Confinement Dataframe (2023-2025)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">x1a</th>
<th style="text-align: left;">x1b</th>
<th style="text-align: left;">x1c</th>
<th style="text-align: left;">x1d</th>
<th style="text-align: left;">x1e</th>
<th style="text-align: left;">x1f</th>
<th style="text-align: left;">x1g</th>
<th style="text-align: left;">x1h</th>
<th style="text-align: right;">x1i</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">50+</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Western</td>
<td style="text-align: left;">Western</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">50+</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">50+</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Central</td>
<td style="text-align: left;">Central</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">50+</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Western</td>
<td style="text-align: left;">Western</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>region_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Central"</span>, <span class="st">"Eastern"</span>, <span class="st">"Northern"</span>, <span class="st">"Toronto"</span>, <span class="st">"Western"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>age_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"18 to 24"</span>, <span class="st">"25 to 49"</span>, <span class="st">"50+"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sex_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">2023</span><span class="sc">:</span><span class="dv">2025</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dataframe_original1b <span class="ot">&lt;-</span> <span class="fu">copy</span>(dataframe_original)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>df_rc <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(df)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>df_rc[, end_fiscal_year <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(end_fiscal_year)]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>df_rc[, age_category <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(age_category, <span class="at">levels =</span> age_levels)]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>df_rc[, gender <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(gender, <span class="at">levels =</span> sex_levels)]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>df_rc[,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  region_at_time_of_placement <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    region_at_time_of_placement,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> region_names</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>get_region_by_age <span class="ot">&lt;-</span> <span class="cf">function</span>(D, yr, <span class="at">sex =</span> <span class="cn">NULL</span>) {</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  tmp <span class="ot">&lt;-</span> D[</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    end_fiscal_year <span class="sc">==</span> yr <span class="sc">&amp;</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(age_category) <span class="sc">&amp;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(region_at_time_of_placement)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(sex)) {</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> tmp[gender <span class="sc">==</span> sex]</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> tmp[,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    .(<span class="at">n =</span> <span class="fu">uniqueN</span>(unique_individual_id)),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">=</span> .(age_category, region_at_time_of_placement)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">&lt;-</span> <span class="fu">CJ</span>(</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_category =</span> age_levels,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">region_at_time_of_placement =</span> region_names,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique =</span> <span class="cn">TRUE</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    grid,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    tab,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"age_category"</span>, <span class="st">"region_at_time_of_placement"</span>),</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  tab[<span class="fu">is.na</span>(n), n <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>L]</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  wide <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    tab,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    age_category <span class="sc">~</span> region_at_time_of_placement,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">value.var =</span> <span class="st">"n"</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(wide[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(S) <span class="ot">&lt;-</span> wide<span class="sc">$</span>age_category</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  den <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(S)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> <span class="fu">sweep</span>(S, <span class="dv">1</span>, den, <span class="st">"/"</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  P[den <span class="sc">==</span> <span class="dv">0</span>, ] <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">S =</span> S, <span class="at">P =</span> P)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>P_year <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>S_year <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (yr <span class="cf">in</span> years) {</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  out_all <span class="ot">&lt;-</span> <span class="fu">get_region_by_age</span>(df_rc, yr)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  P <span class="ot">&lt;-</span> out_all<span class="sc">$</span>P</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  S_year[[<span class="fu">as.character</span>(yr)]] <span class="ot">&lt;-</span> out_all<span class="sc">$</span>S</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  P_year[[<span class="fu">as.character</span>(yr)]] <span class="ot">&lt;-</span> P</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(P))</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matplot</span>(</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    P,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> cols,</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxt =</span> <span class="st">"n"</span>,</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="fu">paste0</span>(yr, <span class="st">" Region at Time of Placement by Age Group"</span>)</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(P)), <span class="at">labels =</span> <span class="fu">rownames</span>(P))</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend</span>(</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">"topright"</span>,</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">colnames</span>(P),</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> cols,</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">bty =</span> <span class="st">"n"</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sex <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)) {</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    out_sex <span class="ot">&lt;-</span> <span class="fu">get_region_by_age</span>(df_rc, yr, <span class="at">sex =</span> sex)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    Psex <span class="ot">&lt;-</span> out_sex<span class="sc">$</span>P</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    cols <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(Psex))</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">matplot</span>(</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>      Psex,</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> cols,</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxt =</span> <span class="st">"n"</span>,</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">ylab =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="fu">paste0</span>(yr, <span class="st">" RTP ("</span>, sex, <span class="st">")"</span>)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at =</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(Psex)), <span class="at">labels =</span> <span class="fu">rownames</span>(Psex))</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>      <span class="st">"topright"</span>,</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend =</span> <span class="fu">colnames</span>(Psex),</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> cols,</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">bty =</span> <span class="st">"n"</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ac1b <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ac1a =</span> <span class="fu">factor</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.character</span>(age_category),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"18 to 24"</span> <span class="ot">=</span> <span class="st">"1"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"25 to 49"</span> <span class="ot">=</span> <span class="st">"2"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"50+"</span> <span class="ot">=</span> <span class="st">"3"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ac1a) <span class="sc">|&gt;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> dplyr<span class="sc">::</span><span class="fu">n</span>(),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(unique_individual_id),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ac1a) <span class="sc">|&gt;</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="dv">2</span>),</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="dv">2</span>),</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate =</span> <span class="fu">round</span>(<span class="dv">10000</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), <span class="dv">2</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gender"</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"age_category"</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"region_at_time_of_placement"</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"region_most_recent_placement"</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mental_health_alert"</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"suicide_watch_alert"</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"suicide_risk_alert"</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>df.counts <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region_at_time_of_placement) <span class="sc">|&gt;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> <span class="fu">n</span>(),</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n_distinct</span>(unique_individual_id),</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count), <span class="at">pct =</span> p <span class="sc">*</span> <span class="dv">100</span>, <span class="at">rate =</span> p <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>df.counts_ac_year <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">all_of</span>(vars), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"level"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_fiscal_year, variable, level) <span class="sc">|&gt;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> <span class="fu">n</span>(),</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n_distinct</span>(unique_individual_id),</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_fiscal_year, variable) <span class="sc">|&gt;</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count), <span class="at">pct =</span> <span class="dv">100</span> <span class="sc">*</span> p, <span class="at">rate =</span> <span class="dv">10000</span> <span class="sc">*</span> p) <span class="sc">|&gt;</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>df.counts_year <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_fiscal_year, region_at_time_of_placement) <span class="sc">|&gt;</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> <span class="fu">n</span>(),</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n_distinct</span>(unique_individual_id),</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(end_fiscal_year) <span class="sc">|&gt;</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count), <span class="at">pct =</span> <span class="dv">100</span> <span class="sc">*</span> p, <span class="at">rate =</span> <span class="dv">10000</span> <span class="sc">*</span> p) <span class="sc">|&gt;</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>df.person_freq_year <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    end_fiscal_year,</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    region_at_time_of_placement,</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    unique_individual_id</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>ecdf_age <span class="ot">&lt;-</span> ac1b <span class="sc">|&gt;</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ac1a) <span class="sc">|&gt;</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ecdf =</span> <span class="fu">cumsum</span>(p))</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>events_per_person <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(unique_individual_id, <span class="at">name =</span> <span class="st">"n_events"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(n_events)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>total_people <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">n_distinct</span>(unique_individual_id)) <span class="sc">|&gt;</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(N)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>df_overall <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(unique_individual_id, <span class="fu">all_of</span>(vars)) <span class="sc">|&gt;</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">all_of</span>(vars), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"level"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable, level) <span class="sc">|&gt;</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> <span class="fu">n</span>(),</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n_distinct</span>(unique_individual_id),</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> count <span class="sc">/</span> total_people,</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> <span class="dv">100</span> <span class="sc">*</span> p,</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate =</span> <span class="dv">10000</span> <span class="sc">*</span> p</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>  ecdf_age,</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`ecdf_age`)'</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>ecdf_age</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">ac1a</th>
<th style="text-align: right;">f</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">pct</th>
<th style="text-align: right;">rate</th>
<th style="text-align: right;">ecdf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">11977</td>
<td style="text-align: right;">10139</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">15.49</td>
<td style="text-align: right;">1548.72</td>
<td style="text-align: right;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">56518</td>
<td style="text-align: right;">47857</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">73.10</td>
<td style="text-align: right;">7310.10</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">8439</td>
<td style="text-align: right;">7471</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">11.41</td>
<td style="text-align: right;">1141.19</td>
<td style="text-align: right;">0.99</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  df.counts,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`df.counts`).'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>df.counts</code>).</caption>
<colgroup>
<col style="width: 41%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">region_at_time_of_placement</th>
<th style="text-align: right;">f</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">pct</th>
<th style="text-align: right;">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Central</td>
<td style="text-align: right;">22643</td>
<td style="text-align: right;">20066</td>
<td style="text-align: right;">0.2943783</td>
<td style="text-align: right;">29.43783</td>
<td style="text-align: right;">2943.783</td>
</tr>
<tr class="even">
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">20349</td>
<td style="text-align: right;">17811</td>
<td style="text-align: right;">0.2612963</td>
<td style="text-align: right;">26.12963</td>
<td style="text-align: right;">2612.963</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">9110</td>
<td style="text-align: right;">7891</td>
<td style="text-align: right;">0.1157649</td>
<td style="text-align: right;">11.57649</td>
<td style="text-align: right;">1157.649</td>
</tr>
<tr class="even">
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">12602</td>
<td style="text-align: right;">11213</td>
<td style="text-align: right;">0.1645003</td>
<td style="text-align: right;">16.45003</td>
<td style="text-align: right;">1645.003</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Western</td>
<td style="text-align: right;">12230</td>
<td style="text-align: right;">11183</td>
<td style="text-align: right;">0.1640602</td>
<td style="text-align: right;">16.40602</td>
<td style="text-align: right;">1640.602</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  df.counts_year,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`df.counts_year`)'</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>df.counts_year</code>)</caption>
<colgroup>
<col style="width: 18%">
<col style="width: 32%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">end_fiscal_year</th>
<th style="text-align: left;">region_at_time_of_placement</th>
<th style="text-align: right;">f</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">pct</th>
<th style="text-align: right;">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">7663</td>
<td style="text-align: right;">6784</td>
<td style="text-align: right;">0.3174841</td>
<td style="text-align: right;">31.748409</td>
<td style="text-align: right;">3174.8409</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">5811</td>
<td style="text-align: right;">5079</td>
<td style="text-align: right;">0.2376919</td>
<td style="text-align: right;">23.769188</td>
<td style="text-align: right;">2376.9188</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">3422</td>
<td style="text-align: right;">3031</td>
<td style="text-align: right;">0.1418476</td>
<td style="text-align: right;">14.184762</td>
<td style="text-align: right;">1418.4762</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">3455</td>
<td style="text-align: right;">2999</td>
<td style="text-align: right;">0.1403501</td>
<td style="text-align: right;">14.035006</td>
<td style="text-align: right;">1403.5006</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">3772</td>
<td style="text-align: right;">3475</td>
<td style="text-align: right;">0.1626264</td>
<td style="text-align: right;">16.262636</td>
<td style="text-align: right;">1626.2636</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">5949</td>
<td style="text-align: right;">5228</td>
<td style="text-align: right;">0.2569926</td>
<td style="text-align: right;">25.699258</td>
<td style="text-align: right;">2569.9258</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">7416</td>
<td style="text-align: right;">6569</td>
<td style="text-align: right;">0.3229121</td>
<td style="text-align: right;">32.291206</td>
<td style="text-align: right;">3229.1206</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">2852</td>
<td style="text-align: right;">2417</td>
<td style="text-align: right;">0.1188124</td>
<td style="text-align: right;">11.881237</td>
<td style="text-align: right;">1188.1237</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">2874</td>
<td style="text-align: right;">2575</td>
<td style="text-align: right;">0.1265792</td>
<td style="text-align: right;">12.657917</td>
<td style="text-align: right;">1265.7917</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">3904</td>
<td style="text-align: right;">3554</td>
<td style="text-align: right;">0.1747038</td>
<td style="text-align: right;">17.470383</td>
<td style="text-align: right;">1747.0383</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">9031</td>
<td style="text-align: right;">8054</td>
<td style="text-align: right;">0.3044645</td>
<td style="text-align: right;">30.446452</td>
<td style="text-align: right;">3044.6452</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">7122</td>
<td style="text-align: right;">6163</td>
<td style="text-align: right;">0.2329792</td>
<td style="text-align: right;">23.297925</td>
<td style="text-align: right;">2329.7925</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">2836</td>
<td style="text-align: right;">2443</td>
<td style="text-align: right;">0.0923525</td>
<td style="text-align: right;">9.235247</td>
<td style="text-align: right;">923.5247</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">6273</td>
<td style="text-align: right;">5639</td>
<td style="text-align: right;">0.2131705</td>
<td style="text-align: right;">21.317053</td>
<td style="text-align: right;">2131.7053</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">4554</td>
<td style="text-align: right;">4154</td>
<td style="text-align: right;">0.1570332</td>
<td style="text-align: right;">15.703323</td>
<td style="text-align: right;">1570.3323</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  df_overall,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`df_overall`)'</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>df_overall</code>)</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">level</th>
<th style="text-align: right;">f</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">pct</th>
<th style="text-align: right;">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">18 to 24</td>
<td style="text-align: right;">11977</td>
<td style="text-align: right;">10139</td>
<td style="text-align: right;">0.1548719</td>
<td style="text-align: right;">15.487192</td>
<td style="text-align: right;">1548.7192</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: right;">56518</td>
<td style="text-align: right;">47857</td>
<td style="text-align: right;">0.7310095</td>
<td style="text-align: right;">73.100952</td>
<td style="text-align: right;">7310.0952</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">50+</td>
<td style="text-align: right;">8439</td>
<td style="text-align: right;">7471</td>
<td style="text-align: right;">0.1141186</td>
<td style="text-align: right;">11.411856</td>
<td style="text-align: right;">1141.1856</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">7242</td>
<td style="text-align: right;">6256</td>
<td style="text-align: right;">0.0955596</td>
<td style="text-align: right;">9.555960</td>
<td style="text-align: right;">955.5959</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">69692</td>
<td style="text-align: right;">59211</td>
<td style="text-align: right;">0.9044404</td>
<td style="text-align: right;">90.444040</td>
<td style="text-align: right;">9044.4041</td>
</tr>
<tr class="even">
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">55837</td>
<td style="text-align: right;">50900</td>
<td style="text-align: right;">0.7774909</td>
<td style="text-align: right;">77.749095</td>
<td style="text-align: right;">7774.9095</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">21097</td>
<td style="text-align: right;">17661</td>
<td style="text-align: right;">0.2697695</td>
<td style="text-align: right;">26.976950</td>
<td style="text-align: right;">2697.6950</td>
</tr>
<tr class="even">
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">22643</td>
<td style="text-align: right;">20066</td>
<td style="text-align: right;">0.3065056</td>
<td style="text-align: right;">30.650557</td>
<td style="text-align: right;">3065.0557</td>
</tr>
<tr class="odd">
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">20349</td>
<td style="text-align: right;">17811</td>
<td style="text-align: right;">0.2720607</td>
<td style="text-align: right;">27.206073</td>
<td style="text-align: right;">2720.6073</td>
</tr>
<tr class="even">
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">9110</td>
<td style="text-align: right;">7891</td>
<td style="text-align: right;">0.1205340</td>
<td style="text-align: right;">12.053401</td>
<td style="text-align: right;">1205.3401</td>
</tr>
<tr class="odd">
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">12602</td>
<td style="text-align: right;">11213</td>
<td style="text-align: right;">0.1712771</td>
<td style="text-align: right;">17.127713</td>
<td style="text-align: right;">1712.7713</td>
</tr>
<tr class="even">
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">12230</td>
<td style="text-align: right;">11183</td>
<td style="text-align: right;">0.1708189</td>
<td style="text-align: right;">17.081889</td>
<td style="text-align: right;">1708.1889</td>
</tr>
<tr class="odd">
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">22577</td>
<td style="text-align: right;">19207</td>
<td style="text-align: right;">0.2933845</td>
<td style="text-align: right;">29.338445</td>
<td style="text-align: right;">2933.8445</td>
</tr>
<tr class="even">
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">20263</td>
<td style="text-align: right;">17237</td>
<td style="text-align: right;">0.2632930</td>
<td style="text-align: right;">26.329296</td>
<td style="text-align: right;">2632.9296</td>
</tr>
<tr class="odd">
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">9080</td>
<td style="text-align: right;">7696</td>
<td style="text-align: right;">0.1175554</td>
<td style="text-align: right;">11.755541</td>
<td style="text-align: right;">1175.5541</td>
</tr>
<tr class="even">
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">12743</td>
<td style="text-align: right;">10558</td>
<td style="text-align: right;">0.1612721</td>
<td style="text-align: right;">16.127209</td>
<td style="text-align: right;">1612.7209</td>
</tr>
<tr class="odd">
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">12271</td>
<td style="text-align: right;">10769</td>
<td style="text-align: right;">0.1644951</td>
<td style="text-align: right;">16.449509</td>
<td style="text-align: right;">1644.9509</td>
</tr>
<tr class="even">
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">63229</td>
<td style="text-align: right;">58447</td>
<td style="text-align: right;">0.8927704</td>
<td style="text-align: right;">89.277040</td>
<td style="text-align: right;">8927.7040</td>
</tr>
<tr class="odd">
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">13705</td>
<td style="text-align: right;">11328</td>
<td style="text-align: right;">0.1730337</td>
<td style="text-align: right;">17.303374</td>
<td style="text-align: right;">1730.3374</td>
</tr>
<tr class="even">
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">71715</td>
<td style="text-align: right;">64433</td>
<td style="text-align: right;">0.9842058</td>
<td style="text-align: right;">98.420578</td>
<td style="text-align: right;">9842.0578</td>
</tr>
<tr class="odd">
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">5219</td>
<td style="text-align: right;">4921</td>
<td style="text-align: right;">0.0751676</td>
<td style="text-align: right;">7.516764</td>
<td style="text-align: right;">751.6764</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  df.counts_ac_year,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`df.counts_ac_year`)'</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>df.counts_ac_year</code>)</caption>
<colgroup>
<col style="width: 16%">
<col style="width: 30%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">end_fiscal_year</th>
<th style="text-align: left;">variable</th>
<th style="text-align: left;">level</th>
<th style="text-align: right;">f</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">p</th>
<th style="text-align: right;">pct</th>
<th style="text-align: right;">rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">18 to 24</td>
<td style="text-align: right;">4062</td>
<td style="text-align: right;">3507</td>
<td style="text-align: right;">0.1687599</td>
<td style="text-align: right;">16.875992</td>
<td style="text-align: right;">1687.5992</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: right;">17437</td>
<td style="text-align: right;">14930</td>
<td style="text-align: right;">0.7184447</td>
<td style="text-align: right;">71.844473</td>
<td style="text-align: right;">7184.4473</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">50+</td>
<td style="text-align: right;">2624</td>
<td style="text-align: right;">2344</td>
<td style="text-align: right;">0.1127953</td>
<td style="text-align: right;">11.279534</td>
<td style="text-align: right;">1127.9534</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">1712</td>
<td style="text-align: right;">1511</td>
<td style="text-align: right;">0.0727106</td>
<td style="text-align: right;">7.271065</td>
<td style="text-align: right;">727.1065</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">22411</td>
<td style="text-align: right;">19270</td>
<td style="text-align: right;">0.9272894</td>
<td style="text-align: right;">92.728935</td>
<td style="text-align: right;">9272.8935</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">17726</td>
<td style="text-align: right;">16399</td>
<td style="text-align: right;">0.7487786</td>
<td style="text-align: right;">74.877859</td>
<td style="text-align: right;">7487.7859</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">6397</td>
<td style="text-align: right;">5502</td>
<td style="text-align: right;">0.2512214</td>
<td style="text-align: right;">25.122141</td>
<td style="text-align: right;">2512.2141</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">7663</td>
<td style="text-align: right;">6784</td>
<td style="text-align: right;">0.3174841</td>
<td style="text-align: right;">31.748409</td>
<td style="text-align: right;">3174.8409</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">5811</td>
<td style="text-align: right;">5079</td>
<td style="text-align: right;">0.2376919</td>
<td style="text-align: right;">23.769188</td>
<td style="text-align: right;">2376.9188</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">3422</td>
<td style="text-align: right;">3031</td>
<td style="text-align: right;">0.1418476</td>
<td style="text-align: right;">14.184762</td>
<td style="text-align: right;">1418.4762</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">3455</td>
<td style="text-align: right;">2999</td>
<td style="text-align: right;">0.1403501</td>
<td style="text-align: right;">14.035006</td>
<td style="text-align: right;">1403.5006</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">3772</td>
<td style="text-align: right;">3475</td>
<td style="text-align: right;">0.1626264</td>
<td style="text-align: right;">16.262636</td>
<td style="text-align: right;">1626.2636</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">7647</td>
<td style="text-align: right;">6581</td>
<td style="text-align: right;">0.3166835</td>
<td style="text-align: right;">31.668351</td>
<td style="text-align: right;">3166.8351</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">5841</td>
<td style="text-align: right;">4987</td>
<td style="text-align: right;">0.2399788</td>
<td style="text-align: right;">23.997883</td>
<td style="text-align: right;">2399.7883</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">3422</td>
<td style="text-align: right;">2988</td>
<td style="text-align: right;">0.1437852</td>
<td style="text-align: right;">14.378519</td>
<td style="text-align: right;">1437.8519</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">3425</td>
<td style="text-align: right;">2826</td>
<td style="text-align: right;">0.1359896</td>
<td style="text-align: right;">13.598961</td>
<td style="text-align: right;">1359.8961</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">3788</td>
<td style="text-align: right;">3399</td>
<td style="text-align: right;">0.1635629</td>
<td style="text-align: right;">16.356287</td>
<td style="text-align: right;">1635.6287</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">20380</td>
<td style="text-align: right;">18942</td>
<td style="text-align: right;">0.8549377</td>
<td style="text-align: right;">85.493771</td>
<td style="text-align: right;">8549.3771</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">3743</td>
<td style="text-align: right;">3214</td>
<td style="text-align: right;">0.1450623</td>
<td style="text-align: right;">14.506229</td>
<td style="text-align: right;">1450.6229</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">23057</td>
<td style="text-align: right;">20621</td>
<td style="text-align: right;">0.9531756</td>
<td style="text-align: right;">95.317556</td>
<td style="text-align: right;">9531.7556</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">1066</td>
<td style="text-align: right;">1013</td>
<td style="text-align: right;">0.0468244</td>
<td style="text-align: right;">4.682444</td>
<td style="text-align: right;">468.2444</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">18 to 24</td>
<td style="text-align: right;">3486</td>
<td style="text-align: right;">2944</td>
<td style="text-align: right;">0.1498905</td>
<td style="text-align: right;">14.989054</td>
<td style="text-align: right;">1498.9054</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: right;">16959</td>
<td style="text-align: right;">14445</td>
<td style="text-align: right;">0.7354514</td>
<td style="text-align: right;">73.545135</td>
<td style="text-align: right;">7354.5135</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">50+</td>
<td style="text-align: right;">2550</td>
<td style="text-align: right;">2252</td>
<td style="text-align: right;">0.1146581</td>
<td style="text-align: right;">11.465811</td>
<td style="text-align: right;">1146.5811</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">2219</td>
<td style="text-align: right;">1924</td>
<td style="text-align: right;">0.0979584</td>
<td style="text-align: right;">9.795835</td>
<td style="text-align: right;">979.5835</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">20776</td>
<td style="text-align: right;">17717</td>
<td style="text-align: right;">0.9020416</td>
<td style="text-align: right;">90.204165</td>
<td style="text-align: right;">9020.4165</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">16562</td>
<td style="text-align: right;">15146</td>
<td style="text-align: right;">0.7372469</td>
<td style="text-align: right;">73.724688</td>
<td style="text-align: right;">7372.4688</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">6433</td>
<td style="text-align: right;">5398</td>
<td style="text-align: right;">0.2627531</td>
<td style="text-align: right;">26.275312</td>
<td style="text-align: right;">2627.5312</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">5949</td>
<td style="text-align: right;">5228</td>
<td style="text-align: right;">0.2569926</td>
<td style="text-align: right;">25.699258</td>
<td style="text-align: right;">2569.9258</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">7416</td>
<td style="text-align: right;">6569</td>
<td style="text-align: right;">0.3229121</td>
<td style="text-align: right;">32.291206</td>
<td style="text-align: right;">3229.1206</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">2852</td>
<td style="text-align: right;">2417</td>
<td style="text-align: right;">0.1188124</td>
<td style="text-align: right;">11.881237</td>
<td style="text-align: right;">1188.1237</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">2874</td>
<td style="text-align: right;">2575</td>
<td style="text-align: right;">0.1265792</td>
<td style="text-align: right;">12.657917</td>
<td style="text-align: right;">1265.7917</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">3904</td>
<td style="text-align: right;">3554</td>
<td style="text-align: right;">0.1747038</td>
<td style="text-align: right;">17.470383</td>
<td style="text-align: right;">1747.0383</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">5969</td>
<td style="text-align: right;">5035</td>
<td style="text-align: right;">0.2563515</td>
<td style="text-align: right;">25.635151</td>
<td style="text-align: right;">2563.5151</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">7400</td>
<td style="text-align: right;">6382</td>
<td style="text-align: right;">0.3249325</td>
<td style="text-align: right;">32.493254</td>
<td style="text-align: right;">3249.3254</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">2860</td>
<td style="text-align: right;">2376</td>
<td style="text-align: right;">0.1209714</td>
<td style="text-align: right;">12.097144</td>
<td style="text-align: right;">1209.7144</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">2896</td>
<td style="text-align: right;">2408</td>
<td style="text-align: right;">0.1226007</td>
<td style="text-align: right;">12.260068</td>
<td style="text-align: right;">1226.0068</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">3870</td>
<td style="text-align: right;">3440</td>
<td style="text-align: right;">0.1751438</td>
<td style="text-align: right;">17.514383</td>
<td style="text-align: right;">1751.4383</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">18616</td>
<td style="text-align: right;">17315</td>
<td style="text-align: right;">0.8272419</td>
<td style="text-align: right;">82.724189</td>
<td style="text-align: right;">8272.4189</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">4379</td>
<td style="text-align: right;">3616</td>
<td style="text-align: right;">0.1727581</td>
<td style="text-align: right;">17.275811</td>
<td style="text-align: right;">1727.5811</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">21198</td>
<td style="text-align: right;">19259</td>
<td style="text-align: right;">0.9190208</td>
<td style="text-align: right;">91.902080</td>
<td style="text-align: right;">9190.2081</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">1797</td>
<td style="text-align: right;">1697</td>
<td style="text-align: right;">0.0809792</td>
<td style="text-align: right;">8.097919</td>
<td style="text-align: right;">809.7919</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">18 to 24</td>
<td style="text-align: right;">4429</td>
<td style="text-align: right;">3688</td>
<td style="text-align: right;">0.1472549</td>
<td style="text-align: right;">14.725494</td>
<td style="text-align: right;">1472.5494</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">25 to 49</td>
<td style="text-align: right;">22122</td>
<td style="text-align: right;">18482</td>
<td style="text-align: right;">0.7379517</td>
<td style="text-align: right;">73.795169</td>
<td style="text-align: right;">7379.5169</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">age_category</td>
<td style="text-align: left;">50+</td>
<td style="text-align: right;">3265</td>
<td style="text-align: right;">2875</td>
<td style="text-align: right;">0.1147934</td>
<td style="text-align: right;">11.479337</td>
<td style="text-align: right;">1147.9337</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Female</td>
<td style="text-align: right;">3311</td>
<td style="text-align: right;">2821</td>
<td style="text-align: right;">0.1126373</td>
<td style="text-align: right;">11.263725</td>
<td style="text-align: right;">1126.3725</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">gender</td>
<td style="text-align: left;">Male</td>
<td style="text-align: right;">26505</td>
<td style="text-align: right;">22224</td>
<td style="text-align: right;">0.8873627</td>
<td style="text-align: right;">88.736275</td>
<td style="text-align: right;">8873.6275</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">21549</td>
<td style="text-align: right;">19355</td>
<td style="text-align: right;">0.7411166</td>
<td style="text-align: right;">74.111656</td>
<td style="text-align: right;">7411.1656</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">mental_health_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">8267</td>
<td style="text-align: right;">6761</td>
<td style="text-align: right;">0.2588834</td>
<td style="text-align: right;">25.888344</td>
<td style="text-align: right;">2588.8344</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">9031</td>
<td style="text-align: right;">8054</td>
<td style="text-align: right;">0.3044645</td>
<td style="text-align: right;">30.446452</td>
<td style="text-align: right;">3044.6452</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">7122</td>
<td style="text-align: right;">6163</td>
<td style="text-align: right;">0.2329792</td>
<td style="text-align: right;">23.297925</td>
<td style="text-align: right;">2329.7925</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">2836</td>
<td style="text-align: right;">2443</td>
<td style="text-align: right;">0.0923525</td>
<td style="text-align: right;">9.235247</td>
<td style="text-align: right;">923.5247</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">6273</td>
<td style="text-align: right;">5639</td>
<td style="text-align: right;">0.2131705</td>
<td style="text-align: right;">21.317053</td>
<td style="text-align: right;">2131.7053</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_at_time_of_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">4554</td>
<td style="text-align: right;">4154</td>
<td style="text-align: right;">0.1570332</td>
<td style="text-align: right;">15.703323</td>
<td style="text-align: right;">1570.3323</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Central</td>
<td style="text-align: right;">8961</td>
<td style="text-align: right;">7591</td>
<td style="text-align: right;">0.3030944</td>
<td style="text-align: right;">30.309443</td>
<td style="text-align: right;">3030.9443</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Eastern</td>
<td style="text-align: right;">7022</td>
<td style="text-align: right;">5868</td>
<td style="text-align: right;">0.2342983</td>
<td style="text-align: right;">23.429826</td>
<td style="text-align: right;">2342.9826</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Northern</td>
<td style="text-align: right;">2798</td>
<td style="text-align: right;">2332</td>
<td style="text-align: right;">0.0931124</td>
<td style="text-align: right;">9.311240</td>
<td style="text-align: right;">931.1240</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Toronto</td>
<td style="text-align: right;">6422</td>
<td style="text-align: right;">5324</td>
<td style="text-align: right;">0.2125774</td>
<td style="text-align: right;">21.257736</td>
<td style="text-align: right;">2125.7736</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">region_most_recent_placement</td>
<td style="text-align: left;">Western</td>
<td style="text-align: right;">4613</td>
<td style="text-align: right;">3930</td>
<td style="text-align: right;">0.1569175</td>
<td style="text-align: right;">15.691755</td>
<td style="text-align: right;">1569.1755</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">24233</td>
<td style="text-align: right;">22190</td>
<td style="text-align: right;">0.8314598</td>
<td style="text-align: right;">83.145983</td>
<td style="text-align: right;">8314.5983</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">suicide_risk_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">5583</td>
<td style="text-align: right;">4498</td>
<td style="text-align: right;">0.1685402</td>
<td style="text-align: right;">16.854017</td>
<td style="text-align: right;">1685.4017</td>
</tr>
<tr class="even">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">27460</td>
<td style="text-align: right;">24553</td>
<td style="text-align: right;">0.9173890</td>
<td style="text-align: right;">91.738903</td>
<td style="text-align: right;">9173.8903</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: left;">suicide_watch_alert</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">2356</td>
<td style="text-align: right;">2211</td>
<td style="text-align: right;">0.0826110</td>
<td style="text-align: right;">8.261097</td>
<td style="text-align: right;">826.1097</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoubleML)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>lgr<span class="sc">::</span><span class="fu">get_logger</span>(<span class="st">"mlr3"</span>)<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="st">"warn"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># "regr.lm" instead of "regr.ranger" utilized (disclaimer)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># "classif.log_reg", predict_type = "prob" instead of classif.ranger</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cores &lt;- max(1L, parallel::detectCores() - 1L)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># yn_cols &lt;- c("mental_health_alert", "suicide_risk_alert", "suicide_watch_alert")</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># dfn &lt;- dfn %&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(across(</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     all_of(yn_cols),</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#     ~ factor(dplyr::if_else(.x == "Yes", 1L, 0L), levels = c(0, 1))</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   ))</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># dt &lt;- as.data.table(dfn)</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># dt[, number_of_placements := as.integer(number_of_placements)]</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># dt &lt;- dt[!is.na(number_of_placements) &amp; number_of_placements &gt; 0L]</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># N_expanded &lt;- sum(dt$number_of_placements)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co"># message("Expanded N = ", format(N_expanded, big.mark = ","))</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># dt &lt;- dt[rep.int(seq_len(.N), number_of_placements)]</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># dt[, Y := as.integer(suicide_risk_alert) - 1L]</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># dt[, D := as.integer(mental_health_alert) - 1L]</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># stopifnot(identical(sort(unique(dt$D)), c(0L, 1L)))</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># dt[, cluster_id := as.factor(unique_individual_id)]</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ml_g &lt;- lrn("regr.lm")</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># ml_m &lt;- lrn("classif.log_reg", predict_type = "prob")</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># fit_irm_ate_atte &lt;- function(dsub, x_cols, tag) {</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   dml_data &lt;- DoubleMLClusterData$new(</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     data = dsub,</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     y_col = "Y",</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">#     d_cols = "D",</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">#     x_cols = x_cols,</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     cluster_cols = "cluster_id"</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   set.seed(1111111111)</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_ate &lt;- DoubleMLIRM$new(</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     dml_data,</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     ml_g = ml_g,</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">#     ml_m = ml_m,</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_folds = 3,</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_rep = 1,</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">#     score = "ATE"</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_ate$fit()</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   set.seed(1111111111)</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_atte &lt;- DoubleMLIRM$new(</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co">#     dml_data,</span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co">#     ml_g = ml_g,</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co">#     ml_m = ml_m,</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_folds = 3,</span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_rep = 1,</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co">#     score = "ATTE"</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   obj_atte$fit()</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   mk &lt;- function(obj, estimand) {</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="co">#     ci &lt;- obj$confint(level = 0.95)</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     data.table(</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       group = tag,</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co">#       estimand = estimand,</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co">#       effect = as.numeric(obj$coef),</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co">#       se = as.numeric(obj$se),</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co">#       t_value = as.numeric(obj$t_stat),</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="co">#       p_value = as.numeric(obj$pval),</span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co">#       ci_low = as.numeric(ci[1, 1]),</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co">#       ci_high = as.numeric(ci[1, 2])</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   rbind(mk(obj_ate, "ATE"), mk(obj_atte, "ATTE"))</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="co"># x_cols_pool &lt;- c(</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   "gender",</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   "age_category",</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   "region_at_time_of_placement",</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   "region_most_recent_placement",</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   "end_fiscal_year"</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="co"># dt[, (x_cols_pool) := lapply(.SD, as.factor), .SDcols = x_cols_pool]</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_pool &lt;- complete.cases(dt[,</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="co">#   c("Y", "D", "cluster_id", x_cols_pool),</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   with = FALSE</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ])</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co"># dsub_pool &lt;- dt[keep_pool, c("Y", "D", "cluster_id", x_cols_pool), with = FALSE]</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="co"># res_pool &lt;- fit_irm_ate_atte(dsub_pool, x_cols_pool, tag = "Pooled 2023-25")</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="co"># years &lt;- sort(unique(dt$end_fiscal_year))</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="co"># x_cols_year &lt;- c(</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="co">#   "gender",</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co">#   "age_category",</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co">#   "region_at_time_of_placement",</span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="co">#   "region_most_recent_placement"</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="co"># res_by_year &lt;- rbindlist(lapply(years, function(yy) {</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   sub &lt;- dt[end_fiscal_year == yy]</span></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   sub[, (x_cols_year) := lapply(.SD, as.factor), .SDcols = x_cols_year]</span></span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   keep_y &lt;- complete.cases(sub[,</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="co">#     c("Y", "D", "cluster_id", x_cols_year),</span></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a><span class="co">#     with = FALSE</span></span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="co">#   ])</span></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="co">#   dsub_y &lt;- sub[keep_y, c("Y", "D", "cluster_id", x_cols_year), with = FALSE]</span></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="co">#   fit_irm_ate_atte(dsub_y, x_cols_year, tag = as.character(yy))</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a><span class="co"># }))</span></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a><span class="fu">setHook</span>(<span class="fu">packageEvent</span>(<span class="st">"graphics"</span>, <span class="st">"onLoad"</span>), <span class="cf">function</span>(...) <span class="fu">par</span>(<span class="at">ask =</span> <span class="cn">FALSE</span>))</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a>  dataframe_original,</span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="fu">c</span>(</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1a"</span>,</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">"unique_individual_id"</span>,</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1b"</span>,</span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1c"</span>,</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1d"</span>,</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1f"</span>,</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1g"</span>,</span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1h"</span>,</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1i"</span></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"id"</span>, <span class="st">"regA"</span>, <span class="st">"regB"</span>, <span class="st">"sex"</span>, <span class="st">"binA"</span>, <span class="st">"binB"</span>, <span class="st">"binC"</span>, <span class="st">"np"</span>)</span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>dt1b <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dataframe_original)</span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>placement_dist <span class="ot">&lt;-</span> dt1b[,</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_placements =</span> <span class="fu">sum</span>(np),</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_status_rows =</span> .N</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a>summary_report <span class="ot">&lt;-</span> placement_dist[,</span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_unique_people =</span> .N,</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_placements_per_person =</span> <span class="fu">mean</span>(total_placements),</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_placements =</span> <span class="fu">median</span>(total_placements),</span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_placements =</span> <span class="fu">max</span>(total_placements),</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_status_changes =</span> <span class="fu">mean</span>(unique_status_rows),</span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_status_changes =</span> <span class="fu">max</span>(unique_status_rows)</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> year</span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(year)]</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of Placement Distribution by Year</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>  summary_report,</span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`summary_report`)'</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>summary_report</code>)</caption>
<colgroup>
<col style="width: 4%">
<col style="width: 16%">
<col style="width: 21%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">year</th>
<th style="text-align: right;">total_unique_people</th>
<th style="text-align: right;">avg_placements_per_person</th>
<th style="text-align: right;">median_placements</th>
<th style="text-align: right;">max_placements</th>
<th style="text-align: right;">avg_status_changes</th>
<th style="text-align: right;">max_status_changes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: right;">20781</td>
<td style="text-align: right;">21.25749</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">362</td>
<td style="text-align: right;">1.160820</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: right;">2024</td>
<td style="text-align: right;">19641</td>
<td style="text-align: right;">27.88183</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">366</td>
<td style="text-align: right;">1.170765</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2025</td>
<td style="text-align: right;">25045</td>
<td style="text-align: right;">37.69008</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">364</td>
<td style="text-align: right;">1.190497</td>
<td style="text-align: right;">8</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequency of Status Combinations per Person</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">table</span>(placement_dist<span class="sc">$</span>unique_status_rows))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Var1  Freq
1    1 56367
2    2  7300
3    3  1397
4    4   286
5    5    83
6    6    25
7    7     5
8    8     4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>placement_rows <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(placement_dist<span class="sc">$</span>unique_status_rows))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  placement_rows,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`placement_rows`)'</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>placement_rows</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Var1</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">56367</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">7300</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">1397</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">286</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>top_rows <span class="ot">&lt;-</span> placement_dist[<span class="fu">order</span>(<span class="sc">-</span>unique_status_rows)][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  top_rows,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`top_rows`)'</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>top_rows</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">total_placements</th>
<th style="text-align: right;">unique_status_rows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2024-09049-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-01080-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-10704-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-11914-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023-06822-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-15226-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024-03863-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-18531-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-20049-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-03600-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">6</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>row_counts_summary <span class="ot">&lt;-</span> placement_dist[,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">count_of_people =</span> .N),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> unique_status_rows</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(unique_status_rows)]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># how many people have 1, 2,...n rows ?:!</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  row_counts_summary,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`row_counts_summary`)'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>row_counts_summary</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">unique_status_rows</th>
<th style="text-align: right;">count_of_people</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">56367</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">7300</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1397</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">286</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(dt1b, <span class="st">"x1e"</span>, <span class="st">"age"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>bin_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"binA"</span>, <span class="st">"binB"</span>, <span class="st">"binC"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>dt1b[,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  (bin_cols) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>L, <span class="dv">0</span>L)),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> bin_cols</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>dt1b[age <span class="sc">==</span> <span class="st">"18 to 24"</span>, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">age_num =</span> <span class="dv">21</span>, <span class="at">age_order =</span> <span class="dv">1</span>L)]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>dt1b[age <span class="sc">==</span> <span class="st">"25 to 49"</span>, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">age_num =</span> <span class="dv">42</span>, <span class="at">age_order =</span> <span class="dv">2</span>L)]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>dt1b[age <span class="sc">==</span> <span class="st">"50+"</span>, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">age_num =</span> <span class="fl">57.5</span>, <span class="at">age_order =</span> <span class="dv">3</span>L)]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>dt1b[,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  age_factor <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    age,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"regA"</span>, <span class="st">"regB"</span>, <span class="st">"sex"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>dt1b[, (cat_cols) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, as.factor), .SDcols <span class="ot">=</span> cat_cols]</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>dt1b[, a1 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span>)] <span class="co"># 1,0,0</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>dt1b[, a2 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span>)] <span class="co"># 0,1,0</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>dt1b[, a3 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span>)] <span class="co"># 0,0,1</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>dt1b[, a4 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span>)] <span class="co"># 1,1,0</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>dt1b[, a5 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span>)] <span class="co"># 0,1,1</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>dt1b[, a6 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span>)] <span class="co"># 1,0,1</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>dt1b[, a7 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span>)] <span class="co"># 1,1,1</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>dt1b[, a8 <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span>)] <span class="co"># 0,0,0</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>dt_unbiased <span class="ot">&lt;-</span> dt1b[,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">a1 =</span> <span class="fu">sum</span>(a1 <span class="sc">*</span> np),</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">a2 =</span> <span class="fu">sum</span>(a2 <span class="sc">*</span> np),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">a3 =</span> <span class="fu">sum</span>(a3 <span class="sc">*</span> np),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">a4 =</span> <span class="fu">sum</span>(a4 <span class="sc">*</span> np),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">a5 =</span> <span class="fu">sum</span>(a5 <span class="sc">*</span> np),</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">a6 =</span> <span class="fu">sum</span>(a6 <span class="sc">*</span> np),</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">a7 =</span> <span class="fu">sum</span>(a7 <span class="sc">*</span> np),</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">a8 =</span> <span class="fu">sum</span>(a8 <span class="sc">*</span> np),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">sum</span>(binB <span class="sc">*</span> np) <span class="sc">/</span> <span class="fu">sum</span>(np),</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">D =</span> <span class="fu">sum</span>(binA <span class="sc">*</span> np) <span class="sc">/</span> <span class="fu">sum</span>(np),</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_np =</span> <span class="fu">sum</span>(np),</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_val =</span> <span class="fu">first</span>(age_num),</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">first</span>(sex),</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">regA =</span> <span class="fu">first</span>(regA)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>state_cols <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"a"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>dt_unbiased[, combo_count <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(.SD <span class="sc">&gt;</span> <span class="dv">0</span>), .SDcols <span class="ot">=</span> state_cols]</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>dt_8 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">8</span>]</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>dt_7 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">7</span>]</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>dt_6 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">6</span>]</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>dt_5 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">5</span>]</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>dt_4 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">4</span>]</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>dt_3 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">3</span>]</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>dt_2 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">2</span>]</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>dt_1 <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>dt_2plus <span class="ot">&lt;-</span> dt_unbiased[combo_count <span class="sc">&gt;=</span> <span class="dv">2</span>]</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>subset_summary <span class="ot">&lt;-</span> dt_unbiased[, .(<span class="at">n_persons =</span> .N), by <span class="ot">=</span> combo_count][<span class="fu">order</span>(</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>combo_count</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  subset_summary,</span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`subset_summary`)'</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>subset_summary</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: right;">combo_count</th>
<th style="text-align: right;">n_persons</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">163</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1092</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">5958</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">58207</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Number of rows with NA combo_count:"</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">is.na</span>(dt_unbiased<span class="sc">$</span>combo_count))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of rows with NA combo_count: 0"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>alert_stats <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_unbiased[, .(a1, a2, a3, a4, a5, a6, a7, a8)])</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  alert_stats,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`alert_stats`)'</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>alert_stats</code>)</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">a1</th>
<th style="text-align: left;">a2</th>
<th style="text-align: left;">a3</th>
<th style="text-align: left;">a4</th>
<th style="text-align: left;">a5</th>
<th style="text-align: left;">a6</th>
<th style="text-align: left;">a7</th>
<th style="text-align: left;">a8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Min. : 0.000</td>
<td style="text-align: left;">Min. : 0.000</td>
<td style="text-align: left;">Min. :0</td>
<td style="text-align: left;">Min. : 0.000</td>
<td style="text-align: left;">Min. : 0.0000</td>
<td style="text-align: left;">Min. :0</td>
<td style="text-align: left;">Min. : 0.0000</td>
<td style="text-align: left;">Min. : 0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">1st Qu.: 0.000</td>
<td style="text-align: left;">1st Qu.: 0.000</td>
<td style="text-align: left;">1st Qu.:0</td>
<td style="text-align: left;">1st Qu.: 0.000</td>
<td style="text-align: left;">1st Qu.: 0.0000</td>
<td style="text-align: left;">1st Qu.:0</td>
<td style="text-align: left;">1st Qu.: 0.0000</td>
<td style="text-align: left;">1st Qu.: 0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Median : 0.000</td>
<td style="text-align: left;">Median : 0.000</td>
<td style="text-align: left;">Median :0</td>
<td style="text-align: left;">Median : 0.000</td>
<td style="text-align: left;">Median : 0.0000</td>
<td style="text-align: left;">Median :0</td>
<td style="text-align: left;">Median : 0.0000</td>
<td style="text-align: left;">Median : 3.00</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Mean : 6.995</td>
<td style="text-align: left;">Mean : 1.294</td>
<td style="text-align: left;">Mean :0</td>
<td style="text-align: left;">Mean : 1.841</td>
<td style="text-align: left;">Mean : 0.3006</td>
<td style="text-align: left;">Mean :0</td>
<td style="text-align: left;">Mean : 0.3485</td>
<td style="text-align: left;">Mean : 18.75</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">3rd Qu.: 0.000</td>
<td style="text-align: left;">3rd Qu.: 0.000</td>
<td style="text-align: left;">3rd Qu.:0</td>
<td style="text-align: left;">3rd Qu.: 0.000</td>
<td style="text-align: left;">3rd Qu.: 0.0000</td>
<td style="text-align: left;">3rd Qu.:0</td>
<td style="text-align: left;">3rd Qu.: 0.0000</td>
<td style="text-align: left;">3rd Qu.: 14.00</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Max. :364.000</td>
<td style="text-align: left;">Max. :357.000</td>
<td style="text-align: left;">Max. :0</td>
<td style="text-align: left;">Max. :364.000</td>
<td style="text-align: left;">Max. :340.0000</td>
<td style="text-align: left;">Max. :0</td>
<td style="text-align: left;">Max. :293.0000</td>
<td style="text-align: left;">Max. :366.00</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dt_unbiased[,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  combo_count_robust <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(.SD <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> state_cols</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>alert_stats1a <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(dt_unbiased<span class="sc">$</span>combo_count_robust)) </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Then pass it to kable</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  alert_stats1a,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`alert_stats1a`)'</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>alert_stats1a</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Var1</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">58207</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">5958</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">1092</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">163</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: right;">12</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>top_ids <span class="ot">&lt;-</span> placement_dist[unique_status_rows <span class="sc">&gt;=</span> <span class="dv">7</span>, id]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>complex_moves <span class="ot">&lt;-</span> dt_unbiased[id <span class="sc">%in%</span> top_ids]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(complex_moves[, .(id, combo_count, total_np, a1, a2, a4, a5, a7, a8)])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              id combo_count total_np    a1    a2    a4    a5    a7    a8
          &lt;char&gt;       &lt;num&gt;    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
1: 2023-06822-RC           5       94     9    27     1    12     0    45
2: 2023-15226-RC           4       30    20     0     0     3     1     6
3: 2024-03863-RC           3       27    10     0     0     1     0    16
4: 2024-09049-RC           4       91    40     0     2     0     4    45
5: 2025-01080-RC           6       83    12    20     3     4    39     5
6: 2025-10704-RC           3      181     0     8     0     5     0   168
7: 2025-11914-RC           6      122    35     2     3    10    32    40
8: 2025-18531-RC           3      108     0     2     0     4     0   102
9: 2025-20049-RC           5       83    20     0    31     2     6    24</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  complex_moves[, .(id, combo_count, total_np, a1, a2, a4, a5, a7, a8)],</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`complex_moves`)'</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>complex_moves</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">combo_count</th>
<th style="text-align: right;">total_np</th>
<th style="text-align: right;">a1</th>
<th style="text-align: right;">a2</th>
<th style="text-align: right;">a4</th>
<th style="text-align: right;">a5</th>
<th style="text-align: right;">a7</th>
<th style="text-align: right;">a8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06822-RC</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-15226-RC</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024-03863-RC</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024-09049-RC</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-01080-RC</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10704-RC</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">168</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-11914-RC</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-18531-RC</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">102</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-20049-RC</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">24</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>region_profile <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  dt1b[id <span class="sc">%in%</span> top_ids],</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">~</span> regA,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>complex_subset <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  dt_unbiased[</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    id <span class="sc">%in%</span> top_ids,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  region_profile,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  complex_subset,</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`complex_subset`)'</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>complex_subset</code>)</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">combo_count</th>
<th style="text-align: right;">total_np</th>
<th style="text-align: right;">a1</th>
<th style="text-align: right;">a2</th>
<th style="text-align: right;">a4</th>
<th style="text-align: right;">a5</th>
<th style="text-align: right;">a7</th>
<th style="text-align: right;">a8</th>
<th style="text-align: right;">Central</th>
<th style="text-align: right;">Eastern</th>
<th style="text-align: right;">Toronto</th>
<th style="text-align: right;">Western</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06822-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-15226-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024-03863-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024-09049-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-01080-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10704-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-11914-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-18531-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-20049-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dt_complex_raw <span class="ot">&lt;-</span> dt1b[id <span class="sc">%in%</span> top_ids]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>regA_counts <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  dt_complex_raw,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">~</span> regA,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  regA_counts,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(regA_counts), <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>)),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="fu">paste0</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(regA_counts), <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>)), <span class="st">"_A"</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>regB_counts <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  dt_complex_raw,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">~</span> regB,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  regB_counts,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(regB_counts), <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>)),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="fu">paste0</span>(<span class="fu">setdiff</span>(<span class="fu">names</span>(regB_counts), <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>)), <span class="st">"_B"</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>complex_subset <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  dt_unbiased[</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    id <span class="sc">%in%</span> top_ids,</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>  regA_counts,</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>complex_subset <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  complex_subset,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  regB_counts,</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>),</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>complex_subset[<span class="fu">is.na</span>(complex_subset)] <span class="ot">&lt;-</span> <span class="fu">as.double</span>(<span class="dv">0</span>)</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  complex_subset,</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`complex_subset`)'</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>complex_subset</code>)</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 3%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">combo_count</th>
<th style="text-align: right;">total_np</th>
<th style="text-align: right;">a1</th>
<th style="text-align: right;">a2</th>
<th style="text-align: right;">a4</th>
<th style="text-align: right;">a5</th>
<th style="text-align: right;">a7</th>
<th style="text-align: right;">a8</th>
<th style="text-align: right;">Central_A</th>
<th style="text-align: right;">Eastern_A</th>
<th style="text-align: right;">Toronto_A</th>
<th style="text-align: right;">Western_A</th>
<th style="text-align: right;">Eastern_B</th>
<th style="text-align: right;">Toronto_B</th>
<th style="text-align: right;">Western_B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06822-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-15226-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024-03863-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024-09049-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-01080-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10704-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">181</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-11914-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-18531-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-20049-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>all_regions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Toronto"</span>, <span class="st">"Central"</span>, <span class="st">"Eastern"</span>, <span class="st">"Western"</span>, <span class="st">"Northern"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dt_complex_raw <span class="ot">&lt;-</span> dt1b[id <span class="sc">%in%</span> top_ids]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>dt_complex_raw[, regA <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(regA, <span class="at">levels =</span> all_regions)]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>dt_complex_raw[, regB <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(regB, <span class="at">levels =</span> all_regions)]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>regA_counts <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  dt_complex_raw,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">~</span> regA,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">drop =</span> <span class="cn">FALSE</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(regA_counts, <span class="at">old =</span> all_regions, <span class="at">new =</span> <span class="fu">paste0</span>(all_regions, <span class="st">"_A"</span>))</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>regB_counts <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  dt_complex_raw,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">~</span> regB,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">drop =</span> <span class="cn">FALSE</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(regB_counts, <span class="at">old =</span> all_regions, <span class="at">new =</span> <span class="fu">paste0</span>(all_regions, <span class="st">"_B"</span>))</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>complex_subset <span class="ot">&lt;-</span> dt_unbiased[</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">%in%</span> top_ids,</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>complex_subset <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  complex_subset,</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  regA_counts,</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>),</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>complex_subset <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  complex_subset,</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>  regB_counts,</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>),</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>cols_to_fix <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(all_regions, <span class="st">"_A"</span>), <span class="fu">paste0</span>(all_regions, <span class="st">"_B"</span>))</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>complex_subset[,</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>  (cols_to_fix) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.na</span>(x), <span class="dv">0</span>, x)),</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> cols_to_fix</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Complex Cases (10 Regional Columns + Possible Alert Status Combinations)</span></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>  complex_subset,</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`complex_subset`)'</span></span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>complex_subset</code>)</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">combo_count</th>
<th style="text-align: right;">total_np</th>
<th style="text-align: right;">a1</th>
<th style="text-align: right;">a2</th>
<th style="text-align: right;">a4</th>
<th style="text-align: right;">a5</th>
<th style="text-align: right;">a7</th>
<th style="text-align: right;">a8</th>
<th style="text-align: right;">Toronto_A</th>
<th style="text-align: right;">Central_A</th>
<th style="text-align: right;">Eastern_A</th>
<th style="text-align: right;">Western_A</th>
<th style="text-align: right;">Northern_A</th>
<th style="text-align: right;">Toronto_B</th>
<th style="text-align: right;">Central_B</th>
<th style="text-align: right;">Eastern_B</th>
<th style="text-align: right;">Western_B</th>
<th style="text-align: right;">Northern_B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023-06822-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">49</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023-15226-RC</td>
<td style="text-align: right;">2023</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024-03863-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024-09049-RC</td>
<td style="text-align: right;">2024</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">91</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-01080-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-10704-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">181</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-11914-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025-18531-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">102</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025-20049-RC</td>
<td style="text-align: right;">2025</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dt_moves_corrected <span class="ot">&lt;-</span> dt1b[</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">order</span>(id, year),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    id,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">internal_move =</span> <span class="fu">as.integer</span>(regA <span class="sc">!=</span> regB),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">external_move =</span> <span class="fu">as.integer</span>(regA <span class="sc">!=</span> <span class="fu">shift</span>(regA, <span class="at">type =</span> <span class="st">"lag"</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>regional_volatility <span class="ot">&lt;-</span> dt_moves_corrected[,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_regional_changes =</span> <span class="fu">sum</span>(</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>      internal_move <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> (external_move <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(external_move))</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>dt_unbiased <span class="ot">&lt;-</span> <span class="fu">merge</span>(</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  dt_unbiased,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  regional_volatility,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">all.x =</span> <span class="cn">TRUE</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>move_summary <span class="ot">&lt;-</span> dt_unbiased[,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">n_persons =</span> .N),</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> total_regional_changes</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>][<span class="fu">order</span>(total_regional_changes)]</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(move_summary)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   total_regional_changes n_persons
                    &lt;int&gt;     &lt;int&gt;
1:                      0     62901
2:                      1       362
3:                      2      1800
4:                      3       315
5:                      4        64
6:                      5        18
7:                      6         2
8:                      7         4
9:                      8         1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>region_counts_per_id <span class="ot">&lt;-</span> dt1b[,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_regions =</span> <span class="fu">list</span>(<span class="fu">unique</span>(<span class="fu">c</span>(regA, regB)))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>region_counts_per_id[, n_regions <span class="sc">:</span><span class="er">=</span> <span class="fu">sapply</span>(unique_regions, length)]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>multi_region_ids <span class="ot">&lt;-</span> region_counts_per_id[n_regions <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>total_multi_region_persons <span class="ot">&lt;-</span> <span class="fu">nrow</span>(multi_region_ids)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>total_unique_persons <span class="ot">&lt;-</span> <span class="fu">nrow</span>(region_counts_per_id)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Total Unique Person-IDs in dataset:"</span>, total_unique_persons))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Total Unique Person-IDs in dataset: 65467"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of Person-IDs with &gt;1 region:"</span>, total_multi_region_persons))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of Person-IDs with &gt;1 region: 2566"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Percentage of population moving regions:"</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>((total_multi_region_persons <span class="sc">/</span> total_unique_persons) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"%"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Percentage of population moving regions: 3.92 %"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>reg_count_id <span class="ot">&lt;-</span> <span class="fu">table</span>(region_counts_per_id<span class="sc">$</span>n_regions)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  reg_count_id,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">'(`reg_count_id`)'</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>(<code>reg_count_id</code>)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Var1</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">62901</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">2425</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">137</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dt1b[,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  status_combo <span class="sc">:</span><span class="er">=</span> <span class="fu">case_when</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a1"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a2"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a3"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a4"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a5"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a6"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a7"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a8"</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>dt1b[, reg_status_key <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(regA, <span class="st">"_"</span>, status_combo)]</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>dt_40state <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  dt1b,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">+</span> sex <span class="sc">+</span> age_num <span class="sc">+</span> age_order <span class="sc">~</span> reg_status_key,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="dv">0</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of columns in the new state-space:"</span>, <span class="fu">ncol</span>(dt_40state)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of columns in the new state-space: 35"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt_40state)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;id, year, sex, age_num, age_order&gt;
              id  year    sex age_num age_order Central_a1 Central_a2
          &lt;char&gt; &lt;num&gt; &lt;fctr&gt;   &lt;num&gt;     &lt;int&gt;      &lt;num&gt;      &lt;num&gt;
1: 2023-00001-RC  2023   Male    42.0         2          0          0
2: 2023-00002-RC  2023   Male    57.5         3          0          0
3: 2023-00003-RC  2023   Male    42.0         2          0          0
4: 2023-00004-RC  2023   Male    42.0         2          0          0
5: 2023-00005-RC  2023   Male    57.5         3          0          0
6: 2023-00006-RC  2023   Male    57.5         3          0          0
   Central_a4 Central_a5 Central_a7 Central_a8 Eastern_a1 Eastern_a2 Eastern_a4
        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:          0          0          0          0          0          0          0
2:          0          0          0          0          0          0          0
3:          0          0          0          0          0          0          9
4:          0          0          0          0          0          0          0
5:          0          0          0          0          0          0          0
6:          0          0          0          0          0          0          0
   Eastern_a5 Eastern_a7 Eastern_a8 Northern_a1 Northern_a2 Northern_a4
        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
1:          0          0          0           0           0           0
2:          0          0          0           0           0           0
3:          0          0          0           0           0           0
4:          0          0          0           0           0           0
5:          0          0          8           0           0           0
6:          0          0          8           0           0           0
   Northern_a5 Northern_a7 Northern_a8 Toronto_a1 Toronto_a2 Toronto_a4
         &lt;num&gt;       &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:           0           0           0          0          8          0
2:           0           0          20          0          0          0
3:           0           0           0          0          0          0
4:           0           0           0          0          0          0
5:           0           0           0          0          0          0
6:           0           0           0          0          0          0
   Toronto_a5 Toronto_a7 Toronto_a8 Western_a1 Western_a2 Western_a4 Western_a5
        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:          0          0         26          0          0          0          0
2:          0          0          0          0          0          0          0
3:          0          0          0          0          0          0          0
4:          0          0          0          0         11          0          0
5:          0          0          0          0          0          0          0
6:          0          0          0          0          0          0          0
   Western_a7 Western_a8
        &lt;num&gt;      &lt;num&gt;
1:          0          0
2:          0          0
3:          0          0
4:          0          0
5:          0          0
6:          0          0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>state_totals <span class="ot">&lt;-</span> <span class="fu">colSums</span>(dt_40state[, .SD, <span class="at">.SDcols =</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>state_summary <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">names</span>(state_totals),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">total_placements =</span> state_totals</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>)[<span class="fu">order</span>(<span class="sc">-</span>total_placements)]</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Top Ten Empirical Region-Status combinations:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Top Ten Empirical Region-Status combinations:"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(state_summary, <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          state total_placements
         &lt;char&gt;            &lt;num&gt;
 1:  Central_a8           440242
 2:  Eastern_a8           421376
 3:  Toronto_a8           197025
 4:  Eastern_a1           196748
 5:  Central_a1           105275
 6:  Western_a8            94102
 7:  Toronto_a1            93729
 8: Northern_a8            74921
 9:  Eastern_a4            55094
10:  Western_a1            36830</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>id_counts <span class="ot">&lt;-</span> dt_40state[,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">sum</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>id_counts_t <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">names</span>(id_counts),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">count_of_people =</span> <span class="fu">as.numeric</span>(id_counts)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>)[<span class="fu">order</span>(<span class="sc">-</span>count_of_people)]</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Number of unique individuals who entered each state:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of unique individuals who entered each state:"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(id_counts_t)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          state count_of_people
         &lt;char&gt;           &lt;num&gt;
 1:  Central_a8           15267
 2:  Eastern_a8           12161
 3:  Toronto_a8            8670
 4:  Western_a8            7473
 5: Northern_a8            5344
 6:  Eastern_a1            4449
 7:  Central_a1            3818
 8:  Toronto_a1            2453
 9:  Western_a1            2335
10:  Eastern_a4            1283
11: Northern_a1            1259
12:  Eastern_a2            1177
13: Northern_a2            1035
14:  Central_a5            1023
15:  Central_a4             921
16:  Western_a4             919
17:  Central_a7             870
18: Northern_a4             788
19:  Central_a2             744
20:  Eastern_a5             695
21:  Western_a2             655
22:  Eastern_a7             584
23:  Toronto_a2             498
24:  Toronto_a4             466
25:  Western_a5             438
26:  Western_a7             410
27: Northern_a5             363
28: Northern_a7             321
29:  Toronto_a5             294
30:  Toronto_a7             221
          state count_of_people
         &lt;char&gt;           &lt;num&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dt_40state[, states_visited <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(.SD <span class="sc">&gt;</span> <span class="dv">0</span>), .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>complexity_dist <span class="ot">&lt;-</span> dt_40state[, .(<span class="at">n_people =</span> .N), by <span class="ot">=</span> states_visited][<span class="fu">order</span>(</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  states_visited</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"How many unique Region-Status states did people visit?"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "How many unique Region-Status states did people visit?"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(complexity_dist)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   states_visited n_people
            &lt;num&gt;    &lt;int&gt;
1:              1    56367
2:              2     7300
3:              3     1397
4:              4      286
5:              5       83
6:              6       25
7:              7        5
8:              8        4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dt1b[,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  status_combo <span class="sc">:</span><span class="er">=</span> <span class="fu">case_when</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a1"</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a2"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a3"</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a4"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a5"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a6"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"a7"</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    binA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> binC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"a8"</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>dt1b[, reg_status_key <span class="sc">:</span><span class="er">=</span> <span class="fu">paste0</span>(regA, <span class="st">"_"</span>, status_combo)]</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>dt_40state_yearly <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  dt1b,</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">+</span> sex <span class="sc">+</span> age_num <span class="sc">~</span> reg_status_key,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="dv">0</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>yearly_stats <span class="ot">&lt;-</span> dt_40state_yearly[,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_ids =</span> <span class="fu">uniqueN</span>(id),</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_placements =</span> <span class="fu">sum</span>(.SD, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> year,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(yearly_stats)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year unique_ids total_placements
   &lt;num&gt;      &lt;int&gt;            &lt;num&gt;
1:  2023      20781           441752
2:  2024      19641           547627
3:  2025      25045           943948</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>split_summary <span class="ot">&lt;-</span> dt_40state_yearly[,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(.SD, sum),</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> year,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"First few rows of 2023 data:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "First few rows of 2023 data:"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt_40state_yearly[year <span class="sc">==</span> <span class="dv">2023</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;id, year, sex, age_num&gt;
              id  year    sex age_num Central_a1 Central_a2 Central_a4
          &lt;char&gt; &lt;num&gt; &lt;fctr&gt;   &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1: 2023-00001-RC  2023   Male    42.0          0          0          0
2: 2023-00002-RC  2023   Male    57.5          0          0          0
3: 2023-00003-RC  2023   Male    42.0          0          0          0
4: 2023-00004-RC  2023   Male    42.0          0          0          0
5: 2023-00005-RC  2023   Male    57.5          0          0          0
6: 2023-00006-RC  2023   Male    57.5          0          0          0
   Central_a5 Central_a7 Central_a8 Eastern_a1 Eastern_a2 Eastern_a4 Eastern_a5
        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:          0          0          0          0          0          0          0
2:          0          0          0          0          0          0          0
3:          0          0          0          0          0          9          0
4:          0          0          0          0          0          0          0
5:          0          0          0          0          0          0          0
6:          0          0          0          0          0          0          0
   Eastern_a7 Eastern_a8 Northern_a1 Northern_a2 Northern_a4 Northern_a5
        &lt;num&gt;      &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;       &lt;num&gt;
1:          0          0           0           0           0           0
2:          0          0           0           0           0           0
3:          0          0           0           0           0           0
4:          0          0           0           0           0           0
5:          0          8           0           0           0           0
6:          0          8           0           0           0           0
   Northern_a7 Northern_a8 Toronto_a1 Toronto_a2 Toronto_a4 Toronto_a5
         &lt;num&gt;       &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:           0           0          0          8          0          0
2:           0          20          0          0          0          0
3:           0           0          0          0          0          0
4:           0           0          0          0          0          0
5:           0           0          0          0          0          0
6:           0           0          0          0          0          0
   Toronto_a7 Toronto_a8 Western_a1 Western_a2 Western_a4 Western_a5 Western_a7
        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt;
1:          0         26          0          0          0          0          0
2:          0          0          0          0          0          0          0
3:          0          0          0          0          0          0          0
4:          0          0          0         11          0          0          0
5:          0          0          0          0          0          0          0
6:          0          0          0          0          0          0          0
   Western_a8
        &lt;num&gt;
1:          0
2:          0
3:          0
4:          0
5:          0
6:          0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dt_40state_yearly[,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  combinations_this_year <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(.SD <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_40state_yearly<span class="sc">$</span>year, dt_40state_yearly<span class="sc">$</span>combinations_this_year)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      
           1     2     3     4     5     6     7     8
  2023 18098  2175   394    85    23     4     2     0
  2024 16992  2120   404    88    26     9     1     1
  2025 21277  3005   599   113    34    12     2     3</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>id_counts_yearly <span class="ot">&lt;-</span> dt_40state_yearly[,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(.SD, <span class="cf">function</span>(x) <span class="fu">sum</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> year,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> <span class="fu">patterns</span>(<span class="st">"_a[1-8]"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>id_counts_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  id_counts_yearly,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">id.vars =</span> <span class="st">"year"</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">variable.name =</span> <span class="st">"state"</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.name =</span> <span class="st">"person_count"</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>id_counts_long <span class="ot">&lt;-</span> id_counts_long[<span class="fu">order</span>(year, <span class="sc">-</span>person_count)]</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Top 5 most frequent Region-Status states per year:"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Top 5 most frequent Region-Status states per year:"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(id_counts_long[, <span class="fu">head</span>(.SD, <span class="dv">5</span>), <span class="at">by =</span> year])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     year       state person_count
    &lt;num&gt;      &lt;fctr&gt;        &lt;int&gt;
 1:  2023  Central_a8         5473
 2:  2023  Eastern_a8         3336
 3:  2023  Western_a8         2464
 4:  2023  Toronto_a8         2265
 5:  2023 Northern_a8         2250
 6:  2024  Eastern_a8         4609
 7:  2024  Central_a8         3791
 8:  2024  Western_a8         2361
 9:  2024  Toronto_a8         1904
10:  2024 Northern_a8         1627
11:  2025  Central_a8         6003
12:  2025  Toronto_a8         4501
13:  2025  Eastern_a8         4216
14:  2025  Western_a8         2648
15:  2025  Central_a1         1490</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>empty_states <span class="ot">&lt;-</span> id_counts_long[,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  .(<span class="at">total_across_years =</span> <span class="fu">sum</span>(person_count)),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> state</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>][total_across_years <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"States with zero occupancy (these won't help the DoubleML):"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "States with zero occupancy (these won't help the DoubleML):"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(empty_states<span class="sc">$</span>state)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>factor()
30 Levels: Central_a1 Central_a2 Central_a4 Central_a5 ... Western_a8</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>reg_summary <span class="ot">&lt;-</span> dt1b[,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_count =</span> <span class="fu">uniqueN</span>(<span class="fu">c</span>(regA, regB)),</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">regC =</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(regA, regB))), <span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>status_summary <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  dt1b,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  id <span class="sc">+</span> year <span class="sc">~</span> status_combo,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"np"</span>,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.aggregate =</span> sum,</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="dv">0</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>dt_final_complex <span class="ot">&lt;-</span> <span class="fu">merge</span>(status_summary, reg_summary, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>))</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>demo_info <span class="ot">&lt;-</span> dt1b[,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> <span class="fu">first</span>(sex),</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_num =</span> <span class="fu">first</span>(age_num)</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(id, year)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>dt_final_complex <span class="ot">&lt;-</span> <span class="fu">merge</span>(dt_final_complex, demo_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"year"</span>))</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(dt_final_complex))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;id, year&gt;
              id  year    a1    a2    a4    a5    a7    a8 reg_count     regC
          &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;int&gt;   &lt;char&gt;
1: 2023-00001-RC  2023     0     8     0     0     0    26         1  Toronto
2: 2023-00002-RC  2023     0     0     0     0     0    20         1 Northern
3: 2023-00003-RC  2023     0     0     9     0     0     0         1  Eastern
4: 2023-00004-RC  2023     0    11     0     0     0     0         1  Western
5: 2023-00005-RC  2023     0     0     0     0     0     8         1  Eastern
6: 2023-00006-RC  2023     0     0     0     0     0     8         1  Eastern
      sex age_num
   &lt;fctr&gt;   &lt;num&gt;
1:   Male    42.0
2:   Male    57.5
3:   Male    42.0
4:   Male    42.0
5:   Male    57.5
6:   Male    57.5</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>regC_stats <span class="ot">&lt;-</span> dt_final_complex[, .(<span class="at">n_persons =</span> .N), by <span class="ot">=</span> regC][<span class="fu">order</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span>n_persons</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(regC_stats)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      regC n_persons
                                    &lt;char&gt;     &lt;int&gt;
 1:                                Central     18403
 2:                                Eastern     16765
 3:                                Western     10374
 4:                                Toronto      9829
 5:                               Northern      7530
 6:                      Central + Toronto       662
 7:                      Central + Western       443
 8:                      Eastern + Toronto       398
 9:                      Central + Eastern       381
10:                     Northern + Toronto       124
11:                      Eastern + Western       116
12:                      Toronto + Western        95
13:                     Northern + Western        84
14:                     Central + Northern        66
15:                     Eastern + Northern        56
16:            Central + Eastern + Toronto        54
17:            Central + Toronto + Western        21
18:            Central + Eastern + Western        19
19:            Eastern + Toronto + Western        13
20:           Central + Northern + Western        11
21:           Central + Northern + Toronto         8
22:           Eastern + Northern + Toronto         5
23:           Northern + Toronto + Western         4
24:  Central + Eastern + Toronto + Western         3
25:           Eastern + Northern + Western         2
26: Eastern + Northern + Toronto + Western         1
                                      regC n_persons
                                    &lt;char&gt;     &lt;int&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>regC_yearly_counts <span class="ot">&lt;-</span> dt_final_complex[, .(<span class="at">n =</span> .N), by <span class="ot">=</span> .(regC, year)]</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>regC_stats_wide <span class="ot">&lt;-</span> <span class="fu">dcast</span>(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  regC_yearly_counts,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  regC <span class="sc">~</span> year,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.var =</span> <span class="st">"n"</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="dv">0</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>year_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(regC_stats_wide), <span class="st">"regC"</span>)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>new_t_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"t"</span>, <span class="fu">seq_along</span>(year_cols))</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(regC_stats_wide, <span class="at">old =</span> year_cols, <span class="at">new =</span> new_t_names)</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>regC_stats_wide[, n_persons <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(.SD), .SDcols <span class="ot">=</span> new_t_names]</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(regC_stats_wide, <span class="fu">c</span>(<span class="st">"regC"</span>, <span class="st">"n_persons"</span>, new_t_names))</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>regC_stats_wide <span class="ot">&lt;-</span> regC_stats_wide[<span class="fu">order</span>(<span class="sc">-</span>n_persons)]</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(regC_stats_wide)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      regC n_persons    t1    t2    t3
                                    &lt;char&gt;     &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1:                                Central     18403  6391  4839  7173
 2:                                Eastern     16765  4869  6215  5681
 3:                                Western     10374  3316  3363  3695
 4:                                Toronto      9829  2687  2237  4905
 5:                               Northern      7530  2949  2324  2257
 6:                      Central + Toronto       662   178   144   340
 7:                      Central + Western       443   107    75   261
 8:                      Eastern + Toronto       398    91   133   174
 9:                      Central + Eastern       381    66   123   192
10:                     Northern + Toronto       124    17    19    88
11:                      Eastern + Western       116    19    48    49
12:                      Toronto + Western        95    14    16    65
13:                     Northern + Western        84     9    32    43
14:                     Central + Northern        66    27    17    22
15:                     Eastern + Northern        56    23    19    14
16:            Central + Eastern + Toronto        54     5    14    35
17:            Central + Toronto + Western        21     3     3    15
18:            Central + Eastern + Western        19     4     8     7
19:            Eastern + Toronto + Western        13     0     4     9
20:           Central + Northern + Western        11     2     2     7
21:           Central + Northern + Toronto         8     1     1     6
22:           Eastern + Northern + Toronto         5     2     2     1
23:           Northern + Toronto + Western         4     1     0     3
24:  Central + Eastern + Toronto + Western         3     0     2     1
25:           Eastern + Northern + Western         2     0     1     1
26: Eastern + Northern + Toronto + Western         1     0     0     1
                                      regC n_persons    t1    t2    t3
                                    &lt;char&gt;     &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>demog_counts <span class="ot">&lt;-</span> dt_final_complex[, .(<span class="at">n =</span> .N), by <span class="ot">=</span> .(regC, year, sex)]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>demog_wide <span class="ot">&lt;-</span> <span class="fu">dcast</span>(demog_counts, regC <span class="sc">~</span> year <span class="sc">+</span> sex, <span class="at">value.var =</span> <span class="st">"n"</span>, <span class="at">fill =</span> <span class="dv">0</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>unique_years <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(demog_counts<span class="sc">$</span>year))</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(unique_years)) {</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  year_val <span class="ot">&lt;-</span> unique_years[i]</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  suffix <span class="ot">&lt;-</span> letters[i]</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setnames</span>(</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>    demog_wide,</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">old =</span> <span class="fu">paste0</span>(year_val, <span class="st">"_Male"</span>),</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">new =</span> <span class="fu">paste0</span>(<span class="st">"g1"</span>, suffix),</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip_absent =</span> <span class="cn">TRUE</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setnames</span>(</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>    demog_wide,</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">old =</span> <span class="fu">paste0</span>(year_val, <span class="st">"_Female"</span>),</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">new =</span> <span class="fu">paste0</span>(<span class="st">"g2"</span>, suffix),</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip_absent =</span> <span class="cn">TRUE</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>demog_wide[, t1 <span class="sc">:</span><span class="er">=</span> g1a <span class="sc">+</span> g2a]</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>demog_wide[, t2 <span class="sc">:</span><span class="er">=</span> g1b <span class="sc">+</span> g2b]</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>demog_wide[, t3 <span class="sc">:</span><span class="er">=</span> g1c <span class="sc">+</span> g2c]</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>demog_wide[, n_persons <span class="sc">:</span><span class="er">=</span> t1 <span class="sc">+</span> t2 <span class="sc">+</span> t3]</span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(</span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>  demog_wide,</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"regC"</span>,</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"n_persons"</span>,</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"t1"</span>,</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"t2"</span>,</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"t3"</span>,</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g1a"</span>,</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g1b"</span>,</span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g1c"</span>,</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g2a"</span>,</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g2b"</span>,</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"g2c"</span></span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>regC_demog_stats <span class="ot">&lt;-</span> demog_wide[<span class="fu">order</span>(<span class="sc">-</span>n_persons)]</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(regC_demog_stats)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      regC n_persons    t1    t2    t3   g1a
                                    &lt;char&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1:                                Central     18403  6391  4839  7173  6390
 2:                                Eastern     16765  4869  6215  5681  4193
 3:                                Western     10374  3316  3363  3695  2927
 4:                                Toronto      9829  2687  2237  4905  2673
 5:                               Northern      7530  2949  2324  2257  2526
 6:                      Central + Toronto       662   178   144   340   178
 7:                      Central + Western       443   107    75   261   107
 8:                      Eastern + Toronto       398    91   133   174    91
 9:                      Central + Eastern       381    66   123   192    65
10:                     Northern + Toronto       124    17    19    88    17
11:                      Eastern + Western       116    19    48    49    16
12:                      Toronto + Western        95    14    16    65    14
13:                     Northern + Western        84     9    32    43     8
14:                     Central + Northern        66    27    17    22    27
15:                     Eastern + Northern        56    23    19    14    20
16:            Central + Eastern + Toronto        54     5    14    35     5
17:            Central + Toronto + Western        21     3     3    15     3
18:            Central + Eastern + Western        19     4     8     7     4
19:            Eastern + Toronto + Western        13     0     4     9     0
20:           Central + Northern + Western        11     2     2     7     2
21:           Central + Northern + Toronto         8     1     1     6     1
22:           Eastern + Northern + Toronto         5     2     2     1     2
23:           Northern + Toronto + Western         4     1     0     3     1
24:  Central + Eastern + Toronto + Western         3     0     2     1     0
25:           Eastern + Northern + Western         2     0     1     1     0
26: Eastern + Northern + Toronto + Western         1     0     0     1     0
                                      regC n_persons    t1    t2    t3   g1a
                                    &lt;char&gt;     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
      g1b   g1c   g2a   g2b   g2c
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1:  4836  6681     1     3   492
 2:  5275  4542   676   940  1139
 3:  2843  3137   389   520   558
 4:  2222  4896    14    15     9
 5:  1896  1724   423   428   533
 6:   142   331     0     2     9
 7:    73   248     0     2    13
 8:   133   173     0     0     1
 9:   121   153     1     2    39
10:    19    87     0     0     1
11:    42    42     3     6     7
12:    16    65     0     0     0
13:    26    37     1     6     6
14:    17    19     0     0     3
15:    19    10     3     0     4
16:    14    34     0     0     1
17:     3    15     0     0     0
18:     8     5     0     0     2
19:     4     9     0     0     0
20:     2     4     0     0     3
21:     1     6     0     0     0
22:     2     1     0     0     0
23:     0     3     0     0     0
24:     2     1     0     0     0
25:     1     0     0     0     1
26:     0     1     0     0     0
      g1b   g1c   g2a   g2b   g2c
    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res_pool, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">caption =</span> <span class="st">"Pooled IRM DoubleML (20232025)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Pooled IRM DoubleML (20232025)</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">t_value</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">ci_low</th>
<th style="text-align: right;">ci_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pooled 2023-25</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1605</td>
<td style="text-align: right;">0.0063</td>
<td style="text-align: right;">25.5418</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1481</td>
<td style="text-align: right;">0.1728</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pooled 2023-25</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1557</td>
<td style="text-align: right;">0.0061</td>
<td style="text-align: right;">25.6923</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1438</td>
<td style="text-align: right;">0.1676</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  res_by_year,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Yearly IRM DoubleML (2023/2024/2025)"</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Yearly IRM DoubleML (2023/2024/2025)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">t_value</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">ci_low</th>
<th style="text-align: right;">ci_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1342</td>
<td style="text-align: right;">0.0099</td>
<td style="text-align: right;">13.6093</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1149</td>
<td style="text-align: right;">0.1535</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1272</td>
<td style="text-align: right;">0.0103</td>
<td style="text-align: right;">12.3080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1070</td>
<td style="text-align: right;">0.1475</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1591</td>
<td style="text-align: right;">0.0117</td>
<td style="text-align: right;">13.6359</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1362</td>
<td style="text-align: right;">0.1820</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1550</td>
<td style="text-align: right;">0.0114</td>
<td style="text-align: right;">13.5809</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1326</td>
<td style="text-align: right;">0.1774</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1737</td>
<td style="text-align: right;">0.0103</td>
<td style="text-align: right;">16.8639</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1535</td>
<td style="text-align: right;">0.1939</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1704</td>
<td style="text-align: right;">0.0097</td>
<td style="text-align: right;">17.6296</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1514</td>
<td style="text-align: right;">0.1893</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  res_pool,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Pooled IRM DoubleML (20232025)"</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Pooled IRM DoubleML (20232025)</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">t_value</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">ci_low</th>
<th style="text-align: right;">ci_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pooled 2023-25</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1605</td>
<td style="text-align: right;">0.0063</td>
<td style="text-align: right;">25.5418</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1481</td>
<td style="text-align: right;">0.1728</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pooled 2023-25</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1557</td>
<td style="text-align: right;">0.0061</td>
<td style="text-align: right;">25.6923</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1438</td>
<td style="text-align: right;">0.1676</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  res_by_year,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">longtable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"IRM DoubleML (2023/2024/2025)"</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>IRM DoubleML (2023/2024/2025)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">t_value</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">ci_low</th>
<th style="text-align: right;">ci_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1342</td>
<td style="text-align: right;">0.0099</td>
<td style="text-align: right;">13.6093</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1149</td>
<td style="text-align: right;">0.1535</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1272</td>
<td style="text-align: right;">0.0103</td>
<td style="text-align: right;">12.3080</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1070</td>
<td style="text-align: right;">0.1475</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1591</td>
<td style="text-align: right;">0.0117</td>
<td style="text-align: right;">13.6359</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1362</td>
<td style="text-align: right;">0.1820</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1550</td>
<td style="text-align: right;">0.0114</td>
<td style="text-align: right;">13.5809</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1326</td>
<td style="text-align: right;">0.1774</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1737</td>
<td style="text-align: right;">0.0103</td>
<td style="text-align: right;">16.8639</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1535</td>
<td style="text-align: right;">0.1939</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1704</td>
<td style="text-align: right;">0.0097</td>
<td style="text-align: right;">17.6296</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1514</td>
<td style="text-align: right;">0.1893</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dt1c <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(dataframe_original1b)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  dt1c,</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">old =</span> <span class="fu">c</span>(</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1a"</span>,</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"unique_individual_id"</span>,</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1b"</span>,</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1c"</span>,</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1d"</span>,</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1e"</span>,</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1f"</span>,</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1g"</span>,</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1h"</span>,</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"x1i"</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">new =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"id"</span>, <span class="st">"regA"</span>, <span class="st">"regB"</span>, <span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"bA"</span>, <span class="st">"bB"</span>, <span class="st">"bC"</span>, <span class="st">"np"</span>),</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip_absent =</span> <span class="cn">TRUE</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>dt1c[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">bA =</span> <span class="fu">as.integer</span>(bA <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">bB =</span> <span class="fu">as.integer</span>(bB <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">bC =</span> <span class="fu">as.integer</span>(bC <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_n =</span> <span class="fu">fcase</span>(</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"18 to 24"</span> , <span class="dv">21</span>   ,</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"25 to 49"</span> , <span class="dv">42</span>   ,</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"50+"</span>      , <span class="fl">57.5</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>dt1c[,</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  combo <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bC <span class="sc">==</span> <span class="dv">0</span> , <span class="st">"a1"</span> ,</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bC <span class="sc">==</span> <span class="dv">0</span> , <span class="st">"a2"</span> ,</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bC <span class="sc">==</span> <span class="dv">0</span> , <span class="st">"a4"</span> ,</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bC <span class="sc">==</span> <span class="dv">1</span> , <span class="st">"a5"</span> ,</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bB <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bC <span class="sc">==</span> <span class="dv">1</span> , <span class="st">"a7"</span> ,</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>    bA <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bB <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bC <span class="sc">==</span> <span class="dv">0</span> , <span class="st">"a8"</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="co"># person-year: alert-state intensity via 2^3 = 8 possible outcomes (a1-a8) where two (a3 and a6) were not observed empirically</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>orc <span class="ot">&lt;-</span> dt1c[,</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">a1 =</span> <span class="fu">sum</span>((combo <span class="sc">==</span> <span class="st">"a1"</span>) <span class="sc">*</span> np, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">a2 =</span> <span class="fu">sum</span>((combo <span class="sc">==</span> <span class="st">"a2"</span>) <span class="sc">*</span> np, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">a4 =</span> <span class="fu">sum</span>((combo <span class="sc">==</span> <span class="st">"a4"</span>) <span class="sc">*</span> np, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">a5 =</span> <span class="fu">sum</span>((combo <span class="sc">==</span> <span class="st">"a5"</span>) <span class="sc">*</span> np, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">a7 =</span> <span class="fu">sum</span>((combo <span class="sc">==</span> <span class="st">"a7"</span>) <span class="sc">*</span> np, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">a8 =</span> <span class="fu">sum</span>((combo <span class="sc">==</span> <span class="st">"a8"</span>) <span class="sc">*</span> np, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">np =</span> <span class="fu">sum</span>(np),</span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">rg =</span> <span class="fu">uniqueN</span>(<span class="fu">c</span>(regA, regB)),</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">rc =</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">c</span>(regA, regB))), <span class="at">collapse =</span> <span class="st">" + "</span>),</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">yr =</span> <span class="fu">first</span>(year),</span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">sg =</span> <span class="fu">first</span>(sex),</span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">ag =</span> <span class="fu">first</span>(age_n)</span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> id</span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a>keyz <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"a1"</span>, <span class="st">"a2"</span>, <span class="st">"a4"</span>, <span class="st">"a5"</span>, <span class="st">"a7"</span>, <span class="st">"a8"</span>)</span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>orc[, ac <span class="sc">:</span><span class="er">=</span> <span class="fu">rowSums</span>(.SD <span class="sc">&gt;</span> <span class="dv">0</span>), .SDcols <span class="ot">=</span> keyz]</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. VOLATILITY (v_moves): placement transfers/shifts within the person-year sequence for vm</span></span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a>moves <span class="ot">&lt;-</span> dt1c[</span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">order</span>(id),</span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">vm =</span> <span class="fu">sum</span>((regA <span class="sc">!=</span> regB) <span class="sc">|</span> (regA <span class="sc">!=</span> <span class="fu">shift</span>(regA) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">shift</span>(regA))))</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-70"><a href="#cb80-70" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> id</span>
<span id="cb80-71"><a href="#cb80-71" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a>orc <span class="ot">&lt;-</span> <span class="fu">merge</span>(orc, moves, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(</span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a>  orc,</span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yr"</span>,</span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ag"</span>,</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sg"</span>,</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"np"</span>,</span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ac"</span>,</span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rg"</span>,</span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vm"</span>,</span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a1"</span>,</span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a2"</span>,</span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a4"</span>,</span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a5"</span>,</span>
<span id="cb80-89"><a href="#cb80-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a7"</span>,</span>
<span id="cb80-90"><a href="#cb80-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a8"</span>,</span>
<span id="cb80-91"><a href="#cb80-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span>,</span>
<span id="cb80-92"><a href="#cb80-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rc"</span></span>
<span id="cb80-93"><a href="#cb80-93" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-94"><a href="#cb80-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-95"><a href="#cb80-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-96"><a href="#cb80-96" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(orc[ac <span class="sc">&gt;</span> <span class="dv">3</span>][<span class="fu">order</span>(<span class="sc">-</span>ac)][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       yr    ag     sg    np    ac    rg    vm    a1    a2    a4    a5    a7
    &lt;num&gt; &lt;num&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
 1:  2023  42.0   Male    93     6     1     0    15    22    11     2     3
 2:  2023  21.0   Male   161     6     1     0   131     3     1     1     1
 3:  2024  42.0   Male   355     6     1     0    31    66     2     4     3
 4:  2024  42.0   Male   183     6     1     0    27     6    11    40    12
 5:  2024  42.0   Male    39     6     1     0    10     2     1     1     1
 6:  2024  42.0   Male   196     6     1     0   161     8     1     1     3
 7:  2025  42.0   Male   249     6     1     0    86     7    12     2     6
 8:  2025  57.5   Male    83     6     3     8    12    20     3     4    39
 9:  2025  42.0   Male    86     6     1     0    16    37     2    11     4
10:  2025  42.0   Male   122     6     2     3    35     2     3    10    32
       a8            id                          rc
    &lt;num&gt;        &lt;char&gt;                      &lt;char&gt;
 1:    40 2023-15720-RC                     Eastern
 2:    24 2023-16285-RC                     Eastern
 3:   249 2024-00145-RC                     Eastern
 4:    87 2024-00280-RC                     Eastern
 5:    24 2024-04490-RC                     Eastern
 6:    22 2024-10754-RC                     Eastern
 7:   136 2025-00167-RC                     Eastern
 8:     5 2025-01080-RC Central + Eastern + Toronto
 9:    16 2025-05185-RC                     Eastern
10:    40 2025-11914-RC           Central + Eastern</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Zero day rows:"</span>, <span class="fu">nrow</span>(orc[np <span class="sc">==</span> <span class="dv">0</span>])))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Zero day rows: 0"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>orc[, id <span class="sc">:</span><span class="er">=</span> .I]</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>orc[, sg <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(sg <span class="sc">==</span> <span class="st">"Male"</span>, <span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Xbar and SD for complexity and volatility by year and gender</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>statz <span class="ot">&lt;-</span> orc[,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> .N,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">xA =</span> <span class="fu">round</span>(<span class="fu">mean</span>(ac, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sA =</span> <span class="fu">round</span>(<span class="fu">sd</span>(ac, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">xB =</span> <span class="fu">round</span>(<span class="fu">mean</span>(vm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">sB =</span> <span class="fu">round</span>(<span class="fu">sd</span>(vm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(yr, sg)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>statz <span class="ot">&lt;-</span> statz[<span class="fu">order</span>(yr, sg)]</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- Summary Statistics for Methods Section ---"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- Summary Statistics for Methods Section ---"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(statz)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      yr    sg     n    xA    sA    xB    sB
   &lt;num&gt; &lt;num&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
1:  2023     1 19270  1.13  0.42  0.06  0.37
2:  2023     2  1511  1.13  0.39  0.01  0.13
3:  2024     1 17717  1.14  0.42  0.08  0.42
4:  2024     2  1924  1.15  0.43  0.02  0.21
5:  2025     1 22224  1.13  0.42  0.11  0.49
6:  2025     2  2821  1.14  0.41  0.06  0.36</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>orc[,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  agc <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="dv">21</span> , <span class="st">"21"</span> , ag <span class="sc">==</span> <span class="dv">42</span> , <span class="st">"42"</span> , ag <span class="sc">==</span> <span class="fl">57.5</span> , <span class="st">"57.5"</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DoubleML)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3learners)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc) <span class="co"># weighted variance/sd</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted mean: sum(value * weight) / sum(weight)</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted sd: sq rt of weighted variance</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>statz1a <span class="ot">&lt;-</span> orc[,</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  .(</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> .N,</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xA =</span> <span class="fu">round</span>(<span class="fu">wtd.mean</span>(ac, <span class="at">weights =</span> np), <span class="dv">2</span>),</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">sA =</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">wtd.var</span>(ac, <span class="at">weights =</span> np)), <span class="dv">2</span>),</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">xB =</span> <span class="fu">round</span>(<span class="fu">wtd.mean</span>(vm, <span class="at">weights =</span> np), <span class="dv">2</span>),</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">sB =</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">wtd.var</span>(vm, <span class="at">weights =</span> np)), <span class="dv">2</span>)</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a>  by <span class="ot">=</span> .(yr, sg, agc, rc)</span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>statz1a[<span class="fu">is.na</span>(sA), sA <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(sB)]</span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>statz1a[<span class="fu">is.na</span>(sB), sB <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>(sB)]</span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(statz1a[<span class="fu">order</span>(yr, agc, sg, n, xA, xB, sA, sB, rc)])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        yr    sg    agc                           rc     n    xA    sA    xB
     &lt;num&gt; &lt;num&gt; &lt;char&gt;                       &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
  1:  2023     1     21  Central + Eastern + Western     1  1.00  0.00  3.00
  2:  2023     1     21  Central + Toronto + Western     1  1.00  0.00  3.00
  3:  2023     1     21 Eastern + Northern + Toronto     1  1.00  0.00  3.00
  4:  2023     1     21            Toronto + Western     2  3.00  0.00  1.06
  5:  2023     1     21  Central + Eastern + Toronto     2  3.49  0.50  5.48
 ---                                                                        
236:  2025     2   57.5            Central + Eastern     3  1.00  0.00  1.11
237:  2025     2   57.5                     Northern    25  1.04  0.20  0.00
238:  2025     2   57.5                      Western    33  1.87  0.85  0.00
239:  2025     2   57.5                      Central    44  1.08  0.28  0.00
240:  2025     2   57.5                      Eastern    99  1.37  0.65  0.00
        sB
     &lt;num&gt;
  1:  0.00
  2:  0.00
  3:  0.00
  4:  0.24
  5:  1.51
 ---      
236:  0.31
237:  0.00
238:  0.00
239:  0.00
240:  0.00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># year, age, gender, region</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>statz1a <span class="ot">&lt;-</span> statz1a[<span class="fu">order</span>(yr, agc, sg, n, xA, xB, sA, sB, rc)]</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"--- Detailed Summary Statistics (By Year, Demographics, and Region) ---"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--- Detailed Summary Statistics (By Year, Demographics, and Region) ---"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(statz1a, <span class="dv">30</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       yr    sg    agc                           rc     n    xA    sA    xB
    &lt;num&gt; &lt;num&gt; &lt;char&gt;                       &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
 1:  2023     1     21  Central + Eastern + Western     1  1.00  0.00  3.00
 2:  2023     1     21  Central + Toronto + Western     1  1.00  0.00  3.00
 3:  2023     1     21 Eastern + Northern + Toronto     1  1.00  0.00  3.00
 4:  2023     1     21            Toronto + Western     2  3.00  0.00  1.06
 5:  2023     1     21  Central + Eastern + Toronto     2  3.49  0.50  5.48
 6:  2023     1     21           Northern + Toronto     4  1.27  0.45  2.00
 7:  2023     1     21           Central + Northern     7  1.00  0.00  1.86
 8:  2023     1     21           Eastern + Northern     7  1.54  0.69  2.00
 9:  2023     1     21            Eastern + Toronto     9  1.73  1.14  2.55
10:  2023     1     21            Central + Eastern    13  1.28  0.59  1.69
11:  2023     1     21            Central + Western    19  1.38  0.55  1.75
12:  2023     1     21            Central + Toronto    33  1.90  1.23  2.28
13:  2023     1     21                      Western   384  1.15  0.45  0.00
14:  2023     1     21                      Toronto   462  1.21  0.49  0.00
15:  2023     1     21                     Northern   464  1.40  0.73  0.00
16:  2023     1     21                      Eastern   722  1.20  0.54  0.00
17:  2023     1     21                      Central  1147  1.23  0.56  0.00
18:  2023     2     21                      Central     1  1.00   NaN  0.00
19:  2023     2     21           Eastern + Northern     1  1.00  0.00  2.00
20:  2023     2     21            Eastern + Western     1  2.00  0.00  1.00
21:  2023     2     21                      Toronto     5  1.58  1.20  0.00
22:  2023     2     21                      Western    42  1.28  0.51  0.00
23:  2023     2     21                     Northern    85  1.13  0.38  0.00
24:  2023     2     21                      Eastern    94  1.87  1.06  0.00
25:  2023     1     42 Central + Northern + Toronto     1  1.00  0.00  3.00
26:  2023     1     42 Northern + Toronto + Western     1  1.00  0.00  3.00
27:  2023     1     42 Eastern + Northern + Toronto     1  2.00  0.00  3.00
28:  2023     1     42 Central + Northern + Western     2  1.62  0.49  3.00
29:  2023     1     42  Central + Toronto + Western     2  2.00  0.00  4.00
30:  2023     1     42  Central + Eastern + Toronto     3  1.59  0.49  3.59
       yr    sg    agc                           rc     n    xA    sA    xB
    &lt;num&gt; &lt;num&gt; &lt;char&gt;                       &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
       sB
    &lt;num&gt;
 1:  0.00
 2:  0.00
 3:  0.00
 4:  0.24
 5:  1.51
 6:  0.00
 7:  0.35
 8:  0.00
 9:  0.78
10:  0.46
11:  0.43
12:  0.55
13:  0.00
14:  0.00
15:  0.00
16:  0.00
17:  0.00
18:   NaN
19:  0.00
20:  0.00
21:  0.00
22:  0.00
23:  0.00
24:  0.00
25:  0.00
26:  0.00
27:  0.00
28:  0.00
29:  0.00
30:  0.49
       sB
    &lt;num&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># paths by volume per year</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>rpvy <span class="ot">&lt;-</span> statz1a[, .SD[<span class="fu">head</span>(<span class="fu">order</span>(<span class="sc">-</span>n), <span class="dv">15</span>)], by <span class="ot">=</span> yr]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rpvy)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       yr    sg    agc       rc     n    xA    sA    xB    sB
    &lt;num&gt; &lt;num&gt; &lt;char&gt;   &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
 1:  2023     1     42  Central  4451  1.25  0.59     0     0
 2:  2023     1     42  Eastern  2950  1.20  0.50     0     0
 3:  2023     1     42  Western  2194  1.20  0.48     0     0
 4:  2023     1     42  Toronto  1902  1.28  0.62     0     0
 5:  2023     1     42 Northern  1814  1.33  0.67     0     0
 6:  2023     1     21  Central  1147  1.23  0.56     0     0
 7:  2023     1   57.5  Central   792  1.25  0.56     0     0
 8:  2023     1     21  Eastern   722  1.20  0.54     0     0
 9:  2023     2     42  Eastern   525  1.29  0.58     0     0
10:  2023     1   57.5  Eastern   521  1.13  0.36     0     0
11:  2023     1     21 Northern   464  1.40  0.73     0     0
12:  2023     1     21  Toronto   462  1.21  0.49     0     0
13:  2023     1     21  Western   384  1.15  0.45     0     0
14:  2023     1   57.5  Western   349  1.10  0.34     0     0
15:  2023     2     42  Western   330  1.29  0.55     0     0
16:  2024     1     42  Eastern  3769  1.20  0.58     0     0
17:  2024     1     42  Central  3515  1.24  0.53     0     0
18:  2024     1     42  Western  2143  1.17  0.45     0     0
19:  2024     1     42  Toronto  1589  1.18  0.46     0     0
20:  2024     1     42 Northern  1408  1.41  0.69     0     0
21:  2024     1     21  Eastern   833  1.21  0.59     0     0
22:  2024     2     42  Eastern   751  1.35  0.78     0     0
23:  2024     1     21  Central   700  1.22  0.48     0     0
24:  2024     1   57.5  Eastern   673  1.16  0.49     0     0
25:  2024     1   57.5  Central   621  1.26  0.59     0     0
26:  2024     2     42  Western   445  1.24  0.50     0     0
27:  2024     1     21  Western   373  1.17  0.43     0     0
28:  2024     1     21  Toronto   361  1.17  0.43     0     0
29:  2024     1   57.5  Western   327  1.18  0.39     0     0
30:  2024     2     42 Northern   326  1.31  0.59     0     0
31:  2025     1     42  Central  4943  1.17  0.45     0     0
32:  2025     1     42  Toronto  3440  1.25  0.57     0     0
33:  2025     1     42  Eastern  3267  1.26  0.64     0     0
34:  2025     1     42  Western  2392  1.17  0.40     0     0
35:  2025     1     42 Northern  1277  1.35  0.64     0     0
36:  2025     1     21  Central   981  1.12  0.40     0     0
37:  2025     2     42  Eastern   918  1.28  0.59     0     0
38:  2025     1     21  Toronto   793  1.14  0.42     0     0
39:  2025     1   57.5  Central   757  1.14  0.39     0     0
40:  2025     1     21  Eastern   663  1.17  0.48     0     0
41:  2025     1   57.5  Toronto   663  1.20  0.43     0     0
42:  2025     1   57.5  Eastern   612  1.18  0.49     0     0
43:  2025     2     42  Western   474  1.28  0.47     0     0
44:  2025     2     42 Northern   400  1.41  0.71     0     0
45:  2025     2     42  Central   379  1.16  0.41     0     0
       yr    sg    agc       rc     n    xA    sA    xB    sB
    &lt;num&gt; &lt;num&gt; &lt;char&gt;   &lt;char&gt; &lt;int&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>orc[, agc <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>orc[,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  ag <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="dv">21</span>   , <span class="st">"21"</span>   ,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="dv">42</span>   , <span class="st">"42"</span>   ,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="fl">57.5</span> , <span class="st">"57.5"</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>orc[, rc <span class="sc">:</span><span class="er">=</span> <span class="fu">as.factor</span>(rc)]</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>orc[, ag <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(ag, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"21"</span>, <span class="st">"42"</span>, <span class="st">"57.5"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>orc[, sg <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(sg, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"M"</span>, <span class="st">"F"</span>))]</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>orc[, yr <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(yr, <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(yr)), <span class="at">ordered =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a><span class="co"># data types</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(orc[, .(yr, ag, sg, rc)])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  65467 obs. of  4 variables:
 $ yr: Ord.factor w/ 3 levels "2023"&lt;"2024"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...
 $ ag: Ord.factor w/ 3 levels "21"&lt;"42"&lt;"57.5": 2 3 2 2 3 3 2 3 2 3 ...
 $ sg: Factor w/ 2 levels "M","F": 1 1 1 1 1 1 1 1 1 1 ...
 $ rc: Factor w/ 26 levels "Central","Central + Eastern",..: 24 20 12 26 12 12 1 20 26 26 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>orc[, treat <span class="sc">:</span><span class="er">=</span> <span class="fu">as.integer</span>(ac <span class="sc">&gt;=</span> <span class="dv">2</span>)]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>m.out <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"glm"</span>,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> orc<span class="sc">$</span>np</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>orc_matched <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out)</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="co"># fit of weighted poisson GLMM  'weights' (matching weights) via MatchIt</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>model_final <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc_matched,</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co"># poisson model fit (matched sample)</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>model_final <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc_matched,</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_final)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized linear mixed model fit by maximum likelihood (Laplace
  Approximation) [glmerMod]
 Family: poisson  ( log )
Formula: vm ~ treat + ag + sg + yr + (1 | rc)
   Data: orc_matched
Weights: weights

      AIC       BIC    logLik -2*log(L)  df.resid 
   3039.7    3100.4   -1511.9    3023.7     14512 

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-1.00219 -0.01331 -0.01131 -0.00979  2.23180 

Random effects:
 Groups Name        Variance Std.Dev.
 rc     (Intercept) 19.41    4.406   
Number of obs: 14520, groups:  rc, 24

Fixed effects:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.409675   0.912681  -1.545    0.122    
treat        0.290601   0.051779   5.612    2e-08 ***
ag.L         0.029770   0.066244   0.449    0.653    
ag.Q         0.017940   0.042570   0.421    0.673    
sgF         -0.105187   0.102136  -1.030    0.303    
yr.L        -0.008085   0.037464  -0.216    0.829    
yr.Q        -0.008459   0.039257  -0.215    0.829    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
      (Intr) treat  ag.L   ag.Q   sgF    yr.L  
treat -0.045                                   
ag.L   0.017 -0.046                            
ag.Q   0.027 -0.017  0.351                     
sgF   -0.009 -0.024  0.056  0.010              
yr.L  -0.006  0.032  0.023  0.016 -0.116       
yr.Q  -0.001  0.062  0.025  0.022 -0.058 -0.163</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  effect sizes (Incidence Rate Ratio) from log-odds</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>results_table <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(model_final))</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       treat        ag.L        ag.Q         sgF        yr.L 
  0.2442227   1.3372305   1.0302174   1.0181016   0.9001565   0.9919480 
       yr.Q 
  0.9915767 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>sim_res <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(model_final)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_res)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(sim_res)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 6.895e-11, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(sim_res)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 1.6609, p-value = 0.016
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>model_final_thesis <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc_matched,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> nbinom2,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmmTMBControl</span>(<span class="at">optimizer =</span> optim, <span class="at">optArgs =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"BFGS"</span>))</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_final_thesis)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: nbinom2  ( log )
Formula:          vm ~ treat + ag + sg + yr + (1 | rc)
Data: orc_matched
Weights: weights

      AIC       BIC    logLik -2*log(L)  df.resid 
   3041.7    3110.0   -1511.9    3023.7     14511 

Random effects:

Conditional model:
 Groups Name        Variance Std.Dev.
 rc     (Intercept) 19.52    4.418   
Number of obs: 14520, groups:  rc, 24

Dispersion parameter for nbinom2 family (): 2.58e+08 

Conditional model:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.416375   0.934642  -1.515    0.130    
treat        0.290602   0.051777   5.613 1.99e-08 ***
ag.L         0.029777   0.066240   0.450    0.653    
ag.Q         0.017940   0.042567   0.421    0.673    
sgF         -0.105184   0.102124  -1.030    0.303    
yr.L        -0.008090   0.037462  -0.216    0.829    
yr.Q        -0.008458   0.039255  -0.215    0.829    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>fix_eff <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_final_thesis)<span class="sc">$</span>coefficients<span class="sc">$</span>cond</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>results_final <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">rownames</span>(fix_eff),</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">IRR =</span> <span class="fu">exp</span>(fix_eff[, <span class="st">"Estimate"</span>]),</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Lower_CI =</span> <span class="fu">exp</span>(fix_eff[, <span class="st">"Estimate"</span>] <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> fix_eff[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Upper_CI =</span> <span class="fu">exp</span>(fix_eff[, <span class="st">"Estimate"</span>] <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> fix_eff[, <span class="st">"Std. Error"</span>]),</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_Value =</span> fix_eff[, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_final)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Variable       IRR   Lower_CI Upper_CI      P_Value
(Intercept) (Intercept) 0.2425918 0.03884119 1.515164 1.296662e-01
treat             treat 1.3372328 1.20818531 1.480064 1.993339e-08
ag.L               ag.L 1.0302247 0.90478976 1.173049 6.530468e-01
ag.Q               ag.Q 1.0181020 0.93660717 1.106688 6.734231e-01
sgF                 sgF 0.9001589 0.73686691 1.099637 3.030295e-01
yr.L               yr.L 0.9919424 0.92171814 1.067517 8.290195e-01
yr.Q               yr.Q 0.9915779 0.91814800 1.070880 8.294083e-01</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>sim_res1b <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(model_final_thesis, <span class="at">n =</span> <span class="dv">5000</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_res1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(sim_res1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 4.2272e-11, p-value = 0.0032
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(sim_res1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 1.6516, p-value = 0.0268
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># naive weighted mean comparison to double-check the 33% increase; close to the IRR ?:!</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(weights)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wtd.mean</span>(</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  orc_matched<span class="sc">$</span>vm[orc_matched<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> orc_matched<span class="sc">$</span>weights[orc_matched<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2538567</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wtd.mean</span>(</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  orc_matched<span class="sc">$</span>vm[orc_matched<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">0</span>],</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> orc_matched<span class="sc">$</span>weights[orc_matched<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06721763</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim_res1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(sim_res1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 4.2272e-11, p-value = 0.0032
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(sim_res1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 1.6516, p-value = 0.0268
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>love_plot <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  m.out,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>),</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">var.order =</span> <span class="st">"unadjusted"</span>,</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">abs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>),</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">shapes =</span> <span class="fu">c</span>(<span class="st">"circle"</span>, <span class="st">"triangle"</span>),</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.names =</span> <span class="fu">c</span>(<span class="st">"Original"</span>, <span class="st">"Matched"</span>),</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="st">"std"</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(love_plot)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>bal_table <span class="ot">&lt;-</span> <span class="fu">bal.tab</span>(m.out, <span class="at">un =</span> <span class="cn">TRUE</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bal_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balance Measures
             Type Diff.Un Diff.Adj
distance Distance  0.0911        0
ag_21      Binary -0.0072        0
ag_42      Binary  0.0314        0
ag_57.5    Binary -0.0242        0
sg_F       Binary  0.0065        0
yr_2023    Binary -0.0027        0
yr_2024    Binary  0.0026        0
yr_2025    Binary  0.0001        0

Sample sizes
          Control Treated
All         58207    7260
Matched      7260    7260
Unmatched   50947       0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">love.plot</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  m.out,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stats =</span> <span class="st">"m"</span>,</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>),</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">abs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="cn">TRUE</span>,</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.names =</span> <span class="fu">c</span>(<span class="st">"Original (Pre-Match)"</span>, <span class="st">"Matched (Final Sample)"</span>),</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#d62728"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">shapes =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>),</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Covariate Balance Across Groups"</span>,</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Absolute Standardized Mean Differences"</span>,</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>dml_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(orc_matched)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>dml_data<span class="sc">$</span>sg <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_data<span class="sc">$</span>sg)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>dml_data<span class="sc">$</span>ag <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_data<span class="sc">$</span>ag)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>dml_data<span class="sc">$</span>yr <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dml_data<span class="sc">$</span>yr)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>data_dml_obj <span class="ot">=</span> <span class="fu">double_ml_data_from_data_frame</span>(</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  dml_data,</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"yr"</span>)</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>l_ranger <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>dml_model <span class="ot">=</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>  data_dml_obj,</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> l_ranger,</span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> l_ranger,</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>) <span class="co">#  l = target y learner ; m = treatment d learner</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>dml_model<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_model<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat   0.18658    0.01048    17.8   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      Estimate. Std. Error  t value     Pr(&gt;|t|)
treat 0.1865815 0.01048398 17.79682 7.480299e-71</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>dml_matrix_data <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> vm <span class="sc">+</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc_matched</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>dml_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dml_matrix_data)</span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(dml_df) <span class="ot">&lt;-</span> <span class="fu">make.names</span>(<span class="fu">colnames</span>(dml_df))</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>data_dml_adj <span class="ot">=</span> <span class="fu">double_ml_data_from_data_frame</span>(</span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  dml_df,</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(dml_df), <span class="fu">c</span>(<span class="st">"vm"</span>, <span class="st">"treat"</span>))</span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>l_ranger <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>dml_model_adj <span class="ot">=</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb131-18"><a href="#cb131-18" aria-hidden="true" tabindex="-1"></a>  data_dml_adj,</span>
<span id="cb131-19"><a href="#cb131-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> l_ranger,</span>
<span id="cb131-20"><a href="#cb131-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> l_ranger,</span>
<span id="cb131-21"><a href="#cb131-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb131-22"><a href="#cb131-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb131-23"><a href="#cb131-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-24"><a href="#cb131-24" aria-hidden="true" tabindex="-1"></a>dml_model_adj<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions =</span> <span class="cn">TRUE</span>)</span>
<span id="cb131-25"><a href="#cb131-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-26"><a href="#cb131-26" aria-hidden="true" tabindex="-1"></a>dml_preds_final <span class="ot">&lt;-</span> dml_model_adj<span class="sc">$</span>predictions<span class="sc">$</span>ml_l[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb131-27"><a href="#cb131-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-28"><a href="#cb131-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"DML Predictions Count:"</span>, <span class="fu">length</span>(dml_preds_final)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "DML Predictions Count: 14520"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>glmm_preds_final <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_final_thesis, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> <span class="fu">as.numeric</span>(orc_matched<span class="sc">$</span>vm),</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">GLMM =</span> <span class="fu">as.numeric</span>(glmm_preds_final),</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">DML =</span> <span class="fu">as.numeric</span>(dml_preds_final)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data) <span class="sc">+</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> GLMM, <span class="at">fill =</span> <span class="st">"GLMM (Parametric)"</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> DML, <span class="at">fill =</span> <span class="st">"DML (Machine Learning)"</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Predicted Values (Log Scale)"</span>,</span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Revealing the distribution of low-probability GLMM predictions"</span>,</span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predicted Moves (Log10 Scale)"</span>,</span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Model Type"</span></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="co"># log10 transformation for distribution of very small GLMM values</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>mse_glmm <span class="ot">&lt;-</span> <span class="fu">mean</span>((plot_data<span class="sc">$</span>Actual <span class="sc">-</span> plot_data<span class="sc">$</span>GLMM)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>mse_dml <span class="ot">&lt;-</span> <span class="fu">mean</span>((plot_data<span class="sc">$</span>Actual <span class="sc">-</span> plot_data<span class="sc">$</span>DML)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Initial Results ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Initial Results ---</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_model_adj<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat  0.090705   0.006215   14.59   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

       Estimate.  Std. Error t value    Pr(&gt;|t|)
treat 0.09070513 0.006215405 14.5936 3.08484e-48</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"GLMM MSE:"</span>, <span class="fu">round</span>(mse_glmm, <span class="dv">6</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>GLMM MSE: 0.033648 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"DML MSE: "</span>, <span class="fu">round</span>(mse_dml, <span class="dv">6</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>DML MSE:  0.176137 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(orc_matched<span class="sc">$</span>weights)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      1       1       1       1       1       1 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Matching weight distribution:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Matching weight distribution:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(orc_matched<span class="sc">$</span>weights))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1 
14520 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">By treatment group:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
By treatment group:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">aggregate</span>(weights <span class="sc">~</span> treat, <span class="at">data =</span> orc_matched, <span class="at">FUN =</span> summary))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  treat weights.Min. weights.1st Qu. weights.Median weights.Mean
1     0            1               1              1            1
2     1            1               1              1            1
  weights.3rd Qu. weights.Max.
1               1            1
2               1            1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Sample sizes by treatment:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Sample sizes by treatment:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(orc_matched<span class="sc">$</span>treat))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
7260 7260 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>dml_data_clustered <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(orc_matched),</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"yr"</span>, <span class="st">"rc"</span>),</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="st">"id"</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42569872</span>)</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>dml_clustered <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>  dml_data_clustered,</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a>dml_clustered<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_clustered<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat  0.078614   0.005167   15.21   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      Estimate.  Std. Error  t value     Pr(&gt;|t|)
treat 0.0786137 0.005167116 15.21423 2.845424e-52</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>dml_data_region_clustered <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(orc_matched),</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>),</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="fu">c</span>(<span class="st">"rc"</span>, <span class="st">"yr"</span>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2764389</span>)</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>dml_region_clustered <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  dml_data_region_clustered,</span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>dml_region_clustered<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_region_clustered<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)
treat    0.2091     0.1277   1.638    0.101

      Estimate. Std. Error  t value  Pr(&gt;|t|)
treat 0.2091398  0.1276979 1.637769 0.1014698</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>dml_data_region <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(orc_matched),</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"yr"</span>),</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="st">"rc"</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6450835</span>)</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>dml_region <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>  dml_data_region,</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb160-15"><a href="#cb160-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb160-16"><a href="#cb160-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-17"><a href="#cb160-17" aria-hidden="true" tabindex="-1"></a>dml_region<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb160-18"><a href="#cb160-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_region<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)  
treat    0.1943     0.1013   1.919    0.055 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      Estimate. Std. Error  t value   Pr(&gt;|t|)
treat 0.1943492  0.1012809 1.918914 0.05499526</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>dml_data_yr <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(orc_matched),</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"rc"</span>),</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="st">"yr"</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">69543</span>)</span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>dml_yearz <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>  dml_data_yr,</span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>dml_yearz<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_yearz<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat   0.13004    0.01491   8.719   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      Estimate. Std. Error  t value     Pr(&gt;|t|)
treat 0.1300352 0.01491448 8.718722 2.813599e-18</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>dml_data_yrID <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(orc_matched),</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"rc"</span>, <span class="st">"id"</span>),</span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="st">"yr"</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2468176</span>)</span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>dml_yearzID <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>  dml_data_yrID,</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>dml_yearzID<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_yearzID<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat   0.08137    0.01173   6.936 4.04e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

       Estimate. Std. Error  t value    Pr(&gt;|t|)
treat 0.08137193 0.01173222 6.935764 4.04033e-12</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>dml_data_IDz <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">as.data.frame</span>(orc_matched),</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ag"</span>,</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sg"</span>,</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rc"</span>,</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yr"</span>,</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"subclass"</span>,</span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span>,</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a1"</span>,</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a2"</span>,</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a4"</span>,</span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a5"</span>,</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a7"</span>,</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"a8"</span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="st">"distance"</span></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4568937</span>)</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>dml_IDz <span class="ot">&lt;-</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a>  dml_data_IDz,</span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>),</span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a>dml_IDz<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_IDz<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat   0.12669    0.01854   6.833 8.29e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      Estimate. Std. Error t value     Pr(&gt;|t|)
treat 0.1266875 0.01853918  6.8335 8.286776e-12</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>ml_g <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>ml_m <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>x_cols_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"rc"</span>, <span class="st">"yr"</span>, <span class="st">"a1"</span>, <span class="st">"a2"</span>, <span class="st">"a4"</span>, <span class="st">"a5"</span>, <span class="st">"a7"</span>, <span class="st">"a8"</span>)</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>orc_matched[,</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">c</span>(<span class="st">"sg"</span>, <span class="st">"rc"</span>, <span class="st">"yr"</span>)) <span class="sc">:</span><span class="er">=</span> <span class="fu">lapply</span>(.SD, as.factor),</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>  .SDcols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"sg"</span>, <span class="st">"rc"</span>, <span class="st">"yr"</span>)</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>run_dml_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_cols, tag, cluster_var) {</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>  dml_data <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(data),</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb168-14"><a href="#cb168-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_cols =</span> x_cols,</span>
<span id="cb168-15"><a href="#cb168-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_cols =</span> cluster_var</span>
<span id="cb168-16"><a href="#cb168-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-17"><a href="#cb168-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-18"><a href="#cb168-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">117504871</span>)</span>
<span id="cb168-19"><a href="#cb168-19" aria-hidden="true" tabindex="-1"></a>  obj_ate <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb168-20"><a href="#cb168-20" aria-hidden="true" tabindex="-1"></a>    dml_data,</span>
<span id="cb168-21"><a href="#cb168-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_g =</span> ml_g,</span>
<span id="cb168-22"><a href="#cb168-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_m =</span> ml_m,</span>
<span id="cb168-23"><a href="#cb168-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb168-24"><a href="#cb168-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> <span class="st">"ATE"</span></span>
<span id="cb168-25"><a href="#cb168-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-26"><a href="#cb168-26" aria-hidden="true" tabindex="-1"></a>  obj_ate<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb168-27"><a href="#cb168-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">16254911</span>)</span>
<span id="cb168-28"><a href="#cb168-28" aria-hidden="true" tabindex="-1"></a>  obj_atte <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb168-29"><a href="#cb168-29" aria-hidden="true" tabindex="-1"></a>    dml_data,</span>
<span id="cb168-30"><a href="#cb168-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_g =</span> ml_g,</span>
<span id="cb168-31"><a href="#cb168-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_m =</span> ml_m,</span>
<span id="cb168-32"><a href="#cb168-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb168-33"><a href="#cb168-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> <span class="st">"ATTE"</span></span>
<span id="cb168-34"><a href="#cb168-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-35"><a href="#cb168-35" aria-hidden="true" tabindex="-1"></a>  obj_atte<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb168-36"><a href="#cb168-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-37"><a href="#cb168-37" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, est) {</span>
<span id="cb168-38"><a href="#cb168-38" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> obj<span class="sc">$</span><span class="fu">confint</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb168-39"><a href="#cb168-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(</span>
<span id="cb168-40"><a href="#cb168-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="fu">paste0</span>(<span class="st">"Clustered by "</span>, cluster_var),</span>
<span id="cb168-41"><a href="#cb168-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> tag,</span>
<span id="cb168-42"><a href="#cb168-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimand =</span> est,</span>
<span id="cb168-43"><a href="#cb168-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">effect =</span> <span class="fu">as.numeric</span>(obj<span class="sc">$</span>coef),</span>
<span id="cb168-44"><a href="#cb168-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">se =</span> <span class="fu">as.numeric</span>(obj<span class="sc">$</span>se),</span>
<span id="cb168-45"><a href="#cb168-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">as.numeric</span>(obj<span class="sc">$</span>pval),</span>
<span id="cb168-46"><a href="#cb168-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">ci_low =</span> <span class="fu">as.numeric</span>(ci[<span class="dv">1</span>, <span class="dv">1</span>]),</span>
<span id="cb168-47"><a href="#cb168-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">ci_high =</span> <span class="fu">as.numeric</span>(ci[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb168-48"><a href="#cb168-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb168-49"><a href="#cb168-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb168-50"><a href="#cb168-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbind</span>(<span class="fu">extract</span>(obj_ate, <span class="st">"ATE"</span>), <span class="fu">extract</span>(obj_atte, <span class="st">"ATTE"</span>)))</span>
<span id="cb168-51"><a href="#cb168-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb168-52"><a href="#cb168-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-53"><a href="#cb168-53" aria-hidden="true" tabindex="-1"></a>res_pool_ID <span class="ot">&lt;-</span> <span class="fu">run_dml_analysis</span>(orc_matched, x_cols_all, <span class="st">"Pooled"</span>, <span class="st">"id"</span>)</span>
<span id="cb168-54"><a href="#cb168-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-55"><a href="#cb168-55" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(orc_matched<span class="sc">$</span>yr))</span>
<span id="cb168-56"><a href="#cb168-56" aria-hidden="true" tabindex="-1"></a>x_cols_yearly <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(x_cols_all, <span class="st">"yr"</span>)</span>
<span id="cb168-57"><a href="#cb168-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-58"><a href="#cb168-58" aria-hidden="true" tabindex="-1"></a>res_year_ID <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(years, <span class="cf">function</span>(yy) {</span>
<span id="cb168-59"><a href="#cb168-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_dml_analysis</span>(orc_matched[yr <span class="sc">==</span> yy], x_cols_yearly, <span class="fu">as.character</span>(yy), <span class="st">"id"</span>)</span>
<span id="cb168-60"><a href="#cb168-60" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb168-61"><a href="#cb168-61" aria-hidden="true" tabindex="-1"></a>res_pool_SUB <span class="ot">&lt;-</span> <span class="fu">run_dml_analysis</span>(orc_matched, x_cols_all, <span class="st">"Pooled"</span>, <span class="st">"subclass"</span>)</span>
<span id="cb168-62"><a href="#cb168-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-63"><a href="#cb168-63" aria-hidden="true" tabindex="-1"></a>res_year_SUB <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(years, <span class="cf">function</span>(yy) {</span>
<span id="cb168-64"><a href="#cb168-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">run_dml_analysis</span>(</span>
<span id="cb168-65"><a href="#cb168-65" aria-hidden="true" tabindex="-1"></a>    orc_matched[yr <span class="sc">==</span> yy],</span>
<span id="cb168-66"><a href="#cb168-66" aria-hidden="true" tabindex="-1"></a>    x_cols_yearly,</span>
<span id="cb168-67"><a href="#cb168-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(yy),</span>
<span id="cb168-68"><a href="#cb168-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">"subclass"</span></span>
<span id="cb168-69"><a href="#cb168-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb168-70"><a href="#cb168-70" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb168-71"><a href="#cb168-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-72"><a href="#cb168-72" aria-hidden="true" tabindex="-1"></a>final_comparison_pool <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_pool_ID, res_pool_SUB)</span>
<span id="cb168-73"><a href="#cb168-73" aria-hidden="true" tabindex="-1"></a>final_comparison_year <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res_year_ID, res_year_SUB)</span>
<span id="cb168-74"><a href="#cb168-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-75"><a href="#cb168-75" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb168-76"><a href="#cb168-76" aria-hidden="true" tabindex="-1"></a>  final_comparison_pool,</span>
<span id="cb168-77"><a href="#cb168-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb168-78"><a href="#cb168-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Pooled: ID vs Subclass Clustering"</span></span>
<span id="cb168-79"><a href="#cb168-79" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Pooled: ID vs Subclass Clustering</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 9%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">method</th>
<th style="text-align: left;">group</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">ci_low</th>
<th style="text-align: right;">ci_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">Pooled</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1166</td>
<td style="text-align: right;">0.0049</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1070</td>
<td style="text-align: right;">0.1262</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">Pooled</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1477</td>
<td style="text-align: right;">0.0081</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1319</td>
<td style="text-align: right;">0.1635</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">Pooled</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1192</td>
<td style="text-align: right;">0.0049</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1095</td>
<td style="text-align: right;">0.1289</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">Pooled</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1474</td>
<td style="text-align: right;">0.0081</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1316</td>
<td style="text-align: right;">0.1632</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>  final_comparison_year,</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Yearly: ID vs Subclass Clustering"</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Yearly: ID vs Subclass Clustering</caption>
<colgroup>
<col style="width: 29%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">method</th>
<th style="text-align: left;">group</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: right;">p_value</th>
<th style="text-align: right;">ci_low</th>
<th style="text-align: right;">ci_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.0834</td>
<td style="text-align: right;">0.0077</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0682</td>
<td style="text-align: right;">0.0985</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1087</td>
<td style="text-align: right;">0.0129</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0835</td>
<td style="text-align: right;">0.1340</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1406</td>
<td style="text-align: right;">0.0098</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1215</td>
<td style="text-align: right;">0.1597</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1876</td>
<td style="text-align: right;">0.0165</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1553</td>
<td style="text-align: right;">0.2198</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1221</td>
<td style="text-align: right;">0.0083</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1058</td>
<td style="text-align: right;">0.1383</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1578</td>
<td style="text-align: right;">0.0137</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1311</td>
<td style="text-align: right;">0.1846</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.0839</td>
<td style="text-align: right;">0.0077</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0687</td>
<td style="text-align: right;">0.0991</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">2023</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1072</td>
<td style="text-align: right;">0.0128</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0821</td>
<td style="text-align: right;">0.1323</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1397</td>
<td style="text-align: right;">0.0097</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1207</td>
<td style="text-align: right;">0.1587</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">2024</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1868</td>
<td style="text-align: right;">0.0165</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1545</td>
<td style="text-align: right;">0.2192</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1228</td>
<td style="text-align: right;">0.0083</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1066</td>
<td style="text-align: right;">0.1391</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">2025</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1564</td>
<td style="text-align: right;">0.0136</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1297</td>
<td style="text-align: right;">0.1830</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>run_dml_extended <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_cols, tag, cluster_var) {</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  dml_data <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(data),</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_cols =</span> x_cols,</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_cols =</span> cluster_var</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">68235576</span>)</span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>  obj_ate <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(dml_data, <span class="at">ml_g =</span> ml_g, <span class="at">ml_m =</span> ml_m, <span class="at">n_folds =</span> <span class="dv">3</span>)</span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a>  obj_ate<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>  preds_g0 <span class="ot">&lt;-</span> obj_ate<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a>  preds_g1 <span class="ot">&lt;-</span> obj_ate<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a>  dml_fitted <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>, preds_g1, preds_g0)</span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a>  current_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((data<span class="sc">$</span>vm <span class="sc">-</span> dml_fitted)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">65196489</span>)</span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a>  sim_response <span class="ot">&lt;-</span> <span class="fu">replicate</span>(<span class="dv">250</span>, <span class="fu">rpois</span>(<span class="fu">length</span>(dml_fitted), dml_fitted))</span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a>  dharma_res <span class="ot">&lt;-</span> <span class="fu">createDHARMa</span>(</span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">simulatedResponse =</span> sim_response,</span>
<span id="cb170-24"><a href="#cb170-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">observedResponse =</span> data<span class="sc">$</span>vm,</span>
<span id="cb170-25"><a href="#cb170-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fittedPredictedResponse =</span> dml_fitted,</span>
<span id="cb170-26"><a href="#cb170-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">integerResponse =</span> <span class="cn">TRUE</span></span>
<span id="cb170-27"><a href="#cb170-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb170-28"><a href="#cb170-28" aria-hidden="true" tabindex="-1"></a>  ci <span class="ot">&lt;-</span> obj_ate<span class="sc">$</span><span class="fu">confint</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb170-29"><a href="#cb170-29" aria-hidden="true" tabindex="-1"></a>  res_table <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb170-30"><a href="#cb170-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">paste0</span>(<span class="st">"Clustered by "</span>, cluster_var),</span>
<span id="cb170-31"><a href="#cb170-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> tag,</span>
<span id="cb170-32"><a href="#cb170-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">effect =</span> <span class="fu">as.numeric</span>(obj_ate<span class="sc">$</span>coef),</span>
<span id="cb170-33"><a href="#cb170-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="fu">as.numeric</span>(obj_ate<span class="sc">$</span>se),</span>
<span id="cb170-34"><a href="#cb170-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> <span class="fu">as.numeric</span>(obj_ate<span class="sc">$</span>pval),</span>
<span id="cb170-35"><a href="#cb170-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">mse =</span> current_mse,</span>
<span id="cb170-36"><a href="#cb170-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_low =</span> <span class="fu">as.numeric</span>(ci[<span class="dv">1</span>, <span class="dv">1</span>]),</span>
<span id="cb170-37"><a href="#cb170-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_high =</span> <span class="fu">as.numeric</span>(ci[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb170-38"><a href="#cb170-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb170-39"><a href="#cb170-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-40"><a href="#cb170-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">table =</span> res_table, <span class="at">dharma =</span> dharma_res, <span class="at">fitted =</span> dml_fitted))</span>
<span id="cb170-41"><a href="#cb170-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb170-42"><a href="#cb170-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-43"><a href="#cb170-43" aria-hidden="true" tabindex="-1"></a>ml_g <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb170-44"><a href="#cb170-44" aria-hidden="true" tabindex="-1"></a>ml_m <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb170-45"><a href="#cb170-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-46"><a href="#cb170-46" aria-hidden="true" tabindex="-1"></a>pooled_analysis_SUB <span class="ot">&lt;-</span> <span class="fu">run_dml_extended</span>(</span>
<span id="cb170-47"><a href="#cb170-47" aria-hidden="true" tabindex="-1"></a>  orc_matched,</span>
<span id="cb170-48"><a href="#cb170-48" aria-hidden="true" tabindex="-1"></a>  x_cols_all,</span>
<span id="cb170-49"><a href="#cb170-49" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pooled"</span>,</span>
<span id="cb170-50"><a href="#cb170-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">"subclass"</span></span>
<span id="cb170-51"><a href="#cb170-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb170-52"><a href="#cb170-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-53"><a href="#cb170-53" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- DML Model Summary (Clustered by Subclass) ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- DML Model Summary (Clustered by Subclass) ---</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pooled_analysis_SUB<span class="sc">$</span>table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  method  group    effect          se       p_value       mse
                  &lt;char&gt; &lt;char&gt;     &lt;num&gt;       &lt;num&gt;         &lt;num&gt;     &lt;num&gt;
1: Clustered by subclass Pooled 0.1173772 0.004912666 3.642154e-126 0.2056631
      ci_low   ci_high
       &lt;num&gt;     &lt;num&gt;
1: 0.1077485 0.1270058</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- DHARMa Diagnostics ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- DHARMa Diagnostics ---</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pooled_analysis_SUB<span class="sc">$</span>dharma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testOutliers</span>(pooled_analysis_SUB<span class="sc">$</span>dharma, <span class="at">type =</span> <span class="st">"bootstrap"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa bootstrapped outlier test

data:  pooled_analysis_SUB$dharma
outliers at both margin(s) = 44, observations = 14520, p-value &lt;
2.2e-16
alternative hypothesis: two.sided
 percent confidence interval:
 0.001203512 0.002377755
sample estimates:
outlier frequency (expected: 0.00176721763085399 ) 
                                       0.003030303 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(pooled_analysis_SUB<span class="sc">$</span>dharma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 1.2939, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(pooled_analysis_SUB<span class="sc">$</span>dharma)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 1.0664, p-value &lt; 2.2e-16
alternative hypothesis: two.sided</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">--- Model Performance Comparison ---</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Model Performance Comparison ---</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"GLMM MSE:"</span>, <span class="fu">round</span>(mse_glmm, <span class="dv">6</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>GLMM MSE: 0.033648 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"DML MSE: "</span>, <span class="fu">round</span>(pooled_analysis_SUB<span class="sc">$</span>table<span class="sc">$</span>mse, <span class="dv">6</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>DML MSE:  0.205663 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>ml_g <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>ml_m <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>x_cols_all <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"rc"</span>, <span class="st">"yr"</span>, <span class="st">"a1"</span>, <span class="st">"a2"</span>, <span class="st">"a4"</span>, <span class="st">"a5"</span>, <span class="st">"a7"</span>, <span class="st">"a8"</span>)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>x_cols_with_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(x_cols_all, <span class="st">"distance"</span>)</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(orc_matched<span class="sc">$</span>yr))</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>run_dml_stable <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_cols, tag, cluster_var) {</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>  dml_data <span class="ot">&lt;-</span> DoubleMLClusterData<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(data),</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x_cols =</span> x_cols,</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">cluster_cols =</span> cluster_var</span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">54893769</span>)</span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>  obj_ate <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>    dml_data,</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_g =</span> ml_g,</span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_m =</span> ml_m,</span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> <span class="st">"ATE"</span></span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions =</span> <span class="cn">TRUE</span>)</span>
<span id="cb189-24"><a href="#cb189-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">6549875</span>)</span>
<span id="cb189-25"><a href="#cb189-25" aria-hidden="true" tabindex="-1"></a>  obj_atte <span class="ot">&lt;-</span> DoubleMLIRM<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb189-26"><a href="#cb189-26" aria-hidden="true" tabindex="-1"></a>    dml_data,</span>
<span id="cb189-27"><a href="#cb189-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_g =</span> ml_g,</span>
<span id="cb189-28"><a href="#cb189-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ml_m =</span> ml_m,</span>
<span id="cb189-29"><a href="#cb189-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_folds =</span> <span class="dv">3</span>,</span>
<span id="cb189-30"><a href="#cb189-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">score =</span> <span class="st">"ATTE"</span></span>
<span id="cb189-31"><a href="#cb189-31" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">$</span><span class="fu">fit</span>(<span class="at">store_predictions =</span> <span class="cn">TRUE</span>)</span>
<span id="cb189-32"><a href="#cb189-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-33"><a href="#cb189-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mse</span></span>
<span id="cb189-34"><a href="#cb189-34" aria-hidden="true" tabindex="-1"></a>  preds_g0 <span class="ot">&lt;-</span> obj_ate<span class="sc">$</span>predictions<span class="sc">$</span>ml_g0[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb189-35"><a href="#cb189-35" aria-hidden="true" tabindex="-1"></a>  preds_g1 <span class="ot">&lt;-</span> obj_ate<span class="sc">$</span>predictions<span class="sc">$</span>ml_g1[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb189-36"><a href="#cb189-36" aria-hidden="true" tabindex="-1"></a>  dml_fitted <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>, preds_g1, preds_g0)</span>
<span id="cb189-37"><a href="#cb189-37" aria-hidden="true" tabindex="-1"></a>  calc_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((data<span class="sc">$</span>vm <span class="sc">-</span> dml_fitted)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb189-38"><a href="#cb189-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-39"><a href="#cb189-39" aria-hidden="true" tabindex="-1"></a>  extract <span class="ot">&lt;-</span> <span class="cf">function</span>(obj, est) {</span>
<span id="cb189-40"><a href="#cb189-40" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> obj<span class="sc">$</span><span class="fu">confint</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb189-41"><a href="#cb189-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.table</span>(</span>
<span id="cb189-42"><a href="#cb189-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="fu">paste0</span>(<span class="st">"Clustered by "</span>, cluster_var),</span>
<span id="cb189-43"><a href="#cb189-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> tag,</span>
<span id="cb189-44"><a href="#cb189-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">estimand =</span> est,</span>
<span id="cb189-45"><a href="#cb189-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">effect =</span> <span class="fu">as.numeric</span>(obj<span class="sc">$</span>coef),</span>
<span id="cb189-46"><a href="#cb189-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">se =</span> <span class="fu">as.numeric</span>(obj<span class="sc">$</span>se),</span>
<span id="cb189-47"><a href="#cb189-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">as.numeric</span>(obj<span class="sc">$</span>pval),</span>
<span id="cb189-48"><a href="#cb189-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">mse =</span> calc_mse,</span>
<span id="cb189-49"><a href="#cb189-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">ci_low =</span> <span class="fu">as.numeric</span>(ci[<span class="dv">1</span>, <span class="dv">1</span>]),</span>
<span id="cb189-50"><a href="#cb189-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">ci_high =</span> <span class="fu">as.numeric</span>(ci[<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb189-51"><a href="#cb189-51" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb189-52"><a href="#cb189-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb189-53"><a href="#cb189-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">rbind</span>(<span class="fu">extract</span>(obj_ate, <span class="st">"ATE"</span>), <span class="fu">extract</span>(obj_atte, <span class="st">"ATTE"</span>)))</span>
<span id="cb189-54"><a href="#cb189-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-55"><a href="#cb189-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-56"><a href="#cb189-56" aria-hidden="true" tabindex="-1"></a>all_results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb189-57"><a href="#cb189-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-58"><a href="#cb189-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (yy <span class="cf">in</span> years) {</span>
<span id="cb189-59"><a href="#cb189-59" aria-hidden="true" tabindex="-1"></a>  x_yearly <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(x_cols_all, <span class="st">"yr"</span>)</span>
<span id="cb189-60"><a href="#cb189-60" aria-hidden="true" tabindex="-1"></a>  all_results_list[[<span class="fu">paste0</span>(<span class="st">"ID_"</span>, yy)]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-61"><a href="#cb189-61" aria-hidden="true" tabindex="-1"></a>    orc_matched[yr <span class="sc">==</span> yy],</span>
<span id="cb189-62"><a href="#cb189-62" aria-hidden="true" tabindex="-1"></a>    x_yearly,</span>
<span id="cb189-63"><a href="#cb189-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(yy),</span>
<span id="cb189-64"><a href="#cb189-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">"id"</span></span>
<span id="cb189-65"><a href="#cb189-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-66"><a href="#cb189-66" aria-hidden="true" tabindex="-1"></a>  all_results_list[[<span class="fu">paste0</span>(<span class="st">"SUB_"</span>, yy)]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-67"><a href="#cb189-67" aria-hidden="true" tabindex="-1"></a>    orc_matched[yr <span class="sc">==</span> yy],</span>
<span id="cb189-68"><a href="#cb189-68" aria-hidden="true" tabindex="-1"></a>    x_yearly,</span>
<span id="cb189-69"><a href="#cb189-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(yy),</span>
<span id="cb189-70"><a href="#cb189-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">"subclass"</span></span>
<span id="cb189-71"><a href="#cb189-71" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-72"><a href="#cb189-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb189-73"><a href="#cb189-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-74"><a href="#cb189-74" aria-hidden="true" tabindex="-1"></a>all_results_list[[<span class="st">"Pool_23_25_ID"</span>]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-75"><a href="#cb189-75" aria-hidden="true" tabindex="-1"></a>  orc_matched,</span>
<span id="cb189-76"><a href="#cb189-76" aria-hidden="true" tabindex="-1"></a>  x_cols_all,</span>
<span id="cb189-77"><a href="#cb189-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pool (23-25)"</span>,</span>
<span id="cb189-78"><a href="#cb189-78" aria-hidden="true" tabindex="-1"></a>  <span class="st">"id"</span></span>
<span id="cb189-79"><a href="#cb189-79" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-80"><a href="#cb189-80" aria-hidden="true" tabindex="-1"></a>all_results_list[[<span class="st">"Pool_23_25_SUB"</span>]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-81"><a href="#cb189-81" aria-hidden="true" tabindex="-1"></a>  orc_matched,</span>
<span id="cb189-82"><a href="#cb189-82" aria-hidden="true" tabindex="-1"></a>  x_cols_all,</span>
<span id="cb189-83"><a href="#cb189-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pool (23-25)"</span>,</span>
<span id="cb189-84"><a href="#cb189-84" aria-hidden="true" tabindex="-1"></a>  <span class="st">"subclass"</span></span>
<span id="cb189-85"><a href="#cb189-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-86"><a href="#cb189-86" aria-hidden="true" tabindex="-1"></a>all_results_list[[<span class="st">"Pool_23_24_SUB"</span>]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-87"><a href="#cb189-87" aria-hidden="true" tabindex="-1"></a>  orc_matched[yr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2023"</span>, <span class="st">"2024"</span>)],</span>
<span id="cb189-88"><a href="#cb189-88" aria-hidden="true" tabindex="-1"></a>  x_cols_all,</span>
<span id="cb189-89"><a href="#cb189-89" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pool (23-24)"</span>,</span>
<span id="cb189-90"><a href="#cb189-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"subclass"</span></span>
<span id="cb189-91"><a href="#cb189-91" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-92"><a href="#cb189-92" aria-hidden="true" tabindex="-1"></a>all_results_list[[<span class="st">"Pool_24_25_SUB"</span>]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-93"><a href="#cb189-93" aria-hidden="true" tabindex="-1"></a>  orc_matched[yr <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"2024"</span>, <span class="st">"2025"</span>)],</span>
<span id="cb189-94"><a href="#cb189-94" aria-hidden="true" tabindex="-1"></a>  x_cols_all,</span>
<span id="cb189-95"><a href="#cb189-95" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pool (24-25)"</span>,</span>
<span id="cb189-96"><a href="#cb189-96" aria-hidden="true" tabindex="-1"></a>  <span class="st">"subclass"</span></span>
<span id="cb189-97"><a href="#cb189-97" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-98"><a href="#cb189-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-99"><a href="#cb189-99" aria-hidden="true" tabindex="-1"></a>all_results_list[[<span class="st">"Pool_Dist_Adj"</span>]] <span class="ot">&lt;-</span> <span class="fu">run_dml_stable</span>(</span>
<span id="cb189-100"><a href="#cb189-100" aria-hidden="true" tabindex="-1"></a>  orc_matched,</span>
<span id="cb189-101"><a href="#cb189-101" aria-hidden="true" tabindex="-1"></a>  x_cols_with_dist,</span>
<span id="cb189-102"><a href="#cb189-102" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Pool (Dist-Adj)"</span>,</span>
<span id="cb189-103"><a href="#cb189-103" aria-hidden="true" tabindex="-1"></a>  <span class="st">"subclass"</span></span>
<span id="cb189-104"><a href="#cb189-104" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-105"><a href="#cb189-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-106"><a href="#cb189-106" aria-hidden="true" tabindex="-1"></a>m_results <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(all_results_list, <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb189-107"><a href="#cb189-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-108"><a href="#cb189-108" aria-hidden="true" tabindex="-1"></a>m_results[, t_stat <span class="sc">:</span><span class="er">=</span> <span class="fu">abs</span>(effect <span class="sc">/</span> se)]</span>
<span id="cb189-109"><a href="#cb189-109" aria-hidden="true" tabindex="-1"></a>m_results[, df <span class="sc">:</span><span class="er">=</span> <span class="dv">1000</span>] <span class="co"># DF for SEs</span></span>
<span id="cb189-110"><a href="#cb189-110" aria-hidden="true" tabindex="-1"></a>m_results[, RV <span class="sc">:</span><span class="er">=</span> <span class="fu">round</span>(t_stat <span class="sc">/</span> <span class="fu">sqrt</span>(df), <span class="dv">4</span>)]</span>
<span id="cb189-111"><a href="#cb189-111" aria-hidden="true" tabindex="-1"></a>m_results[,</span>
<span id="cb189-112"><a href="#cb189-112" aria-hidden="true" tabindex="-1"></a>  sig <span class="sc">:</span><span class="er">=</span> <span class="fu">cut</span>(</span>
<span id="cb189-113"><a href="#cb189-113" aria-hidden="true" tabindex="-1"></a>    p_value,</span>
<span id="cb189-114"><a href="#cb189-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb189-115"><a href="#cb189-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"***"</span>, <span class="st">"**"</span>, <span class="st">"*"</span>, <span class="st">""</span>)</span>
<span id="cb189-116"><a href="#cb189-116" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-117"><a href="#cb189-117" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb189-118"><a href="#cb189-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-119"><a href="#cb189-119" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb189-120"><a href="#cb189-120" aria-hidden="true" tabindex="-1"></a>  m_results[</span>
<span id="cb189-121"><a href="#cb189-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(group, method),</span>
<span id="cb189-122"><a href="#cb189-122" aria-hidden="true" tabindex="-1"></a>    .(group, method, estimand, effect, se, sig, RV, mse)</span>
<span id="cb189-123"><a href="#cb189-123" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb189-124"><a href="#cb189-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb189-125"><a href="#cb189-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Final Consolidated DML Results"</span></span>
<span id="cb189-126"><a href="#cb189-126" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Final Consolidated DML Results</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 27%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: left;">method</th>
<th style="text-align: left;">estimand</th>
<th style="text-align: right;">effect</th>
<th style="text-align: right;">se</th>
<th style="text-align: left;">sig</th>
<th style="text-align: right;">RV</th>
<th style="text-align: right;">mse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.0836</td>
<td style="text-align: right;">0.0077</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.3445</td>
<td style="text-align: right;">0.1636</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1069</td>
<td style="text-align: right;">0.0128</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.2650</td>
<td style="text-align: right;">0.1636</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.0835</td>
<td style="text-align: right;">0.0077</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.3410</td>
<td style="text-align: right;">0.1640</td>
</tr>
<tr class="even">
<td style="text-align: left;">2023</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1092</td>
<td style="text-align: right;">0.0129</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.2670</td>
<td style="text-align: right;">0.1640</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1373</td>
<td style="text-align: right;">0.0095</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.4550</td>
<td style="text-align: right;">0.2288</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1873</td>
<td style="text-align: right;">0.0165</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.3583</td>
<td style="text-align: right;">0.2288</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1391</td>
<td style="text-align: right;">0.0098</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.4510</td>
<td style="text-align: right;">0.2284</td>
</tr>
<tr class="even">
<td style="text-align: left;">2024</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1871</td>
<td style="text-align: right;">0.0165</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.3579</td>
<td style="text-align: right;">0.2284</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1222</td>
<td style="text-align: right;">0.0082</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.4688</td>
<td style="text-align: right;">0.2253</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1546</td>
<td style="text-align: right;">0.0136</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.3584</td>
<td style="text-align: right;">0.2253</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1227</td>
<td style="text-align: right;">0.0081</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.4761</td>
<td style="text-align: right;">0.2252</td>
</tr>
<tr class="even">
<td style="text-align: left;">2025</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1559</td>
<td style="text-align: right;">0.0136</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.3624</td>
<td style="text-align: right;">0.2252</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pool (23-24)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1143</td>
<td style="text-align: right;">0.0063</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.5749</td>
<td style="text-align: right;">0.2081</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pool (23-24)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1398</td>
<td style="text-align: right;">0.0100</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.4410</td>
<td style="text-align: right;">0.2081</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pool (23-25)</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1173</td>
<td style="text-align: right;">0.0049</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.7550</td>
<td style="text-align: right;">0.2067</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pool (23-25)</td>
<td style="text-align: left;">Clustered by id</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1476</td>
<td style="text-align: right;">0.0081</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.5768</td>
<td style="text-align: right;">0.2067</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pool (23-25)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1183</td>
<td style="text-align: right;">0.0050</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.7545</td>
<td style="text-align: right;">0.2081</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pool (23-25)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1481</td>
<td style="text-align: right;">0.0081</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.5786</td>
<td style="text-align: right;">0.2081</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pool (24-25)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1309</td>
<td style="text-align: right;">0.0063</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.6605</td>
<td style="text-align: right;">0.2327</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pool (24-25)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1656</td>
<td style="text-align: right;">0.0103</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.5090</td>
<td style="text-align: right;">0.2327</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pool (Dist-Adj)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATE</td>
<td style="text-align: right;">0.1220</td>
<td style="text-align: right;">0.0052</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.7456</td>
<td style="text-align: right;">0.2242</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pool (Dist-Adj)</td>
<td style="text-align: left;">Clustered by subclass</td>
<td style="text-align: left;">ATTE</td>
<td style="text-align: right;">0.1514</td>
<td style="text-align: right;">0.0083</td>
<td style="text-align: left;">***</td>
<td style="text-align: right;">0.5787</td>
<td style="text-align: right;">0.2242</td>
</tr>
</tbody>
</table>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>plot_data1b <span class="ot">&lt;-</span> <span class="fu">copy</span>(m_results)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>plot_data1b[,</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  group <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>    group,</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">c</span>(</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(years),</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Pool (23-24)"</span>,</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Pool (24-25)"</span>,</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Pool (23-25)"</span>,</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Pool (Dist-Adj)"</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data1b, <span class="fu">aes</span>(<span class="at">x =</span> effect, <span class="at">y =</span> group, <span class="at">color =</span> method)) <span class="sc">+</span></span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(</span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">xmin =</span> ci_low, <span class="at">xmax =</span> ci_high),</span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb190-20"><a href="#cb190-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.6</span>)</span>
<span id="cb190-21"><a href="#cb190-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb190-22"><a href="#cb190-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.6</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb190-23"><a href="#cb190-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>estimand) <span class="sc">+</span></span>
<span id="cb190-24"><a href="#cb190-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb190-25"><a href="#cb190-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb190-26"><a href="#cb190-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"DMLIRM Effect Stability"</span>,</span>
<span id="cb190-27"><a href="#cb190-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average Policy Effects of Treatment Variable"</span>,</span>
<span id="cb190-28"><a href="#cb190-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">" Computational Model"</span></span>
<span id="cb190-29"><a href="#cb190-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb190-30"><a href="#cb190-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5469257</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>m.out1a <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr,</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"glm"</span>,</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>orc_matched1b <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m.out1a)</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>love_plot1b <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>  m.out1a,</span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>),</span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">abs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="st">"std"</span>,</span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">line =</span> <span class="cn">TRUE</span>,</span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample.names =</span> <span class="fu">c</span>(<span class="st">"Original (Pre-Match)"</span>, <span class="st">"Matched (Final Sample)"</span>),</span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#d62728"</span>, <span class="st">"#1f77b4"</span>),</span>
<span id="cb191-20"><a href="#cb191-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Covariate Balance"</span></span>
<span id="cb191-21"><a href="#cb191-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-22"><a href="#cb191-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(love_plot1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>model_final_thesis1b <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc_matched1b,</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> nbinom2,</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">glmmTMBControl</span>(<span class="at">optimizer =</span> optim, <span class="at">optArgs =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"BFGS"</span>))</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>fix_eff1b <span class="ot">&lt;-</span> <span class="fu">summary</span>(model_final_thesis1b)<span class="sc">$</span>coefficients<span class="sc">$</span>cond</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>results_final1b <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">rownames</span>(fix_eff1b),</span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">IRR =</span> <span class="fu">exp</span>(fix_eff1b[, <span class="st">"Estimate"</span>]),</span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">P_Value =</span> fix_eff1b[, <span class="st">"Pr(&gt;|z|)"</span>]</span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results_final1b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Variable       IRR      P_Value
(Intercept) (Intercept) 0.2425918 1.296662e-01
treat             treat 1.3372328 1.993339e-08
ag.L               ag.L 1.0302247 6.530468e-01
ag.Q               ag.Q 1.0181020 6.734231e-01
sgF                 sgF 0.9001589 3.030295e-01
yr.L               yr.L 0.9919424 8.290195e-01
yr.Q               yr.Q 0.9915779 8.294083e-01</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DML robustness test confirms the GLMM via non-linear RF ?:!</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>dml_data1b <span class="ot">&lt;-</span> <span class="fu">copy</span>(orc_matched1b)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>dml_data1b[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sg =</span> <span class="fu">as.numeric</span>(sg),</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ag =</span> <span class="fu">as.numeric</span>(ag),</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">yr =</span> <span class="fu">as.numeric</span>(yr)</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>)]</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>data_dml_obj1b <span class="ot">=</span> <span class="fu">double_ml_data_from_data_frame</span>(</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(dml_data1b),</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_col =</span> <span class="st">"vm"</span>,</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">d_cols =</span> <span class="st">"treat"</span>,</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">x_cols =</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"yr"</span>)</span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a>l_ranger1b <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.ranger"</span>, <span class="at">num.trees =</span> <span class="dv">500</span>, <span class="at">max.depth =</span> <span class="dv">5</span>) <span class="co"># nuisance param</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>dml_model1b <span class="ot">=</span> DoubleMLPLR<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a>  data_dml_obj1b,</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_l =</span> l_ranger1b,</span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">ml_m =</span> l_ranger1b,</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_folds =</span> <span class="dv">3</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>dml_model1b<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dml_model1b<span class="sc">$</span><span class="fu">summary</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimates and significance testing of the effect of target variables
      Estimate. Std. Error t value Pr(&gt;|t|)    
treat   0.18635    0.01049   17.76   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

      Estimate. Std. Error  t value     Pr(&gt;|t|)
treat 0.1863547 0.01049039 17.76433 1.335209e-70</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>fit_raw <span class="ot">&lt;-</span> <span class="fu">glm</span>(vm <span class="sc">~</span> treat, <span class="at">data =</span> orc, <span class="at">family =</span> <span class="fu">poisson</span>()) <span class="co"># baseline</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>ate_raw <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(fit_raw)[<span class="st">"treat"</span>])</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted gcomp log/poisson of outcome via treatment and covariates</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>fit_adj <span class="ot">&lt;-</span> <span class="fu">glm</span>(vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc, <span class="at">data =</span> orc, <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ATE of marginality</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>data_t1 <span class="ot">&lt;-</span> <span class="fu">copy</span>(orc)[, treat <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span>]</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>data_t0 <span class="ot">&lt;-</span> <span class="fu">copy</span>(orc)[, treat <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>]</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>ate_gcomp <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">predict</span>(fit_adj, data_t1, <span class="at">type =</span> <span class="st">"response"</span>)) <span class="sc">/</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="fu">predict</span>(fit_adj, data_t0, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>m_near <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc,</span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nearest"</span>,</span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"glm"</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>) <span class="co"># PSM</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>d_near <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m_near)</span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a><span class="co"># psm subclassification: 'subclass' blocks</span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>m_sub <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc,</span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"subclass"</span>,</span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">subclass =</span> <span class="dv">10</span></span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a>d_sub <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m_sub)</span>
<span id="cb196-26"><a href="#cb196-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-27"><a href="#cb196-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WeightIt)</span>
<span id="cb196-28"><a href="#cb196-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb196-29"><a href="#cb196-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-30"><a href="#cb196-30" aria-hidden="true" tabindex="-1"></a>w_ipw <span class="ot">&lt;-</span> <span class="fu">weightit</span>(</span>
<span id="cb196-31"><a href="#cb196-31" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc,</span>
<span id="cb196-32"><a href="#cb196-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-33"><a href="#cb196-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ps"</span>,</span>
<span id="cb196-34"><a href="#cb196-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span></span>
<span id="cb196-35"><a href="#cb196-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-36"><a href="#cb196-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-37"><a href="#cb196-37" aria-hidden="true" tabindex="-1"></a>fit_ipw <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb196-38"><a href="#cb196-38" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat,</span>
<span id="cb196-39"><a href="#cb196-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-40"><a href="#cb196-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> w_ipw<span class="sc">$</span>weights,</span>
<span id="cb196-41"><a href="#cb196-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>()</span>
<span id="cb196-42"><a href="#cb196-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-43"><a href="#cb196-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-44"><a href="#cb196-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AIPW)</span>
<span id="cb196-45"><a href="#cb196-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SuperLearner)</span>
<span id="cb196-46"><a href="#cb196-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb196-47"><a href="#cb196-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb196-48"><a href="#cb196-48" aria-hidden="true" tabindex="-1"></a>results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb196-49"><a href="#cb196-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-50"><a href="#cb196-50" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"Baseline_Raw"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(<span class="fu">glm</span>(</span>
<span id="cb196-51"><a href="#cb196-51" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat,</span>
<span id="cb196-52"><a href="#cb196-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-53"><a href="#cb196-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson</span>
<span id="cb196-54"><a href="#cb196-54" aria-hidden="true" tabindex="-1"></a>))[<span class="st">"treat"</span>])</span>
<span id="cb196-55"><a href="#cb196-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-56"><a href="#cb196-56" aria-hidden="true" tabindex="-1"></a>fit_adj <span class="ot">&lt;-</span> <span class="fu">glm</span>(vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc, <span class="at">data =</span> orc, <span class="at">family =</span> poisson)</span>
<span id="cb196-57"><a href="#cb196-57" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"Adjusted_GComp"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(fit_adj)[<span class="st">"treat"</span>])</span>
<span id="cb196-58"><a href="#cb196-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-59"><a href="#cb196-59" aria-hidden="true" tabindex="-1"></a>m_near <span class="ot">&lt;-</span> <span class="fu">matchit</span>(treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc, <span class="at">data =</span> orc, <span class="at">method =</span> <span class="st">"nearest"</span>)</span>
<span id="cb196-60"><a href="#cb196-60" aria-hidden="true" tabindex="-1"></a>d_near <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m_near)</span>
<span id="cb196-61"><a href="#cb196-61" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"PSM_Nearest"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(<span class="fu">glmmTMB</span>(</span>
<span id="cb196-62"><a href="#cb196-62" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb196-63"><a href="#cb196-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d_near,</span>
<span id="cb196-64"><a href="#cb196-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson</span>
<span id="cb196-65"><a href="#cb196-65" aria-hidden="true" tabindex="-1"></a>))<span class="sc">$</span>cond[<span class="st">"treat"</span>])</span>
<span id="cb196-66"><a href="#cb196-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-67"><a href="#cb196-67" aria-hidden="true" tabindex="-1"></a>m_sub <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb196-68"><a href="#cb196-68" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc,</span>
<span id="cb196-69"><a href="#cb196-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-70"><a href="#cb196-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"subclass"</span>,</span>
<span id="cb196-71"><a href="#cb196-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">subclass =</span> <span class="dv">5</span></span>
<span id="cb196-72"><a href="#cb196-72" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-73"><a href="#cb196-73" aria-hidden="true" tabindex="-1"></a>d_sub <span class="ot">&lt;-</span> <span class="fu">match.data</span>(m_sub)</span>
<span id="cb196-74"><a href="#cb196-74" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"PSM_Subclass"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(<span class="fu">glmmTMB</span>(</span>
<span id="cb196-75"><a href="#cb196-75" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb196-76"><a href="#cb196-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d_sub,</span>
<span id="cb196-77"><a href="#cb196-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson</span>
<span id="cb196-78"><a href="#cb196-78" aria-hidden="true" tabindex="-1"></a>))<span class="sc">$</span>cond[<span class="st">"treat"</span>])</span>
<span id="cb196-79"><a href="#cb196-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-80"><a href="#cb196-80" aria-hidden="true" tabindex="-1"></a>w_ipw <span class="ot">&lt;-</span> <span class="fu">weightit</span>(</span>
<span id="cb196-81"><a href="#cb196-81" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rc,</span>
<span id="cb196-82"><a href="#cb196-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-83"><a href="#cb196-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ps"</span>,</span>
<span id="cb196-84"><a href="#cb196-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span></span>
<span id="cb196-85"><a href="#cb196-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-86"><a href="#cb196-86" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"IPW_Weighted"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">coef</span>(<span class="fu">glm</span>(</span>
<span id="cb196-87"><a href="#cb196-87" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat,</span>
<span id="cb196-88"><a href="#cb196-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orc,</span>
<span id="cb196-89"><a href="#cb196-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> w_ipw<span class="sc">$</span>weights,</span>
<span id="cb196-90"><a href="#cb196-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson</span>
<span id="cb196-91"><a href="#cb196-91" aria-hidden="true" tabindex="-1"></a>))[<span class="st">"treat"</span>])</span>
<span id="cb196-92"><a href="#cb196-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-93"><a href="#cb196-93" aria-hidden="true" tabindex="-1"></a><span class="co"># nb given overdispersion ?:!</span></span>
<span id="cb196-94"><a href="#cb196-94" aria-hidden="true" tabindex="-1"></a>mod_nbin <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb196-95"><a href="#cb196-95" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb196-96"><a href="#cb196-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d_near,</span>
<span id="cb196-97"><a href="#cb196-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> nbinom2</span>
<span id="cb196-98"><a href="#cb196-98" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-99"><a href="#cb196-99" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"NegBinomial"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(mod_nbin)<span class="sc">$</span>cond[<span class="st">"treat"</span>])</span>
<span id="cb196-100"><a href="#cb196-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-101"><a href="#cb196-101" aria-hidden="true" tabindex="-1"></a><span class="co"># zinb</span></span>
<span id="cb196-102"><a href="#cb196-102" aria-hidden="true" tabindex="-1"></a>mod_zinb <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb196-103"><a href="#cb196-103" aria-hidden="true" tabindex="-1"></a>  vm <span class="sc">~</span> treat <span class="sc">+</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> rc),</span>
<span id="cb196-104"><a href="#cb196-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">ziformula =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb196-105"><a href="#cb196-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d_near,</span>
<span id="cb196-106"><a href="#cb196-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> nbinom2</span>
<span id="cb196-107"><a href="#cb196-107" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-108"><a href="#cb196-108" aria-hidden="true" tabindex="-1"></a>results_list[[<span class="st">"ZINB_Model"</span>]] <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(mod_zinb)<span class="sc">$</span>cond[<span class="st">"treat"</span>])</span>
<span id="cb196-109"><a href="#cb196-109" aria-hidden="true" tabindex="-1"></a>validation_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb196-110"><a href="#cb196-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> <span class="fu">names</span>(results_list),</span>
<span id="cb196-111"><a href="#cb196-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">IRR_Estimate =</span> <span class="fu">unlist</span>(results_list)</span>
<span id="cb196-112"><a href="#cb196-112" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb196-113"><a href="#cb196-113" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(validation_table)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                             Method IRR_Estimate
Baseline_Raw.treat     Baseline_Raw     4.273060
Adjusted_GComp.treat Adjusted_GComp     1.338768
PSM_Nearest.treat       PSM_Nearest     1.349855
PSM_Subclass.treat     PSM_Subclass     1.339447
IPW_Weighted.treat     IPW_Weighted     1.338755
NegBinomial.treat       NegBinomial     1.349856
ZINB_Model.treat         ZINB_Model     1.349856</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AIPW)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm3)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SuperLearner)</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>sl_libs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"SL.glmnet"</span>, <span class="st">"SL.xgboost"</span>, <span class="st">"SL.glm"</span>, <span class="st">"SL.mean"</span>)</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>cov <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ag"</span>, <span class="st">"sg"</span>, <span class="st">"yr"</span>, <span class="st">"rg"</span>)</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>aipw_obj1a <span class="ot">&lt;-</span> AIPW<span class="sc">$</span><span class="fu">new</span>(</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> orc_matched<span class="sc">$</span>vm,</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">A =</span> orc_matched<span class="sc">$</span>treat,</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">W =</span> <span class="fu">subset</span>(orc_matched, <span class="at">select =</span> cov),</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Q.SL.library =</span> sl_libs,</span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">g.SL.library =</span> sl_libs,</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">k_split =</span> <span class="dv">10</span>,</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb198-16"><a href="#cb198-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-17"><a href="#cb198-17" aria-hidden="true" tabindex="-1"></a>aipw_obj1a<span class="sc">$</span><span class="fu">fit</span>()</span>
<span id="cb198-18"><a href="#cb198-18" aria-hidden="true" tabindex="-1"></a>aipw_obj1a<span class="sc">$</span><span class="fu">stratified_fit</span>()</span>
<span id="cb198-19"><a href="#cb198-19" aria-hidden="true" tabindex="-1"></a>aipw_obj1a<span class="sc">$</span><span class="fu">summary</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Estimate      SE 95% LCL 95% UCL     N
Mean of Exposure       0.173 0.00580  0.1612  0.1839  7260
Mean of Control        0.128 0.00430  0.1191  0.1360  7260
Mean Difference        0.045 0.00302  0.0390  0.0509 14520
ATT Mean Difference    0.066 0.00461  0.0569  0.0750 14520
ATC Mean Difference    0.024 0.00206  0.0199  0.0280 14520</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>aipw_obj1a<span class="sc">$</span><span class="fu">plot.p_score</span>(<span class="at">print.ip_weights =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>aipw_obj1a<span class="sc">$</span><span class="fu">plot.ip_weights</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>orcmatch_temp <span class="ot">&lt;-</span> <span class="fu">copy</span>(orc_matched1b)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, weights <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, treat <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, distance <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, subclass <span class="sc">:</span><span class="er">=</span> <span class="cn">NULL</span>]</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[,</span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>  ag <span class="sc">:</span><span class="er">=</span> <span class="fu">fcase</span>(</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="dv">21</span>   , <span class="st">"21"</span>   ,</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="dv">42</span>   , <span class="st">"42"</span>   ,</span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>    ag <span class="sc">==</span> <span class="fl">57.5</span> , <span class="st">"57.5"</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, rc <span class="sc">:</span><span class="er">=</span> <span class="fu">as.factor</span>(rc)]</span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[,</span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>  ag <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(ag, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"21"</span>, <span class="st">"42"</span>, <span class="st">"57.5"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb202-16"><a href="#cb202-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb202-17"><a href="#cb202-17" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, sg <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(sg)]</span>
<span id="cb202-18"><a href="#cb202-18" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, yr <span class="sc">:</span><span class="er">=</span> <span class="fu">factor</span>(yr, <span class="at">levels =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(yr)), <span class="at">ordered =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb202-19"><a href="#cb202-19" aria-hidden="true" tabindex="-1"></a>orcmatch_temp<span class="sc">$</span>norm_weights <span class="ot">&lt;-</span> orcmatch_temp<span class="sc">$</span>np <span class="sc">/</span> <span class="fu">mean</span>(orcmatch_temp<span class="sc">$</span>np)</span>
<span id="cb202-20"><a href="#cb202-20" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(orcmatch_temp[, .(yr, norm_weights, ag, sg)])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'matchdata', 'data.table' and 'data.frame': 14520 obs. of  4 variables:
 $ yr          : Ord.factor w/ 3 levels "2023"&lt;"2024"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...
 $ norm_weights: num  0.877 0.232 1.058 1.161 0.413 ...
 $ ag          : Ord.factor w/ 3 levels "21"&lt;"42"&lt;"57.5": 2 2 2 2 3 3 3 3 2 2 ...
 $ sg          : Factor w/ 2 levels "M","F": 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>orcmatch_temp[, treat <span class="sc">:</span><span class="er">=</span> <span class="fu">as.numeric</span>(ac <span class="sc">&gt;=</span> <span class="fu">median</span>(ac))]</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>modout <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rg,</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orcmatch_temp,</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"cbps"</span>,</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATC"</span>,</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.options =</span> <span class="fu">list</span>(<span class="at">method =</span><span class="st">"exact"</span>),</span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">FALSE</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>coefficients</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Treated
(Intercept)  1.074180658
ag.L        -0.023798449
ag.Q        -0.002682600
sgF         -0.039661234
yr.L         0.026371435
yr.Q         0.005070966
rg          -1.007400078</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>var</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              (Intercept)          ag.L          ag.Q           sgF
(Intercept)  0.0053016181  1.093081e-04  2.999696e-04 -1.010579e-04
ag.L         0.0001093081  3.349526e-04  1.156739e-04  4.132592e-05
ag.Q         0.0002999696  1.156739e-04  3.644225e-04  2.836486e-05
sgF         -0.0001010579  4.132592e-05  2.836486e-05  2.739531e-04
yr.L        -0.0000892365 -2.470722e-05 -6.279140e-06 -5.227314e-05
yr.Q        -0.0000971804  1.051907e-05  1.750383e-05 -5.736243e-06
rg          -0.0011899421  1.106198e-05  1.928462e-05  1.161580e-05
                     yr.L          yr.Q            rg
(Intercept) -8.923650e-05 -9.718040e-05 -1.189942e-03
ag.L        -2.470722e-05  1.051907e-05  1.106198e-05
ag.Q        -6.279140e-06  1.750383e-05  1.928462e-05
sgF         -5.227314e-05 -5.736243e-06  1.161580e-05
yr.L         2.962879e-04 -2.242514e-05  1.438637e-05
yr.Q        -2.242514e-05  3.020457e-04  2.828130e-05
rg           1.438637e-05  2.828130e-05  3.080084e-04</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>deviance</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19886.95</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>J</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0005695698</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>mle.J</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0005744275</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>method</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "exact"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>terms</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>treat ~ ag + sg + yr + rg
attr(,"variables")
list(treat, ag, sg, yr, rg)
attr(,"factors")
      ag sg yr rg
treat  0  0  0  0
ag     1  0  0  0
sg     0  1  0  0
yr     0  0  1  0
rg     0  0  0  1
attr(,"term.labels")
[1] "ag" "sg" "yr" "rg"
attr(,"order")
[1] 1 1 1 1
attr(,"intercept")
[1] 1
attr(,"response")
[1] 1
attr(,".Environment")
&lt;environment: R_GlobalEnv&gt;
attr(,"predvars")
list(treat, ag, sg, yr, rg)
attr(,"dataClasses")
    treat        ag        sg        yr        rg 
"numeric" "ordered"  "factor" "ordered" "numeric" </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>modout<span class="sc">$</span>model<span class="sc">$</span>formula</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>treat ~ ag + sg + yr + rg</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>modsum <span class="ot">&lt;-</span> <span class="fu">summary</span>(modout)</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modout)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = treat ~ ag + sg + yr + rg, data = orcmatch_temp, 
    distance = "cbps", distance.options = list(method = "exact"), 
    estimand = "ATC", replace = FALSE)

Summary of Balance for All Data:
         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance        0.4921        0.5079         -0.3482     2.7489    0.0295
ag21            0.1485        0.1485          0.0000          .    0.0000
ag42            0.7590        0.7590          0.0000          .    0.0000
ag57.5          0.0926        0.0926          0.0000          .    0.0000
sgM             0.8986        0.8986          0.0000          .    0.0000
sgF             0.1014        0.1014          0.0000          .    0.0000
yr2023          0.3150        0.3150          0.0000          .    0.0000
yr2024          0.3023        0.3023          0.0000          .    0.0000
yr2025          0.3826        0.3826          0.0000          .    0.0000
rg              1.1069        1.0375          0.3536     2.9272    0.0174
         eCDF Max
distance   0.0624
ag21       0.0000
ag42       0.0000
ag57.5     0.0000
sgM        0.0000
sgF        0.0000
yr2023     0.0000
yr2024     0.0000
yr2025     0.0000
rg         0.0624

Summary of Balance for Matched Data:
         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean
distance        0.4921        0.5079         -0.3482     2.7489    0.0295
ag21            0.1485        0.1485          0.0000          .    0.0000
ag42            0.7590        0.7590          0.0000          .    0.0000
ag57.5          0.0926        0.0926          0.0000          .    0.0000
sgM             0.8986        0.8986          0.0000          .    0.0000
sgF             0.1014        0.1014          0.0000          .    0.0000
yr2023          0.3150        0.3150          0.0000          .    0.0000
yr2024          0.3023        0.3023          0.0000          .    0.0000
yr2025          0.3826        0.3826          0.0000          .    0.0000
rg              1.1069        1.0375          0.3536     2.9272    0.0174
         eCDF Max Std. Pair Dist.
distance   0.0624          0.3675
ag21       0.0000          0.2231
ag42       0.0000          0.1686
ag57.5     0.0000          0.0747
sgM        0.0000          0.0339
sgF        0.0000          0.0339
yr2023     0.0000          0.1135
yr2024     0.0000          0.1521
yr2025     0.0000          0.1565
rg         0.0624          0.3536

Sample Sizes:
          Control Treated
All          7260    7260
Matched      7260    7260
Unmatched       0       0
Discarded       0       0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>modout1a <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> rg,</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orcmatch_temp,</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"gam"</span>,</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>modsum1a <span class="ot">&lt;-</span> <span class="fu">summary</span>(modout1a<span class="sc">$</span>model)</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modout1a<span class="sc">$</span>model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: quasibinomial 
Link function: logit 

Formula:
treat ~ ag + sg + yr + rg

Parametric coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.083370   0.078555 -13.791   &lt;2e-16 ***
ag.L         0.024002   0.049632   0.484    0.629    
ag.Q         0.002706   0.032627   0.083    0.934    
sgF          0.040001   0.055542   0.720    0.471    
yr.L        -0.026597   0.028592  -0.930    0.352    
yr.Q        -0.005114   0.029792  -0.172    0.864    
rg           1.016018   0.070606  14.390   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1


R-sq.(adj) =  0.0155   Deviance explained =  1.2%
GCV = 1.3709  Scale est. = 1.0005    n = 14520</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>p.score <span class="ot">&lt;-</span> <span class="fu">fitted</span>(<span class="fu">glm</span>(</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> norm_weights,</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orcmatch_temp,</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>modout1b <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> ag <span class="sc">+</span> sg <span class="sc">+</span> yr <span class="sc">+</span> norm_weights,</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orcmatch_temp,</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> p.score</span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>modsum1b <span class="ot">&lt;-</span> <span class="fu">summary</span>(modout1b<span class="sc">$</span>model)</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modout1b<span class="sc">$</span>model)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Length  Class   Mode 
     0   NULL   NULL </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>y1a <span class="ot">&lt;-</span> orcmatch_temp[orcmatch_temp<span class="sc">$</span>yr <span class="sc">==</span> <span class="dv">2023</span>, ]</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>y1b <span class="ot">&lt;-</span> orcmatch_temp[orcmatch_temp<span class="sc">$</span>yr <span class="sc">==</span> <span class="dv">2024</span>, ]</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>y1c <span class="ot">&lt;-</span> orcmatch_temp[orcmatch_temp<span class="sc">$</span>yr <span class="sc">==</span> <span class="dv">2025</span>, ]</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>full_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(vm <span class="sc">~</span> . <span class="sc">-</span> id, <span class="at">data =</span> orcmatch_temp)</span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>backstep <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(full_mod, <span class="at">direction =</span> <span class="st">"backward"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-47581.54
vm ~ (yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + 
    a8 + id + rc + norm_weights + treat) - id


Step:  AIC=-47581.54
vm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + a8 + 
    rc + treat


Step:  AIC=-47581.54
vm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + rc + 
    treat


Step:  AIC=-47581.54
vm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- a5     1       0.0  545.2 -47584
- a2     1       0.0  545.3 -47583
- yr     2       0.1  545.3 -47583
- ag     2       0.1  545.3 -47583
- a7     1       0.0  545.3 -47582
- sg     1       0.0  545.3 -47582
- a1     1       0.1  545.3 -47582
&lt;none&gt;                545.2 -47582
- np     1       0.2  545.4 -47579
- a4     1       0.3  545.5 -47576
- treat  1       8.0  553.2 -47373
- ac     1      19.5  564.7 -47073
- rc    23    5109.5 5654.7 -13665

Step:  AIC=-47583.52
vm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- a2     1       0.0  545.3 -47585
- yr     2       0.1  545.3 -47585
- ag     2       0.1  545.3 -47585
- a7     1       0.0  545.3 -47584
- sg     1       0.0  545.3 -47584
- a1     1       0.1  545.3 -47584
&lt;none&gt;                545.2 -47584
- np     1       0.2  545.4 -47581
- a4     1       0.3  545.5 -47578
- treat  1       8.0  553.2 -47375
- ac     1      19.6  564.8 -47073
- rc    23    5109.5 5654.7 -13667

Step:  AIC=-47585.1
vm ~ yr + ag + sg + np + ac + a1 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- yr     2       0.1  545.4 -47586
- ag     2       0.1  545.4 -47586
- a7     1       0.0  545.3 -47586
- a1     1       0.0  545.3 -47586
- sg     1       0.1  545.3 -47586
&lt;none&gt;                545.3 -47585
- np     1       0.2  545.4 -47583
- a4     1       0.3  545.5 -47580
- treat  1       8.0  553.2 -47377
- ac     1      19.7  564.9 -47072
- rc    23    5109.8 5655.0 -13668

Step:  AIC=-47586.25
vm ~ ag + sg + np + ac + a1 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- ag     2       0.1  545.5 -47587
- a7     1       0.0  545.4 -47587
- a1     1       0.1  545.4 -47587
- sg     1       0.1  545.4 -47587
&lt;none&gt;                545.4 -47586
- np     1       0.2  545.6 -47583
- a4     1       0.3  545.6 -47581
- treat  1       8.0  553.3 -47378
- ac     1      19.7  565.1 -47073
- rc    23    5120.1 5665.5 -13645

Step:  AIC=-47587.37
vm ~ sg + np + ac + a1 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- a7     1       0.0  545.5 -47588
- a1     1       0.1  545.5 -47588
- sg     1       0.1  545.5 -47588
&lt;none&gt;                545.5 -47587
- np     1       0.2  545.7 -47584
- a4     1       0.3  545.7 -47582
- treat  1       7.9  553.4 -47380
- ac     1      19.7  565.2 -47074
- rc    23    5123.0 5668.5 -13642

Step:  AIC=-47588.27
vm ~ sg + np + ac + a1 + a4 + rc + treat

        Df Sum of Sq    RSS    AIC
- a1     1       0.1  545.6 -47589
- sg     1       0.1  545.6 -47588
&lt;none&gt;                545.5 -47588
- np     1       0.2  545.7 -47585
- a4     1       0.3  545.8 -47583
- treat  1       8.0  553.5 -47380
- ac     1      20.0  565.5 -47068
- rc    23    5123.0 5668.5 -13644

Step:  AIC=-47588.87
vm ~ sg + np + ac + a4 + rc + treat

        Df Sum of Sq    RSS    AIC
- sg     1       0.1  545.6 -47589
&lt;none&gt;                545.6 -47589
- np     1       0.1  545.7 -47587
- a4     1       0.2  545.8 -47584
- treat  1       7.9  553.5 -47382
- ac     1      20.0  565.6 -47067
- rc    23    5123.4 5668.9 -13644

Step:  AIC=-47589.14
vm ~ np + ac + a4 + rc + treat

        Df Sum of Sq    RSS    AIC
&lt;none&gt;                545.6 -47589
- np     1       0.1  545.7 -47588
- a4     1       0.2  545.9 -47585
- treat  1       7.9  553.6 -47381
- ac     1      20.1  565.7 -47067
- rc    23    5130.8 5676.5 -13627</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>frontstep <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(vm <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> orcmatch_temp),</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">scope =</span> <span class="fu">formula</span>(full_mod),</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">"forward"</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-12930.38
vm ~ 1

               Df Sum of Sq    RSS    AIC
+ rc           23    5389.0  569.8 -46968
+ rg            1    5340.7  618.1 -45831
+ ac            1     227.6 5731.2 -13494
+ treat         1     126.4 5832.3 -13240
+ np            1      89.6 5869.2 -13148
+ norm_weights  1      89.6 5869.2 -13148
+ a1            1      45.0 5913.7 -13039
+ a8            1      18.2 5940.6 -12973
+ yr            2      15.4 5943.4 -12964
+ sg            1      11.3 5947.5 -12956
+ a7            1      11.2 5947.6 -12956
+ a4            1       8.9 5949.9 -12950
+ a5            1       8.4 5950.4 -12949
+ a2            1       3.9 5954.9 -12938
+ ag            2       2.8 5956.0 -12933
&lt;none&gt;                      5958.8 -12930

Step:  AIC=-46967.87
vm ~ rc

               Df Sum of Sq    RSS    AIC
+ ac            1   15.9938 553.80 -47379
+ treat         1    3.9094 565.88 -47066
+ a7            1    0.7024 569.09 -46984
+ a4            1    0.3932 569.40 -46976
+ a1            1    0.3331 569.46 -46974
+ a8            1    0.2641 569.53 -46973
+ a5            1    0.2088 569.59 -46971
+ np            1    0.1989 569.60 -46971
+ norm_weights  1    0.1989 569.60 -46971
+ a2            1    0.1469 569.65 -46970
+ sg            1    0.0931 569.70 -46968
&lt;none&gt;                      569.79 -46968
+ yr            2    0.1530 569.64 -46968
+ ag            2    0.0969 569.70 -46966

Step:  AIC=-47379.26
vm ~ rc + ac

               Df Sum of Sq    RSS    AIC
+ treat         1    7.8819 545.92 -47585
+ a8            1    0.1932 553.61 -47382
+ a4            1    0.0864 553.71 -47380
+ sg            1    0.0776 553.72 -47379
+ np            1    0.0770 553.72 -47379
+ norm_weights  1    0.0770 553.72 -47379
&lt;none&gt;                      553.80 -47379
+ yr            2    0.1402 553.66 -47379
+ a7            1    0.0472 553.75 -47379
+ ag            2    0.0987 553.70 -47378
+ a5            1    0.0169 553.78 -47378
+ a1            1    0.0114 553.79 -47378
+ a2            1    0.0004 553.80 -47377

Step:  AIC=-47585.4
vm ~ rc + ac + treat

               Df Sum of Sq    RSS    AIC
+ a8            1  0.232295 545.69 -47590
+ a4            1  0.169176 545.75 -47588
&lt;none&gt;                      545.92 -47585
+ yr            2  0.140836 545.78 -47585
+ sg            1  0.054487 545.86 -47585
+ np            1  0.049841 545.87 -47585
+ norm_weights  1  0.049841 545.87 -47585
+ ag            2  0.116231 545.80 -47584
+ a7            1  0.034851 545.88 -47584
+ a5            1  0.015094 545.90 -47584
+ a1            1  0.000607 545.92 -47583
+ a2            1  0.000040 545.92 -47583

Step:  AIC=-47589.58
vm ~ rc + ac + treat + a8

               Df Sum of Sq    RSS    AIC
+ a4            1  0.139125 545.55 -47591
&lt;none&gt;                      545.69 -47590
+ sg            1  0.068728 545.62 -47589
+ ag            2  0.115092 545.57 -47589
+ yr            2  0.111342 545.57 -47589
+ a7            1  0.025486 545.66 -47588
+ np            1  0.016027 545.67 -47588
+ norm_weights  1  0.016027 545.67 -47588
+ a5            1  0.009874 545.68 -47588
+ a1            1  0.004840 545.68 -47588
+ a2            1  0.000046 545.69 -47588

Step:  AIC=-47591.29
vm ~ rc + ac + treat + a8 + a4

               Df Sum of Sq    RSS    AIC
&lt;none&gt;                      545.55 -47591
+ sg            1  0.065830 545.48 -47591
+ yr            2  0.117365 545.43 -47590
+ ag            2  0.116097 545.43 -47590
+ a7            1  0.016300 545.53 -47590
+ a5            1  0.007400 545.54 -47589
+ a1            1  0.002675 545.54 -47589
+ np            1  0.001634 545.55 -47589
+ norm_weights  1  0.001634 545.55 -47589
+ a2            1  0.000120 545.55 -47589</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>bothstep <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(full_mod, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-47581.54
vm ~ (yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + 
    a8 + id + rc + norm_weights + treat) - id


Step:  AIC=-47581.54
vm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + a8 + 
    rc + treat


Step:  AIC=-47581.54
vm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + rc + 
    treat


Step:  AIC=-47581.54
vm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- a5     1       0.0  545.2 -47584
- a2     1       0.0  545.3 -47583
- yr     2       0.1  545.3 -47583
- ag     2       0.1  545.3 -47583
- a7     1       0.0  545.3 -47582
- sg     1       0.0  545.3 -47582
- a1     1       0.1  545.3 -47582
&lt;none&gt;                545.2 -47582
- np     1       0.2  545.4 -47579
- a4     1       0.3  545.5 -47576
- treat  1       8.0  553.2 -47373
- ac     1      19.5  564.7 -47073
- rc    23    5109.5 5654.7 -13665

Step:  AIC=-47583.52
vm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- a2     1       0.0  545.3 -47585
- yr     2       0.1  545.3 -47585
- ag     2       0.1  545.3 -47585
- a7     1       0.0  545.3 -47584
- sg     1       0.0  545.3 -47584
- a1     1       0.1  545.3 -47584
&lt;none&gt;                545.2 -47584
+ a5     1       0.0  545.2 -47582
+ a8     1       0.0  545.2 -47582
- np     1       0.2  545.4 -47581
- a4     1       0.3  545.5 -47578
- treat  1       8.0  553.2 -47375
- ac     1      19.6  564.8 -47073
- rc    23    5109.5 5654.7 -13667

Step:  AIC=-47585.1
vm ~ yr + ag + sg + np + ac + a1 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- yr     2       0.1  545.4 -47586
- ag     2       0.1  545.4 -47586
- a7     1       0.0  545.3 -47586
- a1     1       0.0  545.3 -47586
- sg     1       0.1  545.3 -47586
&lt;none&gt;                545.3 -47585
+ a2     1       0.0  545.2 -47584
+ a8     1       0.0  545.2 -47583
+ a5     1       0.0  545.3 -47583
- np     1       0.2  545.4 -47583
- a4     1       0.3  545.5 -47580
- treat  1       8.0  553.2 -47377
- ac     1      19.7  564.9 -47072
- rc    23    5109.8 5655.0 -13668

Step:  AIC=-47586.25
vm ~ ag + sg + np + ac + a1 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- ag     2       0.1  545.5 -47587
- a7     1       0.0  545.4 -47587
- a1     1       0.1  545.4 -47587
- sg     1       0.1  545.4 -47587
&lt;none&gt;                545.4 -47586
+ yr     2       0.1  545.3 -47585
+ a2     1       0.0  545.3 -47585
+ a8     1       0.0  545.3 -47585
+ a5     1       0.0  545.4 -47584
- np     1       0.2  545.6 -47583
- a4     1       0.3  545.6 -47581
- treat  1       8.0  553.3 -47378
- ac     1      19.7  565.1 -47073
- rc    23    5120.1 5665.5 -13645

Step:  AIC=-47587.37
vm ~ sg + np + ac + a1 + a4 + a7 + rc + treat

        Df Sum of Sq    RSS    AIC
- a7     1       0.0  545.5 -47588
- a1     1       0.1  545.5 -47588
- sg     1       0.1  545.5 -47588
&lt;none&gt;                545.5 -47587
+ ag     2       0.1  545.4 -47586
+ yr     2       0.1  545.4 -47586
+ a2     1       0.0  545.5 -47586
+ a8     1       0.0  545.5 -47586
+ a5     1       0.0  545.5 -47585
- np     1       0.2  545.7 -47584
- a4     1       0.3  545.7 -47582
- treat  1       7.9  553.4 -47380
- ac     1      19.7  565.2 -47074
- rc    23    5123.0 5668.5 -13642

Step:  AIC=-47588.27
vm ~ sg + np + ac + a1 + a4 + rc + treat

        Df Sum of Sq    RSS    AIC
- a1     1       0.1  545.6 -47589
- sg     1       0.1  545.6 -47588
&lt;none&gt;                545.5 -47588
+ a7     1       0.0  545.5 -47587
+ a8     1       0.0  545.5 -47587
+ ag     2       0.1  545.4 -47587
+ yr     2       0.1  545.4 -47587
+ a2     1       0.0  545.5 -47587
+ a5     1       0.0  545.5 -47586
- np     1       0.2  545.7 -47585
- a4     1       0.3  545.8 -47583
- treat  1       8.0  553.5 -47380
- ac     1      20.0  565.5 -47068
- rc    23    5123.0 5668.5 -13644

Step:  AIC=-47588.87
vm ~ sg + np + ac + a4 + rc + treat

        Df Sum of Sq    RSS    AIC
- sg     1       0.1  545.6 -47589
+ a8     1       0.1  545.5 -47589
&lt;none&gt;                545.6 -47589
+ a1     1       0.1  545.5 -47588
+ a7     1       0.0  545.5 -47588
+ yr     2       0.1  545.5 -47588
+ ag     2       0.1  545.5 -47588
- np     1       0.1  545.7 -47587
+ a5     1       0.0  545.6 -47587
+ a2     1       0.0  545.6 -47587
- a4     1       0.2  545.8 -47584
- treat  1       7.9  553.5 -47382
- ac     1      20.0  565.6 -47067
- rc    23    5123.4 5668.9 -13644

Step:  AIC=-47589.14
vm ~ np + ac + a4 + rc + treat

        Df Sum of Sq    RSS    AIC
+ a8     1       0.1  545.5 -47589
&lt;none&gt;                545.6 -47589
+ sg     1       0.1  545.6 -47589
+ a1     1       0.1  545.6 -47588
+ yr     2       0.1  545.5 -47588
+ ag     2       0.1  545.5 -47588
+ a7     1       0.0  545.6 -47588
- np     1       0.1  545.7 -47588
+ a2     1       0.0  545.6 -47587
+ a5     1       0.0  545.6 -47587
- a4     1       0.2  545.9 -47585
- treat  1       7.9  553.6 -47381
- ac     1      20.1  565.7 -47067
- rc    23    5130.8 5676.5 -13627

Step:  AIC=-47589.33
vm ~ np + ac + a4 + rc + treat + a8

        Df Sum of Sq    RSS    AIC
- np     1       0.0  545.5 -47591
&lt;none&gt;                545.5 -47589
- a8     1       0.1  545.6 -47589
+ sg     1       0.1  545.5 -47589
+ yr     2       0.1  545.4 -47588
+ ag     2       0.1  545.4 -47588
- a4     1       0.1  545.7 -47588
+ a7     1       0.0  545.5 -47588
+ a5     1       0.0  545.5 -47588
+ a1     1       0.0  545.5 -47587
+ a2     1       0.0  545.5 -47587
- treat  1       8.0  553.5 -47380
- ac     1      19.8  565.3 -47075
- rc    23    5130.8 5676.4 -13625

Step:  AIC=-47591.29
vm ~ ac + a4 + rc + treat + a8

               Df Sum of Sq    RSS    AIC
&lt;none&gt;                       545.5 -47591
+ sg            1       0.1  545.5 -47591
+ yr            2       0.1  545.4 -47590
+ ag            2       0.1  545.4 -47590
+ a7            1       0.0  545.5 -47590
- a4            1       0.1  545.7 -47590
+ a5            1       0.0  545.5 -47589
+ a1            1       0.0  545.5 -47589
+ np            1       0.0  545.5 -47589
+ norm_weights  1       0.0  545.5 -47589
+ a2            1       0.0  545.5 -47589
- a8            1       0.2  545.7 -47588
- treat         1       8.0  553.5 -47382
- ac            1      20.0  565.5 -47072
- rc           23    5152.2 5697.7 -13573</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(backstep)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vm ~ np + ac + a4 + rc + treat, data = orcmatch_temp)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.4488  0.0016  0.0092  0.0154  3.5834 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                             -1.168e-01  5.642e-03 -20.696   &lt;2e-16
np                                      -5.533e-05  3.079e-05  -1.797   0.0724
ac                                       1.037e-01  4.491e-03  23.082   &lt;2e-16
a4                                       2.232e-04  8.826e-05   2.529   0.0114
rcCentral + Eastern                      2.184e+00  1.789e-02 122.061   &lt;2e-16
rcCentral + Eastern + Toronto            4.007e+00  3.751e-02 106.830   &lt;2e-16
rcCentral + Eastern + Toronto + Western  6.534e+00  1.122e-01  58.231   &lt;2e-16
rcCentral + Eastern + Western            3.504e+00  5.863e-02  59.751   &lt;2e-16
rcCentral + Northern                     2.332e+00  3.819e-02  61.048   &lt;2e-16
rcCentral + Northern + Toronto           2.938e+00  1.121e-01  26.206   &lt;2e-16
rcCentral + Northern + Western           3.161e+00  8.685e-02  36.391   &lt;2e-16
rcCentral + Toronto                      2.358e+00  1.248e-02 189.016   &lt;2e-16
rcCentral + Toronto + Western            4.087e+00  6.480e-02  63.062   &lt;2e-16
rcCentral + Western                      2.144e+00  1.628e-02 131.673   &lt;2e-16
rcEastern                               -5.784e-03  4.493e-03  -1.287   0.1980
rcEastern + Northern                     2.194e+00  4.247e-02  51.658   &lt;2e-16
rcEastern + Northern + Toronto           3.969e+00  1.121e-01  35.412   &lt;2e-16
rcEastern + Northern + Western           4.007e+00  1.941e-01  20.645   &lt;2e-16
rcEastern + Toronto                      2.283e+00  1.495e-02 152.686   &lt;2e-16
rcEastern + Toronto + Western            3.255e+00  9.710e-02  33.522   &lt;2e-16
rcEastern + Western                      2.443e+00  2.946e-02  82.920   &lt;2e-16
rcNorthern                              -3.973e-03  5.530e-03  -0.718   0.4725
rcNorthern + Toronto                     2.065e+00  2.852e-02  72.397   &lt;2e-16
rcNorthern + Western                     2.188e+00  3.501e-02  62.497   &lt;2e-16
rcToronto                                2.635e-05  5.278e-03   0.005   0.9960
rcToronto + Western                      1.985e+00  3.251e-02  61.066   &lt;2e-16
rcWestern                                4.298e-03  5.299e-03   0.811   0.4173
treat                                   -9.167e-02  6.309e-03 -14.529   &lt;2e-16
                                           
(Intercept)                             ***
np                                      .  
ac                                      ***
a4                                      *  
rcCentral + Eastern                     ***
rcCentral + Eastern + Toronto           ***
rcCentral + Eastern + Toronto + Western ***
rcCentral + Eastern + Western           ***
rcCentral + Northern                    ***
rcCentral + Northern + Toronto          ***
rcCentral + Northern + Western          ***
rcCentral + Toronto                     ***
rcCentral + Toronto + Western           ***
rcCentral + Western                     ***
rcEastern                                  
rcEastern + Northern                    ***
rcEastern + Northern + Toronto          ***
rcEastern + Northern + Western          ***
rcEastern + Toronto                     ***
rcEastern + Toronto + Western           ***
rcEastern + Western                     ***
rcNorthern                                 
rcNorthern + Toronto                    ***
rcNorthern + Western                    ***
rcToronto                                  
rcToronto + Western                     ***
rcWestern                                  
treat                                   ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.194 on 14492 degrees of freedom
Multiple R-squared:  0.9084,    Adjusted R-squared:  0.9083 
F-statistic:  5325 on 27 and 14492 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(frontstep)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vm ~ rc + ac + treat + a8 + a4, data = orcmatch_temp)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.4529  0.0017  0.0088  0.0154  3.5834 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                             -1.157e-01  5.683e-03 -20.361   &lt;2e-16
rcCentral + Eastern                      2.184e+00  1.789e-02 122.074   &lt;2e-16
rcCentral + Eastern + Toronto            4.006e+00  3.750e-02 106.817   &lt;2e-16
rcCentral + Eastern + Toronto + Western  6.536e+00  1.122e-01  58.250   &lt;2e-16
rcCentral + Eastern + Western            3.503e+00  5.862e-02  59.761   &lt;2e-16
rcCentral + Northern                     2.331e+00  3.819e-02  61.051   &lt;2e-16
rcCentral + Northern + Toronto           2.937e+00  1.121e-01  26.200   &lt;2e-16
rcCentral + Northern + Western           3.160e+00  8.685e-02  36.389   &lt;2e-16
rcCentral + Toronto                      2.358e+00  1.247e-02 189.137   &lt;2e-16
rcCentral + Toronto + Western            4.087e+00  6.479e-02  63.083   &lt;2e-16
rcCentral + Western                      2.144e+00  1.627e-02 131.765   &lt;2e-16
rcEastern                               -6.046e-03  4.482e-03  -1.349   0.1773
rcEastern + Northern                     2.193e+00  4.246e-02  51.654   &lt;2e-16
rcEastern + Northern + Toronto           3.971e+00  1.121e-01  35.429   &lt;2e-16
rcEastern + Northern + Western           4.010e+00  1.941e-01  20.663   &lt;2e-16
rcEastern + Toronto                      2.283e+00  1.494e-02 152.755   &lt;2e-16
rcEastern + Toronto + Western            3.255e+00  9.710e-02  33.524   &lt;2e-16
rcEastern + Western                      2.442e+00  2.946e-02  82.896   &lt;2e-16
rcNorthern                              -4.247e-03  5.531e-03  -0.768   0.4426
rcNorthern + Toronto                     2.065e+00  2.852e-02  72.413   &lt;2e-16
rcNorthern + Western                     2.188e+00  3.500e-02  62.496   &lt;2e-16
rcToronto                               -2.079e-04  5.278e-03  -0.039   0.9686
rcToronto + Western                      1.985e+00  3.251e-02  61.069   &lt;2e-16
rcWestern                                4.082e-03  5.297e-03   0.771   0.4409
ac                                       1.031e-01  4.477e-03  23.023   &lt;2e-16
treat                                   -9.194e-02  6.309e-03 -14.572   &lt;2e-16
a8                                      -9.117e-05  3.933e-05  -2.318   0.0205
a4                                       1.638e-04  8.519e-05   1.922   0.0546
                                           
(Intercept)                             ***
rcCentral + Eastern                     ***
rcCentral + Eastern + Toronto           ***
rcCentral + Eastern + Toronto + Western ***
rcCentral + Eastern + Western           ***
rcCentral + Northern                    ***
rcCentral + Northern + Toronto          ***
rcCentral + Northern + Western          ***
rcCentral + Toronto                     ***
rcCentral + Toronto + Western           ***
rcCentral + Western                     ***
rcEastern                                  
rcEastern + Northern                    ***
rcEastern + Northern + Toronto          ***
rcEastern + Northern + Western          ***
rcEastern + Toronto                     ***
rcEastern + Toronto + Western           ***
rcEastern + Western                     ***
rcNorthern                                 
rcNorthern + Toronto                    ***
rcNorthern + Western                    ***
rcToronto                                  
rcToronto + Western                     ***
rcWestern                                  
ac                                      ***
treat                                   ***
a8                                      *  
a4                                      .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.194 on 14492 degrees of freedom
Multiple R-squared:  0.9084,    Adjusted R-squared:  0.9083 
F-statistic:  5326 on 27 and 14492 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bothstep)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = vm ~ ac + a4 + rc + treat + a8, data = orcmatch_temp)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.4529  0.0017  0.0088  0.0154  3.5834 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                             -1.157e-01  5.683e-03 -20.361   &lt;2e-16
ac                                       1.031e-01  4.477e-03  23.023   &lt;2e-16
a4                                       1.638e-04  8.519e-05   1.922   0.0546
rcCentral + Eastern                      2.184e+00  1.789e-02 122.074   &lt;2e-16
rcCentral + Eastern + Toronto            4.006e+00  3.750e-02 106.817   &lt;2e-16
rcCentral + Eastern + Toronto + Western  6.536e+00  1.122e-01  58.250   &lt;2e-16
rcCentral + Eastern + Western            3.503e+00  5.862e-02  59.761   &lt;2e-16
rcCentral + Northern                     2.331e+00  3.819e-02  61.051   &lt;2e-16
rcCentral + Northern + Toronto           2.937e+00  1.121e-01  26.200   &lt;2e-16
rcCentral + Northern + Western           3.160e+00  8.685e-02  36.389   &lt;2e-16
rcCentral + Toronto                      2.358e+00  1.247e-02 189.137   &lt;2e-16
rcCentral + Toronto + Western            4.087e+00  6.479e-02  63.083   &lt;2e-16
rcCentral + Western                      2.144e+00  1.627e-02 131.765   &lt;2e-16
rcEastern                               -6.046e-03  4.482e-03  -1.349   0.1773
rcEastern + Northern                     2.193e+00  4.246e-02  51.654   &lt;2e-16
rcEastern + Northern + Toronto           3.971e+00  1.121e-01  35.429   &lt;2e-16
rcEastern + Northern + Western           4.010e+00  1.941e-01  20.663   &lt;2e-16
rcEastern + Toronto                      2.283e+00  1.494e-02 152.755   &lt;2e-16
rcEastern + Toronto + Western            3.255e+00  9.710e-02  33.524   &lt;2e-16
rcEastern + Western                      2.442e+00  2.946e-02  82.896   &lt;2e-16
rcNorthern                              -4.247e-03  5.531e-03  -0.768   0.4426
rcNorthern + Toronto                     2.065e+00  2.852e-02  72.413   &lt;2e-16
rcNorthern + Western                     2.188e+00  3.500e-02  62.496   &lt;2e-16
rcToronto                               -2.079e-04  5.278e-03  -0.039   0.9686
rcToronto + Western                      1.985e+00  3.251e-02  61.069   &lt;2e-16
rcWestern                                4.082e-03  5.297e-03   0.771   0.4409
treat                                   -9.194e-02  6.309e-03 -14.572   &lt;2e-16
a8                                      -9.117e-05  3.933e-05  -2.318   0.0205
                                           
(Intercept)                             ***
ac                                      ***
a4                                      .  
rcCentral + Eastern                     ***
rcCentral + Eastern + Toronto           ***
rcCentral + Eastern + Toronto + Western ***
rcCentral + Eastern + Western           ***
rcCentral + Northern                    ***
rcCentral + Northern + Toronto          ***
rcCentral + Northern + Western          ***
rcCentral + Toronto                     ***
rcCentral + Toronto + Western           ***
rcCentral + Western                     ***
rcEastern                                  
rcEastern + Northern                    ***
rcEastern + Northern + Toronto          ***
rcEastern + Northern + Western          ***
rcEastern + Toronto                     ***
rcEastern + Toronto + Western           ***
rcEastern + Western                     ***
rcNorthern                                 
rcNorthern + Toronto                    ***
rcNorthern + Western                    ***
rcToronto                                  
rcToronto + Western                     ***
rcWestern                                  
treat                                   ***
a8                                      *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.194 on 14492 degrees of freedom
Multiple R-squared:  0.9084,    Adjusted R-squared:  0.9083 
F-statistic:  5326 on 27 and 14492 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(bothstep)</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>abs_t <span class="ot">&lt;-</span> <span class="fu">sort</span>(</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>(<span class="fu">summary</span>(bothstep)<span class="sc">$</span>coefficients[, <span class="st">"t value"</span>]),</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">decreasing =</span> <span class="cn">TRUE</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(abs_t)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    rcCentral + Toronto                     rcEastern + Toronto 
                           189.13684688                            152.75510003 
                    rcCentral + Western                     rcCentral + Eastern 
                           131.76467803                            122.07365301 
          rcCentral + Eastern + Toronto                     rcEastern + Western 
                           106.81715727                             82.89618520 
                   rcNorthern + Toronto           rcCentral + Toronto + Western 
                            72.41282325                             63.08289090 
                   rcNorthern + Western                     rcToronto + Western 
                            62.49575446                             61.06891525 
                   rcCentral + Northern           rcCentral + Eastern + Western 
                            61.05089828                             59.76090767 
rcCentral + Eastern + Toronto + Western                    rcEastern + Northern 
                            58.25037221                             51.65369553 
         rcCentral + Northern + Western          rcEastern + Northern + Toronto 
                            36.38941150                             35.42944826 
          rcEastern + Toronto + Western          rcCentral + Northern + Toronto 
                            33.52431600                             26.19996817 
                                     ac          rcEastern + Northern + Western 
                            23.02250346                             20.66306816 
                            (Intercept)                                   treat 
                            20.36090376                             14.57178211 
                                     a8                                      a4 
                             2.31785814                              1.92243389 
                              rcEastern                               rcWestern 
                             1.34910662                              0.77074141 
                             rcNorthern                               rcToronto 
                             0.76786860                              0.03939446 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bothstep, <span class="at">ask =</span> <span class="cn">FALSE</span>, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>  bothstep,</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Variables selected in Stepwise Regression Model"</span>,</span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subtitle =</span> <span class="st">"vm ~ ac + a4 + rc + treatment + a8"</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bothstep, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Model Fit"</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  bothstep,</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Target Predictors from Stepwise Regression"</span>,</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sort.est =</span> <span class="cn">FALSE</span>,</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">show.values =</span> <span class="cn">TRUE</span>,</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value.offset =</span> <span class="fl">0.4</span>,</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"std"</span></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>final_covariates <span class="ot">&lt;-</span> <span class="fu">formula</span>(bothstep)</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(final_covariates)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>vm ~ ac + a4 + rc + treat + a8</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">36825994</span>)</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>fmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(treat <span class="sc">~</span> . <span class="sc">-</span> id <span class="sc">-</span> vm, <span class="at">data =</span> orcmatch_temp)</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>bstepz <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(fmod, <span class="at">direction =</span> <span class="st">"backward"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-39611.14
treat ~ (yr + ag + sg + np + ac + rg + vm + a1 + a2 + a4 + a5 + 
    a7 + a8 + id + rc + norm_weights) - id - vm


Step:  AIC=-39611.14
treat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + 
    a8 + rc


Step:  AIC=-39611.14
treat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + 
    rc


Step:  AIC=-39611.14
treat ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- yr    2      0.00  944.2 -39615
- ag    2      0.10  944.2 -39614
- a2    1      0.00  944.1 -39613
- a5    1      0.06  944.2 -39612
- np    1      0.07  944.2 -39612
&lt;none&gt;               944.1 -39611
- a7    1      0.23  944.4 -39610
- sg    1      0.29  944.4 -39609
- a1    1      0.93  945.1 -39599
- a4    1      1.90  946.1 -39584
- rc   23      5.73  949.9 -39569
- ac    1   2363.05 3307.2 -21411

Step:  AIC=-39615.06
treat ~ ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- ag    2      0.10  944.3 -39618
- a2    1      0.00  944.2 -39617
- a5    1      0.06  944.2 -39616
- np    1      0.07  944.2 -39616
&lt;none&gt;               944.2 -39615
- a7    1      0.23  944.4 -39614
- sg    1      0.28  944.4 -39613
- a1    1      0.94  945.1 -39603
- a4    1      1.91  946.1 -39588
- rc   23      5.74  949.9 -39573
- ac    1   2366.23 3310.4 -21401

Step:  AIC=-39617.5
treat ~ sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- a2    1      0.00  944.3 -39619
- a5    1      0.06  944.3 -39619
- np    1      0.07  944.3 -39618
&lt;none&gt;               944.3 -39618
- a7    1      0.23  944.5 -39616
- sg    1      0.27  944.5 -39615
- a1    1      0.94  945.2 -39605
- a4    1      1.91  946.2 -39590
- rc   23      5.72  950.0 -39576
- ac    1   2366.36 3310.6 -21404

Step:  AIC=-39619.49
treat ~ sg + np + ac + a1 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- a5    1      0.06  944.3 -39621
- np    1      0.08  944.3 -39620
&lt;none&gt;               944.3 -39619
- a7    1      0.23  944.5 -39618
- sg    1      0.27  944.5 -39617
- a1    1      0.99  945.2 -39606
- a4    1      1.93  946.2 -39592
- rc   23      5.72  950.0 -39578
- ac    1   2382.55 3326.8 -21335

Step:  AIC=-39620.58
treat ~ sg + np + ac + a1 + a4 + a7 + rc

       Df Sum of Sq    RSS    AIC
- np    1      0.06  944.4 -39622
&lt;none&gt;               944.3 -39621
- a7    1      0.24  944.6 -39619
- sg    1      0.27  944.6 -39618
- a1    1      0.94  945.3 -39608
- a4    1      1.88  946.2 -39594
- rc   23      5.73  950.0 -39579
- ac    1   2441.60 3385.9 -21082

Step:  AIC=-39621.66
treat ~ sg + ac + a1 + a4 + a7 + rc

       Df Sum of Sq    RSS    AIC
&lt;none&gt;               944.4 -39622
- a7    1      0.27  944.6 -39619
- sg    1      0.29  944.7 -39619
- a1    1      1.00  945.4 -39608
- a4    1      1.87  946.2 -39595
- rc   23      5.87  950.2 -39578
- ac    1   2450.06 3394.4 -21047</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>fstepz <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(</span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(treat <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> orcmatch_temp),</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">scope =</span> <span class="fu">formula</span>(fmod),</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">"forward"</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-20126.99
treat ~ 1

               Df Sum of Sq    RSS    AIC
+ ac            1   2677.37  952.6 -39549
+ norm_weights  1    114.94 3515.1 -20592
+ np            1    114.94 3515.1 -20592
+ a1            1    104.80 3525.2 -20550
+ a7            1     63.16 3566.8 -20380
+ a5            1     62.07 3567.9 -20375
+ rc           23     70.94 3559.1 -20368
+ rg            1     56.88 3573.1 -20354
+ a4            1     35.41 3594.6 -20267
+ a2            1     23.32 3606.7 -20219
+ a8            1      0.59 3629.4 -20127
&lt;none&gt;                      3630.0 -20127
+ sg            1      0.00 3630.0 -20125
+ yr            2      0.00 3630.0 -20123
+ ag            2      0.00 3630.0 -20123

Step:  AIC=-39549.22
treat ~ ac

               Df Sum of Sq    RSS    AIC
+ rc           23    5.1441 947.49 -39582
+ a4            1    1.3992 951.24 -39569
+ a1            1    0.5435 952.09 -39556
+ a8            1    0.3666 952.27 -39553
&lt;none&gt;                      952.63 -39549
+ sg            1    0.1257 952.51 -39549
+ np            1    0.1108 952.52 -39549
+ norm_weights  1    0.1108 952.52 -39549
+ a7            1    0.1060 952.53 -39549
+ rg            1    0.0486 952.59 -39548
+ a2            1    0.0307 952.60 -39548
+ a5            1    0.0050 952.63 -39547
+ ag            2    0.0737 952.56 -39546
+ yr            2    0.0026 952.63 -39545

Step:  AIC=-39581.84
treat ~ ac + rc

               Df Sum of Sq    RSS    AIC
+ a4            1   1.64733 945.84 -39605
+ a1            1   0.81461 946.68 -39592
+ np            1   0.35315 947.14 -39585
+ norm_weights  1   0.35315 947.14 -39585
+ sg            1   0.24603 947.24 -39584
+ a8            1   0.21604 947.27 -39583
&lt;none&gt;                      947.49 -39582
+ a7            1   0.11160 947.38 -39582
+ a2            1   0.01858 947.47 -39580
+ a5            1   0.00582 947.48 -39580
+ ag            2   0.08668 947.40 -39579
+ yr            2   0.00137 947.49 -39578

Step:  AIC=-39605.1
treat ~ ac + rc + a4

               Df Sum of Sq    RSS    AIC
+ a1            1   0.90828 944.94 -39617
+ sg            1   0.25827 945.59 -39607
+ a7            1   0.20460 945.64 -39606
&lt;none&gt;                      945.84 -39605
+ a8            1   0.12956 945.71 -39605
+ np            1   0.06411 945.78 -39604
+ norm_weights  1   0.06411 945.78 -39604
+ a2            1   0.02345 945.82 -39603
+ a5            1   0.01620 945.83 -39603
+ ag            2   0.08950 945.75 -39602
+ yr            2   0.00113 945.84 -39601

Step:  AIC=-39617.05
treat ~ ac + rc + a4 + a1

               Df Sum of Sq    RSS    AIC
+ sg            1  0.285580 944.65 -39619
+ a7            1  0.271186 944.66 -39619
&lt;none&gt;                      944.94 -39617
+ np            1  0.114428 944.82 -39617
+ norm_weights  1  0.114428 944.82 -39617
+ a8            1  0.072427 944.86 -39616
+ a5            1  0.037751 944.90 -39616
+ a2            1  0.007321 944.93 -39615
+ ag            2  0.091240 944.84 -39614
+ yr            2  0.006384 944.93 -39613

Step:  AIC=-39619.44
treat ~ ac + rc + a4 + a1 + sg

               Df Sum of Sq    RSS    AIC
+ a7            1  0.274550 944.37 -39622
&lt;none&gt;                      944.65 -39619
+ np            1  0.091537 944.56 -39619
+ norm_weights  1  0.091537 944.56 -39619
+ a8            1  0.055695 944.59 -39618
+ a5            1  0.040227 944.61 -39618
+ a2            1  0.004945 944.64 -39618
+ ag            2  0.106140 944.54 -39617
+ yr            2  0.014561 944.63 -39616

Step:  AIC=-39621.66
treat ~ ac + rc + a4 + a1 + sg + a7

               Df Sum of Sq    RSS    AIC
&lt;none&gt;                      944.37 -39622
+ a8            1  0.066835 944.31 -39621
+ np            1  0.059571 944.32 -39621
+ norm_weights  1  0.059571 944.32 -39621
+ a5            1  0.035854 944.34 -39620
+ a2            1  0.007461 944.37 -39620
+ ag            2  0.104758 944.27 -39619
+ yr            2  0.010153 944.36 -39618</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>bothstepz <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">step</span>(fmod, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=-39611.14
treat ~ (yr + ag + sg + np + ac + rg + vm + a1 + a2 + a4 + a5 + 
    a7 + a8 + id + rc + norm_weights) - id - vm


Step:  AIC=-39611.14
treat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + 
    a8 + rc


Step:  AIC=-39611.14
treat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + 
    rc


Step:  AIC=-39611.14
treat ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- yr    2      0.00  944.2 -39615
- ag    2      0.10  944.2 -39614
- a2    1      0.00  944.1 -39613
- a5    1      0.06  944.2 -39612
- np    1      0.07  944.2 -39612
&lt;none&gt;               944.1 -39611
- a7    1      0.23  944.4 -39610
- sg    1      0.29  944.4 -39609
- a1    1      0.93  945.1 -39599
- a4    1      1.90  946.1 -39584
- rc   23      5.73  949.9 -39569
- ac    1   2363.05 3307.2 -21411

Step:  AIC=-39615.06
treat ~ ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- ag    2      0.10  944.3 -39618
- a2    1      0.00  944.2 -39617
- a5    1      0.06  944.2 -39616
- np    1      0.07  944.2 -39616
&lt;none&gt;               944.2 -39615
- a7    1      0.23  944.4 -39614
- sg    1      0.28  944.4 -39613
+ yr    2      0.00  944.1 -39611
- a1    1      0.94  945.1 -39603
- a4    1      1.91  946.1 -39588
- rc   23      5.74  949.9 -39573
- ac    1   2366.23 3310.4 -21401

Step:  AIC=-39617.5
treat ~ sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- a2    1      0.00  944.3 -39619
- a5    1      0.06  944.3 -39619
- np    1      0.07  944.3 -39618
&lt;none&gt;               944.3 -39618
- a7    1      0.23  944.5 -39616
- sg    1      0.27  944.5 -39615
+ ag    2      0.10  944.2 -39615
+ yr    2      0.01  944.2 -39614
- a1    1      0.94  945.2 -39605
- a4    1      1.91  946.2 -39590
- rc   23      5.72  950.0 -39576
- ac    1   2366.36 3310.6 -21404

Step:  AIC=-39619.49
treat ~ sg + np + ac + a1 + a4 + a5 + a7 + rc

       Df Sum of Sq    RSS    AIC
- a5    1      0.06  944.3 -39621
- np    1      0.08  944.3 -39620
&lt;none&gt;               944.3 -39619
- a7    1      0.23  944.5 -39618
+ a2    1      0.00  944.3 -39618
+ a8    1      0.00  944.3 -39618
- sg    1      0.27  944.5 -39617
+ ag    2      0.10  944.2 -39617
+ yr    2      0.01  944.3 -39616
- a1    1      0.99  945.2 -39606
- a4    1      1.93  946.2 -39592
- rc   23      5.72  950.0 -39578
- ac    1   2382.55 3326.8 -21335

Step:  AIC=-39620.58
treat ~ sg + np + ac + a1 + a4 + a7 + rc

       Df Sum of Sq    RSS    AIC
- np    1      0.06  944.4 -39622
&lt;none&gt;               944.3 -39621
+ a5    1      0.06  944.3 -39619
- a7    1      0.24  944.6 -39619
+ a8    1      0.01  944.3 -39619
+ a2    1      0.00  944.3 -39619
- sg    1      0.27  944.6 -39618
+ ag    2      0.10  944.2 -39618
+ yr    2      0.01  944.3 -39617
- a1    1      0.94  945.3 -39608
- a4    1      1.88  946.2 -39594
- rc   23      5.73  950.0 -39579
- ac    1   2441.60 3385.9 -21082

Step:  AIC=-39621.66
treat ~ sg + ac + a1 + a4 + a7 + rc

               Df Sum of Sq    RSS    AIC
&lt;none&gt;                       944.4 -39622
+ a8            1      0.07  944.3 -39621
+ np            1      0.06  944.3 -39621
+ norm_weights  1      0.06  944.3 -39621
+ a5            1      0.04  944.3 -39620
+ a2            1      0.01  944.4 -39620
- a7            1      0.27  944.6 -39619
+ ag            2      0.10  944.3 -39619
- sg            1      0.29  944.7 -39619
+ yr            2      0.01  944.4 -39618
- a1            1      1.00  945.4 -39608
- a4            1      1.87  946.2 -39595
- rc           23      5.87  950.2 -39578
- ac            1   2450.06 3394.4 -21047</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>stepform <span class="ot">&lt;-</span> <span class="fu">formula</span>(bothstepz)</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(stepform)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>treat ~ sg + ac + a1 + a4 + a7 + rc</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bstepz)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1814 -0.1378 -0.1044  0.2558  0.4331 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                             -0.4681377  0.0063124 -74.161  &lt; 2e-16
sgF                                      0.0153125  0.0072721   2.106 0.035253
ac                                       0.6059280  0.0031250 193.894  &lt; 2e-16
a1                                       0.0002449  0.0000624   3.924 8.74e-05
a4                                       0.0006013  0.0001122   5.360 8.46e-08
a7                                      -0.0006034  0.0002940  -2.053 0.040137
rcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594
rcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479
rcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168
rcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775
rcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285
rcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409
rcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321
rcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426
rcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676
rcCentral + Western                      0.0307709  0.0213937   1.438 0.150365
rcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09
rcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343
rcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472
rcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935
rcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546
rcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134
rcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755
rcNorthern                              -0.0047978  0.0073647  -0.651 0.514756
rcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573
rcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769
rcToronto                               -0.0132884  0.0069503  -1.912 0.055906
rcToronto + Western                      0.0296455  0.0427685   0.693 0.488219
rcWestern                                0.0020497  0.0070114   0.292 0.770035
                                           
(Intercept)                             ***
sgF                                     *  
ac                                      ***
a1                                      ***
a4                                      ***
a7                                      *  
rcCentral + Eastern                     ***
rcCentral + Eastern + Toronto              
rcCentral + Eastern + Toronto + Western ***
rcCentral + Eastern + Western              
rcCentral + Northern                       
rcCentral + Northern + Toronto          .  
rcCentral + Northern + Western             
rcCentral + Toronto                     .  
rcCentral + Toronto + Western              
rcCentral + Western                        
rcEastern                               ***
rcEastern + Northern                       
rcEastern + Northern + Toronto             
rcEastern + Northern + Western             
rcEastern + Toronto                     .  
rcEastern + Toronto + Western              
rcEastern + Western                        
rcNorthern                                 
rcNorthern + Toronto                       
rcNorthern + Western                       
rcToronto                               .  
rcToronto + Western                        
rcWestern                                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2553 on 14491 degrees of freedom
Multiple R-squared:  0.7398,    Adjusted R-squared:  0.7393 
F-statistic:  1472 on 28 and 14491 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fstepz)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = treat ~ ac + rc + a4 + a1 + sg + a7, data = orcmatch_temp)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1814 -0.1378 -0.1044  0.2558  0.4331 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                             -0.4681377  0.0063124 -74.161  &lt; 2e-16
ac                                       0.6059280  0.0031250 193.894  &lt; 2e-16
rcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594
rcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479
rcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168
rcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775
rcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285
rcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409
rcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321
rcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426
rcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676
rcCentral + Western                      0.0307709  0.0213937   1.438 0.150365
rcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09
rcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343
rcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472
rcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935
rcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546
rcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134
rcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755
rcNorthern                              -0.0047978  0.0073647  -0.651 0.514756
rcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573
rcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769
rcToronto                               -0.0132884  0.0069503  -1.912 0.055906
rcToronto + Western                      0.0296455  0.0427685   0.693 0.488219
rcWestern                                0.0020497  0.0070114   0.292 0.770035
a4                                       0.0006013  0.0001122   5.360 8.46e-08
a1                                       0.0002449  0.0000624   3.924 8.74e-05
sgF                                      0.0153125  0.0072721   2.106 0.035253
a7                                      -0.0006034  0.0002940  -2.053 0.040137
                                           
(Intercept)                             ***
ac                                      ***
rcCentral + Eastern                     ***
rcCentral + Eastern + Toronto              
rcCentral + Eastern + Toronto + Western ***
rcCentral + Eastern + Western              
rcCentral + Northern                       
rcCentral + Northern + Toronto          .  
rcCentral + Northern + Western             
rcCentral + Toronto                     .  
rcCentral + Toronto + Western              
rcCentral + Western                        
rcEastern                               ***
rcEastern + Northern                       
rcEastern + Northern + Toronto             
rcEastern + Northern + Western             
rcEastern + Toronto                     .  
rcEastern + Toronto + Western              
rcEastern + Western                        
rcNorthern                                 
rcNorthern + Toronto                       
rcNorthern + Western                       
rcToronto                               .  
rcToronto + Western                        
rcWestern                                  
a4                                      ***
a1                                      ***
sgF                                     *  
a7                                      *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2553 on 14491 degrees of freedom
Multiple R-squared:  0.7398,    Adjusted R-squared:  0.7393 
F-statistic:  1472 on 28 and 14491 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bothstepz)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1814 -0.1378 -0.1044  0.2558  0.4331 

Coefficients:
                                          Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)                             -0.4681377  0.0063124 -74.161  &lt; 2e-16
sgF                                      0.0153125  0.0072721   2.106 0.035253
ac                                       0.6059280  0.0031250 193.894  &lt; 2e-16
a1                                       0.0002449  0.0000624   3.924 8.74e-05
a4                                       0.0006013  0.0001122   5.360 8.46e-08
a7                                      -0.0006034  0.0002940  -2.053 0.040137
rcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594
rcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479
rcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168
rcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775
rcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285
rcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409
rcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321
rcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426
rcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676
rcCentral + Western                      0.0307709  0.0213937   1.438 0.150365
rcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09
rcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343
rcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472
rcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935
rcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546
rcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134
rcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755
rcNorthern                              -0.0047978  0.0073647  -0.651 0.514756
rcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573
rcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769
rcToronto                               -0.0132884  0.0069503  -1.912 0.055906
rcToronto + Western                      0.0296455  0.0427685   0.693 0.488219
rcWestern                                0.0020497  0.0070114   0.292 0.770035
                                           
(Intercept)                             ***
sgF                                     *  
ac                                      ***
a1                                      ***
a4                                      ***
a7                                      *  
rcCentral + Eastern                     ***
rcCentral + Eastern + Toronto              
rcCentral + Eastern + Toronto + Western ***
rcCentral + Eastern + Western              
rcCentral + Northern                       
rcCentral + Northern + Toronto          .  
rcCentral + Northern + Western             
rcCentral + Toronto                     .  
rcCentral + Toronto + Western              
rcCentral + Western                        
rcEastern                               ***
rcEastern + Northern                       
rcEastern + Northern + Toronto             
rcEastern + Northern + Western             
rcEastern + Toronto                     .  
rcEastern + Toronto + Western              
rcEastern + Western                        
rcNorthern                                 
rcNorthern + Toronto                       
rcNorthern + Western                       
rcToronto                               .  
rcToronto + Western                        
rcWestern                                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2553 on 14491 degrees of freedom
Multiple R-squared:  0.7398,    Adjusted R-squared:  0.7393 
F-statistic:  1472 on 28 and 14491 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>fca <span class="ot">&lt;-</span> <span class="fu">formula</span>(backstep)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>fcb <span class="ot">&lt;-</span> <span class="fu">formula</span>(frontstep)</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>fcc <span class="ot">&lt;-</span> <span class="fu">formula</span>(bothstep)</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>fcd <span class="ot">&lt;-</span> <span class="fu">formula</span>(bstepz)</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>fce <span class="ot">&lt;-</span> <span class="fu">formula</span>(fstepz)</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>fcg <span class="ot">&lt;-</span> <span class="fu">formula</span>(bothstepz)</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>fca</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>vm ~ np + ac + a4 + rc + treat</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>fcb</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>vm ~ rc + ac + treat + a8 + a4</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>fcc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>vm ~ ac + a4 + rc + treat + a8</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>fcd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>treat ~ sg + ac + a1 + a4 + a7 + rc</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>fce</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>treat ~ ac + rc + a4 + a1 + sg + a7</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>fcg</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>treat ~ sg + ac + a1 + a4 + a7 + rc</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(bothstep, which = 1:4, ask = FALSE)</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>abs_t <span class="ot">&lt;-</span> <span class="fu">sort</span>(</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abs</span>(<span class="fu">summary</span>(bothstepz)<span class="sc">$</span>coefficients[, <span class="st">"t value"</span>]),</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">decreasing =</span> <span class="cn">TRUE</span></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(abs_t)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                     ac                             (Intercept) 
                           193.89430387                             74.16145718 
                              rcEastern                                      a4 
                             5.81222708                              5.35975365 
                                     a1 rcCentral + Eastern + Toronto + Western 
                             3.92438914                              3.76359743 
                    rcCentral + Eastern                                     sgF 
                             3.43505680                              2.10564024 
                                     a7          rcCentral + Northern + Toronto 
                             2.05252052                              1.93992188 
                              rcToronto                     rcEastern + Toronto 
                             1.91192157                              1.84165356 
                    rcCentral + Toronto                    rcNorthern + Western 
                             1.81577492                              1.57287823 
                   rcEastern + Northern                     rcCentral + Western 
                             1.53688722                              1.43832097 
          rcCentral + Eastern + Western                     rcEastern + Western 
                             1.41949910                              1.22192732 
         rcEastern + Northern + Western                    rcCentral + Northern 
                             0.93863274                              0.88479013 
                    rcToronto + Western                              rcNorthern 
                             0.69316137                              0.65146542 
          rcCentral + Toronto + Western           rcCentral + Eastern + Toronto 
                             0.50199859                              0.39414662 
         rcEastern + Northern + Toronto                               rcWestern 
                             0.36050841                              0.29233524 
          rcEastern + Toronto + Western          rcCentral + Northern + Western 
                             0.27654380                              0.03971491 
                   rcNorthern + Toronto 
                             0.01682979 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bothstepz, <span class="at">ask =</span> <span class="cn">FALSE</span>, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a>  bothstepz,</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Variables selected in Stepwise Regression Model (treatment ~ sg + ac + a1 + a4 + a7 + rc)"</span></span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>modz <span class="ot">&lt;-</span> <span class="fu">matchit</span>(</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>  treat <span class="sc">~</span> sg <span class="sc">+</span> ac <span class="sc">+</span> a1 <span class="sc">+</span> a4 <span class="sc">+</span> a7 <span class="sc">+</span> rc,</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> orcmatch_temp,</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance =</span> <span class="st">"cbps"</span>,</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATC"</span>,</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distance.options =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"exact"</span>),</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modz)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
matchit(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp, 
    distance = "cbps", distance.options = list(method = "exact"), 
    estimand = "ATC", replace = TRUE)

Summary of Balance for All Data:
                                        Means Treated Means Control
distance                                       0.0000        1.0000
sgM                                            0.8986        0.8986
sgF                                            0.1014        0.1014
ac                                             2.2164        1.0000
a1                                            17.9529        6.0704
a4                                             5.4539        1.6624
a7                                             2.1215        0.1784
rcCentral                                      0.2646        0.2753
rcCentral + Eastern                            0.0117        0.0051
rcCentral + Eastern + Toronto                  0.0034        0.0003
rcCentral + Eastern + Toronto + Western        0.0004        0.0000
rcCentral + Eastern + Western                  0.0012        0.0003
rcCentral + Northern                           0.0028        0.0008
rcCentral + Northern + Toronto                 0.0003        0.0001
rcCentral + Northern + Western                 0.0007        0.0000
rcCentral + Toronto                            0.0274        0.0085
rcCentral + Toronto + Western                  0.0010        0.0003
rcCentral + Western                            0.0131        0.0073
rcEastern                                      0.2519        0.2528
rcEastern + Northern                           0.0019        0.0010
rcEastern + Northern + Toronto                 0.0004        0.0000
rcEastern + Northern + Western                 0.0001        0.0000
rcEastern + Toronto                            0.0174        0.0070
rcEastern + Toronto + Western                  0.0003        0.0003
rcEastern + Western                            0.0050        0.0011
rcNorthern                                     0.1303        0.1204
rcNorthern + Toronto                           0.0048        0.0017
rcNorthern + Western                           0.0030        0.0012
rcToronto                                      0.1321        0.1522
rcToronto + Western                            0.0037        0.0012
rcWestern                                      0.1225        0.1631
                                             Std. Mean Diff.
distance                                -10877574058277.4844
sgM                                                   0.0000
sgF                                                   0.0000
ac                                                    3.3528
a1                                                    0.4306
a4                                                    0.2616
a7                                                    0.5093
rcCentral                                            -0.0241
rcCentral + Eastern                                   0.0928
rcCentral + Eastern + Toronto                         0.1909
rcCentral + Eastern + Toronto + Western               0.0288
rcCentral + Eastern + Western                         0.0581
rcCentral + Northern                                  0.0671
rcCentral + Northern + Toronto                        0.0117
rcCentral + Northern + Western                        0.0371
rcCentral + Toronto                                   0.2051
rcCentral + Toronto + Western                         0.0415
rcCentral + Western                                   0.0680
rcEastern                                            -0.0019
rcEastern + Northern                                  0.0311
rcEastern + Northern + Toronto                        0.0288
rcEastern + Northern + Western                        0.0166
rcEastern + Toronto                                   0.1237
rcEastern + Toronto + Western                         0.0000
rcEastern + Western                                   0.1162
rcNorthern                                            0.0305
rcNorthern + Toronto                                  0.0780
rcNorthern + Western                                  0.0509
rcToronto                                            -0.0560
rcToronto + Western                                   0.0705
rcWestern                                            -0.1100
                                                              Var. Ratio
distance                                                          0.0000
sgM                                                                    .
sgF                                                                    .
ac                                      341692012766349154532196352.0000
a1                                                                2.1188
a4                                                                2.4738
a7                                                                6.3246
rcCentral                                                              .
rcCentral + Eastern                                                    .
rcCentral + Eastern + Toronto                                          .
rcCentral + Eastern + Toronto + Western                                .
rcCentral + Eastern + Western                                          .
rcCentral + Northern                                                   .
rcCentral + Northern + Toronto                                         .
rcCentral + Northern + Western                                         .
rcCentral + Toronto                                                    .
rcCentral + Toronto + Western                                          .
rcCentral + Western                                                    .
rcEastern                                                              .
rcEastern + Northern                                                   .
rcEastern + Northern + Toronto                                         .
rcEastern + Northern + Western                                         .
rcEastern + Toronto                                                    .
rcEastern + Toronto + Western                                          .
rcEastern + Western                                                    .
rcNorthern                                                             .
rcNorthern + Toronto                                                   .
rcNorthern + Western                                                   .
rcToronto                                                              .
rcToronto + Western                                                    .
rcWestern                                                              .
                                        eCDF Mean eCDF Max
distance                                   0.5000   1.0000
sgM                                        0.0000   0.0000
sgF                                        0.0000   0.0000
ac                                         0.2027   1.0000
a1                                         0.0434   0.3814
a4                                         0.0188   0.1782
a7                                         0.0189   0.2579
rcCentral                                  0.0107   0.0107
rcCentral + Eastern                        0.0066   0.0066
rcCentral + Eastern + Toronto              0.0032   0.0032
rcCentral + Eastern + Toronto + Western    0.0004   0.0004
rcCentral + Eastern + Western              0.0010   0.0010
rcCentral + Northern                       0.0019   0.0019
rcCentral + Northern + Toronto             0.0001   0.0001
rcCentral + Northern + Western             0.0007   0.0007
rcCentral + Toronto                        0.0189   0.0189
rcCentral + Toronto + Western              0.0007   0.0007
rcCentral + Western                        0.0058   0.0058
rcEastern                                  0.0008   0.0008
rcEastern + Northern                       0.0010   0.0010
rcEastern + Northern + Toronto             0.0004   0.0004
rcEastern + Northern + Western             0.0001   0.0001
rcEastern + Toronto                        0.0103   0.0103
rcEastern + Toronto + Western              0.0000   0.0000
rcEastern + Western                        0.0039   0.0039
rcNorthern                                 0.0099   0.0099
rcNorthern + Toronto                       0.0032   0.0032
rcNorthern + Western                       0.0018   0.0018
rcToronto                                  0.0201   0.0201
rcToronto + Western                        0.0025   0.0025
rcWestern                                  0.0406   0.0406

Summary of Balance for Matched Data:
                                        Means Treated Means Control
distance                                            0        1.0000
sgM                                                 0        0.8986
sgF                                                 1        0.1014
ac                                                  2        1.0000
a1                                                  0        6.0704
a4                                                  0        1.6624
a7                                                  0        0.1784
rcCentral                                           0        0.2753
rcCentral + Eastern                                 0        0.0051
rcCentral + Eastern + Toronto                       0        0.0003
rcCentral + Eastern + Toronto + Western             0        0.0000
rcCentral + Eastern + Western                       0        0.0003
rcCentral + Northern                                0        0.0008
rcCentral + Northern + Toronto                      0        0.0001
rcCentral + Northern + Western                      0        0.0000
rcCentral + Toronto                                 0        0.0085
rcCentral + Toronto + Western                       0        0.0003
rcCentral + Western                                 0        0.0073
rcEastern                                           1        0.2528
rcEastern + Northern                                0        0.0010
rcEastern + Northern + Toronto                      0        0.0000
rcEastern + Northern + Western                      0        0.0000
rcEastern + Toronto                                 0        0.0070
rcEastern + Toronto + Western                       0        0.0003
rcEastern + Western                                 0        0.0011
rcNorthern                                          0        0.1204
rcNorthern + Toronto                                0        0.0017
rcNorthern + Western                                0        0.0012
rcToronto                                           0        0.1522
rcToronto + Western                                 0        0.0012
rcWestern                                           0        0.1631
                                             Std. Mean Diff. Var. Ratio
distance                                -10877574058277.4844          .
sgM                                                  -2.9773          .
sgF                                                   2.9773          .
ac                                                    2.7563          .
a1                                                   -0.2200          .
a4                                                   -0.1147          .
a7                                                   -0.0467          .
rcCentral                                            -0.6164          .
rcCentral + Eastern                                  -0.0716          .
rcCentral + Eastern + Toronto                        -0.0166          .
rcCentral + Eastern + Toronto + Western               0.0000          .
rcCentral + Eastern + Western                        -0.0166          .
rcCentral + Northern                                 -0.0288          .
rcCentral + Northern + Toronto                       -0.0117          .
rcCentral + Northern + Western                        0.0000          .
rcCentral + Toronto                                  -0.0928          .
rcCentral + Toronto + Western                        -0.0166          .
rcCentral + Western                                  -0.0858          .
rcEastern                                             1.7194          .
rcEastern + Northern                                 -0.0311          .
rcEastern + Northern + Toronto                        0.0000          .
rcEastern + Northern + Western                        0.0000          .
rcEastern + Toronto                                  -0.0841          .
rcEastern + Toronto + Western                        -0.0166          .
rcEastern + Western                                  -0.0332          .
rcNorthern                                           -0.3699          .
rcNorthern + Toronto                                 -0.0407          .
rcNorthern + Western                                 -0.0352          .
rcToronto                                            -0.4237          .
rcToronto + Western                                  -0.0352          .
rcWestern                                            -0.4414          .
                                        eCDF Mean eCDF Max     Std. Pair Dist.
distance                                   0.5000   1.0000 10877574058278.9004
sgM                                        0.8986   0.8986              2.9773
sgF                                        0.8986   0.8986              2.9773
ac                                         0.1667   1.0000              2.7563
a1                                         0.0216   0.1682              0.2200
a4                                         0.0078   0.0486              0.1147
a7                                         0.0015   0.0076              0.0467
rcCentral                                  0.2753   0.2753              0.6164
rcCentral + Eastern                        0.0051   0.0051              0.0716
rcCentral + Eastern + Toronto              0.0003   0.0003              0.0166
rcCentral + Eastern + Toronto + Western    0.0000   0.0000              0.0000
rcCentral + Eastern + Western              0.0003   0.0003              0.0166
rcCentral + Northern                       0.0008   0.0008              0.0288
rcCentral + Northern + Toronto             0.0001   0.0001              0.0117
rcCentral + Northern + Western             0.0000   0.0000              0.0000
rcCentral + Toronto                        0.0085   0.0085              0.0928
rcCentral + Toronto + Western              0.0003   0.0003              0.0166
rcCentral + Western                        0.0073   0.0073              0.0858
rcEastern                                  0.7472   0.7472              1.7194
rcEastern + Northern                       0.0010   0.0010              0.0311
rcEastern + Northern + Toronto             0.0000   0.0000              0.0000
rcEastern + Northern + Western             0.0000   0.0000              0.0000
rcEastern + Toronto                        0.0070   0.0070              0.0841
rcEastern + Toronto + Western              0.0003   0.0003              0.0166
rcEastern + Western                        0.0011   0.0011              0.0332
rcNorthern                                 0.1204   0.1204              0.3699
rcNorthern + Toronto                       0.0017   0.0017              0.0407
rcNorthern + Western                       0.0012   0.0012              0.0352
rcToronto                                  0.1522   0.1522              0.4237
rcToronto + Western                        0.0012   0.0012              0.0352
rcWestern                                  0.1631   0.1631              0.4414

Sample Sizes:
          Control Treated
All          7260    7260
Matched      7260       1
Unmatched       0    7259
Discarded       0       0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>modz1a <span class="ot">&lt;-</span> <span class="fu">match.data</span>(modz)</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjmisc)</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>orcm <span class="ot">&lt;-</span> <span class="fu">copy</span>(orcmatch_temp)</span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>orcm <span class="ot">&lt;-</span> <span class="fu">to_factor</span>(orcm, sg, rc, treat)</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>morc <span class="ot">&lt;-</span> <span class="fu">lm</span>(treat <span class="sc">~</span> sg <span class="sc">+</span> ac <span class="sc">+</span> a1 <span class="sc">+</span> a4 <span class="sc">+</span> a7 <span class="sc">+</span> rc, <span class="at">data =</span> orcm)</span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(</span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>  morc,</span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"pred"</span>,</span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rc"</span>, <span class="st">"ac"</span>, <span class="st">"sg"</span>),</span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Stepwise Regression Prediction of Treatment"</span>,</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>sjPlot<span class="sc">::</span><span class="fu">plot_model</span>(</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>  morc,</span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Stepwise Regression Prediction of Treatment"</span>,</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"pred"</span>,</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"rc"</span>, <span class="st">"ac"</span>, <span class="st">"sg"</span>)</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb279-7"><a href="#cb279-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb279-8"><a href="#cb279-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb279-9"><a href="#cb279-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb279-10"><a href="#cb279-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">angle =</span> <span class="dv">45</span>, </span>
<span id="cb279-11"><a href="#cb279-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">hjust =</span> <span class="dv">1</span>, </span>
<span id="cb279-12"><a href="#cb279-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">vjust =</span> <span class="dv">1</span>,  </span>
<span id="cb279-13"><a href="#cb279-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">9</span>   </span>
<span id="cb279-14"><a href="#cb279-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb279-15"><a href="#cb279-15" aria-hidden="true" tabindex="-1"></a>  )  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bothstep, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bothstepz, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">ask =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="notez1a_files/figure-html/unnamed-chunk-1-44.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>