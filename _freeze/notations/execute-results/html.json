{
  "hash": "9ddbccbe03260194addc660a4078ed60",
  "result": {
    "engine": "knitr",
    "markdown": "# Robust Clustering DML\n\n## Cross-fitting under clustering\n\nClustering requires (i) cluster-robust variance estimation and (ii) cluster-aware sample splitting: standard cross-fitting can otherwise place dependent observations from the same cluster into both train and test. This is emphasized in the DoubleML clustering example and in the cluster-robust DML paper \\parencites{ChiangKatoMaSasaki_2022}{DoubleMLDocsClusterExampleR}{CameronGelbachMiller_2011}.\\footnote{In explicit terms of this study's DoubleML implementation, the outcome $Y$ and treatment $D$ are availed via \\texttt{y\\_col} and \\texttt{d\\_cols}, covariates $X$ via \\texttt{x\\_cols}, and the person-level identifier (\\texttt{cluster\\_id} derived from \\texttt{UniqueIndividual\\_ID}) via \\texttt{cluster\\_cols}, so that both cross-fitting and inference respect within-individual dependence \\parencites{DoubleMLDocsDataBackend}{DoubleMLDocsClusterDataAPI}.}\n\n## Oneway Clustering\n\nOne-way cluster splitting (A01RCDD)\n\nLet the data be one-way clustered: for clusters $g\\in[G]$, cluster $g$ contains observations $\\{W_{gi}: i\\in[n_g]\\}$. Partition the cluster index set into $K$ disjoint parts $[G]=\\mathcal{G}_1\\cup\\cdots\\cup\\mathcal{G}_K$. Define the holdout (evaluation) set for fold $k$ as the union of all observations in the held-out clusters, \\[ \\mathcal{I}k := {(g,i): g\\in\\mathcal{G}k, i\\in[n_g]}, \\] and let $\\mathcal{I}_k^c$ denote its complement (all observations in clusters not in $\\mathcal{G}_k$). Estimate nuisance parameters $\\widehat{\\eta}_k$ using only $\\mathcal{I}_k^c$, and evaluate the score on $\\mathcal{I}_k$. The one-way cluster cross-fitted DML estimator solves \\[ \\frac{1}{K}\\sum{k=1}\\^K \\mathbb{E}{n,k}!\\left[\\psi\\!\\left(W;\\theta,\\widehat{\\eta}_{k}\\right)\\right]=0, \\] where $\\mathbb{E}_{n,k}[\\cdot]$ is the empirical mean over $(g,i)\\in\\mathcal{I}_k$ \\parencites{ChiangKatoMaSasaki_2022}{DoubleMLDocsClusterExampleR}.\n\n### One-way cluster-robust variance\n\nLet $\\widehat{\\psi}_{gi}$ denote the fitted score contribution for observation $i$ in cluster $g$ (ATE or ATTE), evaluated using cross-fitted nuisance estimates. Define the cluster score sum $\\widehat{S}_g := \\sum_{i\\in[n_g]}\\widehat{\\psi}_{gi}$. A one-way cluster-robust \\textit{meat} matrix is \\[ \\widehat{\\Omega} = \\frac{1}{n}\\sum\\*{g=1}^G\\*^ \\widehat{S}g,\\widehat{S}g{!\\top} = \\frac{1}{n}\\sum{g=1}\\^G \\left(\\sum{i\\in[n_g]}\\widehat{\\psi}{gi}\\right) \\left(\\sum\\*{i\\*\\\\in\\[n_g\\]}\\\\widehat{\\\\psi}{gi}\\\\right)\\^{!\\top}, \\] with multiway extensions based on inclusion--exclusion across cluster dimensions \\parencites{CameronGelbachMiller_2011}{ChiangKatoMaSasaki_2022}\n\n### Pooled IRM\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'lgr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dials':\n\n    threshold\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ggplot2':\n\n    Layout\n```\n\n\n:::\n\n::: {.cell-output-display}\n\n\nTable: Pooled IRM DoubleML (2023–2025)\n\n|group          |estimand | effect|     se| t_value| p_value| ci_low| ci_high|\n|:--------------|:--------|------:|------:|-------:|-------:|------:|-------:|\n|Pooled 2023-25 |ATE      | 0.1605| 0.0063| 25.5418|       0| 0.1481|  0.1728|\n|Pooled 2023-25 |ATTE     | 0.1557| 0.0061| 25.6923|       0| 0.1438|  0.1676|\n\n\n:::\n:::\n\n\n### Disaggregegated IRM\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\nTable: IRM DoubleML (2023/2024/2025)\n\n|group |estimand | effect|     se| t_value| p_value| ci_low| ci_high|\n|:-----|:--------|------:|------:|-------:|-------:|------:|-------:|\n|2023  |ATE      | 0.1342| 0.0099| 13.6093|       0| 0.1149|  0.1535|\n|2023  |ATTE     | 0.1272| 0.0103| 12.3080|       0| 0.1070|  0.1475|\n|2024  |ATE      | 0.1591| 0.0117| 13.6359|       0| 0.1362|  0.1820|\n|2024  |ATTE     | 0.1550| 0.0114| 13.5809|       0| 0.1326|  0.1774|\n|2025  |ATE      | 0.1737| 0.0103| 16.8639|       0| 0.1535|  0.1939|\n|2025  |ATTE     | 0.1704| 0.0097| 17.6296|       0| 0.1514|  0.1893|\n\n\n:::\n:::\n\n\n## Multiway Policy Dimensions\n\n![](clustermatrixplot_a01rc1a1a.jpg){fig-cap=\"Regional Cluster Matrix\" fig-align=\"center\" width=\"100%\"}\n\n### Multiway cross-fitting (2 Dimensions)\n\nFor two-way clustered data $\\{W_{ij}: i\\in[N],\\, j\\in[M]\\}$, partition the index sets $[N]=I_1\\cup\\cdots\\cup I_K$ and $[M]=J_1\\cup\\cdots\\cup J_K$ into $K$ disjoint parts. For each $(k,\\ell)\\in[K]^2$, estimate the nuisance parameters $\\widehat{\\eta}_{k\\ell}$ using only observations with indices in the complements $([N]\\setminus I_k)\\times([M]\\setminus J_\\ell)$, and evaluate the score on the holdout block $I_k\\times J_\\ell$. The multiway cross-fitted DML estimator $\\widetilde{\\theta}$ solves \\[ \\frac{1}{K^2}\\sum\\*{k=1}\\^K\\*\\sum{\\ell=1}\\^K \\mathbb{E}\\_{n,k\\ell}!\\left[\\psi\\!\\left(W;\\theta,\\widehat{\\eta}_{k\\ell}\\right)\\right]=0, \\] where $\\mathbb{E}_{n,k\\ell}[\\cdot]$ denotes the empirical mean over $(i,j)\\in I_k\\times J_\\ell$ \\parencites{ChiangKatoMaSasaki_2022}{DoubleMLDocsClusterExampleR}.\n\n### Regional Clustering Variations\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"correctional_stats_report1z.RData\")\nload(\"correctional_stats_report1z.RData\")\nknitr::kable(res_all, booktabs = TRUE, longtable = TRUE, digits = 4, caption = \"Multi-way Regional Clustering Variations\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Multi-way Regional Clustering Variations\n\n|region_contrast    |clustering                  |estimand |     n| effect|     se| t_value| p_value| ci_low| ci_high|\n|:------------------|:---------------------------|:--------|-----:|------:|------:|-------:|-------:|------:|-------:|\n|Toronto vs others  |0-way                       |ATE      | 76934| 0.1958| 0.0035| 55.9040|       0| 0.1889|  0.2026|\n|Toronto vs others  |0-way                       |ATTE     | 76934| 0.1941| 0.0035| 55.2631|       0| 0.1872|  0.2010|\n|Toronto vs others  |cluster_id                  |ATE      | 76934| 0.1958| 0.0035| 56.6119|       0| 0.1890|  0.2026|\n|Toronto vs others  |cluster_id                  |ATTE     | 76934| 0.1938| 0.0035| 55.7208|       0| 0.1870|  0.2006|\n|Toronto vs others  |cluster_id + cluster_region |ATE      | 76934| 0.2010| 0.0183| 11.0060|       0| 0.1652|  0.2368|\n|Toronto vs others  |cluster_id + cluster_region |ATTE     | 76934| 0.2013| 0.0182| 11.0566|       0| 0.1656|  0.2370|\n|Eastern vs others  |0-way                       |ATE      | 76934| 0.1979| 0.0035| 56.0164|       0| 0.1910|  0.2048|\n|Eastern vs others  |0-way                       |ATTE     | 76934| 0.1935| 0.0035| 54.8684|       0| 0.1866|  0.2004|\n|Eastern vs others  |cluster_id                  |ATE      | 76934| 0.1980| 0.0035| 56.8639|       0| 0.1912|  0.2048|\n|Eastern vs others  |cluster_id                  |ATTE     | 76934| 0.1932| 0.0035| 55.2683|       0| 0.1863|  0.2000|\n|Eastern vs others  |cluster_id + cluster_region |ATE      | 76934| 0.1998| 0.0182| 10.9762|       0| 0.1641|  0.2355|\n|Eastern vs others  |cluster_id + cluster_region |ATTE     | 76934| 0.1956| 0.0185| 10.5605|       0| 0.1593|  0.2319|\n|Western vs others  |0-way                       |ATE      | 76934| 0.1971| 0.0035| 55.9721|       0| 0.1902|  0.2040|\n|Western vs others  |0-way                       |ATTE     | 76934| 0.1946| 0.0035| 55.2772|       0| 0.1877|  0.2015|\n|Western vs others  |cluster_id                  |ATE      | 76934| 0.1973| 0.0035| 56.6810|       0| 0.1905|  0.2041|\n|Western vs others  |cluster_id                  |ATTE     | 76934| 0.1944| 0.0035| 55.7063|       0| 0.1876|  0.2013|\n|Western vs others  |cluster_id + cluster_region |ATE      | 76934| 0.1969| 0.0178| 11.0717|       0| 0.1621|  0.2318|\n|Western vs others  |cluster_id + cluster_region |ATTE     | 76934| 0.1974| 0.0190| 10.3743|       0| 0.1601|  0.2347|\n|Central vs others  |0-way                       |ATE      | 76934| 0.1981| 0.0035| 56.0529|       0| 0.1912|  0.2050|\n|Central vs others  |0-way                       |ATTE     | 76934| 0.1940| 0.0035| 54.9521|       0| 0.1871|  0.2009|\n|Central vs others  |cluster_id                  |ATE      | 76934| 0.1982| 0.0035| 56.9820|       0| 0.1913|  0.2050|\n|Central vs others  |cluster_id                  |ATTE     | 76934| 0.1940| 0.0035| 55.3884|       0| 0.1871|  0.2008|\n|Central vs others  |cluster_id + cluster_region |ATE      | 76934| 0.1989| 0.0175| 11.3633|       0| 0.1646|  0.2332|\n|Central vs others  |cluster_id + cluster_region |ATTE     | 76934| 0.1971| 0.0181| 10.9061|       0| 0.1617|  0.2325|\n|Northern vs others |0-way                       |ATE      | 76934| 0.1990| 0.0035| 56.6860|       0| 0.1921|  0.2059|\n|Northern vs others |0-way                       |ATTE     | 76934| 0.1958| 0.0035| 55.9774|       0| 0.1889|  0.2027|\n|Northern vs others |cluster_id                  |ATE      | 76934| 0.1991| 0.0035| 57.5614|       0| 0.1924|  0.2059|\n|Northern vs others |cluster_id                  |ATTE     | 76934| 0.1955| 0.0035| 56.4823|       0| 0.1887|  0.2023|\n|Northern vs others |cluster_id + cluster_region |ATE      | 76934| 0.1997| 0.0181| 11.0579|       0| 0.1643|  0.2351|\n|Northern vs others |cluster_id + cluster_region |ATTE     | 76934| 0.1979| 0.0192| 10.2894|       0| 0.1602|  0.2356|\n\n\n:::\n:::\n",
    "supporting": [
      "Notations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}