{
  "hash": "49a246f86e79f1d02a768094cc79813d",
  "result": {
    "engine": "knitr",
    "markdown": "# Logic Notebook\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressWarnings(suppressPackageStartupMessages({\n  library(data.table)\n  library(tidyverse)\n  library(tidymodels)\n  library(naniar)\n  library(readxl)\n  library(janitor)\n  library(rmarkdown)\n  library(knitr)\n  library(kableExtra)\n  library(modelsummary)\n  library(DoubleML)\n  library(mlr3)\n  library(broom)\n  library(ranger)\n  library(sandwich)\n  library(lmtest)\n  library(mlr3learners)\n  library(readr)\n  library(MatchIt)\n  library(ggplot2)\n  library(dplyr)\n  library(summarytools)\n  library(DataExplorer)\n  library(mlr3learners)\n  library(mlr3measures)\n  library(mlr3resampling)\n}))\nset.seed(5824769)\noptions(warn = -1)\noptions(device.ask.default = FALSE)\ndata010a <- rnorm(1000000)\nhist(\n  data010a,\n  labels = TRUE,\n  col = \"grey\",\n  breaks = 100,\n  main = \"Histogram of Random Data\",\n  xlab = \"Value\",\n  ylab = \"Frequency\"\n)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nrdx = rnorm(1000)\nrdy = as.numeric(rdx > 0)\nrdix = sample(1:1000, 100)\nrdy[rdix] = 1 - rdy[rdix]\nrdf = data.frame(rdx, rdy)\nplot(rdf$rdx, rdf$rdy)\nm <- glm(rdy ~ rdx, data = rdf, family = binomial())\nxs <- seq(min(rdf$rdx), max(rdf$rdx), length.out = 300)\nlines(\n  xs,\n  predict(m, newdata = data.frame(rdx = xs), type = \"response\"),\n  lwd = 2\n)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-2.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nload(\"correctional_stats_report_environment1b.RData\")\n\ndataframe_original <- df\ncols_to_rename <- setdiff(names(dataframe_original), \"unique_individual_id\")\nnum_to_letters <- function(n) {\n  sapply(n, function(i) {\n    out <- \"\"\n    while (i > 0) {\n      i <- i - 1\n      out <- paste0(letters[(i %% 26) + 1], out)\n      i <- i %/% 26\n    }\n    out\n  })\n}\nnew_names <- paste0(\"x1\", num_to_letters(seq_along(cols_to_rename)))\nnames(dataframe_original)[match(\n  cols_to_rename,\n  names(dataframe_original)\n)] <- new_names\nknitr::kable(\n  head(\n    dataframe_original[, setdiff(\n      names(dataframe_original),\n      \"unique_individual_id\"\n    )],\n    10\n  ),\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = \"Ontario Restrictive Confinement Dataframe (2023-2025)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Ontario Restrictive Confinement Dataframe (2023-2025)\n\n|  x1a|x1b      |x1c      |x1d  |x1e      |x1f |x1g |x1h | x1i|\n|----:|:--------|:--------|:----|:--------|:---|:---|:---|---:|\n| 2023|Toronto  |Toronto  |Male |25 to 49 |No  |Yes |No  |   8|\n| 2023|Toronto  |Toronto  |Male |25 to 49 |No  |No  |No  |  26|\n| 2023|Northern |Northern |Male |50+      |No  |No  |No  |  20|\n| 2023|Eastern  |Eastern  |Male |25 to 49 |Yes |Yes |No  |   9|\n| 2023|Western  |Western  |Male |25 to 49 |No  |Yes |No  |  11|\n| 2023|Eastern  |Eastern  |Male |50+      |No  |No  |No  |   8|\n| 2023|Eastern  |Eastern  |Male |50+      |No  |No  |No  |   8|\n| 2023|Central  |Central  |Male |25 to 49 |No  |No  |No  |  10|\n| 2023|Northern |Northern |Male |50+      |No  |No  |No  |   3|\n| 2023|Western  |Western  |Male |25 to 49 |No  |No  |No  |  11|\n\n\n:::\n\n```{.r .cell-code}\nregion_names <- c(\"Central\", \"Eastern\", \"Northern\", \"Toronto\", \"Western\")\nage_levels <- c(\"18 to 24\", \"25 to 49\", \"50+\")\nsex_levels <- c(\"Male\", \"Female\")\nyears <- 2023:2025\ndataframe_original1b <- copy(dataframe_original)\ndf_rc <- as.data.table(df)\ndf_rc[, end_fiscal_year := as.integer(end_fiscal_year)]\ndf_rc[, age_category := factor(age_category, levels = age_levels)]\ndf_rc[, gender := factor(gender, levels = sex_levels)]\ndf_rc[,\n  region_at_time_of_placement := factor(\n    region_at_time_of_placement,\n    levels = region_names\n  )\n]\nget_region_by_age <- function(D, yr, sex = NULL) {\n  tmp <- D[\n    end_fiscal_year == yr &\n      !is.na(age_category) &\n      !is.na(region_at_time_of_placement)\n  ]\n  if (!is.null(sex)) {\n    tmp <- tmp[gender == sex]\n  }\n  tab <- tmp[,\n    .(n = uniqueN(unique_individual_id)),\n    by = .(age_category, region_at_time_of_placement)\n  ]\n  grid <- CJ(\n    age_category = age_levels,\n    region_at_time_of_placement = region_names,\n    unique = TRUE\n  )\n  tab <- merge(\n    grid,\n    tab,\n    by = c(\"age_category\", \"region_at_time_of_placement\"),\n    all.x = TRUE\n  )\n  tab[is.na(n), n := 0L]\n  wide <- dcast(\n    tab,\n    age_category ~ region_at_time_of_placement,\n    value.var = \"n\"\n  )\n  S <- as.matrix(wide[, -1])\n  rownames(S) <- wide$age_category\n  den <- rowSums(S)\n  P <- sweep(S, 1, den, \"/\")\n  P[den == 0, ] <- NA_real_\n  list(S = S, P = P)\n}\nP_year <- list()\nS_year <- list()\nfor (yr in years) {\n  out_all <- get_region_by_age(df_rc, yr)\n  P <- out_all$P\n  S_year[[as.character(yr)]] <- out_all$S\n  P_year[[as.character(yr)]] <- P\n  cols <- seq_len(ncol(P))\n  matplot(\n    P,\n    type = \"l\",\n    lwd = 2,\n    lty = 1,\n    col = cols,\n    xaxt = \"n\",\n    xlab = \"Age Group\",\n    ylab = \"Proportion\",\n    main = paste0(yr, \" Region at Time of Placement by Age Group\")\n  )\n  axis(1, at = seq_len(nrow(P)), labels = rownames(P))\n  legend(\n    \"topright\",\n    legend = colnames(P),\n    col = cols,\n    lty = 1,\n    lwd = 2,\n    bty = \"n\"\n  )\n  par(mfrow = c(1, 2), mar = c(4, 4, 3, 1))\n  for (sex in c(\"Male\", \"Female\")) {\n    out_sex <- get_region_by_age(df_rc, yr, sex = sex)\n    Psex <- out_sex$P\n    cols <- seq_len(ncol(Psex))\n    matplot(\n      Psex,\n      type = \"l\",\n      lwd = 2,\n      lty = 1,\n      col = cols,\n      xaxt = \"n\",\n      xlab = \"Age Group\",\n      ylab = \"Proportion\",\n      main = paste0(yr, \" RTP (\", sex, \")\")\n    )\n    axis(1, at = seq_len(nrow(Psex)), labels = rownames(Psex))\n    legend(\n      \"topright\",\n      legend = colnames(Psex),\n      col = cols,\n      lty = 1,\n      lwd = 2,\n      bty = \"n\"\n    )\n  }\n  par(mfrow = c(1, 1))\n}\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-3.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-4.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-5.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-6.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-7.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-8.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nac1b <- df |>\n  mutate(\n    ac1a = factor(\n      dplyr::recode(\n        as.character(age_category),\n        \"18 to 24\" = \"1\",\n        \"25 to 49\" = \"2\",\n        \"50+\" = \"3\"\n      ),\n      levels = c(\"1\", \"2\", \"3\"),\n      ordered = TRUE\n    )\n  ) |>\n  group_by(ac1a) |>\n  summarise(\n    f = dplyr::n(),\n    n = dplyr::n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |>\n  arrange(ac1a) |>\n  mutate(\n    p = round(n / sum(n), 2),\n    pct = round(100 * n / sum(n), 2),\n    rate = round(10000 * n / sum(n), 2)\n  )\nvars <- c(\n  \"gender\",\n  \"age_category\",\n  \"region_at_time_of_placement\",\n  \"region_most_recent_placement\",\n  \"mental_health_alert\",\n  \"suicide_watch_alert\",\n  \"suicide_risk_alert\"\n)\ndf.counts <- df |>\n  group_by(region_at_time_of_placement) |>\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |>\n  mutate(p = count / sum(count), pct = p * 100, rate = p * 10000)\ndf.counts_ac_year <- df |>\n  pivot_longer(all_of(vars), names_to = \"variable\", values_to = \"level\") |>\n  group_by(end_fiscal_year, variable, level) |>\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |>\n  group_by(end_fiscal_year, variable) |>\n  mutate(p = count / sum(count), pct = 100 * p, rate = 10000 * p) |>\n  ungroup()\ndf.counts_year <- df |>\n  group_by(end_fiscal_year, region_at_time_of_placement) |>\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |>\n  group_by(end_fiscal_year) |>\n  mutate(p = count / sum(count), pct = 100 * p, rate = 10000 * p) |>\n  ungroup()\ndf.person_freq_year <- df |>\n  group_by(\n    end_fiscal_year,\n    region_at_time_of_placement,\n    unique_individual_id\n  ) |>\n  summarise(freq = n(), .groups = \"drop\")\necdf_age <- ac1b |>\n  arrange(ac1a) |>\n  mutate(ecdf = cumsum(p))\nevents_per_person <- df |>\n  count(unique_individual_id, name = \"n_events\") |>\n  pull(n_events)\ntotal_people <- df |>\n  summarise(N = n_distinct(unique_individual_id)) |>\n  pull(N)\ndf_overall <- df |>\n  select(unique_individual_id, all_of(vars)) |>\n  pivot_longer(all_of(vars), names_to = \"variable\", values_to = \"level\") |>\n  group_by(variable, level) |>\n  summarise(\n    f = n(),\n    count = n_distinct(unique_individual_id),\n    .groups = \"drop\"\n  ) |>\n  mutate(\n    p = count / total_people,\n    pct = 100 * p,\n    rate = 10000 * p\n  )\n\nknitr::kable(\n  ecdf_age,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`ecdf_age`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`ecdf_age`)\n\n|ac1a |     f|     n|    p|   pct|    rate| ecdf|\n|:----|-----:|-----:|----:|-----:|-------:|----:|\n|1    | 11977| 10139| 0.15| 15.49| 1548.72| 0.15|\n|2    | 56518| 47857| 0.73| 73.10| 7310.10| 0.88|\n|3    |  8439|  7471| 0.11| 11.41| 1141.19| 0.99|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  df.counts,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df.counts`).'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`df.counts`).\n\n|region_at_time_of_placement |     f| count|         p|      pct|     rate|\n|:---------------------------|-----:|-----:|---------:|--------:|--------:|\n|Central                     | 22643| 20066| 0.2943783| 29.43783| 2943.783|\n|Eastern                     | 20349| 17811| 0.2612963| 26.12963| 2612.963|\n|Northern                    |  9110|  7891| 0.1157649| 11.57649| 1157.649|\n|Toronto                     | 12602| 11213| 0.1645003| 16.45003| 1645.003|\n|Western                     | 12230| 11183| 0.1640602| 16.40602| 1640.602|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  df.counts_year,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df.counts_year`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`df.counts_year`)\n\n| end_fiscal_year|region_at_time_of_placement |    f| count|         p|       pct|      rate|\n|---------------:|:---------------------------|----:|-----:|---------:|---------:|---------:|\n|            2023|Central                     | 7663|  6784| 0.3174841| 31.748409| 3174.8409|\n|            2023|Eastern                     | 5811|  5079| 0.2376919| 23.769188| 2376.9188|\n|            2023|Northern                    | 3422|  3031| 0.1418476| 14.184762| 1418.4762|\n|            2023|Toronto                     | 3455|  2999| 0.1403501| 14.035006| 1403.5006|\n|            2023|Western                     | 3772|  3475| 0.1626264| 16.262636| 1626.2636|\n|            2024|Central                     | 5949|  5228| 0.2569926| 25.699258| 2569.9258|\n|            2024|Eastern                     | 7416|  6569| 0.3229121| 32.291206| 3229.1206|\n|            2024|Northern                    | 2852|  2417| 0.1188124| 11.881237| 1188.1237|\n|            2024|Toronto                     | 2874|  2575| 0.1265792| 12.657917| 1265.7917|\n|            2024|Western                     | 3904|  3554| 0.1747038| 17.470383| 1747.0383|\n|            2025|Central                     | 9031|  8054| 0.3044645| 30.446452| 3044.6452|\n|            2025|Eastern                     | 7122|  6163| 0.2329792| 23.297925| 2329.7925|\n|            2025|Northern                    | 2836|  2443| 0.0923525|  9.235247|  923.5247|\n|            2025|Toronto                     | 6273|  5639| 0.2131705| 21.317053| 2131.7053|\n|            2025|Western                     | 4554|  4154| 0.1570332| 15.703323| 1570.3323|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  df_overall,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df_overall`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`df_overall`)\n\n|variable                     |level    |     f| count|         p|       pct|      rate|\n|:----------------------------|:--------|-----:|-----:|---------:|---------:|---------:|\n|age_category                 |18 to 24 | 11977| 10139| 0.1548719| 15.487192| 1548.7192|\n|age_category                 |25 to 49 | 56518| 47857| 0.7310095| 73.100952| 7310.0952|\n|age_category                 |50+      |  8439|  7471| 0.1141186| 11.411856| 1141.1856|\n|gender                       |Female   |  7242|  6256| 0.0955596|  9.555960|  955.5959|\n|gender                       |Male     | 69692| 59211| 0.9044404| 90.444040| 9044.4041|\n|mental_health_alert          |No       | 55837| 50900| 0.7774909| 77.749095| 7774.9095|\n|mental_health_alert          |Yes      | 21097| 17661| 0.2697695| 26.976950| 2697.6950|\n|region_at_time_of_placement  |Central  | 22643| 20066| 0.3065056| 30.650557| 3065.0557|\n|region_at_time_of_placement  |Eastern  | 20349| 17811| 0.2720607| 27.206073| 2720.6073|\n|region_at_time_of_placement  |Northern |  9110|  7891| 0.1205340| 12.053401| 1205.3401|\n|region_at_time_of_placement  |Toronto  | 12602| 11213| 0.1712771| 17.127713| 1712.7713|\n|region_at_time_of_placement  |Western  | 12230| 11183| 0.1708189| 17.081889| 1708.1889|\n|region_most_recent_placement |Central  | 22577| 19207| 0.2933845| 29.338445| 2933.8445|\n|region_most_recent_placement |Eastern  | 20263| 17237| 0.2632930| 26.329296| 2632.9296|\n|region_most_recent_placement |Northern |  9080|  7696| 0.1175554| 11.755541| 1175.5541|\n|region_most_recent_placement |Toronto  | 12743| 10558| 0.1612721| 16.127209| 1612.7209|\n|region_most_recent_placement |Western  | 12271| 10769| 0.1644951| 16.449509| 1644.9509|\n|suicide_risk_alert           |No       | 63229| 58447| 0.8927704| 89.277040| 8927.7040|\n|suicide_risk_alert           |Yes      | 13705| 11328| 0.1730337| 17.303374| 1730.3374|\n|suicide_watch_alert          |No       | 71715| 64433| 0.9842058| 98.420578| 9842.0578|\n|suicide_watch_alert          |Yes      |  5219|  4921| 0.0751676|  7.516764|  751.6764|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  df.counts_ac_year,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`df.counts_ac_year`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`df.counts_ac_year`)\n\n| end_fiscal_year|variable                     |level    |     f| count|         p|       pct|      rate|\n|---------------:|:----------------------------|:--------|-----:|-----:|---------:|---------:|---------:|\n|            2023|age_category                 |18 to 24 |  4062|  3507| 0.1687599| 16.875992| 1687.5992|\n|            2023|age_category                 |25 to 49 | 17437| 14930| 0.7184447| 71.844473| 7184.4473|\n|            2023|age_category                 |50+      |  2624|  2344| 0.1127953| 11.279534| 1127.9534|\n|            2023|gender                       |Female   |  1712|  1511| 0.0727106|  7.271065|  727.1065|\n|            2023|gender                       |Male     | 22411| 19270| 0.9272894| 92.728935| 9272.8935|\n|            2023|mental_health_alert          |No       | 17726| 16399| 0.7487786| 74.877859| 7487.7859|\n|            2023|mental_health_alert          |Yes      |  6397|  5502| 0.2512214| 25.122141| 2512.2141|\n|            2023|region_at_time_of_placement  |Central  |  7663|  6784| 0.3174841| 31.748409| 3174.8409|\n|            2023|region_at_time_of_placement  |Eastern  |  5811|  5079| 0.2376919| 23.769188| 2376.9188|\n|            2023|region_at_time_of_placement  |Northern |  3422|  3031| 0.1418476| 14.184762| 1418.4762|\n|            2023|region_at_time_of_placement  |Toronto  |  3455|  2999| 0.1403501| 14.035006| 1403.5006|\n|            2023|region_at_time_of_placement  |Western  |  3772|  3475| 0.1626264| 16.262636| 1626.2636|\n|            2023|region_most_recent_placement |Central  |  7647|  6581| 0.3166835| 31.668351| 3166.8351|\n|            2023|region_most_recent_placement |Eastern  |  5841|  4987| 0.2399788| 23.997883| 2399.7883|\n|            2023|region_most_recent_placement |Northern |  3422|  2988| 0.1437852| 14.378519| 1437.8519|\n|            2023|region_most_recent_placement |Toronto  |  3425|  2826| 0.1359896| 13.598961| 1359.8961|\n|            2023|region_most_recent_placement |Western  |  3788|  3399| 0.1635629| 16.356287| 1635.6287|\n|            2023|suicide_risk_alert           |No       | 20380| 18942| 0.8549377| 85.493771| 8549.3771|\n|            2023|suicide_risk_alert           |Yes      |  3743|  3214| 0.1450623| 14.506229| 1450.6229|\n|            2023|suicide_watch_alert          |No       | 23057| 20621| 0.9531756| 95.317556| 9531.7556|\n|            2023|suicide_watch_alert          |Yes      |  1066|  1013| 0.0468244|  4.682444|  468.2444|\n|            2024|age_category                 |18 to 24 |  3486|  2944| 0.1498905| 14.989054| 1498.9054|\n|            2024|age_category                 |25 to 49 | 16959| 14445| 0.7354514| 73.545135| 7354.5135|\n|            2024|age_category                 |50+      |  2550|  2252| 0.1146581| 11.465811| 1146.5811|\n|            2024|gender                       |Female   |  2219|  1924| 0.0979584|  9.795835|  979.5835|\n|            2024|gender                       |Male     | 20776| 17717| 0.9020416| 90.204165| 9020.4165|\n|            2024|mental_health_alert          |No       | 16562| 15146| 0.7372469| 73.724688| 7372.4688|\n|            2024|mental_health_alert          |Yes      |  6433|  5398| 0.2627531| 26.275312| 2627.5312|\n|            2024|region_at_time_of_placement  |Central  |  5949|  5228| 0.2569926| 25.699258| 2569.9258|\n|            2024|region_at_time_of_placement  |Eastern  |  7416|  6569| 0.3229121| 32.291206| 3229.1206|\n|            2024|region_at_time_of_placement  |Northern |  2852|  2417| 0.1188124| 11.881237| 1188.1237|\n|            2024|region_at_time_of_placement  |Toronto  |  2874|  2575| 0.1265792| 12.657917| 1265.7917|\n|            2024|region_at_time_of_placement  |Western  |  3904|  3554| 0.1747038| 17.470383| 1747.0383|\n|            2024|region_most_recent_placement |Central  |  5969|  5035| 0.2563515| 25.635151| 2563.5151|\n|            2024|region_most_recent_placement |Eastern  |  7400|  6382| 0.3249325| 32.493254| 3249.3254|\n|            2024|region_most_recent_placement |Northern |  2860|  2376| 0.1209714| 12.097144| 1209.7144|\n|            2024|region_most_recent_placement |Toronto  |  2896|  2408| 0.1226007| 12.260068| 1226.0068|\n|            2024|region_most_recent_placement |Western  |  3870|  3440| 0.1751438| 17.514383| 1751.4383|\n|            2024|suicide_risk_alert           |No       | 18616| 17315| 0.8272419| 82.724189| 8272.4189|\n|            2024|suicide_risk_alert           |Yes      |  4379|  3616| 0.1727581| 17.275811| 1727.5811|\n|            2024|suicide_watch_alert          |No       | 21198| 19259| 0.9190208| 91.902080| 9190.2081|\n|            2024|suicide_watch_alert          |Yes      |  1797|  1697| 0.0809792|  8.097919|  809.7919|\n|            2025|age_category                 |18 to 24 |  4429|  3688| 0.1472549| 14.725494| 1472.5494|\n|            2025|age_category                 |25 to 49 | 22122| 18482| 0.7379517| 73.795169| 7379.5169|\n|            2025|age_category                 |50+      |  3265|  2875| 0.1147934| 11.479337| 1147.9337|\n|            2025|gender                       |Female   |  3311|  2821| 0.1126373| 11.263725| 1126.3725|\n|            2025|gender                       |Male     | 26505| 22224| 0.8873627| 88.736275| 8873.6275|\n|            2025|mental_health_alert          |No       | 21549| 19355| 0.7411166| 74.111656| 7411.1656|\n|            2025|mental_health_alert          |Yes      |  8267|  6761| 0.2588834| 25.888344| 2588.8344|\n|            2025|region_at_time_of_placement  |Central  |  9031|  8054| 0.3044645| 30.446452| 3044.6452|\n|            2025|region_at_time_of_placement  |Eastern  |  7122|  6163| 0.2329792| 23.297925| 2329.7925|\n|            2025|region_at_time_of_placement  |Northern |  2836|  2443| 0.0923525|  9.235247|  923.5247|\n|            2025|region_at_time_of_placement  |Toronto  |  6273|  5639| 0.2131705| 21.317053| 2131.7053|\n|            2025|region_at_time_of_placement  |Western  |  4554|  4154| 0.1570332| 15.703323| 1570.3323|\n|            2025|region_most_recent_placement |Central  |  8961|  7591| 0.3030944| 30.309443| 3030.9443|\n|            2025|region_most_recent_placement |Eastern  |  7022|  5868| 0.2342983| 23.429826| 2342.9826|\n|            2025|region_most_recent_placement |Northern |  2798|  2332| 0.0931124|  9.311240|  931.1240|\n|            2025|region_most_recent_placement |Toronto  |  6422|  5324| 0.2125774| 21.257736| 2125.7736|\n|            2025|region_most_recent_placement |Western  |  4613|  3930| 0.1569175| 15.691755| 1569.1755|\n|            2025|suicide_risk_alert           |No       | 24233| 22190| 0.8314598| 83.145983| 8314.5983|\n|            2025|suicide_risk_alert           |Yes      |  5583|  4498| 0.1685402| 16.854017| 1685.4017|\n|            2025|suicide_watch_alert          |No       | 27460| 24553| 0.9173890| 91.738903| 9173.8903|\n|            2025|suicide_watch_alert          |Yes      |  2356|  2211| 0.0826110|  8.261097|  826.1097|\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DoubleML)\nlibrary(mlr3)\nlibrary(mlr3learners)\nlibrary(data.table)\nlibrary(dplyr)\nlibrary(parallel)\nlgr::get_logger(\"mlr3\")$set_threshold(\"warn\")\n# \"regr.lm\" instead of \"regr.ranger\" utilized (disclaimer)\n# \"classif.log_reg\", predict_type = \"prob\" instead of classif.ranger\n# cores <- max(1L, parallel::detectCores() - 1L)\n# yn_cols <- c(\"mental_health_alert\", \"suicide_risk_alert\", \"suicide_watch_alert\")\n# dfn <- dfn %>%\n#   mutate(across(\n#     all_of(yn_cols),\n#     ~ factor(dplyr::if_else(.x == \"Yes\", 1L, 0L), levels = c(0, 1))\n#   ))\n# dt <- as.data.table(dfn)\n# dt[, number_of_placements := as.integer(number_of_placements)]\n# dt <- dt[!is.na(number_of_placements) & number_of_placements > 0L]\n# N_expanded <- sum(dt$number_of_placements)\n# message(\"Expanded N = \", format(N_expanded, big.mark = \",\"))\n# dt <- dt[rep.int(seq_len(.N), number_of_placements)]\n# dt[, Y := as.integer(suicide_risk_alert) - 1L]\n# dt[, D := as.integer(mental_health_alert) - 1L]\n# stopifnot(identical(sort(unique(dt$D)), c(0L, 1L)))\n# dt[, cluster_id := as.factor(unique_individual_id)]\n# ml_g <- lrn(\"regr.lm\")\n# ml_m <- lrn(\"classif.log_reg\", predict_type = \"prob\")\n# fit_irm_ate_atte <- function(dsub, x_cols, tag) {\n#   dml_data <- DoubleMLClusterData$new(\n#     data = dsub,\n#     y_col = \"Y\",\n#     d_cols = \"D\",\n#     x_cols = x_cols,\n#     cluster_cols = \"cluster_id\"\n#   )\n#   set.seed(1111111111)\n#   obj_ate <- DoubleMLIRM$new(\n#     dml_data,\n#     ml_g = ml_g,\n#     ml_m = ml_m,\n#     n_folds = 3,\n#     n_rep = 1,\n#     score = \"ATE\"\n#   )\n#   obj_ate$fit()\n#   set.seed(1111111111)\n#   obj_atte <- DoubleMLIRM$new(\n#     dml_data,\n#     ml_g = ml_g,\n#     ml_m = ml_m,\n#     n_folds = 3,\n#     n_rep = 1,\n#     score = \"ATTE\"\n#   )\n#   obj_atte$fit()\n#   mk <- function(obj, estimand) {\n#     ci <- obj$confint(level = 0.95)\n#     data.table(\n#       group = tag,\n#       estimand = estimand,\n#       effect = as.numeric(obj$coef),\n#       se = as.numeric(obj$se),\n#       t_value = as.numeric(obj$t_stat),\n#       p_value = as.numeric(obj$pval),\n#       ci_low = as.numeric(ci[1, 1]),\n#       ci_high = as.numeric(ci[1, 2])\n#     )\n#   }\n#   rbind(mk(obj_ate, \"ATE\"), mk(obj_atte, \"ATTE\"))\n# }\n# x_cols_pool <- c(\n#   \"gender\",\n#   \"age_category\",\n#   \"region_at_time_of_placement\",\n#   \"region_most_recent_placement\",\n#   \"end_fiscal_year\"\n# )\n# dt[, (x_cols_pool) := lapply(.SD, as.factor), .SDcols = x_cols_pool]\n# keep_pool <- complete.cases(dt[,\n#   c(\"Y\", \"D\", \"cluster_id\", x_cols_pool),\n#   with = FALSE\n# ])\n# dsub_pool <- dt[keep_pool, c(\"Y\", \"D\", \"cluster_id\", x_cols_pool), with = FALSE]\n# res_pool <- fit_irm_ate_atte(dsub_pool, x_cols_pool, tag = \"Pooled 2023-25\")\n# years <- sort(unique(dt$end_fiscal_year))\n# x_cols_year <- c(\n#   \"gender\",\n#   \"age_category\",\n#   \"region_at_time_of_placement\",\n#   \"region_most_recent_placement\"\n# )\n# res_by_year <- rbindlist(lapply(years, function(yy) {\n#   sub <- dt[end_fiscal_year == yy]\n#   sub[, (x_cols_year) := lapply(.SD, as.factor), .SDcols = x_cols_year]\n#   keep_y <- complete.cases(sub[,\n#     c(\"Y\", \"D\", \"cluster_id\", x_cols_year),\n#     with = FALSE\n#   ])\n#   dsub_y <- sub[keep_y, c(\"Y\", \"D\", \"cluster_id\", x_cols_year), with = FALSE]\n#   fit_irm_ate_atte(dsub_y, x_cols_year, tag = as.character(yy))\n# }))\n\nsetHook(packageEvent(\"graphics\", \"onLoad\"), function(...) par(ask = FALSE))\nsetnames(\n  dataframe_original,\n  old = c(\n    \"x1a\",\n    \"unique_individual_id\",\n    \"x1b\",\n    \"x1c\",\n    \"x1d\",\n    \"x1f\",\n    \"x1g\",\n    \"x1h\",\n    \"x1i\"\n  ),\n  new = c(\"year\", \"id\", \"regA\", \"regB\", \"sex\", \"binA\", \"binB\", \"binC\", \"np\")\n)\n\ndt1b <- as.data.table(dataframe_original)\nplacement_dist <- dt1b[,\n  .(\n    total_placements = sum(np),\n    unique_status_rows = .N\n  ),\n  by = .(id, year)\n]\n\nsummary_report <- placement_dist[,\n  .(\n    total_unique_people = .N,\n    avg_placements_per_person = mean(total_placements),\n    median_placements = median(total_placements),\n    max_placements = max(total_placements),\n    avg_status_changes = mean(unique_status_rows),\n    max_status_changes = max(unique_status_rows)\n  ),\n  by = year\n][order(year)]\n\n# Summary of Placement Distribution by Year\nknitr::kable(\n  summary_report,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`summary_report`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`summary_report`)\n\n| year| total_unique_people| avg_placements_per_person| median_placements| max_placements| avg_status_changes| max_status_changes|\n|----:|-------------------:|-------------------------:|-----------------:|--------------:|------------------:|------------------:|\n| 2023|               20781|                  21.25749|                10|            362|           1.160820|                  7|\n| 2024|               19641|                  27.88183|                 8|            366|           1.170765|                  8|\n| 2025|               25045|                  37.69008|                 8|            364|           1.190497|                  8|\n\n\n:::\n\n```{.r .cell-code}\n# Frequency of Status Combinations per Person\nas.data.frame(table(placement_dist$unique_status_rows))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  Var1  Freq\n1    1 56367\n2    2  7300\n3    3  1397\n4    4   286\n5    5    83\n6    6    25\n7    7     5\n8    8     4\n```\n\n\n:::\n\n```{.r .cell-code}\nplacement_rows <- as.data.frame(table(placement_dist$unique_status_rows))\nknitr::kable(\n  placement_rows,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`placement_rows`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`placement_rows`)\n\n|Var1 |  Freq|\n|:----|-----:|\n|1    | 56367|\n|2    |  7300|\n|3    |  1397|\n|4    |   286|\n|5    |    83|\n|6    |    25|\n|7    |     5|\n|8    |     4|\n\n\n:::\n\n```{.r .cell-code}\ntop_rows <- placement_dist[order(-unique_status_rows)][1:10]\nknitr::kable(\n  top_rows,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`top_rows`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`top_rows`)\n\n|id            | year| total_placements| unique_status_rows|\n|:-------------|----:|----------------:|------------------:|\n|2024-09049-RC | 2024|               91|                  8|\n|2025-01080-RC | 2025|               83|                  8|\n|2025-10704-RC | 2025|              181|                  8|\n|2025-11914-RC | 2025|              122|                  8|\n|2023-06822-RC | 2023|               94|                  7|\n|2023-15226-RC | 2023|               30|                  7|\n|2024-03863-RC | 2024|               27|                  7|\n|2025-18531-RC | 2025|              108|                  7|\n|2025-20049-RC | 2025|               83|                  7|\n|2023-03600-RC | 2023|               48|                  6|\n\n\n:::\n\n```{.r .cell-code}\nrow_counts_summary <- placement_dist[,\n  .(count_of_people = .N),\n  by = unique_status_rows\n][order(unique_status_rows)]\n# how many people have 1, 2,...n rows ?:!\nknitr::kable(\n  row_counts_summary,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`row_counts_summary`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`row_counts_summary`)\n\n| unique_status_rows| count_of_people|\n|------------------:|---------------:|\n|                  1|           56367|\n|                  2|            7300|\n|                  3|            1397|\n|                  4|             286|\n|                  5|              83|\n|                  6|              25|\n|                  7|               5|\n|                  8|               4|\n\n\n:::\n\n```{.r .cell-code}\nsetnames(dt1b, \"x1e\", \"age\")\nbin_cols <- c(\"binA\", \"binB\", \"binC\")\ndt1b[,\n  (bin_cols) := lapply(.SD, function(x) ifelse(x == \"Yes\", 1L, 0L)),\n  .SDcols = bin_cols\n]\ndt1b[age == \"18 to 24\", `:=`(age_num = 21, age_order = 1L)]\ndt1b[age == \"25 to 49\", `:=`(age_num = 42, age_order = 2L)]\ndt1b[age == \"50+\", `:=`(age_num = 57.5, age_order = 3L)]\ndt1b[,\n  age_factor := factor(\n    age,\n    levels = c(\"A\", \"B\", \"C\"),\n    ordered = TRUE\n  )\n]\ncat_cols <- c(\"regA\", \"regB\", \"sex\")\ndt1b[, (cat_cols) := lapply(.SD, as.factor), .SDcols = cat_cols]\n\ndt1b[, a1 := as.integer(binA == 1 & binB == 0 & binC == 0)] # 1,0,0\ndt1b[, a2 := as.integer(binA == 0 & binB == 1 & binC == 0)] # 0,1,0\ndt1b[, a3 := as.integer(binA == 0 & binB == 0 & binC == 1)] # 0,0,1\ndt1b[, a4 := as.integer(binA == 1 & binB == 1 & binC == 0)] # 1,1,0\ndt1b[, a5 := as.integer(binA == 0 & binB == 1 & binC == 1)] # 0,1,1\ndt1b[, a6 := as.integer(binA == 1 & binB == 0 & binC == 1)] # 1,0,1\ndt1b[, a7 := as.integer(binA == 1 & binB == 1 & binC == 1)] # 1,1,1\ndt1b[, a8 := as.integer(binA == 0 & binB == 0 & binC == 0)] # 0,0,0\n\ndt_unbiased <- dt1b[,\n  .(\n    a1 = sum(a1 * np),\n    a2 = sum(a2 * np),\n    a3 = sum(a3 * np),\n    a4 = sum(a4 * np),\n    a5 = sum(a5 * np),\n    a6 = sum(a6 * np),\n    a7 = sum(a7 * np),\n    a8 = sum(a8 * np),\n    Y = sum(binB * np) / sum(np),\n    D = sum(binA * np) / sum(np),\n    total_np = sum(np),\n    age_val = first(age_num),\n    sex = first(sex),\n    regA = first(regA)\n  ),\n  by = .(id, year)\n]\n\nstate_cols <- paste0(\"a\", 1:8)\ndt_unbiased[, combo_count := rowSums(.SD > 0), .SDcols = state_cols]\ndt_8 <- dt_unbiased[combo_count == 8]\ndt_7 <- dt_unbiased[combo_count == 7]\ndt_6 <- dt_unbiased[combo_count == 6]\ndt_5 <- dt_unbiased[combo_count == 5]\ndt_4 <- dt_unbiased[combo_count == 4]\ndt_3 <- dt_unbiased[combo_count == 3]\ndt_2 <- dt_unbiased[combo_count == 2]\ndt_1 <- dt_unbiased[combo_count == 1]\ndt_2plus <- dt_unbiased[combo_count >= 2]\n\nsubset_summary <- dt_unbiased[, .(n_persons = .N), by = combo_count][order(\n  -combo_count\n)]\nknitr::kable(\n  subset_summary,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`subset_summary`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`subset_summary`)\n\n| combo_count| n_persons|\n|-----------:|---------:|\n|           6|        12|\n|           5|        35|\n|           4|       163|\n|           3|      1092|\n|           2|      5958|\n|           1|     58207|\n\n\n:::\n\n```{.r .cell-code}\nprint(paste(\n  \"Number of rows with NA combo_count:\",\n  sum(is.na(dt_unbiased$combo_count))\n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Number of rows with NA combo_count: 0\"\n```\n\n\n:::\n\n```{.r .cell-code}\nalert_stats <- summary(dt_unbiased[, .(a1, a2, a3, a4, a5, a6, a7, a8)])\nknitr::kable(\n  alert_stats,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`alert_stats`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`alert_stats`)\n\n|   |      a1        |      a2        |      a3  |      a4        |      a5         |      a6  |      a7         |      a8       |\n|:--|:---------------|:---------------|:---------|:---------------|:----------------|:---------|:----------------|:--------------|\n|   |Min.   :  0.000 |Min.   :  0.000 |Min.   :0 |Min.   :  0.000 |Min.   :  0.0000 |Min.   :0 |Min.   :  0.0000 |Min.   :  0.00 |\n|   |1st Qu.:  0.000 |1st Qu.:  0.000 |1st Qu.:0 |1st Qu.:  0.000 |1st Qu.:  0.0000 |1st Qu.:0 |1st Qu.:  0.0000 |1st Qu.:  0.00 |\n|   |Median :  0.000 |Median :  0.000 |Median :0 |Median :  0.000 |Median :  0.0000 |Median :0 |Median :  0.0000 |Median :  3.00 |\n|   |Mean   :  6.995 |Mean   :  1.294 |Mean   :0 |Mean   :  1.841 |Mean   :  0.3006 |Mean   :0 |Mean   :  0.3485 |Mean   : 18.75 |\n|   |3rd Qu.:  0.000 |3rd Qu.:  0.000 |3rd Qu.:0 |3rd Qu.:  0.000 |3rd Qu.:  0.0000 |3rd Qu.:0 |3rd Qu.:  0.0000 |3rd Qu.: 14.00 |\n|   |Max.   :364.000 |Max.   :357.000 |Max.   :0 |Max.   :364.000 |Max.   :340.0000 |Max.   :0 |Max.   :293.0000 |Max.   :366.00 |\n\n\n:::\n\n```{.r .cell-code}\ndt_unbiased[,\n  combo_count_robust := rowSums(.SD > 0, na.rm = TRUE),\n  .SDcols = state_cols\n]\n\nalert_stats1a <- as.data.frame(table(dt_unbiased$combo_count_robust)) \n\n# Then pass it to kable\nknitr::kable(\n  alert_stats1a,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`alert_stats1a`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`alert_stats1a`)\n\n|Var1 |  Freq|\n|:----|-----:|\n|1    | 58207|\n|2    |  5958|\n|3    |  1092|\n|4    |   163|\n|5    |    35|\n|6    |    12|\n\n\n:::\n\n```{.r .cell-code}\ntop_ids <- placement_dist[unique_status_rows >= 7, id]\ncomplex_moves <- dt_unbiased[id %in% top_ids]\nprint(complex_moves[, .(id, combo_count, total_np, a1, a2, a4, a5, a7, a8)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              id combo_count total_np    a1    a2    a4    a5    a7    a8\n          <char>       <num>    <num> <num> <num> <num> <num> <num> <num>\n1: 2023-06822-RC           5       94     9    27     1    12     0    45\n2: 2023-15226-RC           4       30    20     0     0     3     1     6\n3: 2024-03863-RC           3       27    10     0     0     1     0    16\n4: 2024-09049-RC           4       91    40     0     2     0     4    45\n5: 2025-01080-RC           6       83    12    20     3     4    39     5\n6: 2025-10704-RC           3      181     0     8     0     5     0   168\n7: 2025-11914-RC           6      122    35     2     3    10    32    40\n8: 2025-18531-RC           3      108     0     2     0     4     0   102\n9: 2025-20049-RC           5       83    20     0    31     2     6    24\n```\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  complex_moves[, .(id, combo_count, total_np, a1, a2, a4, a5, a7, a8)],\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_moves`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`complex_moves`)\n\n|id            | combo_count| total_np| a1| a2| a4| a5| a7|  a8|\n|:-------------|-----------:|--------:|--:|--:|--:|--:|--:|---:|\n|2023-06822-RC |           5|       94|  9| 27|  1| 12|  0|  45|\n|2023-15226-RC |           4|       30| 20|  0|  0|  3|  1|   6|\n|2024-03863-RC |           3|       27| 10|  0|  0|  1|  0|  16|\n|2024-09049-RC |           4|       91| 40|  0|  2|  0|  4|  45|\n|2025-01080-RC |           6|       83| 12| 20|  3|  4| 39|   5|\n|2025-10704-RC |           3|      181|  0|  8|  0|  5|  0| 168|\n|2025-11914-RC |           6|      122| 35|  2|  3| 10| 32|  40|\n|2025-18531-RC |           3|      108|  0|  2|  0|  4|  0| 102|\n|2025-20049-RC |           5|       83| 20|  0| 31|  2|  6|  24|\n\n\n:::\n\n```{.r .cell-code}\nregion_profile <- dcast(\n  dt1b[id %in% top_ids],\n  id + year ~ regA,\n  value.var = \"np\",\n  fun.aggregate = sum\n)\n\ncomplex_subset <- merge(\n  dt_unbiased[\n    id %in% top_ids,\n    .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)\n  ],\n  region_profile,\n  by = c(\"id\", \"year\")\n)\nknitr::kable(\n  complex_subset,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_subset`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`complex_subset`)\n\n|id            | year| combo_count| total_np| a1| a2| a4| a5| a7|  a8| Central| Eastern| Toronto| Western|\n|:-------------|----:|-----------:|--------:|--:|--:|--:|--:|--:|---:|-------:|-------:|-------:|-------:|\n|2023-06822-RC | 2023|           5|       94|  9| 27|  1| 12|  0|  45|       0|      49|      45|       0|\n|2023-15226-RC | 2023|           4|       30| 20|  0|  0|  3|  1|   6|      25|       2|       3|       0|\n|2024-03863-RC | 2024|           3|       27| 10|  0|  0|  1|  0|  16|       4|       6|      15|       2|\n|2024-09049-RC | 2024|           4|       91| 40|  0|  2|  0|  4|  45|      19|      18|      47|       7|\n|2025-01080-RC | 2025|           6|       83| 12| 20|  3|  4| 39|   5|       7|      64|      12|       0|\n|2025-10704-RC | 2025|           3|      181|  0|  8|  0|  5|  0| 168|      29|       0|     137|      15|\n|2025-11914-RC | 2025|           6|      122| 35|  2|  3| 10| 32|  40|      24|      98|       0|       0|\n|2025-18531-RC | 2025|           3|      108|  0|  2|  0|  4|  0| 102|      81|      17|       3|       7|\n|2025-20049-RC | 2025|           5|       83| 20|  0| 31|  2|  6|  24|      36|       0|      47|       0|\n\n\n:::\n\n```{.r .cell-code}\ndt_complex_raw <- dt1b[id %in% top_ids]\nregA_counts <- dcast(\n  dt_complex_raw,\n  id + year ~ regA,\n  value.var = \"np\",\n  fun.aggregate = sum\n)\nsetnames(\n  regA_counts,\n  old = setdiff(names(regA_counts), c(\"id\", \"year\")),\n  new = paste0(setdiff(names(regA_counts), c(\"id\", \"year\")), \"_A\")\n)\n\nregB_counts <- dcast(\n  dt_complex_raw,\n  id + year ~ regB,\n  value.var = \"np\",\n  fun.aggregate = sum\n)\nsetnames(\n  regB_counts,\n  old = setdiff(names(regB_counts), c(\"id\", \"year\")),\n  new = paste0(setdiff(names(regB_counts), c(\"id\", \"year\")), \"_B\")\n)\n\ncomplex_subset <- merge(\n  dt_unbiased[\n    id %in% top_ids,\n    .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)\n  ],\n  regA_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\ncomplex_subset <- merge(\n  complex_subset,\n  regB_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\n\ncomplex_subset[is.na(complex_subset)] <- as.double(0)\n\nknitr::kable(\n  complex_subset,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_subset`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`complex_subset`)\n\n|id            | year| combo_count| total_np| a1| a2| a4| a5| a7|  a8| Central_A| Eastern_A| Toronto_A| Western_A| Eastern_B| Toronto_B| Western_B|\n|:-------------|----:|-----------:|--------:|--:|--:|--:|--:|--:|---:|---------:|---------:|---------:|---------:|---------:|---------:|---------:|\n|2023-06822-RC | 2023|           5|       94|  9| 27|  1| 12|  0|  45|         0|        49|        45|         0|        94|         0|         0|\n|2023-15226-RC | 2023|           4|       30| 20|  0|  0|  3|  1|   6|        25|         2|         3|         0|         0|        30|         0|\n|2024-03863-RC | 2024|           3|       27| 10|  0|  0|  1|  0|  16|         4|         6|        15|         2|        27|         0|         0|\n|2024-09049-RC | 2024|           4|       91| 40|  0|  2|  0|  4|  45|        19|        18|        47|         7|         0|        91|         0|\n|2025-01080-RC | 2025|           6|       83| 12| 20|  3|  4| 39|   5|         7|        64|        12|         0|         0|        83|         0|\n|2025-10704-RC | 2025|           3|      181|  0|  8|  0|  5|  0| 168|        29|         0|       137|        15|         0|         0|       181|\n|2025-11914-RC | 2025|           6|      122| 35|  2|  3| 10| 32|  40|        24|        98|         0|         0|       122|         0|         0|\n|2025-18531-RC | 2025|           3|      108|  0|  2|  0|  4|  0| 102|        81|        17|         3|         7|         0|       108|         0|\n|2025-20049-RC | 2025|           5|       83| 20|  0| 31|  2|  6|  24|        36|         0|        47|         0|         0|        83|         0|\n\n\n:::\n\n```{.r .cell-code}\nall_regions <- c(\"Toronto\", \"Central\", \"Eastern\", \"Western\", \"Northern\")\ndt_complex_raw <- dt1b[id %in% top_ids]\ndt_complex_raw[, regA := factor(regA, levels = all_regions)]\ndt_complex_raw[, regB := factor(regB, levels = all_regions)]\n\nregA_counts <- dcast(\n  dt_complex_raw,\n  id + year ~ regA,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  drop = FALSE\n)\n\nsetnames(regA_counts, old = all_regions, new = paste0(all_regions, \"_A\"))\n\nregB_counts <- dcast(\n  dt_complex_raw,\n  id + year ~ regB,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  drop = FALSE\n)\n\nsetnames(regB_counts, old = all_regions, new = paste0(all_regions, \"_B\"))\n\ncomplex_subset <- dt_unbiased[\n  id %in% top_ids,\n  .(id, year, combo_count, total_np, a1, a2, a4, a5, a7, a8)\n]\n\ncomplex_subset <- merge(\n  complex_subset,\n  regA_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\ncomplex_subset <- merge(\n  complex_subset,\n  regB_counts,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\n\ncols_to_fix <- c(paste0(all_regions, \"_A\"), paste0(all_regions, \"_B\"))\ncomplex_subset[,\n  (cols_to_fix) := lapply(.SD, function(x) ifelse(is.na(x), 0, x)),\n  .SDcols = cols_to_fix\n]\n\n# Complex Cases (10 Regional Columns + Possible Alert Status Combinations)\nknitr::kable(\n  complex_subset,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`complex_subset`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`complex_subset`)\n\n|id            | year| combo_count| total_np| a1| a2| a4| a5| a7|  a8| Toronto_A| Central_A| Eastern_A| Western_A| Northern_A| Toronto_B| Central_B| Eastern_B| Western_B| Northern_B|\n|:-------------|----:|-----------:|--------:|--:|--:|--:|--:|--:|---:|---------:|---------:|---------:|---------:|----------:|---------:|---------:|---------:|---------:|----------:|\n|2023-06822-RC | 2023|           5|       94|  9| 27|  1| 12|  0|  45|        45|         0|        49|         0|          0|         0|         0|        94|         0|          0|\n|2023-15226-RC | 2023|           4|       30| 20|  0|  0|  3|  1|   6|         3|        25|         2|         0|          0|        30|         0|         0|         0|          0|\n|2024-03863-RC | 2024|           3|       27| 10|  0|  0|  1|  0|  16|        15|         4|         6|         2|          0|         0|         0|        27|         0|          0|\n|2024-09049-RC | 2024|           4|       91| 40|  0|  2|  0|  4|  45|        47|        19|        18|         7|          0|        91|         0|         0|         0|          0|\n|2025-01080-RC | 2025|           6|       83| 12| 20|  3|  4| 39|   5|        12|         7|        64|         0|          0|        83|         0|         0|         0|          0|\n|2025-10704-RC | 2025|           3|      181|  0|  8|  0|  5|  0| 168|       137|        29|         0|        15|          0|         0|         0|         0|       181|          0|\n|2025-11914-RC | 2025|           6|      122| 35|  2|  3| 10| 32|  40|         0|        24|        98|         0|          0|         0|         0|       122|         0|          0|\n|2025-18531-RC | 2025|           3|      108|  0|  2|  0|  4|  0| 102|         3|        81|        17|         7|          0|       108|         0|         0|         0|          0|\n|2025-20049-RC | 2025|           5|       83| 20|  0| 31|  2|  6|  24|        47|        36|         0|         0|          0|        83|         0|         0|         0|          0|\n\n\n:::\n\n```{.r .cell-code}\ndt_moves_corrected <- dt1b[\n  order(id, year),\n  .(\n    id,\n    year,\n    internal_move = as.integer(regA != regB),\n    external_move = as.integer(regA != shift(regA, type = \"lag\"))\n  ),\n  by = .(id, year)\n]\nregional_volatility <- dt_moves_corrected[,\n  .(\n    total_regional_changes = sum(\n      internal_move == 1 | (external_move == 1 & !is.na(external_move))\n    )\n  ),\n  by = .(id, year)\n]\ndt_unbiased <- merge(\n  dt_unbiased,\n  regional_volatility,\n  by = c(\"id\", \"year\"),\n  all.x = TRUE\n)\nmove_summary <- dt_unbiased[,\n  .(n_persons = .N),\n  by = total_regional_changes\n][order(total_regional_changes)]\nprint(move_summary)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   total_regional_changes n_persons\n                    <int>     <int>\n1:                      0     62901\n2:                      1       362\n3:                      2      1800\n4:                      3       315\n5:                      4        64\n6:                      5        18\n7:                      6         2\n8:                      7         4\n9:                      8         1\n```\n\n\n:::\n\n```{.r .cell-code}\nregion_counts_per_id <- dt1b[,\n  .(\n    unique_regions = list(unique(c(regA, regB)))\n  ),\n  by = .(id, year)\n]\nregion_counts_per_id[, n_regions := sapply(unique_regions, length)]\nmulti_region_ids <- region_counts_per_id[n_regions > 1]\ntotal_multi_region_persons <- nrow(multi_region_ids)\ntotal_unique_persons <- nrow(region_counts_per_id)\n\nprint(paste(\"Total Unique Person-IDs in dataset:\", total_unique_persons))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Total Unique Person-IDs in dataset: 65467\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(paste(\"Number of Person-IDs with >1 region:\", total_multi_region_persons))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Number of Person-IDs with >1 region: 2566\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(paste(\n  \"Percentage of population moving regions:\",\n  round((total_multi_region_persons / total_unique_persons) * 100, 2),\n  \"%\"\n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Percentage of population moving regions: 3.92 %\"\n```\n\n\n:::\n\n```{.r .cell-code}\nreg_count_id <- table(region_counts_per_id$n_regions)\nknitr::kable(\n  reg_count_id,\n  booktabs = TRUE,\n  longtable = TRUE,\n  caption = '(`reg_count_id`)'\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: (`reg_count_id`)\n\n|Var1 |  Freq|\n|:----|-----:|\n|1    | 62901|\n|2    |  2425|\n|3    |   137|\n|4    |     4|\n\n\n:::\n\n```{.r .cell-code}\ndt1b[,\n  status_combo := case_when(\n    binA == 1 & binB == 0 & binC == 0 ~ \"a1\",\n    binA == 0 & binB == 1 & binC == 0 ~ \"a2\",\n    binA == 0 & binB == 0 & binC == 1 ~ \"a3\",\n    binA == 1 & binB == 1 & binC == 0 ~ \"a4\",\n    binA == 0 & binB == 1 & binC == 1 ~ \"a5\",\n    binA == 1 & binB == 0 & binC == 1 ~ \"a6\",\n    binA == 1 & binB == 1 & binC == 1 ~ \"a7\",\n    binA == 0 & binB == 0 & binC == 0 ~ \"a8\"\n  )\n]\n\ndt1b[, reg_status_key := paste0(regA, \"_\", status_combo)]\ndt_40state <- dcast(\n  dt1b,\n  id + year + sex + age_num + age_order ~ reg_status_key,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  fill = 0\n)\n\nprint(paste(\"Number of columns in the new state-space:\", ncol(dt_40state)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Number of columns in the new state-space: 35\"\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(dt_40state)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nKey: <id, year, sex, age_num, age_order>\n              id  year    sex age_num age_order Central_a1 Central_a2\n          <char> <num> <fctr>   <num>     <int>      <num>      <num>\n1: 2023-00001-RC  2023   Male    42.0         2          0          0\n2: 2023-00002-RC  2023   Male    57.5         3          0          0\n3: 2023-00003-RC  2023   Male    42.0         2          0          0\n4: 2023-00004-RC  2023   Male    42.0         2          0          0\n5: 2023-00005-RC  2023   Male    57.5         3          0          0\n6: 2023-00006-RC  2023   Male    57.5         3          0          0\n   Central_a4 Central_a5 Central_a7 Central_a8 Eastern_a1 Eastern_a2 Eastern_a4\n        <num>      <num>      <num>      <num>      <num>      <num>      <num>\n1:          0          0          0          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          0          9\n4:          0          0          0          0          0          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Eastern_a5 Eastern_a7 Eastern_a8 Northern_a1 Northern_a2 Northern_a4\n        <num>      <num>      <num>       <num>       <num>       <num>\n1:          0          0          0           0           0           0\n2:          0          0          0           0           0           0\n3:          0          0          0           0           0           0\n4:          0          0          0           0           0           0\n5:          0          0          8           0           0           0\n6:          0          0          8           0           0           0\n   Northern_a5 Northern_a7 Northern_a8 Toronto_a1 Toronto_a2 Toronto_a4\n         <num>       <num>       <num>      <num>      <num>      <num>\n1:           0           0           0          0          8          0\n2:           0           0          20          0          0          0\n3:           0           0           0          0          0          0\n4:           0           0           0          0          0          0\n5:           0           0           0          0          0          0\n6:           0           0           0          0          0          0\n   Toronto_a5 Toronto_a7 Toronto_a8 Western_a1 Western_a2 Western_a4 Western_a5\n        <num>      <num>      <num>      <num>      <num>      <num>      <num>\n1:          0          0         26          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          0          0\n4:          0          0          0          0         11          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Western_a7 Western_a8\n        <num>      <num>\n1:          0          0\n2:          0          0\n3:          0          0\n4:          0          0\n5:          0          0\n6:          0          0\n```\n\n\n:::\n\n```{.r .cell-code}\nstate_totals <- colSums(dt_40state[, .SD, .SDcols = patterns(\"_a[1-8]\")])\n\nstate_summary <- data.table(\n  state = names(state_totals),\n  total_placements = state_totals\n)[order(-total_placements)]\n\nprint(\"Top Ten Empirical Region-Status combinations:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Top Ten Empirical Region-Status combinations:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(head(state_summary, 10))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          state total_placements\n         <char>            <num>\n 1:  Central_a8           440242\n 2:  Eastern_a8           421376\n 3:  Toronto_a8           197025\n 4:  Eastern_a1           196748\n 5:  Central_a1           105275\n 6:  Western_a8            94102\n 7:  Toronto_a1            93729\n 8: Northern_a8            74921\n 9:  Eastern_a4            55094\n10:  Western_a1            36830\n```\n\n\n:::\n\n```{.r .cell-code}\nid_counts <- dt_40state[,\n  lapply(.SD, function(x) sum(x > 0)),\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nid_counts_t <- data.table(\n  state = names(id_counts),\n  count_of_people = as.numeric(id_counts)\n)[order(-count_of_people)]\n\nprint(\"Number of unique individuals who entered each state:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Number of unique individuals who entered each state:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(id_counts_t)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          state count_of_people\n         <char>           <num>\n 1:  Central_a8           15267\n 2:  Eastern_a8           12161\n 3:  Toronto_a8            8670\n 4:  Western_a8            7473\n 5: Northern_a8            5344\n 6:  Eastern_a1            4449\n 7:  Central_a1            3818\n 8:  Toronto_a1            2453\n 9:  Western_a1            2335\n10:  Eastern_a4            1283\n11: Northern_a1            1259\n12:  Eastern_a2            1177\n13: Northern_a2            1035\n14:  Central_a5            1023\n15:  Central_a4             921\n16:  Western_a4             919\n17:  Central_a7             870\n18: Northern_a4             788\n19:  Central_a2             744\n20:  Eastern_a5             695\n21:  Western_a2             655\n22:  Eastern_a7             584\n23:  Toronto_a2             498\n24:  Toronto_a4             466\n25:  Western_a5             438\n26:  Western_a7             410\n27: Northern_a5             363\n28: Northern_a7             321\n29:  Toronto_a5             294\n30:  Toronto_a7             221\n          state count_of_people\n         <char>           <num>\n```\n\n\n:::\n\n```{.r .cell-code}\ndt_40state[, states_visited := rowSums(.SD > 0), .SDcols = patterns(\"_a[1-8]\")]\n\ncomplexity_dist <- dt_40state[, .(n_people = .N), by = states_visited][order(\n  states_visited\n)]\n\nprint(\"How many unique Region-Status states did people visit?\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"How many unique Region-Status states did people visit?\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(complexity_dist)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   states_visited n_people\n            <num>    <int>\n1:              1    56367\n2:              2     7300\n3:              3     1397\n4:              4      286\n5:              5       83\n6:              6       25\n7:              7        5\n8:              8        4\n```\n\n\n:::\n\n```{.r .cell-code}\ndt1b[,\n  status_combo := case_when(\n    binA == 1 & binB == 0 & binC == 0 ~ \"a1\",\n    binA == 0 & binB == 1 & binC == 0 ~ \"a2\",\n    binA == 0 & binB == 0 & binC == 1 ~ \"a3\",\n    binA == 1 & binB == 1 & binC == 0 ~ \"a4\",\n    binA == 0 & binB == 1 & binC == 1 ~ \"a5\",\n    binA == 1 & binB == 0 & binC == 1 ~ \"a6\",\n    binA == 1 & binB == 1 & binC == 1 ~ \"a7\",\n    binA == 0 & binB == 0 & binC == 0 ~ \"a8\"\n  )\n]\n\ndt1b[, reg_status_key := paste0(regA, \"_\", status_combo)]\ndt_40state_yearly <- dcast(\n  dt1b,\n  id + year + sex + age_num ~ reg_status_key,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  fill = 0\n)\n\nyearly_stats <- dt_40state_yearly[,\n  .(\n    unique_ids = uniqueN(id),\n    total_placements = sum(.SD, na.rm = TRUE)\n  ),\n  by = year,\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nprint(yearly_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    year unique_ids total_placements\n   <num>      <int>            <num>\n1:  2023      20781           441752\n2:  2024      19641           547627\n3:  2025      25045           943948\n```\n\n\n:::\n\n```{.r .cell-code}\nsplit_summary <- dt_40state_yearly[,\n  lapply(.SD, sum),\n  by = year,\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nprint(\"First few rows of 2023 data:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"First few rows of 2023 data:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(dt_40state_yearly[year == 2023])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nKey: <id, year, sex, age_num>\n              id  year    sex age_num Central_a1 Central_a2 Central_a4\n          <char> <num> <fctr>   <num>      <num>      <num>      <num>\n1: 2023-00001-RC  2023   Male    42.0          0          0          0\n2: 2023-00002-RC  2023   Male    57.5          0          0          0\n3: 2023-00003-RC  2023   Male    42.0          0          0          0\n4: 2023-00004-RC  2023   Male    42.0          0          0          0\n5: 2023-00005-RC  2023   Male    57.5          0          0          0\n6: 2023-00006-RC  2023   Male    57.5          0          0          0\n   Central_a5 Central_a7 Central_a8 Eastern_a1 Eastern_a2 Eastern_a4 Eastern_a5\n        <num>      <num>      <num>      <num>      <num>      <num>      <num>\n1:          0          0          0          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          9          0\n4:          0          0          0          0          0          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Eastern_a7 Eastern_a8 Northern_a1 Northern_a2 Northern_a4 Northern_a5\n        <num>      <num>       <num>       <num>       <num>       <num>\n1:          0          0           0           0           0           0\n2:          0          0           0           0           0           0\n3:          0          0           0           0           0           0\n4:          0          0           0           0           0           0\n5:          0          8           0           0           0           0\n6:          0          8           0           0           0           0\n   Northern_a7 Northern_a8 Toronto_a1 Toronto_a2 Toronto_a4 Toronto_a5\n         <num>       <num>      <num>      <num>      <num>      <num>\n1:           0           0          0          8          0          0\n2:           0          20          0          0          0          0\n3:           0           0          0          0          0          0\n4:           0           0          0          0          0          0\n5:           0           0          0          0          0          0\n6:           0           0          0          0          0          0\n   Toronto_a7 Toronto_a8 Western_a1 Western_a2 Western_a4 Western_a5 Western_a7\n        <num>      <num>      <num>      <num>      <num>      <num>      <num>\n1:          0         26          0          0          0          0          0\n2:          0          0          0          0          0          0          0\n3:          0          0          0          0          0          0          0\n4:          0          0          0         11          0          0          0\n5:          0          0          0          0          0          0          0\n6:          0          0          0          0          0          0          0\n   Western_a8\n        <num>\n1:          0\n2:          0\n3:          0\n4:          0\n5:          0\n6:          0\n```\n\n\n:::\n\n```{.r .cell-code}\ndt_40state_yearly[,\n  combinations_this_year := rowSums(.SD > 0),\n  .SDcols = patterns(\"_a[1-8]\")\n]\ntable(dt_40state_yearly$year, dt_40state_yearly$combinations_this_year)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      \n           1     2     3     4     5     6     7     8\n  2023 18098  2175   394    85    23     4     2     0\n  2024 16992  2120   404    88    26     9     1     1\n  2025 21277  3005   599   113    34    12     2     3\n```\n\n\n:::\n\n```{.r .cell-code}\nid_counts_yearly <- dt_40state_yearly[,\n  lapply(.SD, function(x) sum(x > 0)),\n  by = year,\n  .SDcols = patterns(\"_a[1-8]\")\n]\n\nid_counts_long <- melt(\n  id_counts_yearly,\n  id.vars = \"year\",\n  variable.name = \"state\",\n  value.name = \"person_count\"\n)\n\nid_counts_long <- id_counts_long[order(year, -person_count)]\nprint(\"Top 5 most frequent Region-Status states per year:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Top 5 most frequent Region-Status states per year:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(id_counts_long[, head(.SD, 5), by = year])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     year       state person_count\n    <num>      <fctr>        <int>\n 1:  2023  Central_a8         5473\n 2:  2023  Eastern_a8         3336\n 3:  2023  Western_a8         2464\n 4:  2023  Toronto_a8         2265\n 5:  2023 Northern_a8         2250\n 6:  2024  Eastern_a8         4609\n 7:  2024  Central_a8         3791\n 8:  2024  Western_a8         2361\n 9:  2024  Toronto_a8         1904\n10:  2024 Northern_a8         1627\n11:  2025  Central_a8         6003\n12:  2025  Toronto_a8         4501\n13:  2025  Eastern_a8         4216\n14:  2025  Western_a8         2648\n15:  2025  Central_a1         1490\n```\n\n\n:::\n\n```{.r .cell-code}\nempty_states <- id_counts_long[,\n  .(total_across_years = sum(person_count)),\n  by = state\n][total_across_years == 0]\n\nprint(\"States with zero occupancy (these won't help the DoubleML):\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"States with zero occupancy (these won't help the DoubleML):\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(empty_states$state)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nfactor()\n30 Levels: Central_a1 Central_a2 Central_a4 Central_a5 ... Western_a8\n```\n\n\n:::\n\n```{.r .cell-code}\nreg_summary <- dt1b[,\n  .(\n    reg_count = uniqueN(c(regA, regB)),\n    regC = paste(sort(unique(c(regA, regB))), collapse = \" + \")\n  ),\n  by = .(id, year)\n]\n\nstatus_summary <- dcast(\n  dt1b,\n  id + year ~ status_combo,\n  value.var = \"np\",\n  fun.aggregate = sum,\n  fill = 0\n)\n\ndt_final_complex <- merge(status_summary, reg_summary, by = c(\"id\", \"year\"))\n\ndemo_info <- dt1b[,\n  .(\n    sex = first(sex),\n    age_num = first(age_num)\n  ),\n  by = .(id, year)\n]\n\ndt_final_complex <- merge(dt_final_complex, demo_info, by = c(\"id\", \"year\"))\n\nprint(head(dt_final_complex))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nKey: <id, year>\n              id  year    a1    a2    a4    a5    a7    a8 reg_count     regC\n          <char> <num> <num> <num> <num> <num> <num> <num>     <int>   <char>\n1: 2023-00001-RC  2023     0     8     0     0     0    26         1  Toronto\n2: 2023-00002-RC  2023     0     0     0     0     0    20         1 Northern\n3: 2023-00003-RC  2023     0     0     9     0     0     0         1  Eastern\n4: 2023-00004-RC  2023     0    11     0     0     0     0         1  Western\n5: 2023-00005-RC  2023     0     0     0     0     0     8         1  Eastern\n6: 2023-00006-RC  2023     0     0     0     0     0     8         1  Eastern\n      sex age_num\n   <fctr>   <num>\n1:   Male    42.0\n2:   Male    57.5\n3:   Male    42.0\n4:   Male    42.0\n5:   Male    57.5\n6:   Male    57.5\n```\n\n\n:::\n\n```{.r .cell-code}\nregC_stats <- dt_final_complex[, .(n_persons = .N), by = regC][order(\n  -n_persons\n)]\nprint(regC_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                      regC n_persons\n                                    <char>     <int>\n 1:                                Central     18403\n 2:                                Eastern     16765\n 3:                                Western     10374\n 4:                                Toronto      9829\n 5:                               Northern      7530\n 6:                      Central + Toronto       662\n 7:                      Central + Western       443\n 8:                      Eastern + Toronto       398\n 9:                      Central + Eastern       381\n10:                     Northern + Toronto       124\n11:                      Eastern + Western       116\n12:                      Toronto + Western        95\n13:                     Northern + Western        84\n14:                     Central + Northern        66\n15:                     Eastern + Northern        56\n16:            Central + Eastern + Toronto        54\n17:            Central + Toronto + Western        21\n18:            Central + Eastern + Western        19\n19:            Eastern + Toronto + Western        13\n20:           Central + Northern + Western        11\n21:           Central + Northern + Toronto         8\n22:           Eastern + Northern + Toronto         5\n23:           Northern + Toronto + Western         4\n24:  Central + Eastern + Toronto + Western         3\n25:           Eastern + Northern + Western         2\n26: Eastern + Northern + Toronto + Western         1\n                                      regC n_persons\n                                    <char>     <int>\n```\n\n\n:::\n\n```{.r .cell-code}\nregC_yearly_counts <- dt_final_complex[, .(n = .N), by = .(regC, year)]\n\nregC_stats_wide <- dcast(\n  regC_yearly_counts,\n  regC ~ year,\n  value.var = \"n\",\n  fill = 0\n)\n\nyear_cols <- setdiff(names(regC_stats_wide), \"regC\")\nnew_t_names <- paste0(\"t\", seq_along(year_cols))\nsetnames(regC_stats_wide, old = year_cols, new = new_t_names)\n\nregC_stats_wide[, n_persons := rowSums(.SD), .SDcols = new_t_names]\n\nsetcolorder(regC_stats_wide, c(\"regC\", \"n_persons\", new_t_names))\nregC_stats_wide <- regC_stats_wide[order(-n_persons)]\n\nprint(regC_stats_wide)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                      regC n_persons    t1    t2    t3\n                                    <char>     <num> <int> <int> <int>\n 1:                                Central     18403  6391  4839  7173\n 2:                                Eastern     16765  4869  6215  5681\n 3:                                Western     10374  3316  3363  3695\n 4:                                Toronto      9829  2687  2237  4905\n 5:                               Northern      7530  2949  2324  2257\n 6:                      Central + Toronto       662   178   144   340\n 7:                      Central + Western       443   107    75   261\n 8:                      Eastern + Toronto       398    91   133   174\n 9:                      Central + Eastern       381    66   123   192\n10:                     Northern + Toronto       124    17    19    88\n11:                      Eastern + Western       116    19    48    49\n12:                      Toronto + Western        95    14    16    65\n13:                     Northern + Western        84     9    32    43\n14:                     Central + Northern        66    27    17    22\n15:                     Eastern + Northern        56    23    19    14\n16:            Central + Eastern + Toronto        54     5    14    35\n17:            Central + Toronto + Western        21     3     3    15\n18:            Central + Eastern + Western        19     4     8     7\n19:            Eastern + Toronto + Western        13     0     4     9\n20:           Central + Northern + Western        11     2     2     7\n21:           Central + Northern + Toronto         8     1     1     6\n22:           Eastern + Northern + Toronto         5     2     2     1\n23:           Northern + Toronto + Western         4     1     0     3\n24:  Central + Eastern + Toronto + Western         3     0     2     1\n25:           Eastern + Northern + Western         2     0     1     1\n26: Eastern + Northern + Toronto + Western         1     0     0     1\n                                      regC n_persons    t1    t2    t3\n                                    <char>     <num> <int> <int> <int>\n```\n\n\n:::\n\n```{.r .cell-code}\ndemog_counts <- dt_final_complex[, .(n = .N), by = .(regC, year, sex)]\n\ndemog_wide <- dcast(demog_counts, regC ~ year + sex, value.var = \"n\", fill = 0)\n\nunique_years <- sort(unique(demog_counts$year))\n\nfor (i in seq_along(unique_years)) {\n  year_val <- unique_years[i]\n  suffix <- letters[i]\n  setnames(\n    demog_wide,\n    old = paste0(year_val, \"_Male\"),\n    new = paste0(\"g1\", suffix),\n    skip_absent = TRUE\n  )\n  setnames(\n    demog_wide,\n    old = paste0(year_val, \"_Female\"),\n    new = paste0(\"g2\", suffix),\n    skip_absent = TRUE\n  )\n}\n\ndemog_wide[, t1 := g1a + g2a]\ndemog_wide[, t2 := g1b + g2b]\ndemog_wide[, t3 := g1c + g2c]\n\ndemog_wide[, n_persons := t1 + t2 + t3]\n\nsetcolorder(\n  demog_wide,\n  c(\n    \"regC\",\n    \"n_persons\",\n    \"t1\",\n    \"t2\",\n    \"t3\",\n    \"g1a\",\n    \"g1b\",\n    \"g1c\",\n    \"g2a\",\n    \"g2b\",\n    \"g2c\"\n  )\n)\nregC_demog_stats <- demog_wide[order(-n_persons)]\n\nprint(regC_demog_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                      regC n_persons    t1    t2    t3   g1a\n                                    <char>     <int> <int> <int> <int> <int>\n 1:                                Central     18403  6391  4839  7173  6390\n 2:                                Eastern     16765  4869  6215  5681  4193\n 3:                                Western     10374  3316  3363  3695  2927\n 4:                                Toronto      9829  2687  2237  4905  2673\n 5:                               Northern      7530  2949  2324  2257  2526\n 6:                      Central + Toronto       662   178   144   340   178\n 7:                      Central + Western       443   107    75   261   107\n 8:                      Eastern + Toronto       398    91   133   174    91\n 9:                      Central + Eastern       381    66   123   192    65\n10:                     Northern + Toronto       124    17    19    88    17\n11:                      Eastern + Western       116    19    48    49    16\n12:                      Toronto + Western        95    14    16    65    14\n13:                     Northern + Western        84     9    32    43     8\n14:                     Central + Northern        66    27    17    22    27\n15:                     Eastern + Northern        56    23    19    14    20\n16:            Central + Eastern + Toronto        54     5    14    35     5\n17:            Central + Toronto + Western        21     3     3    15     3\n18:            Central + Eastern + Western        19     4     8     7     4\n19:            Eastern + Toronto + Western        13     0     4     9     0\n20:           Central + Northern + Western        11     2     2     7     2\n21:           Central + Northern + Toronto         8     1     1     6     1\n22:           Eastern + Northern + Toronto         5     2     2     1     2\n23:           Northern + Toronto + Western         4     1     0     3     1\n24:  Central + Eastern + Toronto + Western         3     0     2     1     0\n25:           Eastern + Northern + Western         2     0     1     1     0\n26: Eastern + Northern + Toronto + Western         1     0     0     1     0\n                                      regC n_persons    t1    t2    t3   g1a\n                                    <char>     <int> <int> <int> <int> <int>\n      g1b   g1c   g2a   g2b   g2c\n    <int> <int> <int> <int> <int>\n 1:  4836  6681     1     3   492\n 2:  5275  4542   676   940  1139\n 3:  2843  3137   389   520   558\n 4:  2222  4896    14    15     9\n 5:  1896  1724   423   428   533\n 6:   142   331     0     2     9\n 7:    73   248     0     2    13\n 8:   133   173     0     0     1\n 9:   121   153     1     2    39\n10:    19    87     0     0     1\n11:    42    42     3     6     7\n12:    16    65     0     0     0\n13:    26    37     1     6     6\n14:    17    19     0     0     3\n15:    19    10     3     0     4\n16:    14    34     0     0     1\n17:     3    15     0     0     0\n18:     8     5     0     0     2\n19:     4     9     0     0     0\n20:     2     4     0     0     3\n21:     1     6     0     0     0\n22:     2     1     0     0     0\n23:     0     3     0     0     0\n24:     2     1     0     0     0\n25:     1     0     0     0     1\n26:     0     1     0     0     0\n      g1b   g1c   g2a   g2b   g2c\n    <int> <int> <int> <int> <int>\n```\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(res_pool, digits = 4, caption = \"Pooled IRM DoubleML (20232025)\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Pooled IRM DoubleML (20232025)\n\n|group          |estimand | effect|     se| t_value| p_value| ci_low| ci_high|\n|:--------------|:--------|------:|------:|-------:|-------:|------:|-------:|\n|Pooled 2023-25 |ATE      | 0.1605| 0.0063| 25.5418|       0| 0.1481|  0.1728|\n|Pooled 2023-25 |ATTE     | 0.1557| 0.0061| 25.6923|       0| 0.1438|  0.1676|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  res_by_year,\n  digits = 4,\n  caption = \"Yearly IRM DoubleML (2023/2024/2025)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Yearly IRM DoubleML (2023/2024/2025)\n\n|group |estimand | effect|     se| t_value| p_value| ci_low| ci_high|\n|:-----|:--------|------:|------:|-------:|-------:|------:|-------:|\n|2023  |ATE      | 0.1342| 0.0099| 13.6093|       0| 0.1149|  0.1535|\n|2023  |ATTE     | 0.1272| 0.0103| 12.3080|       0| 0.1070|  0.1475|\n|2024  |ATE      | 0.1591| 0.0117| 13.6359|       0| 0.1362|  0.1820|\n|2024  |ATTE     | 0.1550| 0.0114| 13.5809|       0| 0.1326|  0.1774|\n|2025  |ATE      | 0.1737| 0.0103| 16.8639|       0| 0.1535|  0.1939|\n|2025  |ATTE     | 0.1704| 0.0097| 17.6296|       0| 0.1514|  0.1893|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  res_pool,\n  booktabs = TRUE,\n  longtable = TRUE,\n  digits = 4,\n  caption = \"Pooled IRM DoubleML (20232025)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Pooled IRM DoubleML (20232025)\n\n|group          |estimand | effect|     se| t_value| p_value| ci_low| ci_high|\n|:--------------|:--------|------:|------:|-------:|-------:|------:|-------:|\n|Pooled 2023-25 |ATE      | 0.1605| 0.0063| 25.5418|       0| 0.1481|  0.1728|\n|Pooled 2023-25 |ATTE     | 0.1557| 0.0061| 25.6923|       0| 0.1438|  0.1676|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  res_by_year,\n  booktabs = TRUE,\n  longtable = TRUE,\n  digits = 4,\n  caption = \"IRM DoubleML (2023/2024/2025)\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: IRM DoubleML (2023/2024/2025)\n\n|group |estimand | effect|     se| t_value| p_value| ci_low| ci_high|\n|:-----|:--------|------:|------:|-------:|-------:|------:|-------:|\n|2023  |ATE      | 0.1342| 0.0099| 13.6093|       0| 0.1149|  0.1535|\n|2023  |ATTE     | 0.1272| 0.0103| 12.3080|       0| 0.1070|  0.1475|\n|2024  |ATE      | 0.1591| 0.0117| 13.6359|       0| 0.1362|  0.1820|\n|2024  |ATTE     | 0.1550| 0.0114| 13.5809|       0| 0.1326|  0.1774|\n|2025  |ATE      | 0.1737| 0.0103| 16.8639|       0| 0.1535|  0.1939|\n|2025  |ATTE     | 0.1704| 0.0097| 17.6296|       0| 0.1514|  0.1893|\n\n\n:::\n\n```{.r .cell-code}\ndt1c <- as.data.table(dataframe_original1b)\nsetnames(\n  dt1c,\n  old = c(\n    \"x1a\",\n    \"unique_individual_id\",\n    \"x1b\",\n    \"x1c\",\n    \"x1d\",\n    \"x1e\",\n    \"x1f\",\n    \"x1g\",\n    \"x1h\",\n    \"x1i\"\n  ),\n  new = c(\"year\", \"id\", \"regA\", \"regB\", \"sex\", \"age\", \"bA\", \"bB\", \"bC\", \"np\"),\n  skip_absent = TRUE\n)\n\ndt1c[, `:=`(\n  bA = as.integer(bA == \"Yes\"),\n  bB = as.integer(bB == \"Yes\"),\n  bC = as.integer(bC == \"Yes\"),\n  age_n = fcase(\n    age == \"18 to 24\" , 21   ,\n    age == \"25 to 49\" , 42   ,\n    age == \"50+\"      , 57.5\n  )\n)]\n\ndt1c[,\n  combo := fcase(\n    bA == 1 & bB == 0 & bC == 0 , \"a1\" ,\n    bA == 0 & bB == 1 & bC == 0 , \"a2\" ,\n    bA == 1 & bB == 1 & bC == 0 , \"a4\" ,\n    bA == 0 & bB == 1 & bC == 1 , \"a5\" ,\n    bA == 1 & bB == 1 & bC == 1 , \"a7\" ,\n    bA == 0 & bB == 0 & bC == 0 , \"a8\"\n  )\n]\n\n# person-year: alert-state intensity via 2^3 = 8 possible outcomes (a1-a8) where two (a3 and a6) were not observed empirically\norc <- dt1c[,\n  .(\n    a1 = sum((combo == \"a1\") * np, na.rm = TRUE),\n    a2 = sum((combo == \"a2\") * np, na.rm = TRUE),\n    a4 = sum((combo == \"a4\") * np, na.rm = TRUE),\n    a5 = sum((combo == \"a5\") * np, na.rm = TRUE),\n    a7 = sum((combo == \"a7\") * np, na.rm = TRUE),\n    a8 = sum((combo == \"a8\") * np, na.rm = TRUE),\n    np = sum(np),\n    rg = uniqueN(c(regA, regB)),\n    rc = paste(sort(unique(c(regA, regB))), collapse = \" + \"),\n    yr = first(year),\n    sg = first(sex),\n    ag = first(age_n)\n  ),\n  by = id\n]\n\nkeyz <- c(\"a1\", \"a2\", \"a4\", \"a5\", \"a7\", \"a8\")\norc[, ac := rowSums(.SD > 0), .SDcols = keyz]\n\n# 6. VOLATILITY (v_moves): placement transfers/shifts within the person-year sequence for vm\nmoves <- dt1c[\n  order(id),\n  .(\n    vm = sum((regA != regB) | (regA != shift(regA) & !is.na(shift(regA))))\n  ),\n  by = id\n]\n\norc <- merge(orc, moves, by = \"id\")\n\nsetcolorder(\n  orc,\n  c(\n    \"yr\",\n    \"ag\",\n    \"sg\",\n    \"np\",\n    \"ac\",\n    \"rg\",\n    \"vm\",\n    \"a1\",\n    \"a2\",\n    \"a4\",\n    \"a5\",\n    \"a7\",\n    \"a8\",\n    \"id\",\n    \"rc\"\n  )\n)\n\nprint(orc[ac > 3][order(-ac)][1:10])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       yr    ag     sg    np    ac    rg    vm    a1    a2    a4    a5    a7\n    <num> <num> <char> <num> <num> <int> <int> <num> <num> <num> <num> <num>\n 1:  2023  42.0   Male    93     6     1     0    15    22    11     2     3\n 2:  2023  21.0   Male   161     6     1     0   131     3     1     1     1\n 3:  2024  42.0   Male   355     6     1     0    31    66     2     4     3\n 4:  2024  42.0   Male   183     6     1     0    27     6    11    40    12\n 5:  2024  42.0   Male    39     6     1     0    10     2     1     1     1\n 6:  2024  42.0   Male   196     6     1     0   161     8     1     1     3\n 7:  2025  42.0   Male   249     6     1     0    86     7    12     2     6\n 8:  2025  57.5   Male    83     6     3     8    12    20     3     4    39\n 9:  2025  42.0   Male    86     6     1     0    16    37     2    11     4\n10:  2025  42.0   Male   122     6     2     3    35     2     3    10    32\n       a8            id                          rc\n    <num>        <char>                      <char>\n 1:    40 2023-15720-RC                     Eastern\n 2:    24 2023-16285-RC                     Eastern\n 3:   249 2024-00145-RC                     Eastern\n 4:    87 2024-00280-RC                     Eastern\n 5:    24 2024-04490-RC                     Eastern\n 6:    22 2024-10754-RC                     Eastern\n 7:   136 2025-00167-RC                     Eastern\n 8:     5 2025-01080-RC Central + Eastern + Toronto\n 9:    16 2025-05185-RC                     Eastern\n10:    40 2025-11914-RC           Central + Eastern\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(paste(\"Zero day rows:\", nrow(orc[np == 0])))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Zero day rows: 0\"\n```\n\n\n:::\n\n```{.r .cell-code}\norc[, id := .I]\norc[, sg := ifelse(sg == \"Male\", 1, 2)]\n\n\n# Xbar and SD for complexity and volatility by year and gender\nstatz <- orc[,\n  .(\n    n = .N,\n    xA = round(mean(ac, na.rm = TRUE), 2),\n    sA = round(sd(ac, na.rm = TRUE), 2),\n    xB = round(mean(vm, na.rm = TRUE), 2),\n    sB = round(sd(vm, na.rm = TRUE), 2)\n  ),\n  by = .(yr, sg)\n]\n\nstatz <- statz[order(yr, sg)]\nprint(\"--- Summary Statistics for Methods Section ---\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"--- Summary Statistics for Methods Section ---\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(statz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      yr    sg     n    xA    sA    xB    sB\n   <num> <num> <int> <num> <num> <num> <num>\n1:  2023     1 19270  1.13  0.42  0.06  0.37\n2:  2023     2  1511  1.13  0.39  0.01  0.13\n3:  2024     1 17717  1.14  0.42  0.08  0.42\n4:  2024     2  1924  1.15  0.43  0.02  0.21\n5:  2025     1 22224  1.13  0.42  0.11  0.49\n6:  2025     2  2821  1.14  0.41  0.06  0.36\n```\n\n\n:::\n\n```{.r .cell-code}\norc[,\n  agc := fcase(\n    ag == 21 , \"21\" , ag == 42 , \"42\" , ag == 57.5 , \"57.5\"\n  )\n]\n\nlibrary(data.table)\nlibrary(lme4)\nlibrary(glmmTMB)\nlibrary(DHARMa)\nlibrary(cobalt)\nlibrary(DoubleML)\nlibrary(mlr3)\nlibrary(mlr3learners)\nlibrary(Hmisc) # weighted variance/sd\n# weighted mean: sum(value * weight) / sum(weight)\n# weighted sd: sq rt of weighted variance\n\nstatz1a <- orc[,\n  .(\n    n = .N,\n    xA = round(wtd.mean(ac, weights = np), 2),\n    sA = round(sqrt(wtd.var(ac, weights = np)), 2),\n    xB = round(wtd.mean(vm, weights = np), 2),\n    sB = round(sqrt(wtd.var(vm, weights = np)), 2)\n  ),\n  by = .(yr, sg, agc, rc)\n]\nstatz1a[is.na(sA), sA := mean(sB)]\nstatz1a[is.na(sB), sB := mean(sB)]\n\nprint(statz1a[order(yr, agc, sg, n, xA, xB, sA, sB, rc)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        yr    sg    agc                           rc     n    xA    sA    xB\n     <num> <num> <char>                       <char> <int> <num> <num> <num>\n  1:  2023     1     21  Central + Eastern + Western     1  1.00  0.00  3.00\n  2:  2023     1     21  Central + Toronto + Western     1  1.00  0.00  3.00\n  3:  2023     1     21 Eastern + Northern + Toronto     1  1.00  0.00  3.00\n  4:  2023     1     21            Toronto + Western     2  3.00  0.00  1.06\n  5:  2023     1     21  Central + Eastern + Toronto     2  3.49  0.50  5.48\n ---                                                                        \n236:  2025     2   57.5            Central + Eastern     3  1.00  0.00  1.11\n237:  2025     2   57.5                     Northern    25  1.04  0.20  0.00\n238:  2025     2   57.5                      Western    33  1.87  0.85  0.00\n239:  2025     2   57.5                      Central    44  1.08  0.28  0.00\n240:  2025     2   57.5                      Eastern    99  1.37  0.65  0.00\n        sB\n     <num>\n  1:  0.00\n  2:  0.00\n  3:  0.00\n  4:  0.24\n  5:  1.51\n ---      \n236:  0.31\n237:  0.00\n238:  0.00\n239:  0.00\n240:  0.00\n```\n\n\n:::\n\n```{.r .cell-code}\n# year, age, gender, region\nstatz1a <- statz1a[order(yr, agc, sg, n, xA, xB, sA, sB, rc)]\nprint(\"--- Detailed Summary Statistics (By Year, Demographics, and Region) ---\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"--- Detailed Summary Statistics (By Year, Demographics, and Region) ---\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(head(statz1a, 30))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       yr    sg    agc                           rc     n    xA    sA    xB\n    <num> <num> <char>                       <char> <int> <num> <num> <num>\n 1:  2023     1     21  Central + Eastern + Western     1  1.00  0.00  3.00\n 2:  2023     1     21  Central + Toronto + Western     1  1.00  0.00  3.00\n 3:  2023     1     21 Eastern + Northern + Toronto     1  1.00  0.00  3.00\n 4:  2023     1     21            Toronto + Western     2  3.00  0.00  1.06\n 5:  2023     1     21  Central + Eastern + Toronto     2  3.49  0.50  5.48\n 6:  2023     1     21           Northern + Toronto     4  1.27  0.45  2.00\n 7:  2023     1     21           Central + Northern     7  1.00  0.00  1.86\n 8:  2023     1     21           Eastern + Northern     7  1.54  0.69  2.00\n 9:  2023     1     21            Eastern + Toronto     9  1.73  1.14  2.55\n10:  2023     1     21            Central + Eastern    13  1.28  0.59  1.69\n11:  2023     1     21            Central + Western    19  1.38  0.55  1.75\n12:  2023     1     21            Central + Toronto    33  1.90  1.23  2.28\n13:  2023     1     21                      Western   384  1.15  0.45  0.00\n14:  2023     1     21                      Toronto   462  1.21  0.49  0.00\n15:  2023     1     21                     Northern   464  1.40  0.73  0.00\n16:  2023     1     21                      Eastern   722  1.20  0.54  0.00\n17:  2023     1     21                      Central  1147  1.23  0.56  0.00\n18:  2023     2     21                      Central     1  1.00   NaN  0.00\n19:  2023     2     21           Eastern + Northern     1  1.00  0.00  2.00\n20:  2023     2     21            Eastern + Western     1  2.00  0.00  1.00\n21:  2023     2     21                      Toronto     5  1.58  1.20  0.00\n22:  2023     2     21                      Western    42  1.28  0.51  0.00\n23:  2023     2     21                     Northern    85  1.13  0.38  0.00\n24:  2023     2     21                      Eastern    94  1.87  1.06  0.00\n25:  2023     1     42 Central + Northern + Toronto     1  1.00  0.00  3.00\n26:  2023     1     42 Northern + Toronto + Western     1  1.00  0.00  3.00\n27:  2023     1     42 Eastern + Northern + Toronto     1  2.00  0.00  3.00\n28:  2023     1     42 Central + Northern + Western     2  1.62  0.49  3.00\n29:  2023     1     42  Central + Toronto + Western     2  2.00  0.00  4.00\n30:  2023     1     42  Central + Eastern + Toronto     3  1.59  0.49  3.59\n       yr    sg    agc                           rc     n    xA    sA    xB\n    <num> <num> <char>                       <char> <int> <num> <num> <num>\n       sB\n    <num>\n 1:  0.00\n 2:  0.00\n 3:  0.00\n 4:  0.24\n 5:  1.51\n 6:  0.00\n 7:  0.35\n 8:  0.00\n 9:  0.78\n10:  0.46\n11:  0.43\n12:  0.55\n13:  0.00\n14:  0.00\n15:  0.00\n16:  0.00\n17:  0.00\n18:   NaN\n19:  0.00\n20:  0.00\n21:  0.00\n22:  0.00\n23:  0.00\n24:  0.00\n25:  0.00\n26:  0.00\n27:  0.00\n28:  0.00\n29:  0.00\n30:  0.49\n       sB\n    <num>\n```\n\n\n:::\n\n```{.r .cell-code}\n# paths by volume per year\nrpvy <- statz1a[, .SD[head(order(-n), 15)], by = yr]\nprint(rpvy)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       yr    sg    agc       rc     n    xA    sA    xB    sB\n    <num> <num> <char>   <char> <int> <num> <num> <num> <num>\n 1:  2023     1     42  Central  4451  1.25  0.59     0     0\n 2:  2023     1     42  Eastern  2950  1.20  0.50     0     0\n 3:  2023     1     42  Western  2194  1.20  0.48     0     0\n 4:  2023     1     42  Toronto  1902  1.28  0.62     0     0\n 5:  2023     1     42 Northern  1814  1.33  0.67     0     0\n 6:  2023     1     21  Central  1147  1.23  0.56     0     0\n 7:  2023     1   57.5  Central   792  1.25  0.56     0     0\n 8:  2023     1     21  Eastern   722  1.20  0.54     0     0\n 9:  2023     2     42  Eastern   525  1.29  0.58     0     0\n10:  2023     1   57.5  Eastern   521  1.13  0.36     0     0\n11:  2023     1     21 Northern   464  1.40  0.73     0     0\n12:  2023     1     21  Toronto   462  1.21  0.49     0     0\n13:  2023     1     21  Western   384  1.15  0.45     0     0\n14:  2023     1   57.5  Western   349  1.10  0.34     0     0\n15:  2023     2     42  Western   330  1.29  0.55     0     0\n16:  2024     1     42  Eastern  3769  1.20  0.58     0     0\n17:  2024     1     42  Central  3515  1.24  0.53     0     0\n18:  2024     1     42  Western  2143  1.17  0.45     0     0\n19:  2024     1     42  Toronto  1589  1.18  0.46     0     0\n20:  2024     1     42 Northern  1408  1.41  0.69     0     0\n21:  2024     1     21  Eastern   833  1.21  0.59     0     0\n22:  2024     2     42  Eastern   751  1.35  0.78     0     0\n23:  2024     1     21  Central   700  1.22  0.48     0     0\n24:  2024     1   57.5  Eastern   673  1.16  0.49     0     0\n25:  2024     1   57.5  Central   621  1.26  0.59     0     0\n26:  2024     2     42  Western   445  1.24  0.50     0     0\n27:  2024     1     21  Western   373  1.17  0.43     0     0\n28:  2024     1     21  Toronto   361  1.17  0.43     0     0\n29:  2024     1   57.5  Western   327  1.18  0.39     0     0\n30:  2024     2     42 Northern   326  1.31  0.59     0     0\n31:  2025     1     42  Central  4943  1.17  0.45     0     0\n32:  2025     1     42  Toronto  3440  1.25  0.57     0     0\n33:  2025     1     42  Eastern  3267  1.26  0.64     0     0\n34:  2025     1     42  Western  2392  1.17  0.40     0     0\n35:  2025     1     42 Northern  1277  1.35  0.64     0     0\n36:  2025     1     21  Central   981  1.12  0.40     0     0\n37:  2025     2     42  Eastern   918  1.28  0.59     0     0\n38:  2025     1     21  Toronto   793  1.14  0.42     0     0\n39:  2025     1   57.5  Central   757  1.14  0.39     0     0\n40:  2025     1     21  Eastern   663  1.17  0.48     0     0\n41:  2025     1   57.5  Toronto   663  1.20  0.43     0     0\n42:  2025     1   57.5  Eastern   612  1.18  0.49     0     0\n43:  2025     2     42  Western   474  1.28  0.47     0     0\n44:  2025     2     42 Northern   400  1.41  0.71     0     0\n45:  2025     2     42  Central   379  1.16  0.41     0     0\n       yr    sg    agc       rc     n    xA    sA    xB    sB\n    <num> <num> <char>   <char> <int> <num> <num> <num> <num>\n```\n\n\n:::\n\n```{.r .cell-code}\norc[, agc := NULL]\n\norc[,\n  ag := fcase(\n    ag == 21   , \"21\"   ,\n    ag == 42   , \"42\"   ,\n    ag == 57.5 , \"57.5\"\n  )\n]\n\norc[, rc := as.factor(rc)]\norc[, ag := factor(ag, levels = c(\"21\", \"42\", \"57.5\"), ordered = TRUE)]\norc[, sg := factor(sg, levels = c(1, 2), labels = c(\"M\", \"F\"))]\norc[, yr := factor(yr, levels = sort(unique(yr)), ordered = TRUE)]\n# data types\nstr(orc[, .(yr, ag, sg, rc)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'data.table' and 'data.frame':\t65467 obs. of  4 variables:\n $ yr: Ord.factor w/ 3 levels \"2023\"<\"2024\"<..: 1 1 1 1 1 1 1 1 1 1 ...\n $ ag: Ord.factor w/ 3 levels \"21\"<\"42\"<\"57.5\": 2 3 2 2 3 3 2 3 2 3 ...\n $ sg: Factor w/ 2 levels \"M\",\"F\": 1 1 1 1 1 1 1 1 1 1 ...\n $ rc: Factor w/ 26 levels \"Central\",\"Central + Eastern\",..: 24 20 12 26 12 12 1 20 26 26 ...\n - attr(*, \".internal.selfref\")=<externalptr> \n```\n\n\n:::\n\n```{.r .cell-code}\norc[, treat := as.integer(ac >= 2)]\nm.out <- matchit(\n  treat ~ ag + sg + yr,\n  data = orc,\n  method = \"nearest\",\n  distance = \"glm\",\n  weights = orc$np\n)\n\norc_matched <- match.data(m.out)\n\n# fit of weighted poisson GLMM  'weights' (matching weights) via MatchIt\nmodel_final <- glmer(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched,\n  family = poisson(link = \"log\"),\n  weights = weights\n)\n# poisson model fit (matched sample)\nmodel_final <- glmer(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched,\n  family = poisson(link = \"log\"),\n  weights = weights\n)\nsummary(model_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGeneralized linear mixed model fit by maximum likelihood (Laplace\n  Approximation) [glmerMod]\n Family: poisson  ( log )\nFormula: vm ~ treat + ag + sg + yr + (1 | rc)\n   Data: orc_matched\nWeights: weights\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n   3039.7    3100.4   -1511.9    3023.7     14512 \n\nScaled residuals: \n     Min       1Q   Median       3Q      Max \n-1.00219 -0.01331 -0.01131 -0.00979  2.23180 \n\nRandom effects:\n Groups Name        Variance Std.Dev.\n rc     (Intercept) 19.41    4.406   \nNumber of obs: 14520, groups:  rc, 24\n\nFixed effects:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.409675   0.912681  -1.545    0.122    \ntreat        0.290601   0.051779   5.612    2e-08 ***\nag.L         0.029770   0.066244   0.449    0.653    \nag.Q         0.017940   0.042570   0.421    0.673    \nsgF         -0.105187   0.102136  -1.030    0.303    \nyr.L        -0.008085   0.037464  -0.216    0.829    \nyr.Q        -0.008459   0.039257  -0.215    0.829    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n      (Intr) treat  ag.L   ag.Q   sgF    yr.L  \ntreat -0.045                                   \nag.L   0.017 -0.046                            \nag.Q   0.027 -0.017  0.351                     \nsgF   -0.009 -0.024  0.056  0.010              \nyr.L  -0.006  0.032  0.023  0.016 -0.116       \nyr.Q  -0.001  0.062  0.025  0.022 -0.058 -0.163\n```\n\n\n:::\n\n```{.r .cell-code}\n#  effect sizes (Incidence Rate Ratio) from log-odds\nresults_table <- exp(fixef(model_final))\nprint(results_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(Intercept)       treat        ag.L        ag.Q         sgF        yr.L \n  0.2442227   1.3372305   1.0302174   1.0181016   0.9001565   0.9919480 \n       yr.Q \n  0.9915767 \n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\nsim_res <- simulateResiduals(model_final)\nplot(sim_res)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-9.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\ntestDispersion(sim_res)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-10.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa nonparametric dispersion test via sd of residuals fitted vs.\n\tsimulated\n\ndata:  simulationOutput\ndispersion = 6.895e-11, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\ntestZeroInflation(sim_res)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-11.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa zero-inflation test via comparison to expected zeros with\n\tsimulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.6609, p-value = 0.016\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(glmmTMB)\nmodel_final_thesis <- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched,\n  family = nbinom2,\n  weights = weights,\n  control = glmmTMBControl(optimizer = optim, optArgs = list(method = \"BFGS\"))\n)\n\nsummary(model_final_thesis)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: nbinom2  ( log )\nFormula:          vm ~ treat + ag + sg + yr + (1 | rc)\nData: orc_matched\nWeights: weights\n\n      AIC       BIC    logLik -2*log(L)  df.resid \n   3041.7    3110.0   -1511.9    3023.7     14511 \n\nRandom effects:\n\nConditional model:\n Groups Name        Variance Std.Dev.\n rc     (Intercept) 19.52    4.418   \nNumber of obs: 14520, groups:  rc, 24\n\nDispersion parameter for nbinom2 family (): 2.58e+08 \n\nConditional model:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -1.416375   0.934642  -1.515    0.130    \ntreat        0.290602   0.051777   5.613 1.99e-08 ***\nag.L         0.029777   0.066240   0.450    0.653    \nag.Q         0.017940   0.042567   0.421    0.673    \nsgF         -0.105184   0.102124  -1.030    0.303    \nyr.L        -0.008090   0.037462  -0.216    0.829    \nyr.Q        -0.008458   0.039255  -0.215    0.829    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\nfix_eff <- summary(model_final_thesis)$coefficients$cond\n\nresults_final <- data.frame(\n  Variable = rownames(fix_eff),\n  IRR = exp(fix_eff[, \"Estimate\"]),\n  Lower_CI = exp(fix_eff[, \"Estimate\"] - 1.96 * fix_eff[, \"Std. Error\"]),\n  Upper_CI = exp(fix_eff[, \"Estimate\"] + 1.96 * fix_eff[, \"Std. Error\"]),\n  P_Value = fix_eff[, \"Pr(>|z|)\"]\n)\n\nprint(results_final)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Variable       IRR   Lower_CI Upper_CI      P_Value\n(Intercept) (Intercept) 0.2425918 0.03884119 1.515164 1.296662e-01\ntreat             treat 1.3372328 1.20818531 1.480064 1.993339e-08\nag.L               ag.L 1.0302247 0.90478976 1.173049 6.530468e-01\nag.Q               ag.Q 1.0181020 0.93660717 1.106688 6.734231e-01\nsgF                 sgF 0.9001589 0.73686691 1.099637 3.030295e-01\nyr.L               yr.L 0.9919424 0.92171814 1.067517 8.290195e-01\nyr.Q               yr.Q 0.9915779 0.91814800 1.070880 8.294083e-01\n```\n\n\n:::\n\n```{.r .cell-code}\nsim_res1b <- simulateResiduals(model_final_thesis, n = 5000)\nplot(sim_res1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-12.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\ntestDispersion(sim_res1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-13.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa nonparametric dispersion test via sd of residuals fitted vs.\n\tsimulated\n\ndata:  simulationOutput\ndispersion = 4.2272e-11, p-value = 0.0032\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\ntestZeroInflation(sim_res1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-14.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa zero-inflation test via comparison to expected zeros with\n\tsimulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.6516, p-value = 0.0268\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\n# naive weighted mean comparison to double-check the 33% increase; close to the IRR ?:!\nlibrary(weights)\nwtd.mean(\n  orc_matched$vm[orc_matched$treat == 1],\n  weights = orc_matched$weights[orc_matched$treat == 1]\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.2538567\n```\n\n\n:::\n\n```{.r .cell-code}\nwtd.mean(\n  orc_matched$vm[orc_matched$treat == 0],\n  weights = orc_matched$weights[orc_matched$treat == 0]\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.06721763\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(sim_res1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-15.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\ntestDispersion(sim_res1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-16.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa nonparametric dispersion test via sd of residuals fitted vs.\n\tsimulated\n\ndata:  simulationOutput\ndispersion = 4.2272e-11, p-value = 0.0032\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\ntestZeroInflation(sim_res1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-17.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa zero-inflation test via comparison to expected zeros with\n\tsimulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.6516, p-value = 0.0268\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(cobalt)\n\nlove_plot <- love.plot(\n  m.out,\n  binary = \"std\",\n  thresholds = c(m = .1),\n  var.order = \"unadjusted\",\n  abs = TRUE,\n  colors = c(\"red\", \"blue\"),\n  shapes = c(\"circle\", \"triangle\"),\n  sample.names = c(\"Original\", \"Matched\"),\n  stars = \"std\"\n)\n\nprint(love_plot)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-18.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nbal_table <- bal.tab(m.out, un = TRUE)\nprint(bal_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nBalance Measures\n             Type Diff.Un Diff.Adj\ndistance Distance  0.0911        0\nag_21      Binary -0.0072        0\nag_42      Binary  0.0314        0\nag_57.5    Binary -0.0242        0\nsg_F       Binary  0.0065        0\nyr_2023    Binary -0.0027        0\nyr_2024    Binary  0.0026        0\nyr_2025    Binary  0.0001        0\n\nSample sizes\n          Control Treated\nAll         58207    7260\nMatched      7260    7260\nUnmatched   50947       0\n```\n\n\n:::\n\n```{.r .cell-code}\nlove.plot(\n  m.out,\n  binary = \"std\",\n  stats = \"m\",\n  thresholds = c(m = .1),\n  abs = TRUE,\n  line = TRUE,\n  sample.names = c(\"Original (Pre-Match)\", \"Matched (Final Sample)\"),\n  colors = c(\"#d62728\", \"#1f77b4\"),\n  shapes = c(21, 24),\n  title = \"Covariate Balance Across Groups\",\n  xlab = \"Absolute Standardized Mean Differences\",\n)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-19.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\ndml_data <- as.data.frame(orc_matched)\ndml_data$sg <- as.numeric(dml_data$sg)\ndml_data$ag <- as.numeric(dml_data$ag)\ndml_data$yr <- as.numeric(dml_data$yr)\n\ndata_dml_obj = double_ml_data_from_data_frame(\n  dml_data,\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\")\n)\n\nl_ranger = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\n\ndml_model = DoubleMLPLR$new(\n  data_dml_obj,\n  ml_l = l_ranger,\n  ml_m = l_ranger,\n  n_folds = 3\n) #  l = target y learner ; m = treatment d learner\n\ndml_model$fit()\nprint(dml_model$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat   0.18658    0.01048    17.8   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value     Pr(>|t|)\ntreat 0.1865815 0.01048398 17.79682 7.480299e-71\n```\n\n\n:::\n\n```{.r .cell-code}\ndml_matrix_data <- model.matrix(\n  ~ vm + treat + ag + sg + yr + rc - 1,\n  data = orc_matched\n)\ndml_df <- as.data.frame(dml_matrix_data)\ncolnames(dml_df) <- make.names(colnames(dml_df))\n\ndata_dml_adj = double_ml_data_from_data_frame(\n  dml_df,\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = setdiff(colnames(dml_df), c(\"vm\", \"treat\"))\n)\n\nl_ranger = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\n\ndml_model_adj = DoubleMLPLR$new(\n  data_dml_adj,\n  ml_l = l_ranger,\n  ml_m = l_ranger,\n  n_folds = 3\n)\n\ndml_model_adj$fit(store_predictions = TRUE)\n\ndml_preds_final <- dml_model_adj$predictions$ml_l[, 1, 1]\n\nprint(paste(\"DML Predictions Count:\", length(dml_preds_final)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"DML Predictions Count: 14520\"\n```\n\n\n:::\n\n```{.r .cell-code}\nglmm_preds_final <- predict(model_final_thesis, type = \"response\")\n\nplot_data <- data.frame(\n  Actual = as.numeric(orc_matched$vm),\n  GLMM = as.numeric(glmm_preds_final),\n  DML = as.numeric(dml_preds_final)\n)\n\nggplot(plot_data) +\n  geom_density(aes(x = GLMM, fill = \"GLMM (Parametric)\"), alpha = 0.4) +\n  geom_density(aes(x = DML, fill = \"DML (Machine Learning)\"), alpha = 0.4) +\n  scale_x_log10(labels = scales::comma) +\n  labs(\n    title = \"Comparison of Predicted Values (Log Scale)\",\n    subtitle = \"Revealing the distribution of low-probability GLMM predictions\",\n    x = \"Predicted Moves (Log10 Scale)\",\n    y = \"Density\",\n    fill = \"Model Type\"\n  ) +\n  theme_minimal() # log10 transformation for distribution of very small GLMM values\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-20.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nmse_glmm <- mean((plot_data$Actual - plot_data$GLMM)^2)\nmse_dml <- mean((plot_data$Actual - plot_data$DML)^2)\n\ncat(\"\\n--- Initial Results ---\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n--- Initial Results ---\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(dml_model_adj$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat  0.090705   0.006215   14.59   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       Estimate.  Std. Error t value    Pr(>|t|)\ntreat 0.09070513 0.006215405 14.5936 3.08484e-48\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"GLMM MSE:\", round(mse_glmm, 6), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGLMM MSE: 0.033648 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"DML MSE: \", round(mse_dml, 6), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDML MSE:  0.176137 \n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(orc_matched$weights)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n      1       1       1       1       1       1 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Matching weight distribution:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMatching weight distribution:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(table(orc_matched$weights))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n    1 \n14520 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\nBy treatment group:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nBy treatment group:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(aggregate(weights ~ treat, data = orc_matched, FUN = summary))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  treat weights.Min. weights.1st Qu. weights.Median weights.Mean\n1     0            1               1              1            1\n2     1            1               1              1            1\n  weights.3rd Qu. weights.Max.\n1               1            1\n2               1            1\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\nSample sizes by treatment:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nSample sizes by treatment:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(table(orc_matched$treat))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n   0    1 \n7260 7260 \n```\n\n\n:::\n\n```{.r .cell-code}\ndml_data_clustered <- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\", \"rc\"),\n  cluster_cols = \"id\"\n)\n\nset.seed(42569872)\ndml_clustered <- DoubleMLPLR$new(\n  dml_data_clustered,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_clustered$fit()\nprint(dml_clustered$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat  0.078614   0.005167   15.21   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate.  Std. Error  t value     Pr(>|t|)\ntreat 0.0786137 0.005167116 15.21423 2.845424e-52\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(sandwich)\nlibrary(lmtest)\ndml_data_region_clustered <- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\"),\n  cluster_cols = c(\"rc\", \"yr\")\n)\n\nset.seed(2764389)\ndml_region_clustered <- DoubleMLPLR$new(\n  dml_data_region_clustered,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_region_clustered$fit()\nprint(dml_region_clustered$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)\ntreat    0.2091     0.1277   1.638    0.101\n\n      Estimate. Std. Error  t value  Pr(>|t|)\ntreat 0.2091398  0.1276979 1.637769 0.1014698\n```\n\n\n:::\n\n```{.r .cell-code}\ndml_data_region <- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\"),\n  cluster_cols = \"rc\"\n)\n\nset.seed(6450835)\ndml_region <- DoubleMLPLR$new(\n  dml_data_region,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_region$fit()\nprint(dml_region$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)  \ntreat    0.1943     0.1013   1.919    0.055 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value   Pr(>|t|)\ntreat 0.1943492  0.1012809 1.918914 0.05499526\n```\n\n\n:::\n\n```{.r .cell-code}\ndml_data_yr <- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"rc\"),\n  cluster_cols = \"yr\"\n)\n\nset.seed(69543)\ndml_yearz <- DoubleMLPLR$new(\n  dml_data_yr,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_yearz$fit()\nprint(dml_yearz$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat   0.13004    0.01491   8.719   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value     Pr(>|t|)\ntreat 0.1300352 0.01491448 8.718722 2.813599e-18\n```\n\n\n:::\n\n```{.r .cell-code}\ndml_data_yrID <- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"rc\", \"id\"),\n  cluster_cols = \"yr\"\n)\n\nset.seed(2468176)\ndml_yearzID <- DoubleMLPLR$new(\n  dml_data_yrID,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_yearzID$fit()\nprint(dml_yearzID$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat   0.08137    0.01173   6.936 4.04e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n       Estimate. Std. Error  t value    Pr(>|t|)\ntreat 0.08137193 0.01173222 6.935764 4.04033e-12\n```\n\n\n:::\n\n```{.r .cell-code}\ndml_data_IDz <- DoubleMLClusterData$new(\n  data = as.data.frame(orc_matched),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\n    \"ag\",\n    \"sg\",\n    \"rc\",\n    \"yr\",\n    \"subclass\",\n    \"id\",\n    \"a1\",\n    \"a2\",\n    \"a4\",\n    \"a5\",\n    \"a7\",\n    \"a8\"\n  ),\n  cluster_cols = \"distance\"\n)\n\nset.seed(4568937)\ndml_IDz <- DoubleMLPLR$new(\n  dml_data_IDz,\n  ml_l = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  ml_m = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5),\n  n_folds = 3\n)\n\ndml_IDz$fit()\nprint(dml_IDz$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat   0.12669    0.01854   6.833 8.29e-12 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error t value     Pr(>|t|)\ntreat 0.1266875 0.01853918  6.8335 8.286776e-12\n```\n\n\n:::\n\n```{.r .cell-code}\nml_g <- lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\nml_m <- lrn(\"classif.ranger\", num.trees = 500, max.depth = 5)\nx_cols_all <- c(\"ag\", \"sg\", \"rc\", \"yr\", \"a1\", \"a2\", \"a4\", \"a5\", \"a7\", \"a8\")\norc_matched[,\n  (c(\"sg\", \"rc\", \"yr\")) := lapply(.SD, as.factor),\n  .SDcols = c(\"sg\", \"rc\", \"yr\")\n]\n\nrun_dml_analysis <- function(data, x_cols, tag, cluster_var) {\n  dml_data <- DoubleMLClusterData$new(\n    data = as.data.frame(data),\n    y_col = \"vm\",\n    d_cols = \"treat\",\n    x_cols = x_cols,\n    cluster_cols = cluster_var\n  )\n\n  set.seed(117504871)\n  obj_ate <- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATE\"\n  )\n  obj_ate$fit()\n  set.seed(16254911)\n  obj_atte <- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATTE\"\n  )\n  obj_atte$fit()\n\n  extract <- function(obj, est) {\n    ci <- obj$confint(level = 0.95)\n    data.table(\n      method = paste0(\"Clustered by \", cluster_var),\n      group = tag,\n      estimand = est,\n      effect = as.numeric(obj$coef),\n      se = as.numeric(obj$se),\n      p_value = as.numeric(obj$pval),\n      ci_low = as.numeric(ci[1, 1]),\n      ci_high = as.numeric(ci[1, 2])\n    )\n  }\n  return(rbind(extract(obj_ate, \"ATE\"), extract(obj_atte, \"ATTE\")))\n}\n\nres_pool_ID <- run_dml_analysis(orc_matched, x_cols_all, \"Pooled\", \"id\")\n\nyears <- sort(unique(orc_matched$yr))\nx_cols_yearly <- setdiff(x_cols_all, \"yr\")\n\nres_year_ID <- rbindlist(lapply(years, function(yy) {\n  run_dml_analysis(orc_matched[yr == yy], x_cols_yearly, as.character(yy), \"id\")\n}))\nres_pool_SUB <- run_dml_analysis(orc_matched, x_cols_all, \"Pooled\", \"subclass\")\n\nres_year_SUB <- rbindlist(lapply(years, function(yy) {\n  run_dml_analysis(\n    orc_matched[yr == yy],\n    x_cols_yearly,\n    as.character(yy),\n    \"subclass\"\n  )\n}))\n\nfinal_comparison_pool <- rbind(res_pool_ID, res_pool_SUB)\nfinal_comparison_year <- rbind(res_year_ID, res_year_SUB)\n\nknitr::kable(\n  final_comparison_pool,\n  digits = 4,\n  caption = \"Pooled: ID vs Subclass Clustering\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Pooled: ID vs Subclass Clustering\n\n|method                |group  |estimand | effect|     se| p_value| ci_low| ci_high|\n|:---------------------|:------|:--------|------:|------:|-------:|------:|-------:|\n|Clustered by id       |Pooled |ATE      | 0.1166| 0.0049|       0| 0.1070|  0.1262|\n|Clustered by id       |Pooled |ATTE     | 0.1477| 0.0081|       0| 0.1319|  0.1635|\n|Clustered by subclass |Pooled |ATE      | 0.1192| 0.0049|       0| 0.1095|  0.1289|\n|Clustered by subclass |Pooled |ATTE     | 0.1474| 0.0081|       0| 0.1316|  0.1632|\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(\n  final_comparison_year,\n  digits = 4,\n  caption = \"Yearly: ID vs Subclass Clustering\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Yearly: ID vs Subclass Clustering\n\n|method                |group |estimand | effect|     se| p_value| ci_low| ci_high|\n|:---------------------|:-----|:--------|------:|------:|-------:|------:|-------:|\n|Clustered by id       |2023  |ATE      | 0.0834| 0.0077|       0| 0.0682|  0.0985|\n|Clustered by id       |2023  |ATTE     | 0.1087| 0.0129|       0| 0.0835|  0.1340|\n|Clustered by id       |2024  |ATE      | 0.1406| 0.0098|       0| 0.1215|  0.1597|\n|Clustered by id       |2024  |ATTE     | 0.1876| 0.0165|       0| 0.1553|  0.2198|\n|Clustered by id       |2025  |ATE      | 0.1221| 0.0083|       0| 0.1058|  0.1383|\n|Clustered by id       |2025  |ATTE     | 0.1578| 0.0137|       0| 0.1311|  0.1846|\n|Clustered by subclass |2023  |ATE      | 0.0839| 0.0077|       0| 0.0687|  0.0991|\n|Clustered by subclass |2023  |ATTE     | 0.1072| 0.0128|       0| 0.0821|  0.1323|\n|Clustered by subclass |2024  |ATE      | 0.1397| 0.0097|       0| 0.1207|  0.1587|\n|Clustered by subclass |2024  |ATTE     | 0.1868| 0.0165|       0| 0.1545|  0.2192|\n|Clustered by subclass |2025  |ATE      | 0.1228| 0.0083|       0| 0.1066|  0.1391|\n|Clustered by subclass |2025  |ATTE     | 0.1564| 0.0136|       0| 0.1297|  0.1830|\n\n\n:::\n\n```{.r .cell-code}\nlibrary(DHARMa)\n\nrun_dml_extended <- function(data, x_cols, tag, cluster_var) {\n  dml_data <- DoubleMLClusterData$new(\n    data = as.data.frame(data),\n    y_col = \"vm\",\n    d_cols = \"treat\",\n    x_cols = x_cols,\n    cluster_cols = cluster_var\n  )\n\n  set.seed(68235576)\n  obj_ate <- DoubleMLIRM$new(dml_data, ml_g = ml_g, ml_m = ml_m, n_folds = 3)\n  obj_ate$fit(store_predictions = TRUE)\n  preds_g0 <- obj_ate$predictions$ml_g0[, 1, 1]\n  preds_g1 <- obj_ate$predictions$ml_g1[, 1, 1]\n  dml_fitted <- ifelse(data$treat == 1, preds_g1, preds_g0)\n  current_mse <- mean((data$vm - dml_fitted)^2)\n\n  set.seed(65196489)\n  sim_response <- replicate(250, rpois(length(dml_fitted), dml_fitted))\n  dharma_res <- createDHARMa(\n    simulatedResponse = sim_response,\n    observedResponse = data$vm,\n    fittedPredictedResponse = dml_fitted,\n    integerResponse = TRUE\n  )\n  ci <- obj_ate$confint(level = 0.95)\n  res_table <- data.table(\n    method = paste0(\"Clustered by \", cluster_var),\n    group = tag,\n    effect = as.numeric(obj_ate$coef),\n    se = as.numeric(obj_ate$se),\n    p_value = as.numeric(obj_ate$pval),\n    mse = current_mse,\n    ci_low = as.numeric(ci[1, 1]),\n    ci_high = as.numeric(ci[1, 2])\n  )\n\n  return(list(table = res_table, dharma = dharma_res, fitted = dml_fitted))\n}\n\nml_g <- lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\nml_m <- lrn(\"classif.ranger\", num.trees = 500, max.depth = 5)\n\npooled_analysis_SUB <- run_dml_extended(\n  orc_matched,\n  x_cols_all,\n  \"Pooled\",\n  \"subclass\"\n)\n\ncat(\"\\n--- DML Model Summary (Clustered by Subclass) ---\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n--- DML Model Summary (Clustered by Subclass) ---\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(pooled_analysis_SUB$table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  method  group    effect          se       p_value       mse\n                  <char> <char>     <num>       <num>         <num>     <num>\n1: Clustered by subclass Pooled 0.1173772 0.004912666 3.642154e-126 0.2056631\n      ci_low   ci_high\n       <num>     <num>\n1: 0.1077485 0.1270058\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n--- DHARMa Diagnostics ---\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n--- DHARMa Diagnostics ---\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(pooled_analysis_SUB$dharma)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-21.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\ntestOutliers(pooled_analysis_SUB$dharma, type = \"bootstrap\")\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-22.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa bootstrapped outlier test\n\ndata:  pooled_analysis_SUB$dharma\noutliers at both margin(s) = 44, observations = 14520, p-value <\n2.2e-16\nalternative hypothesis: two.sided\n percent confidence interval:\n 0.001203512 0.002377755\nsample estimates:\noutlier frequency (expected: 0.00176721763085399 ) \n                                       0.003030303 \n```\n\n\n:::\n\n```{.r .cell-code}\ntestDispersion(pooled_analysis_SUB$dharma)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-23.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa nonparametric dispersion test via sd of residuals fitted vs.\n\tsimulated\n\ndata:  simulationOutput\ndispersion = 1.2939, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\ntestZeroInflation(pooled_analysis_SUB$dharma)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-24.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tDHARMa zero-inflation test via comparison to expected zeros with\n\tsimulation under H0 = fitted model\n\ndata:  simulationOutput\nratioObsSim = 1.0664, p-value < 2.2e-16\nalternative hypothesis: two.sided\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n--- Model Performance Comparison ---\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n--- Model Performance Comparison ---\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"GLMM MSE:\", round(mse_glmm, 6), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nGLMM MSE: 0.033648 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"DML MSE: \", round(pooled_analysis_SUB$table$mse, 6), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDML MSE:  0.205663 \n```\n\n\n:::\n\n```{.r .cell-code}\nml_g <- lrn(\"regr.ranger\", num.trees = 500, max.depth = 5)\nml_m <- lrn(\"classif.ranger\", num.trees = 500, max.depth = 5)\nx_cols_all <- c(\"ag\", \"sg\", \"rc\", \"yr\", \"a1\", \"a2\", \"a4\", \"a5\", \"a7\", \"a8\")\nx_cols_with_dist <- c(x_cols_all, \"distance\")\nyears <- sort(unique(orc_matched$yr))\n\nrun_dml_stable <- function(data, x_cols, tag, cluster_var) {\n  dml_data <- DoubleMLClusterData$new(\n    data = as.data.frame(data),\n    y_col = \"vm\",\n    d_cols = \"treat\",\n    x_cols = x_cols,\n    cluster_cols = cluster_var\n  )\n\n  set.seed(54893769)\n  obj_ate <- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATE\"\n  )$fit(store_predictions = TRUE)\n  set.seed(6549875)\n  obj_atte <- DoubleMLIRM$new(\n    dml_data,\n    ml_g = ml_g,\n    ml_m = ml_m,\n    n_folds = 3,\n    score = \"ATTE\"\n  )$fit(store_predictions = TRUE)\n\n  # mse\n  preds_g0 <- obj_ate$predictions$ml_g0[, 1, 1]\n  preds_g1 <- obj_ate$predictions$ml_g1[, 1, 1]\n  dml_fitted <- ifelse(data$treat == 1, preds_g1, preds_g0)\n  calc_mse <- mean((data$vm - dml_fitted)^2)\n\n  extract <- function(obj, est) {\n    ci <- obj$confint(level = 0.95)\n    data.table(\n      method = paste0(\"Clustered by \", cluster_var),\n      group = tag,\n      estimand = est,\n      effect = as.numeric(obj$coef),\n      se = as.numeric(obj$se),\n      p_value = as.numeric(obj$pval),\n      mse = calc_mse,\n      ci_low = as.numeric(ci[1, 1]),\n      ci_high = as.numeric(ci[1, 2])\n    )\n  }\n  return(rbind(extract(obj_ate, \"ATE\"), extract(obj_atte, \"ATTE\")))\n}\n\nall_results_list <- list()\n\nfor (yy in years) {\n  x_yearly <- setdiff(x_cols_all, \"yr\")\n  all_results_list[[paste0(\"ID_\", yy)]] <- run_dml_stable(\n    orc_matched[yr == yy],\n    x_yearly,\n    as.character(yy),\n    \"id\"\n  )\n  all_results_list[[paste0(\"SUB_\", yy)]] <- run_dml_stable(\n    orc_matched[yr == yy],\n    x_yearly,\n    as.character(yy),\n    \"subclass\"\n  )\n}\n\nall_results_list[[\"Pool_23_25_ID\"]] <- run_dml_stable(\n  orc_matched,\n  x_cols_all,\n  \"Pool (23-25)\",\n  \"id\"\n)\nall_results_list[[\"Pool_23_25_SUB\"]] <- run_dml_stable(\n  orc_matched,\n  x_cols_all,\n  \"Pool (23-25)\",\n  \"subclass\"\n)\nall_results_list[[\"Pool_23_24_SUB\"]] <- run_dml_stable(\n  orc_matched[yr %in% c(\"2023\", \"2024\")],\n  x_cols_all,\n  \"Pool (23-24)\",\n  \"subclass\"\n)\nall_results_list[[\"Pool_24_25_SUB\"]] <- run_dml_stable(\n  orc_matched[yr %in% c(\"2024\", \"2025\")],\n  x_cols_all,\n  \"Pool (24-25)\",\n  \"subclass\"\n)\n\nall_results_list[[\"Pool_Dist_Adj\"]] <- run_dml_stable(\n  orc_matched,\n  x_cols_with_dist,\n  \"Pool (Dist-Adj)\",\n  \"subclass\"\n)\n\nm_results <- rbindlist(all_results_list, fill = TRUE)\n\nm_results[, t_stat := abs(effect / se)]\nm_results[, df := 1000] # DF for SEs\nm_results[, RV := round(t_stat / sqrt(df), 4)]\nm_results[,\n  sig := cut(\n    p_value,\n    breaks = c(-Inf, 0.01, 0.05, 0.1, Inf),\n    label = c(\"***\", \"**\", \"*\", \"\")\n  )\n]\n\nknitr::kable(\n  m_results[\n    order(group, method),\n    .(group, method, estimand, effect, se, sig, RV, mse)\n  ],\n  digits = 4,\n  caption = \"Final Consolidated DML Results\"\n)\n```\n\n::: {.cell-output-display}\n\n\nTable: Final Consolidated DML Results\n\n|group           |method                |estimand | effect|     se|sig |     RV|    mse|\n|:---------------|:---------------------|:--------|------:|------:|:---|------:|------:|\n|2023            |Clustered by id       |ATE      | 0.0836| 0.0077|*** | 0.3445| 0.1636|\n|2023            |Clustered by id       |ATTE     | 0.1069| 0.0128|*** | 0.2650| 0.1636|\n|2023            |Clustered by subclass |ATE      | 0.0835| 0.0077|*** | 0.3410| 0.1640|\n|2023            |Clustered by subclass |ATTE     | 0.1092| 0.0129|*** | 0.2670| 0.1640|\n|2024            |Clustered by id       |ATE      | 0.1373| 0.0095|*** | 0.4550| 0.2288|\n|2024            |Clustered by id       |ATTE     | 0.1873| 0.0165|*** | 0.3583| 0.2288|\n|2024            |Clustered by subclass |ATE      | 0.1391| 0.0098|*** | 0.4510| 0.2284|\n|2024            |Clustered by subclass |ATTE     | 0.1871| 0.0165|*** | 0.3579| 0.2284|\n|2025            |Clustered by id       |ATE      | 0.1222| 0.0082|*** | 0.4688| 0.2253|\n|2025            |Clustered by id       |ATTE     | 0.1546| 0.0136|*** | 0.3584| 0.2253|\n|2025            |Clustered by subclass |ATE      | 0.1227| 0.0081|*** | 0.4761| 0.2252|\n|2025            |Clustered by subclass |ATTE     | 0.1559| 0.0136|*** | 0.3624| 0.2252|\n|Pool (23-24)    |Clustered by subclass |ATE      | 0.1143| 0.0063|*** | 0.5749| 0.2081|\n|Pool (23-24)    |Clustered by subclass |ATTE     | 0.1398| 0.0100|*** | 0.4410| 0.2081|\n|Pool (23-25)    |Clustered by id       |ATE      | 0.1173| 0.0049|*** | 0.7550| 0.2067|\n|Pool (23-25)    |Clustered by id       |ATTE     | 0.1476| 0.0081|*** | 0.5768| 0.2067|\n|Pool (23-25)    |Clustered by subclass |ATE      | 0.1183| 0.0050|*** | 0.7545| 0.2081|\n|Pool (23-25)    |Clustered by subclass |ATTE     | 0.1481| 0.0081|*** | 0.5786| 0.2081|\n|Pool (24-25)    |Clustered by subclass |ATE      | 0.1309| 0.0063|*** | 0.6605| 0.2327|\n|Pool (24-25)    |Clustered by subclass |ATTE     | 0.1656| 0.0103|*** | 0.5090| 0.2327|\n|Pool (Dist-Adj) |Clustered by subclass |ATE      | 0.1220| 0.0052|*** | 0.7456| 0.2242|\n|Pool (Dist-Adj) |Clustered by subclass |ATTE     | 0.1514| 0.0083|*** | 0.5787| 0.2242|\n\n\n:::\n\n```{.r .cell-code}\nplot_data1b <- copy(m_results)\nplot_data1b[,\n  group := factor(\n    group,\n    levels = rev(c(\n      as.character(years),\n      \"Pool (23-24)\",\n      \"Pool (24-25)\",\n      \"Pool (23-25)\",\n      \"Pool (Dist-Adj)\"\n    ))\n  )\n]\n\nggplot(plot_data1b, aes(x = effect, y = group, color = method)) +\n  geom_vline(xintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n  geom_errorbarh(\n    aes(xmin = ci_low, xmax = ci_high),\n    height = 0.3,\n    position = position_dodge(width = 0.6)\n  ) +\n  geom_point(position = position_dodge(width = 0.6), size = 3) +\n  facet_wrap(~estimand) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(\n    title = \"DMLIRM Effect Stability\",\n    x = \"Average Policy Effects of Treatment Variable\",\n    y = \" Computational Model\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-25.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nset.seed(5469257)\nm.out1a <- matchit(\n  treat ~ ag + sg + yr,\n  data = orc,\n  method = \"nearest\",\n  distance = \"glm\",\n)\n\norc_matched1b <- match.data(m.out1a)\n\nlove_plot1b <- love.plot(\n  m.out1a,\n  binary = \"std\",\n  thresholds = c(m = .1),\n  abs = TRUE,\n  stars = \"std\",\n  line = TRUE,\n  sample.names = c(\"Original (Pre-Match)\", \"Matched (Final Sample)\"),\n  colors = c(\"#d62728\", \"#1f77b4\"),\n  title = \"Covariate Balance\"\n)\nprint(love_plot1b)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-26.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nmodel_final_thesis1b <- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = orc_matched1b,\n  family = nbinom2,\n  weights = weights,\n  control = glmmTMBControl(optimizer = optim, optArgs = list(method = \"BFGS\"))\n)\nfix_eff1b <- summary(model_final_thesis1b)$coefficients$cond\nresults_final1b <- data.frame(\n  Variable = rownames(fix_eff1b),\n  IRR = exp(fix_eff1b[, \"Estimate\"]),\n  P_Value = fix_eff1b[, \"Pr(>|z|)\"]\n)\nprint(results_final1b)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Variable       IRR      P_Value\n(Intercept) (Intercept) 0.2425918 1.296662e-01\ntreat             treat 1.3372328 1.993339e-08\nag.L               ag.L 1.0302247 6.530468e-01\nag.Q               ag.Q 1.0181020 6.734231e-01\nsgF                 sgF 0.9001589 3.030295e-01\nyr.L               yr.L 0.9919424 8.290195e-01\nyr.Q               yr.Q 0.9915779 8.294083e-01\n```\n\n\n:::\n\n```{.r .cell-code}\n# DML robustness test confirms the GLMM via non-linear RF ?:!\ndml_data1b <- copy(orc_matched1b)\ndml_data1b[, `:=`(\n  sg = as.numeric(sg),\n  ag = as.numeric(ag),\n  yr = as.numeric(yr)\n)]\n\ndata_dml_obj1b = double_ml_data_from_data_frame(\n  as.data.frame(dml_data1b),\n  y_col = \"vm\",\n  d_cols = \"treat\",\n  x_cols = c(\"ag\", \"sg\", \"yr\")\n)\n\nl_ranger1b = lrn(\"regr.ranger\", num.trees = 500, max.depth = 5) # nuisance param\ndml_model1b = DoubleMLPLR$new(\n  data_dml_obj1b,\n  ml_l = l_ranger1b,\n  ml_m = l_ranger1b,\n  n_folds = 3\n)\ndml_model1b$fit()\nprint(dml_model1b$summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEstimates and significance testing of the effect of target variables\n      Estimate. Std. Error t value Pr(>|t|)    \ntreat   0.18635    0.01049   17.76   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n      Estimate. Std. Error  t value     Pr(>|t|)\ntreat 0.1863547 0.01049039 17.76433 1.335209e-70\n```\n\n\n:::\n\n```{.r .cell-code}\nfit_raw <- glm(vm ~ treat, data = orc, family = poisson()) # baseline\nate_raw <- exp(coef(fit_raw)[\"treat\"])\n# adjusted gcomp log/poisson of outcome via treatment and covariates\nfit_adj <- glm(vm ~ treat + ag + sg + yr + rc, data = orc, family = poisson())\n# ATE of marginality\ndata_t1 <- copy(orc)[, treat := 1]\ndata_t0 <- copy(orc)[, treat := 0]\nate_gcomp <- mean(predict(fit_adj, data_t1, type = \"response\")) /\n  mean(predict(fit_adj, data_t0, type = \"response\"))\n\nm_near <- matchit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"nearest\",\n  distance = \"glm\"\n) # PSM\nd_near <- match.data(m_near)\n# psm subclassification: 'subclass' blocks\nm_sub <- matchit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"subclass\",\n  subclass = 10\n)\nd_sub <- match.data(m_sub)\n\nlibrary(WeightIt)\nlibrary(survey)\n\nw_ipw <- weightit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"ps\",\n  estimand = \"ATE\"\n)\n\nfit_ipw <- glm(\n  vm ~ treat,\n  data = orc,\n  weights = w_ipw$weights,\n  family = poisson()\n)\n\nlibrary(AIPW)\nlibrary(SuperLearner)\nlibrary(glmmTMB)\nlibrary(pscl)\nresults_list <- list()\n\nresults_list[[\"Baseline_Raw\"]] <- exp(coef(glm(\n  vm ~ treat,\n  data = orc,\n  family = poisson\n))[\"treat\"])\n\nfit_adj <- glm(vm ~ treat + ag + sg + yr + rc, data = orc, family = poisson)\nresults_list[[\"Adjusted_GComp\"]] <- exp(coef(fit_adj)[\"treat\"])\n\nm_near <- matchit(treat ~ ag + sg + yr + rc, data = orc, method = \"nearest\")\nd_near <- match.data(m_near)\nresults_list[[\"PSM_Nearest\"]] <- exp(fixef(glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = d_near,\n  family = poisson\n))$cond[\"treat\"])\n\nm_sub <- matchit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"subclass\",\n  subclass = 5\n)\nd_sub <- match.data(m_sub)\nresults_list[[\"PSM_Subclass\"]] <- exp(fixef(glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = d_sub,\n  family = poisson\n))$cond[\"treat\"])\n\nw_ipw <- weightit(\n  treat ~ ag + sg + yr + rc,\n  data = orc,\n  method = \"ps\",\n  estimand = \"ATE\"\n)\nresults_list[[\"IPW_Weighted\"]] <- exp(coef(glm(\n  vm ~ treat,\n  data = orc,\n  weights = w_ipw$weights,\n  family = poisson\n))[\"treat\"])\n\n# nb given overdispersion ?:!\nmod_nbin <- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  data = d_near,\n  family = nbinom2\n)\nresults_list[[\"NegBinomial\"]] <- exp(fixef(mod_nbin)$cond[\"treat\"])\n\n# zinb\nmod_zinb <- glmmTMB(\n  vm ~ treat + ag + sg + yr + (1 | rc),\n  ziformula = ~1,\n  data = d_near,\n  family = nbinom2\n)\nresults_list[[\"ZINB_Model\"]] <- exp(fixef(mod_zinb)$cond[\"treat\"])\nvalidation_table <- data.frame(\n  Method = names(results_list),\n  IRR_Estimate = unlist(results_list)\n)\nprint(validation_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                             Method IRR_Estimate\nBaseline_Raw.treat     Baseline_Raw     4.273060\nAdjusted_GComp.treat Adjusted_GComp     1.338768\nPSM_Nearest.treat       PSM_Nearest     1.349855\nPSM_Subclass.treat     PSM_Subclass     1.339447\nIPW_Weighted.treat     IPW_Weighted     1.338755\nNegBinomial.treat       NegBinomial     1.349856\nZINB_Model.treat         ZINB_Model     1.349856\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(AIPW)\nlibrary(randomForest)\nlibrary(gbm3)\nlibrary(SuperLearner)\nsl_libs <- c(\"SL.glmnet\", \"SL.xgboost\", \"SL.glm\", \"SL.mean\")\ncov <- c(\"ag\", \"sg\", \"yr\", \"rg\")\naipw_obj1a <- AIPW$new(\n  Y = orc_matched$vm,\n  A = orc_matched$treat,\n  W = subset(orc_matched, select = cov),\n  Q.SL.library = sl_libs,\n  g.SL.library = sl_libs,\n  k_split = 10,\n  verbose = TRUE\n)\n\naipw_obj1a$fit()\naipw_obj1a$stratified_fit()\naipw_obj1a$summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    Estimate      SE 95% LCL 95% UCL     N\nMean of Exposure       0.173 0.00580  0.1612  0.1839  7260\nMean of Control        0.128 0.00430  0.1191  0.1360  7260\nMean Difference        0.045 0.00302  0.0390  0.0509 14520\nATT Mean Difference    0.066 0.00461  0.0569  0.0750 14520\nATC Mean Difference    0.024 0.00206  0.0199  0.0280 14520\n```\n\n\n:::\n\n```{.r .cell-code}\naipw_obj1a$plot.p_score(print.ip_weights = TRUE)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-27.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\naipw_obj1a$plot.ip_weights()\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-28.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\norcmatch_temp <- copy(orc_matched1b)\norcmatch_temp[, weights := NULL]\norcmatch_temp[, treat := NULL]\norcmatch_temp[, distance := NULL]\norcmatch_temp[, subclass := NULL]\norcmatch_temp[,\n  ag := fcase(\n    ag == 21   , \"21\"   ,\n    ag == 42   , \"42\"   ,\n    ag == 57.5 , \"57.5\"\n  )\n]\norcmatch_temp[, rc := as.factor(rc)]\norcmatch_temp[,\n  ag := factor(ag, levels = c(\"21\", \"42\", \"57.5\"), ordered = TRUE)\n]\norcmatch_temp[, sg := factor(sg)]\norcmatch_temp[, yr := factor(yr, levels = sort(unique(yr)), ordered = TRUE)]\norcmatch_temp$norm_weights <- orcmatch_temp$np / mean(orcmatch_temp$np)\nstr(orcmatch_temp[, .(yr, norm_weights, ag, sg)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'matchdata', 'data.table' and 'data.frame':\t14520 obs. of  4 variables:\n $ yr          : Ord.factor w/ 3 levels \"2023\"<\"2024\"<..: 1 1 1 1 1 1 1 1 1 1 ...\n $ norm_weights: num  0.877 0.232 1.058 1.161 0.413 ...\n $ ag          : Ord.factor w/ 3 levels \"21\"<\"42\"<\"57.5\": 2 2 2 2 3 3 3 3 2 2 ...\n $ sg          : Factor w/ 2 levels \"M\",\"F\": 1 1 1 1 1 1 1 1 1 1 ...\n - attr(*, \".internal.selfref\")=<externalptr> \n```\n\n\n:::\n\n```{.r .cell-code}\norcmatch_temp[, treat := as.numeric(ac >= median(ac))]\nmodout <- matchit(\n  treat ~ ag + sg + yr + rg,\n  data = orcmatch_temp,\n  distance = \"cbps\",\n  estimand = \"ATC\",\n  distance.options = list(method =\"exact\"),\n  replace = FALSE\n)\nmodout$model$coefficients\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 Treated\n(Intercept)  1.074180658\nag.L        -0.023798449\nag.Q        -0.002682600\nsgF         -0.039661234\nyr.L         0.026371435\nyr.Q         0.005070966\nrg          -1.007400078\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$var\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              (Intercept)          ag.L          ag.Q           sgF\n(Intercept)  0.0053016181  1.093081e-04  2.999696e-04 -1.010579e-04\nag.L         0.0001093081  3.349526e-04  1.156739e-04  4.132592e-05\nag.Q         0.0002999696  1.156739e-04  3.644225e-04  2.836486e-05\nsgF         -0.0001010579  4.132592e-05  2.836486e-05  2.739531e-04\nyr.L        -0.0000892365 -2.470722e-05 -6.279140e-06 -5.227314e-05\nyr.Q        -0.0000971804  1.051907e-05  1.750383e-05 -5.736243e-06\nrg          -0.0011899421  1.106198e-05  1.928462e-05  1.161580e-05\n                     yr.L          yr.Q            rg\n(Intercept) -8.923650e-05 -9.718040e-05 -1.189942e-03\nag.L        -2.470722e-05  1.051907e-05  1.106198e-05\nag.Q        -6.279140e-06  1.750383e-05  1.928462e-05\nsgF         -5.227314e-05 -5.736243e-06  1.161580e-05\nyr.L         2.962879e-04 -2.242514e-05  1.438637e-05\nyr.Q        -2.242514e-05  3.020457e-04  2.828130e-05\nrg           1.438637e-05  2.828130e-05  3.080084e-04\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$deviance\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 19886.95\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$J\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.0005695698\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$mle.J\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.0005744275\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$method\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"exact\"\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$terms\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat ~ ag + sg + yr + rg\nattr(,\"variables\")\nlist(treat, ag, sg, yr, rg)\nattr(,\"factors\")\n      ag sg yr rg\ntreat  0  0  0  0\nag     1  0  0  0\nsg     0  1  0  0\nyr     0  0  1  0\nrg     0  0  0  1\nattr(,\"term.labels\")\n[1] \"ag\" \"sg\" \"yr\" \"rg\"\nattr(,\"order\")\n[1] 1 1 1 1\nattr(,\"intercept\")\n[1] 1\nattr(,\"response\")\n[1] 1\nattr(,\".Environment\")\n<environment: R_GlobalEnv>\nattr(,\"predvars\")\nlist(treat, ag, sg, yr, rg)\nattr(,\"dataClasses\")\n    treat        ag        sg        yr        rg \n\"numeric\" \"ordered\"  \"factor\" \"ordered\" \"numeric\" \n```\n\n\n:::\n\n```{.r .cell-code}\nmodout$model$formula\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat ~ ag + sg + yr + rg\n```\n\n\n:::\n\n```{.r .cell-code}\nmodsum <- summary(modout)\nsummary(modout)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nmatchit(formula = treat ~ ag + sg + yr + rg, data = orcmatch_temp, \n    distance = \"cbps\", distance.options = list(method = \"exact\"), \n    estimand = \"ATC\", replace = FALSE)\n\nSummary of Balance for All Data:\n         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance        0.4921        0.5079         -0.3482     2.7489    0.0295\nag21            0.1485        0.1485          0.0000          .    0.0000\nag42            0.7590        0.7590          0.0000          .    0.0000\nag57.5          0.0926        0.0926          0.0000          .    0.0000\nsgM             0.8986        0.8986          0.0000          .    0.0000\nsgF             0.1014        0.1014          0.0000          .    0.0000\nyr2023          0.3150        0.3150          0.0000          .    0.0000\nyr2024          0.3023        0.3023          0.0000          .    0.0000\nyr2025          0.3826        0.3826          0.0000          .    0.0000\nrg              1.1069        1.0375          0.3536     2.9272    0.0174\n         eCDF Max\ndistance   0.0624\nag21       0.0000\nag42       0.0000\nag57.5     0.0000\nsgM        0.0000\nsgF        0.0000\nyr2023     0.0000\nyr2024     0.0000\nyr2025     0.0000\nrg         0.0624\n\nSummary of Balance for Matched Data:\n         Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance        0.4921        0.5079         -0.3482     2.7489    0.0295\nag21            0.1485        0.1485          0.0000          .    0.0000\nag42            0.7590        0.7590          0.0000          .    0.0000\nag57.5          0.0926        0.0926          0.0000          .    0.0000\nsgM             0.8986        0.8986          0.0000          .    0.0000\nsgF             0.1014        0.1014          0.0000          .    0.0000\nyr2023          0.3150        0.3150          0.0000          .    0.0000\nyr2024          0.3023        0.3023          0.0000          .    0.0000\nyr2025          0.3826        0.3826          0.0000          .    0.0000\nrg              1.1069        1.0375          0.3536     2.9272    0.0174\n         eCDF Max Std. Pair Dist.\ndistance   0.0624          0.3675\nag21       0.0000          0.2231\nag42       0.0000          0.1686\nag57.5     0.0000          0.0747\nsgM        0.0000          0.0339\nsgF        0.0000          0.0339\nyr2023     0.0000          0.1135\nyr2024     0.0000          0.1521\nyr2025     0.0000          0.1565\nrg         0.0624          0.3536\n\nSample Sizes:\n          Control Treated\nAll          7260    7260\nMatched      7260    7260\nUnmatched       0       0\nDiscarded       0       0\n```\n\n\n:::\n\n```{.r .cell-code}\nmodout1a <- matchit(\n  treat ~ ag + sg + yr + rg,\n  data = orcmatch_temp,\n  distance = \"gam\",\n  replace = TRUE\n)\nmodsum1a <- summary(modout1a$model)\nsummary(modout1a$model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFamily: quasibinomial \nLink function: logit \n\nFormula:\ntreat ~ ag + sg + yr + rg\n\nParametric coefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -1.083370   0.078555 -13.791   <2e-16 ***\nag.L         0.024002   0.049632   0.484    0.629    \nag.Q         0.002706   0.032627   0.083    0.934    \nsgF          0.040001   0.055542   0.720    0.471    \nyr.L        -0.026597   0.028592  -0.930    0.352    \nyr.Q        -0.005114   0.029792  -0.172    0.864    \nrg           1.016018   0.070606  14.390   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nR-sq.(adj) =  0.0155   Deviance explained =  1.2%\nGCV = 1.3709  Scale est. = 1.0005    n = 14520\n```\n\n\n:::\n\n```{.r .cell-code}\np.score <- fitted(glm(\n  treat ~ ag + sg + yr + norm_weights,\n  data = orcmatch_temp,\n  family = binomial\n))\nmodout1b <- matchit(\n  treat ~ ag + sg + yr + norm_weights,\n  data = orcmatch_temp,\n  distance = p.score\n)\nmodsum1b <- summary(modout1b$model)\nsummary(modout1b$model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLength  Class   Mode \n     0   NULL   NULL \n```\n\n\n:::\n\n```{.r .cell-code}\ny1a <- orcmatch_temp[orcmatch_temp$yr == 2023, ]\ny1b <- orcmatch_temp[orcmatch_temp$yr == 2024, ]\ny1c <- orcmatch_temp[orcmatch_temp$yr == 2025, ]\nfull_mod <- lm(vm ~ . - id, data = orcmatch_temp)\nbackstep <- stats::step(full_mod, direction = \"backward\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=-47581.54\nvm ~ (yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + id + rc + norm_weights + treat) - id\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + a8 + \n    rc + treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + rc + \n    treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a5     1       0.0  545.2 -47584\n- a2     1       0.0  545.3 -47583\n- yr     2       0.1  545.3 -47583\n- ag     2       0.1  545.3 -47583\n- a7     1       0.0  545.3 -47582\n- sg     1       0.0  545.3 -47582\n- a1     1       0.1  545.3 -47582\n<none>                545.2 -47582\n- np     1       0.2  545.4 -47579\n- a4     1       0.3  545.5 -47576\n- treat  1       8.0  553.2 -47373\n- ac     1      19.5  564.7 -47073\n- rc    23    5109.5 5654.7 -13665\n\nStep:  AIC=-47583.52\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a2     1       0.0  545.3 -47585\n- yr     2       0.1  545.3 -47585\n- ag     2       0.1  545.3 -47585\n- a7     1       0.0  545.3 -47584\n- sg     1       0.0  545.3 -47584\n- a1     1       0.1  545.3 -47584\n<none>                545.2 -47584\n- np     1       0.2  545.4 -47581\n- a4     1       0.3  545.5 -47578\n- treat  1       8.0  553.2 -47375\n- ac     1      19.6  564.8 -47073\n- rc    23    5109.5 5654.7 -13667\n\nStep:  AIC=-47585.1\nvm ~ yr + ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- yr     2       0.1  545.4 -47586\n- ag     2       0.1  545.4 -47586\n- a7     1       0.0  545.3 -47586\n- a1     1       0.0  545.3 -47586\n- sg     1       0.1  545.3 -47586\n<none>                545.3 -47585\n- np     1       0.2  545.4 -47583\n- a4     1       0.3  545.5 -47580\n- treat  1       8.0  553.2 -47377\n- ac     1      19.7  564.9 -47072\n- rc    23    5109.8 5655.0 -13668\n\nStep:  AIC=-47586.25\nvm ~ ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- ag     2       0.1  545.5 -47587\n- a7     1       0.0  545.4 -47587\n- a1     1       0.1  545.4 -47587\n- sg     1       0.1  545.4 -47587\n<none>                545.4 -47586\n- np     1       0.2  545.6 -47583\n- a4     1       0.3  545.6 -47581\n- treat  1       8.0  553.3 -47378\n- ac     1      19.7  565.1 -47073\n- rc    23    5120.1 5665.5 -13645\n\nStep:  AIC=-47587.37\nvm ~ sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a7     1       0.0  545.5 -47588\n- a1     1       0.1  545.5 -47588\n- sg     1       0.1  545.5 -47588\n<none>                545.5 -47587\n- np     1       0.2  545.7 -47584\n- a4     1       0.3  545.7 -47582\n- treat  1       7.9  553.4 -47380\n- ac     1      19.7  565.2 -47074\n- rc    23    5123.0 5668.5 -13642\n\nStep:  AIC=-47588.27\nvm ~ sg + np + ac + a1 + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a1     1       0.1  545.6 -47589\n- sg     1       0.1  545.6 -47588\n<none>                545.5 -47588\n- np     1       0.2  545.7 -47585\n- a4     1       0.3  545.8 -47583\n- treat  1       8.0  553.5 -47380\n- ac     1      20.0  565.5 -47068\n- rc    23    5123.0 5668.5 -13644\n\nStep:  AIC=-47588.87\nvm ~ sg + np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- sg     1       0.1  545.6 -47589\n<none>                545.6 -47589\n- np     1       0.1  545.7 -47587\n- a4     1       0.2  545.8 -47584\n- treat  1       7.9  553.5 -47382\n- ac     1      20.0  565.6 -47067\n- rc    23    5123.4 5668.9 -13644\n\nStep:  AIC=-47589.14\nvm ~ np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n<none>                545.6 -47589\n- np     1       0.1  545.7 -47588\n- a4     1       0.2  545.9 -47585\n- treat  1       7.9  553.6 -47381\n- ac     1      20.1  565.7 -47067\n- rc    23    5130.8 5676.5 -13627\n```\n\n\n:::\n\n```{.r .cell-code}\nfrontstep <- stats::step(\n  lm(vm ~ 1, data = orcmatch_temp),\n  scope = formula(full_mod),\n  direction = \"forward\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=-12930.38\nvm ~ 1\n\n               Df Sum of Sq    RSS    AIC\n+ rc           23    5389.0  569.8 -46968\n+ rg            1    5340.7  618.1 -45831\n+ ac            1     227.6 5731.2 -13494\n+ treat         1     126.4 5832.3 -13240\n+ np            1      89.6 5869.2 -13148\n+ norm_weights  1      89.6 5869.2 -13148\n+ a1            1      45.0 5913.7 -13039\n+ a8            1      18.2 5940.6 -12973\n+ yr            2      15.4 5943.4 -12964\n+ sg            1      11.3 5947.5 -12956\n+ a7            1      11.2 5947.6 -12956\n+ a4            1       8.9 5949.9 -12950\n+ a5            1       8.4 5950.4 -12949\n+ a2            1       3.9 5954.9 -12938\n+ ag            2       2.8 5956.0 -12933\n<none>                      5958.8 -12930\n\nStep:  AIC=-46967.87\nvm ~ rc\n\n               Df Sum of Sq    RSS    AIC\n+ ac            1   15.9938 553.80 -47379\n+ treat         1    3.9094 565.88 -47066\n+ a7            1    0.7024 569.09 -46984\n+ a4            1    0.3932 569.40 -46976\n+ a1            1    0.3331 569.46 -46974\n+ a8            1    0.2641 569.53 -46973\n+ a5            1    0.2088 569.59 -46971\n+ np            1    0.1989 569.60 -46971\n+ norm_weights  1    0.1989 569.60 -46971\n+ a2            1    0.1469 569.65 -46970\n+ sg            1    0.0931 569.70 -46968\n<none>                      569.79 -46968\n+ yr            2    0.1530 569.64 -46968\n+ ag            2    0.0969 569.70 -46966\n\nStep:  AIC=-47379.26\nvm ~ rc + ac\n\n               Df Sum of Sq    RSS    AIC\n+ treat         1    7.8819 545.92 -47585\n+ a8            1    0.1932 553.61 -47382\n+ a4            1    0.0864 553.71 -47380\n+ sg            1    0.0776 553.72 -47379\n+ np            1    0.0770 553.72 -47379\n+ norm_weights  1    0.0770 553.72 -47379\n<none>                      553.80 -47379\n+ yr            2    0.1402 553.66 -47379\n+ a7            1    0.0472 553.75 -47379\n+ ag            2    0.0987 553.70 -47378\n+ a5            1    0.0169 553.78 -47378\n+ a1            1    0.0114 553.79 -47378\n+ a2            1    0.0004 553.80 -47377\n\nStep:  AIC=-47585.4\nvm ~ rc + ac + treat\n\n               Df Sum of Sq    RSS    AIC\n+ a8            1  0.232295 545.69 -47590\n+ a4            1  0.169176 545.75 -47588\n<none>                      545.92 -47585\n+ yr            2  0.140836 545.78 -47585\n+ sg            1  0.054487 545.86 -47585\n+ np            1  0.049841 545.87 -47585\n+ norm_weights  1  0.049841 545.87 -47585\n+ ag            2  0.116231 545.80 -47584\n+ a7            1  0.034851 545.88 -47584\n+ a5            1  0.015094 545.90 -47584\n+ a1            1  0.000607 545.92 -47583\n+ a2            1  0.000040 545.92 -47583\n\nStep:  AIC=-47589.58\nvm ~ rc + ac + treat + a8\n\n               Df Sum of Sq    RSS    AIC\n+ a4            1  0.139125 545.55 -47591\n<none>                      545.69 -47590\n+ sg            1  0.068728 545.62 -47589\n+ ag            2  0.115092 545.57 -47589\n+ yr            2  0.111342 545.57 -47589\n+ a7            1  0.025486 545.66 -47588\n+ np            1  0.016027 545.67 -47588\n+ norm_weights  1  0.016027 545.67 -47588\n+ a5            1  0.009874 545.68 -47588\n+ a1            1  0.004840 545.68 -47588\n+ a2            1  0.000046 545.69 -47588\n\nStep:  AIC=-47591.29\nvm ~ rc + ac + treat + a8 + a4\n\n               Df Sum of Sq    RSS    AIC\n<none>                      545.55 -47591\n+ sg            1  0.065830 545.48 -47591\n+ yr            2  0.117365 545.43 -47590\n+ ag            2  0.116097 545.43 -47590\n+ a7            1  0.016300 545.53 -47590\n+ a5            1  0.007400 545.54 -47589\n+ a1            1  0.002675 545.54 -47589\n+ np            1  0.001634 545.55 -47589\n+ norm_weights  1  0.001634 545.55 -47589\n+ a2            1  0.000120 545.55 -47589\n```\n\n\n:::\n\n```{.r .cell-code}\nbothstep <- stats::step(full_mod, direction = \"both\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=-47581.54\nvm ~ (yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + id + rc + norm_weights + treat) - id\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + a8 + \n    rc + treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + rc + \n    treat\n\n\nStep:  AIC=-47581.54\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a5     1       0.0  545.2 -47584\n- a2     1       0.0  545.3 -47583\n- yr     2       0.1  545.3 -47583\n- ag     2       0.1  545.3 -47583\n- a7     1       0.0  545.3 -47582\n- sg     1       0.0  545.3 -47582\n- a1     1       0.1  545.3 -47582\n<none>                545.2 -47582\n- np     1       0.2  545.4 -47579\n- a4     1       0.3  545.5 -47576\n- treat  1       8.0  553.2 -47373\n- ac     1      19.5  564.7 -47073\n- rc    23    5109.5 5654.7 -13665\n\nStep:  AIC=-47583.52\nvm ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a2     1       0.0  545.3 -47585\n- yr     2       0.1  545.3 -47585\n- ag     2       0.1  545.3 -47585\n- a7     1       0.0  545.3 -47584\n- sg     1       0.0  545.3 -47584\n- a1     1       0.1  545.3 -47584\n<none>                545.2 -47584\n+ a5     1       0.0  545.2 -47582\n+ a8     1       0.0  545.2 -47582\n- np     1       0.2  545.4 -47581\n- a4     1       0.3  545.5 -47578\n- treat  1       8.0  553.2 -47375\n- ac     1      19.6  564.8 -47073\n- rc    23    5109.5 5654.7 -13667\n\nStep:  AIC=-47585.1\nvm ~ yr + ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- yr     2       0.1  545.4 -47586\n- ag     2       0.1  545.4 -47586\n- a7     1       0.0  545.3 -47586\n- a1     1       0.0  545.3 -47586\n- sg     1       0.1  545.3 -47586\n<none>                545.3 -47585\n+ a2     1       0.0  545.2 -47584\n+ a8     1       0.0  545.2 -47583\n+ a5     1       0.0  545.3 -47583\n- np     1       0.2  545.4 -47583\n- a4     1       0.3  545.5 -47580\n- treat  1       8.0  553.2 -47377\n- ac     1      19.7  564.9 -47072\n- rc    23    5109.8 5655.0 -13668\n\nStep:  AIC=-47586.25\nvm ~ ag + sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- ag     2       0.1  545.5 -47587\n- a7     1       0.0  545.4 -47587\n- a1     1       0.1  545.4 -47587\n- sg     1       0.1  545.4 -47587\n<none>                545.4 -47586\n+ yr     2       0.1  545.3 -47585\n+ a2     1       0.0  545.3 -47585\n+ a8     1       0.0  545.3 -47585\n+ a5     1       0.0  545.4 -47584\n- np     1       0.2  545.6 -47583\n- a4     1       0.3  545.6 -47581\n- treat  1       8.0  553.3 -47378\n- ac     1      19.7  565.1 -47073\n- rc    23    5120.1 5665.5 -13645\n\nStep:  AIC=-47587.37\nvm ~ sg + np + ac + a1 + a4 + a7 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a7     1       0.0  545.5 -47588\n- a1     1       0.1  545.5 -47588\n- sg     1       0.1  545.5 -47588\n<none>                545.5 -47587\n+ ag     2       0.1  545.4 -47586\n+ yr     2       0.1  545.4 -47586\n+ a2     1       0.0  545.5 -47586\n+ a8     1       0.0  545.5 -47586\n+ a5     1       0.0  545.5 -47585\n- np     1       0.2  545.7 -47584\n- a4     1       0.3  545.7 -47582\n- treat  1       7.9  553.4 -47380\n- ac     1      19.7  565.2 -47074\n- rc    23    5123.0 5668.5 -13642\n\nStep:  AIC=-47588.27\nvm ~ sg + np + ac + a1 + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- a1     1       0.1  545.6 -47589\n- sg     1       0.1  545.6 -47588\n<none>                545.5 -47588\n+ a7     1       0.0  545.5 -47587\n+ a8     1       0.0  545.5 -47587\n+ ag     2       0.1  545.4 -47587\n+ yr     2       0.1  545.4 -47587\n+ a2     1       0.0  545.5 -47587\n+ a5     1       0.0  545.5 -47586\n- np     1       0.2  545.7 -47585\n- a4     1       0.3  545.8 -47583\n- treat  1       8.0  553.5 -47380\n- ac     1      20.0  565.5 -47068\n- rc    23    5123.0 5668.5 -13644\n\nStep:  AIC=-47588.87\nvm ~ sg + np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n- sg     1       0.1  545.6 -47589\n+ a8     1       0.1  545.5 -47589\n<none>                545.6 -47589\n+ a1     1       0.1  545.5 -47588\n+ a7     1       0.0  545.5 -47588\n+ yr     2       0.1  545.5 -47588\n+ ag     2       0.1  545.5 -47588\n- np     1       0.1  545.7 -47587\n+ a5     1       0.0  545.6 -47587\n+ a2     1       0.0  545.6 -47587\n- a4     1       0.2  545.8 -47584\n- treat  1       7.9  553.5 -47382\n- ac     1      20.0  565.6 -47067\n- rc    23    5123.4 5668.9 -13644\n\nStep:  AIC=-47589.14\nvm ~ np + ac + a4 + rc + treat\n\n        Df Sum of Sq    RSS    AIC\n+ a8     1       0.1  545.5 -47589\n<none>                545.6 -47589\n+ sg     1       0.1  545.6 -47589\n+ a1     1       0.1  545.6 -47588\n+ yr     2       0.1  545.5 -47588\n+ ag     2       0.1  545.5 -47588\n+ a7     1       0.0  545.6 -47588\n- np     1       0.1  545.7 -47588\n+ a2     1       0.0  545.6 -47587\n+ a5     1       0.0  545.6 -47587\n- a4     1       0.2  545.9 -47585\n- treat  1       7.9  553.6 -47381\n- ac     1      20.1  565.7 -47067\n- rc    23    5130.8 5676.5 -13627\n\nStep:  AIC=-47589.33\nvm ~ np + ac + a4 + rc + treat + a8\n\n        Df Sum of Sq    RSS    AIC\n- np     1       0.0  545.5 -47591\n<none>                545.5 -47589\n- a8     1       0.1  545.6 -47589\n+ sg     1       0.1  545.5 -47589\n+ yr     2       0.1  545.4 -47588\n+ ag     2       0.1  545.4 -47588\n- a4     1       0.1  545.7 -47588\n+ a7     1       0.0  545.5 -47588\n+ a5     1       0.0  545.5 -47588\n+ a1     1       0.0  545.5 -47587\n+ a2     1       0.0  545.5 -47587\n- treat  1       8.0  553.5 -47380\n- ac     1      19.8  565.3 -47075\n- rc    23    5130.8 5676.4 -13625\n\nStep:  AIC=-47591.29\nvm ~ ac + a4 + rc + treat + a8\n\n               Df Sum of Sq    RSS    AIC\n<none>                       545.5 -47591\n+ sg            1       0.1  545.5 -47591\n+ yr            2       0.1  545.4 -47590\n+ ag            2       0.1  545.4 -47590\n+ a7            1       0.0  545.5 -47590\n- a4            1       0.1  545.7 -47590\n+ a5            1       0.0  545.5 -47589\n+ a1            1       0.0  545.5 -47589\n+ np            1       0.0  545.5 -47589\n+ norm_weights  1       0.0  545.5 -47589\n+ a2            1       0.0  545.5 -47589\n- a8            1       0.2  545.7 -47588\n- treat         1       8.0  553.5 -47382\n- ac            1      20.0  565.5 -47072\n- rc           23    5152.2 5697.7 -13573\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(backstep)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = vm ~ np + ac + a4 + rc + treat, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4488  0.0016  0.0092  0.0154  3.5834 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             -1.168e-01  5.642e-03 -20.696   <2e-16\nnp                                      -5.533e-05  3.079e-05  -1.797   0.0724\nac                                       1.037e-01  4.491e-03  23.082   <2e-16\na4                                       2.232e-04  8.826e-05   2.529   0.0114\nrcCentral + Eastern                      2.184e+00  1.789e-02 122.061   <2e-16\nrcCentral + Eastern + Toronto            4.007e+00  3.751e-02 106.830   <2e-16\nrcCentral + Eastern + Toronto + Western  6.534e+00  1.122e-01  58.231   <2e-16\nrcCentral + Eastern + Western            3.504e+00  5.863e-02  59.751   <2e-16\nrcCentral + Northern                     2.332e+00  3.819e-02  61.048   <2e-16\nrcCentral + Northern + Toronto           2.938e+00  1.121e-01  26.206   <2e-16\nrcCentral + Northern + Western           3.161e+00  8.685e-02  36.391   <2e-16\nrcCentral + Toronto                      2.358e+00  1.248e-02 189.016   <2e-16\nrcCentral + Toronto + Western            4.087e+00  6.480e-02  63.062   <2e-16\nrcCentral + Western                      2.144e+00  1.628e-02 131.673   <2e-16\nrcEastern                               -5.784e-03  4.493e-03  -1.287   0.1980\nrcEastern + Northern                     2.194e+00  4.247e-02  51.658   <2e-16\nrcEastern + Northern + Toronto           3.969e+00  1.121e-01  35.412   <2e-16\nrcEastern + Northern + Western           4.007e+00  1.941e-01  20.645   <2e-16\nrcEastern + Toronto                      2.283e+00  1.495e-02 152.686   <2e-16\nrcEastern + Toronto + Western            3.255e+00  9.710e-02  33.522   <2e-16\nrcEastern + Western                      2.443e+00  2.946e-02  82.920   <2e-16\nrcNorthern                              -3.973e-03  5.530e-03  -0.718   0.4725\nrcNorthern + Toronto                     2.065e+00  2.852e-02  72.397   <2e-16\nrcNorthern + Western                     2.188e+00  3.501e-02  62.497   <2e-16\nrcToronto                                2.635e-05  5.278e-03   0.005   0.9960\nrcToronto + Western                      1.985e+00  3.251e-02  61.066   <2e-16\nrcWestern                                4.298e-03  5.299e-03   0.811   0.4173\ntreat                                   -9.167e-02  6.309e-03 -14.529   <2e-16\n                                           \n(Intercept)                             ***\nnp                                      .  \nac                                      ***\na4                                      *  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto           ***\nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western           ***\nrcCentral + Northern                    ***\nrcCentral + Northern + Toronto          ***\nrcCentral + Northern + Western          ***\nrcCentral + Toronto                     ***\nrcCentral + Toronto + Western           ***\nrcCentral + Western                     ***\nrcEastern                                  \nrcEastern + Northern                    ***\nrcEastern + Northern + Toronto          ***\nrcEastern + Northern + Western          ***\nrcEastern + Toronto                     ***\nrcEastern + Toronto + Western           ***\nrcEastern + Western                     ***\nrcNorthern                                 \nrcNorthern + Toronto                    ***\nrcNorthern + Western                    ***\nrcToronto                                  \nrcToronto + Western                     ***\nrcWestern                                  \ntreat                                   ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.194 on 14492 degrees of freedom\nMultiple R-squared:  0.9084,\tAdjusted R-squared:  0.9083 \nF-statistic:  5325 on 27 and 14492 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(frontstep)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = vm ~ rc + ac + treat + a8 + a4, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4529  0.0017  0.0088  0.0154  3.5834 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             -1.157e-01  5.683e-03 -20.361   <2e-16\nrcCentral + Eastern                      2.184e+00  1.789e-02 122.074   <2e-16\nrcCentral + Eastern + Toronto            4.006e+00  3.750e-02 106.817   <2e-16\nrcCentral + Eastern + Toronto + Western  6.536e+00  1.122e-01  58.250   <2e-16\nrcCentral + Eastern + Western            3.503e+00  5.862e-02  59.761   <2e-16\nrcCentral + Northern                     2.331e+00  3.819e-02  61.051   <2e-16\nrcCentral + Northern + Toronto           2.937e+00  1.121e-01  26.200   <2e-16\nrcCentral + Northern + Western           3.160e+00  8.685e-02  36.389   <2e-16\nrcCentral + Toronto                      2.358e+00  1.247e-02 189.137   <2e-16\nrcCentral + Toronto + Western            4.087e+00  6.479e-02  63.083   <2e-16\nrcCentral + Western                      2.144e+00  1.627e-02 131.765   <2e-16\nrcEastern                               -6.046e-03  4.482e-03  -1.349   0.1773\nrcEastern + Northern                     2.193e+00  4.246e-02  51.654   <2e-16\nrcEastern + Northern + Toronto           3.971e+00  1.121e-01  35.429   <2e-16\nrcEastern + Northern + Western           4.010e+00  1.941e-01  20.663   <2e-16\nrcEastern + Toronto                      2.283e+00  1.494e-02 152.755   <2e-16\nrcEastern + Toronto + Western            3.255e+00  9.710e-02  33.524   <2e-16\nrcEastern + Western                      2.442e+00  2.946e-02  82.896   <2e-16\nrcNorthern                              -4.247e-03  5.531e-03  -0.768   0.4426\nrcNorthern + Toronto                     2.065e+00  2.852e-02  72.413   <2e-16\nrcNorthern + Western                     2.188e+00  3.500e-02  62.496   <2e-16\nrcToronto                               -2.079e-04  5.278e-03  -0.039   0.9686\nrcToronto + Western                      1.985e+00  3.251e-02  61.069   <2e-16\nrcWestern                                4.082e-03  5.297e-03   0.771   0.4409\nac                                       1.031e-01  4.477e-03  23.023   <2e-16\ntreat                                   -9.194e-02  6.309e-03 -14.572   <2e-16\na8                                      -9.117e-05  3.933e-05  -2.318   0.0205\na4                                       1.638e-04  8.519e-05   1.922   0.0546\n                                           \n(Intercept)                             ***\nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto           ***\nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western           ***\nrcCentral + Northern                    ***\nrcCentral + Northern + Toronto          ***\nrcCentral + Northern + Western          ***\nrcCentral + Toronto                     ***\nrcCentral + Toronto + Western           ***\nrcCentral + Western                     ***\nrcEastern                                  \nrcEastern + Northern                    ***\nrcEastern + Northern + Toronto          ***\nrcEastern + Northern + Western          ***\nrcEastern + Toronto                     ***\nrcEastern + Toronto + Western           ***\nrcEastern + Western                     ***\nrcNorthern                                 \nrcNorthern + Toronto                    ***\nrcNorthern + Western                    ***\nrcToronto                                  \nrcToronto + Western                     ***\nrcWestern                                  \nac                                      ***\ntreat                                   ***\na8                                      *  \na4                                      .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.194 on 14492 degrees of freedom\nMultiple R-squared:  0.9084,\tAdjusted R-squared:  0.9083 \nF-statistic:  5326 on 27 and 14492 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(bothstep)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = vm ~ ac + a4 + rc + treat + a8, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-1.4529  0.0017  0.0088  0.0154  3.5834 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             -1.157e-01  5.683e-03 -20.361   <2e-16\nac                                       1.031e-01  4.477e-03  23.023   <2e-16\na4                                       1.638e-04  8.519e-05   1.922   0.0546\nrcCentral + Eastern                      2.184e+00  1.789e-02 122.074   <2e-16\nrcCentral + Eastern + Toronto            4.006e+00  3.750e-02 106.817   <2e-16\nrcCentral + Eastern + Toronto + Western  6.536e+00  1.122e-01  58.250   <2e-16\nrcCentral + Eastern + Western            3.503e+00  5.862e-02  59.761   <2e-16\nrcCentral + Northern                     2.331e+00  3.819e-02  61.051   <2e-16\nrcCentral + Northern + Toronto           2.937e+00  1.121e-01  26.200   <2e-16\nrcCentral + Northern + Western           3.160e+00  8.685e-02  36.389   <2e-16\nrcCentral + Toronto                      2.358e+00  1.247e-02 189.137   <2e-16\nrcCentral + Toronto + Western            4.087e+00  6.479e-02  63.083   <2e-16\nrcCentral + Western                      2.144e+00  1.627e-02 131.765   <2e-16\nrcEastern                               -6.046e-03  4.482e-03  -1.349   0.1773\nrcEastern + Northern                     2.193e+00  4.246e-02  51.654   <2e-16\nrcEastern + Northern + Toronto           3.971e+00  1.121e-01  35.429   <2e-16\nrcEastern + Northern + Western           4.010e+00  1.941e-01  20.663   <2e-16\nrcEastern + Toronto                      2.283e+00  1.494e-02 152.755   <2e-16\nrcEastern + Toronto + Western            3.255e+00  9.710e-02  33.524   <2e-16\nrcEastern + Western                      2.442e+00  2.946e-02  82.896   <2e-16\nrcNorthern                              -4.247e-03  5.531e-03  -0.768   0.4426\nrcNorthern + Toronto                     2.065e+00  2.852e-02  72.413   <2e-16\nrcNorthern + Western                     2.188e+00  3.500e-02  62.496   <2e-16\nrcToronto                               -2.079e-04  5.278e-03  -0.039   0.9686\nrcToronto + Western                      1.985e+00  3.251e-02  61.069   <2e-16\nrcWestern                                4.082e-03  5.297e-03   0.771   0.4409\ntreat                                   -9.194e-02  6.309e-03 -14.572   <2e-16\na8                                      -9.117e-05  3.933e-05  -2.318   0.0205\n                                           \n(Intercept)                             ***\nac                                      ***\na4                                      .  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto           ***\nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western           ***\nrcCentral + Northern                    ***\nrcCentral + Northern + Toronto          ***\nrcCentral + Northern + Western          ***\nrcCentral + Toronto                     ***\nrcCentral + Toronto + Western           ***\nrcCentral + Western                     ***\nrcEastern                                  \nrcEastern + Northern                    ***\nrcEastern + Northern + Toronto          ***\nrcEastern + Northern + Western          ***\nrcEastern + Toronto                     ***\nrcEastern + Toronto + Western           ***\nrcEastern + Western                     ***\nrcNorthern                                 \nrcNorthern + Toronto                    ***\nrcNorthern + Western                    ***\nrcToronto                                  \nrcToronto + Western                     ***\nrcWestern                                  \ntreat                                   ***\na8                                      *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.194 on 14492 degrees of freedom\nMultiple R-squared:  0.9084,\tAdjusted R-squared:  0.9083 \nF-statistic:  5326 on 27 and 14492 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\n# plot(bothstep)\nabs_t <- sort(\n  abs(summary(bothstep)$coefficients[, \"t value\"]),\n  decreasing = TRUE\n)\nprint(abs_t)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    rcCentral + Toronto                     rcEastern + Toronto \n                           189.13684688                            152.75510003 \n                    rcCentral + Western                     rcCentral + Eastern \n                           131.76467803                            122.07365301 \n          rcCentral + Eastern + Toronto                     rcEastern + Western \n                           106.81715727                             82.89618520 \n                   rcNorthern + Toronto           rcCentral + Toronto + Western \n                            72.41282325                             63.08289090 \n                   rcNorthern + Western                     rcToronto + Western \n                            62.49575446                             61.06891525 \n                   rcCentral + Northern           rcCentral + Eastern + Western \n                            61.05089828                             59.76090767 \nrcCentral + Eastern + Toronto + Western                    rcEastern + Northern \n                            58.25037221                             51.65369553 \n         rcCentral + Northern + Western          rcEastern + Northern + Toronto \n                            36.38941150                             35.42944826 \n          rcEastern + Toronto + Western          rcCentral + Northern + Toronto \n                            33.52431600                             26.19996817 \n                                     ac          rcEastern + Northern + Western \n                            23.02250346                             20.66306816 \n                            (Intercept)                                   treat \n                            20.36090376                             14.57178211 \n                                     a8                                      a4 \n                             2.31785814                              1.92243389 \n                              rcEastern                               rcWestern \n                             1.34910662                              0.77074141 \n                             rcNorthern                               rcToronto \n                             0.76786860                              0.03939446 \n```\n\n\n:::\n\n```{.r .cell-code}\npar(mfrow = c(2, 2))\nplot(bothstep, ask = FALSE, which = 1:4)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-29.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\nlibrary(sjPlot)\nsjPlot::plot_model(\n  bothstep,\n  title = \"Variables selected in Stepwise Regression Model\",\n  subtitle = \"vm ~ ac + a4 + rc + treatment + a8\"\n)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-30.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nplot(bothstep, which = 1, main = \"Model Fit\", ask = FALSE)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-31.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nplot_model(\n  bothstep,\n  title = \"Target Predictors from Stepwise Regression\",\n  sort.est = FALSE,\n  show.values = TRUE,\n  value.offset = 0.4,\n  type = \"std\"\n)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-32.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nfinal_covariates <- formula(bothstep)\nprint(final_covariates)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nvm ~ ac + a4 + rc + treat + a8\n```\n\n\n:::\n\n```{.r .cell-code}\nset.seed(36825994)\nfmod <- lm(treat ~ . - id - vm, data = orcmatch_temp)\nbstepz <- stats::step(fmod, direction = \"backward\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=-39611.14\ntreat ~ (yr + ag + sg + np + ac + rg + vm + a1 + a2 + a4 + a5 + \n    a7 + a8 + id + rc + norm_weights) - id - vm\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- yr    2      0.00  944.2 -39615\n- ag    2      0.10  944.2 -39614\n- a2    1      0.00  944.1 -39613\n- a5    1      0.06  944.2 -39612\n- np    1      0.07  944.2 -39612\n<none>               944.1 -39611\n- a7    1      0.23  944.4 -39610\n- sg    1      0.29  944.4 -39609\n- a1    1      0.93  945.1 -39599\n- a4    1      1.90  946.1 -39584\n- rc   23      5.73  949.9 -39569\n- ac    1   2363.05 3307.2 -21411\n\nStep:  AIC=-39615.06\ntreat ~ ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- ag    2      0.10  944.3 -39618\n- a2    1      0.00  944.2 -39617\n- a5    1      0.06  944.2 -39616\n- np    1      0.07  944.2 -39616\n<none>               944.2 -39615\n- a7    1      0.23  944.4 -39614\n- sg    1      0.28  944.4 -39613\n- a1    1      0.94  945.1 -39603\n- a4    1      1.91  946.1 -39588\n- rc   23      5.74  949.9 -39573\n- ac    1   2366.23 3310.4 -21401\n\nStep:  AIC=-39617.5\ntreat ~ sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a2    1      0.00  944.3 -39619\n- a5    1      0.06  944.3 -39619\n- np    1      0.07  944.3 -39618\n<none>               944.3 -39618\n- a7    1      0.23  944.5 -39616\n- sg    1      0.27  944.5 -39615\n- a1    1      0.94  945.2 -39605\n- a4    1      1.91  946.2 -39590\n- rc   23      5.72  950.0 -39576\n- ac    1   2366.36 3310.6 -21404\n\nStep:  AIC=-39619.49\ntreat ~ sg + np + ac + a1 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a5    1      0.06  944.3 -39621\n- np    1      0.08  944.3 -39620\n<none>               944.3 -39619\n- a7    1      0.23  944.5 -39618\n- sg    1      0.27  944.5 -39617\n- a1    1      0.99  945.2 -39606\n- a4    1      1.93  946.2 -39592\n- rc   23      5.72  950.0 -39578\n- ac    1   2382.55 3326.8 -21335\n\nStep:  AIC=-39620.58\ntreat ~ sg + np + ac + a1 + a4 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- np    1      0.06  944.4 -39622\n<none>               944.3 -39621\n- a7    1      0.24  944.6 -39619\n- sg    1      0.27  944.6 -39618\n- a1    1      0.94  945.3 -39608\n- a4    1      1.88  946.2 -39594\n- rc   23      5.73  950.0 -39579\n- ac    1   2441.60 3385.9 -21082\n\nStep:  AIC=-39621.66\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n<none>               944.4 -39622\n- a7    1      0.27  944.6 -39619\n- sg    1      0.29  944.7 -39619\n- a1    1      1.00  945.4 -39608\n- a4    1      1.87  946.2 -39595\n- rc   23      5.87  950.2 -39578\n- ac    1   2450.06 3394.4 -21047\n```\n\n\n:::\n\n```{.r .cell-code}\nfstepz <- stats::step(\n  lm(treat ~ 1, data = orcmatch_temp),\n  scope = formula(fmod),\n  direction = \"forward\"\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=-20126.99\ntreat ~ 1\n\n               Df Sum of Sq    RSS    AIC\n+ ac            1   2677.37  952.6 -39549\n+ norm_weights  1    114.94 3515.1 -20592\n+ np            1    114.94 3515.1 -20592\n+ a1            1    104.80 3525.2 -20550\n+ a7            1     63.16 3566.8 -20380\n+ a5            1     62.07 3567.9 -20375\n+ rc           23     70.94 3559.1 -20368\n+ rg            1     56.88 3573.1 -20354\n+ a4            1     35.41 3594.6 -20267\n+ a2            1     23.32 3606.7 -20219\n+ a8            1      0.59 3629.4 -20127\n<none>                      3630.0 -20127\n+ sg            1      0.00 3630.0 -20125\n+ yr            2      0.00 3630.0 -20123\n+ ag            2      0.00 3630.0 -20123\n\nStep:  AIC=-39549.22\ntreat ~ ac\n\n               Df Sum of Sq    RSS    AIC\n+ rc           23    5.1441 947.49 -39582\n+ a4            1    1.3992 951.24 -39569\n+ a1            1    0.5435 952.09 -39556\n+ a8            1    0.3666 952.27 -39553\n<none>                      952.63 -39549\n+ sg            1    0.1257 952.51 -39549\n+ np            1    0.1108 952.52 -39549\n+ norm_weights  1    0.1108 952.52 -39549\n+ a7            1    0.1060 952.53 -39549\n+ rg            1    0.0486 952.59 -39548\n+ a2            1    0.0307 952.60 -39548\n+ a5            1    0.0050 952.63 -39547\n+ ag            2    0.0737 952.56 -39546\n+ yr            2    0.0026 952.63 -39545\n\nStep:  AIC=-39581.84\ntreat ~ ac + rc\n\n               Df Sum of Sq    RSS    AIC\n+ a4            1   1.64733 945.84 -39605\n+ a1            1   0.81461 946.68 -39592\n+ np            1   0.35315 947.14 -39585\n+ norm_weights  1   0.35315 947.14 -39585\n+ sg            1   0.24603 947.24 -39584\n+ a8            1   0.21604 947.27 -39583\n<none>                      947.49 -39582\n+ a7            1   0.11160 947.38 -39582\n+ a2            1   0.01858 947.47 -39580\n+ a5            1   0.00582 947.48 -39580\n+ ag            2   0.08668 947.40 -39579\n+ yr            2   0.00137 947.49 -39578\n\nStep:  AIC=-39605.1\ntreat ~ ac + rc + a4\n\n               Df Sum of Sq    RSS    AIC\n+ a1            1   0.90828 944.94 -39617\n+ sg            1   0.25827 945.59 -39607\n+ a7            1   0.20460 945.64 -39606\n<none>                      945.84 -39605\n+ a8            1   0.12956 945.71 -39605\n+ np            1   0.06411 945.78 -39604\n+ norm_weights  1   0.06411 945.78 -39604\n+ a2            1   0.02345 945.82 -39603\n+ a5            1   0.01620 945.83 -39603\n+ ag            2   0.08950 945.75 -39602\n+ yr            2   0.00113 945.84 -39601\n\nStep:  AIC=-39617.05\ntreat ~ ac + rc + a4 + a1\n\n               Df Sum of Sq    RSS    AIC\n+ sg            1  0.285580 944.65 -39619\n+ a7            1  0.271186 944.66 -39619\n<none>                      944.94 -39617\n+ np            1  0.114428 944.82 -39617\n+ norm_weights  1  0.114428 944.82 -39617\n+ a8            1  0.072427 944.86 -39616\n+ a5            1  0.037751 944.90 -39616\n+ a2            1  0.007321 944.93 -39615\n+ ag            2  0.091240 944.84 -39614\n+ yr            2  0.006384 944.93 -39613\n\nStep:  AIC=-39619.44\ntreat ~ ac + rc + a4 + a1 + sg\n\n               Df Sum of Sq    RSS    AIC\n+ a7            1  0.274550 944.37 -39622\n<none>                      944.65 -39619\n+ np            1  0.091537 944.56 -39619\n+ norm_weights  1  0.091537 944.56 -39619\n+ a8            1  0.055695 944.59 -39618\n+ a5            1  0.040227 944.61 -39618\n+ a2            1  0.004945 944.64 -39618\n+ ag            2  0.106140 944.54 -39617\n+ yr            2  0.014561 944.63 -39616\n\nStep:  AIC=-39621.66\ntreat ~ ac + rc + a4 + a1 + sg + a7\n\n               Df Sum of Sq    RSS    AIC\n<none>                      944.37 -39622\n+ a8            1  0.066835 944.31 -39621\n+ np            1  0.059571 944.32 -39621\n+ norm_weights  1  0.059571 944.32 -39621\n+ a5            1  0.035854 944.34 -39620\n+ a2            1  0.007461 944.37 -39620\n+ ag            2  0.104758 944.27 -39619\n+ yr            2  0.010153 944.36 -39618\n```\n\n\n:::\n\n```{.r .cell-code}\nbothstepz <- stats::step(fmod, direction = \"both\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nStart:  AIC=-39611.14\ntreat ~ (yr + ag + sg + np + ac + rg + vm + a1 + a2 + a4 + a5 + \n    a7 + a8 + id + rc + norm_weights) - id - vm\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    a8 + rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + rg + a1 + a2 + a4 + a5 + a7 + \n    rc\n\n\nStep:  AIC=-39611.14\ntreat ~ yr + ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- yr    2      0.00  944.2 -39615\n- ag    2      0.10  944.2 -39614\n- a2    1      0.00  944.1 -39613\n- a5    1      0.06  944.2 -39612\n- np    1      0.07  944.2 -39612\n<none>               944.1 -39611\n- a7    1      0.23  944.4 -39610\n- sg    1      0.29  944.4 -39609\n- a1    1      0.93  945.1 -39599\n- a4    1      1.90  946.1 -39584\n- rc   23      5.73  949.9 -39569\n- ac    1   2363.05 3307.2 -21411\n\nStep:  AIC=-39615.06\ntreat ~ ag + sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- ag    2      0.10  944.3 -39618\n- a2    1      0.00  944.2 -39617\n- a5    1      0.06  944.2 -39616\n- np    1      0.07  944.2 -39616\n<none>               944.2 -39615\n- a7    1      0.23  944.4 -39614\n- sg    1      0.28  944.4 -39613\n+ yr    2      0.00  944.1 -39611\n- a1    1      0.94  945.1 -39603\n- a4    1      1.91  946.1 -39588\n- rc   23      5.74  949.9 -39573\n- ac    1   2366.23 3310.4 -21401\n\nStep:  AIC=-39617.5\ntreat ~ sg + np + ac + a1 + a2 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a2    1      0.00  944.3 -39619\n- a5    1      0.06  944.3 -39619\n- np    1      0.07  944.3 -39618\n<none>               944.3 -39618\n- a7    1      0.23  944.5 -39616\n- sg    1      0.27  944.5 -39615\n+ ag    2      0.10  944.2 -39615\n+ yr    2      0.01  944.2 -39614\n- a1    1      0.94  945.2 -39605\n- a4    1      1.91  946.2 -39590\n- rc   23      5.72  950.0 -39576\n- ac    1   2366.36 3310.6 -21404\n\nStep:  AIC=-39619.49\ntreat ~ sg + np + ac + a1 + a4 + a5 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- a5    1      0.06  944.3 -39621\n- np    1      0.08  944.3 -39620\n<none>               944.3 -39619\n- a7    1      0.23  944.5 -39618\n+ a2    1      0.00  944.3 -39618\n+ a8    1      0.00  944.3 -39618\n- sg    1      0.27  944.5 -39617\n+ ag    2      0.10  944.2 -39617\n+ yr    2      0.01  944.3 -39616\n- a1    1      0.99  945.2 -39606\n- a4    1      1.93  946.2 -39592\n- rc   23      5.72  950.0 -39578\n- ac    1   2382.55 3326.8 -21335\n\nStep:  AIC=-39620.58\ntreat ~ sg + np + ac + a1 + a4 + a7 + rc\n\n       Df Sum of Sq    RSS    AIC\n- np    1      0.06  944.4 -39622\n<none>               944.3 -39621\n+ a5    1      0.06  944.3 -39619\n- a7    1      0.24  944.6 -39619\n+ a8    1      0.01  944.3 -39619\n+ a2    1      0.00  944.3 -39619\n- sg    1      0.27  944.6 -39618\n+ ag    2      0.10  944.2 -39618\n+ yr    2      0.01  944.3 -39617\n- a1    1      0.94  945.3 -39608\n- a4    1      1.88  946.2 -39594\n- rc   23      5.73  950.0 -39579\n- ac    1   2441.60 3385.9 -21082\n\nStep:  AIC=-39621.66\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n\n               Df Sum of Sq    RSS    AIC\n<none>                       944.4 -39622\n+ a8            1      0.07  944.3 -39621\n+ np            1      0.06  944.3 -39621\n+ norm_weights  1      0.06  944.3 -39621\n+ a5            1      0.04  944.3 -39620\n+ a2            1      0.01  944.4 -39620\n- a7            1      0.27  944.6 -39619\n+ ag            2      0.10  944.3 -39619\n- sg            1      0.29  944.7 -39619\n+ yr            2      0.01  944.4 -39618\n- a1            1      1.00  945.4 -39608\n- a4            1      1.87  946.2 -39595\n- rc           23      5.87  950.2 -39578\n- ac            1   2450.06 3394.4 -21047\n```\n\n\n:::\n\n```{.r .cell-code}\nstepform <- formula(bothstepz)\nprint(stepform)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(bstepz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.1814 -0.1378 -0.1044  0.2558  0.4331 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             -0.4681377  0.0063124 -74.161  < 2e-16\nsgF                                      0.0153125  0.0072721   2.106 0.035253\nac                                       0.6059280  0.0031250 193.894  < 2e-16\na1                                       0.0002449  0.0000624   3.924 8.74e-05\na4                                       0.0006013  0.0001122   5.360 8.46e-08\na7                                      -0.0006034  0.0002940  -2.053 0.040137\nrcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594\nrcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479\nrcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168\nrcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775\nrcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285\nrcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409\nrcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321\nrcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426\nrcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676\nrcCentral + Western                      0.0307709  0.0213937   1.438 0.150365\nrcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09\nrcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343\nrcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472\nrcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935\nrcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546\nrcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134\nrcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755\nrcNorthern                              -0.0047978  0.0073647  -0.651 0.514756\nrcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573\nrcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769\nrcToronto                               -0.0132884  0.0069503  -1.912 0.055906\nrcToronto + Western                      0.0296455  0.0427685   0.693 0.488219\nrcWestern                                0.0020497  0.0070114   0.292 0.770035\n                                           \n(Intercept)                             ***\nsgF                                     *  \nac                                      ***\na1                                      ***\na4                                      ***\na7                                      *  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto              \nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western              \nrcCentral + Northern                       \nrcCentral + Northern + Toronto          .  \nrcCentral + Northern + Western             \nrcCentral + Toronto                     .  \nrcCentral + Toronto + Western              \nrcCentral + Western                        \nrcEastern                               ***\nrcEastern + Northern                       \nrcEastern + Northern + Toronto             \nrcEastern + Northern + Western             \nrcEastern + Toronto                     .  \nrcEastern + Toronto + Western              \nrcEastern + Western                        \nrcNorthern                                 \nrcNorthern + Toronto                       \nrcNorthern + Western                       \nrcToronto                               .  \nrcToronto + Western                        \nrcWestern                                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2553 on 14491 degrees of freedom\nMultiple R-squared:  0.7398,\tAdjusted R-squared:  0.7393 \nF-statistic:  1472 on 28 and 14491 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(fstepz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = treat ~ ac + rc + a4 + a1 + sg + a7, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.1814 -0.1378 -0.1044  0.2558  0.4331 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             -0.4681377  0.0063124 -74.161  < 2e-16\nac                                       0.6059280  0.0031250 193.894  < 2e-16\nrcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594\nrcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479\nrcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168\nrcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775\nrcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285\nrcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409\nrcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321\nrcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426\nrcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676\nrcCentral + Western                      0.0307709  0.0213937   1.438 0.150365\nrcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09\nrcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343\nrcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472\nrcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935\nrcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546\nrcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134\nrcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755\nrcNorthern                              -0.0047978  0.0073647  -0.651 0.514756\nrcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573\nrcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769\nrcToronto                               -0.0132884  0.0069503  -1.912 0.055906\nrcToronto + Western                      0.0296455  0.0427685   0.693 0.488219\nrcWestern                                0.0020497  0.0070114   0.292 0.770035\na4                                       0.0006013  0.0001122   5.360 8.46e-08\na1                                       0.0002449  0.0000624   3.924 8.74e-05\nsgF                                      0.0153125  0.0072721   2.106 0.035253\na7                                      -0.0006034  0.0002940  -2.053 0.040137\n                                           \n(Intercept)                             ***\nac                                      ***\nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto              \nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western              \nrcCentral + Northern                       \nrcCentral + Northern + Toronto          .  \nrcCentral + Northern + Western             \nrcCentral + Toronto                     .  \nrcCentral + Toronto + Western              \nrcCentral + Western                        \nrcEastern                               ***\nrcEastern + Northern                       \nrcEastern + Northern + Toronto             \nrcEastern + Northern + Western             \nrcEastern + Toronto                     .  \nrcEastern + Toronto + Western              \nrcEastern + Western                        \nrcNorthern                                 \nrcNorthern + Toronto                       \nrcNorthern + Western                       \nrcToronto                               .  \nrcToronto + Western                        \nrcWestern                                  \na4                                      ***\na1                                      ***\nsgF                                     *  \na7                                      *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2553 on 14491 degrees of freedom\nMultiple R-squared:  0.7398,\tAdjusted R-squared:  0.7393 \nF-statistic:  1472 on 28 and 14491 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(bothstepz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-2.1814 -0.1378 -0.1044  0.2558  0.4331 \n\nCoefficients:\n                                          Estimate Std. Error t value Pr(>|t|)\n(Intercept)                             -0.4681377  0.0063124 -74.161  < 2e-16\nsgF                                      0.0153125  0.0072721   2.106 0.035253\nac                                       0.6059280  0.0031250 193.894  < 2e-16\na1                                       0.0002449  0.0000624   3.924 8.74e-05\na4                                       0.0006013  0.0001122   5.360 8.46e-08\na7                                      -0.0006034  0.0002940  -2.053 0.040137\nrcCentral + Eastern                     -0.0809279  0.0235594  -3.435 0.000594\nrcCentral + Eastern + Toronto            0.0194658  0.0493872   0.394 0.693479\nrcCentral + Eastern + Toronto + Western -0.5553001  0.1475450  -3.764 0.000168\nrcCentral + Eastern + Western           -0.1094948  0.0771363  -1.419 0.155775\nrcCentral + Northern                     0.0444578  0.0502467   0.885 0.376285\nrcCentral + Northern + Toronto          -0.2860683  0.1474638  -1.940 0.052409\nrcCentral + Northern + Western           0.0045387  0.1142821   0.040 0.968321\nrcCentral + Toronto                     -0.0297699  0.0163952  -1.816 0.069426\nrcCentral + Toronto + Western           -0.0427823  0.0852239  -0.502 0.615676\nrcCentral + Western                      0.0307709  0.0213937   1.438 0.150365\nrcEastern                               -0.0348488  0.0059958  -5.812 6.29e-09\nrcEastern + Northern                     0.0858735  0.0558750   1.537 0.124343\nrcEastern + Northern + Toronto           0.0531629  0.1474664   0.361 0.718472\nrcEastern + Northern + Western           0.2397447  0.2554191   0.939 0.347935\nrcEastern + Toronto                     -0.0362451  0.0196808  -1.842 0.065546\nrcEastern + Toronto + Western            0.0353294  0.1277534   0.277 0.782134\nrcEastern + Western                     -0.0474037  0.0387942  -1.222 0.221755\nrcNorthern                              -0.0047978  0.0073647  -0.651 0.514756\nrcNorthern + Toronto                     0.0006315  0.0375218   0.017 0.986573\nrcNorthern + Western                     0.0724490  0.0460614   1.573 0.115769\nrcToronto                               -0.0132884  0.0069503  -1.912 0.055906\nrcToronto + Western                      0.0296455  0.0427685   0.693 0.488219\nrcWestern                                0.0020497  0.0070114   0.292 0.770035\n                                           \n(Intercept)                             ***\nsgF                                     *  \nac                                      ***\na1                                      ***\na4                                      ***\na7                                      *  \nrcCentral + Eastern                     ***\nrcCentral + Eastern + Toronto              \nrcCentral + Eastern + Toronto + Western ***\nrcCentral + Eastern + Western              \nrcCentral + Northern                       \nrcCentral + Northern + Toronto          .  \nrcCentral + Northern + Western             \nrcCentral + Toronto                     .  \nrcCentral + Toronto + Western              \nrcCentral + Western                        \nrcEastern                               ***\nrcEastern + Northern                       \nrcEastern + Northern + Toronto             \nrcEastern + Northern + Western             \nrcEastern + Toronto                     .  \nrcEastern + Toronto + Western              \nrcEastern + Western                        \nrcNorthern                                 \nrcNorthern + Toronto                       \nrcNorthern + Western                       \nrcToronto                               .  \nrcToronto + Western                        \nrcWestern                                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.2553 on 14491 degrees of freedom\nMultiple R-squared:  0.7398,\tAdjusted R-squared:  0.7393 \nF-statistic:  1472 on 28 and 14491 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n\n```{.r .cell-code}\nfca <- formula(backstep)\nfcb <- formula(frontstep)\nfcc <- formula(bothstep)\nfcd <- formula(bstepz)\nfce <- formula(fstepz)\nfcg <- formula(bothstepz)\nfca\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nvm ~ np + ac + a4 + rc + treat\n```\n\n\n:::\n\n```{.r .cell-code}\nfcb\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nvm ~ rc + ac + treat + a8 + a4\n```\n\n\n:::\n\n```{.r .cell-code}\nfcc\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nvm ~ ac + a4 + rc + treat + a8\n```\n\n\n:::\n\n```{.r .cell-code}\nfcd\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n```\n\n\n:::\n\n```{.r .cell-code}\nfce\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat ~ ac + rc + a4 + a1 + sg + a7\n```\n\n\n:::\n\n```{.r .cell-code}\nfcg\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntreat ~ sg + ac + a1 + a4 + a7 + rc\n```\n\n\n:::\n\n```{.r .cell-code}\n# plot(bothstep, which = 1:4, ask = FALSE)\nabs_t <- sort(\n  abs(summary(bothstepz)$coefficients[, \"t value\"]),\n  decreasing = TRUE\n)\nprint(abs_t)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                     ac                             (Intercept) \n                           193.89430387                             74.16145718 \n                              rcEastern                                      a4 \n                             5.81222708                              5.35975365 \n                                     a1 rcCentral + Eastern + Toronto + Western \n                             3.92438914                              3.76359743 \n                    rcCentral + Eastern                                     sgF \n                             3.43505680                              2.10564024 \n                                     a7          rcCentral + Northern + Toronto \n                             2.05252052                              1.93992188 \n                              rcToronto                     rcEastern + Toronto \n                             1.91192157                              1.84165356 \n                    rcCentral + Toronto                    rcNorthern + Western \n                             1.81577492                              1.57287823 \n                   rcEastern + Northern                     rcCentral + Western \n                             1.53688722                              1.43832097 \n          rcCentral + Eastern + Western                     rcEastern + Western \n                             1.41949910                              1.22192732 \n         rcEastern + Northern + Western                    rcCentral + Northern \n                             0.93863274                              0.88479013 \n                    rcToronto + Western                              rcNorthern \n                             0.69316137                              0.65146542 \n          rcCentral + Toronto + Western           rcCentral + Eastern + Toronto \n                             0.50199859                              0.39414662 \n         rcEastern + Northern + Toronto                               rcWestern \n                             0.36050841                              0.29233524 \n          rcEastern + Toronto + Western          rcCentral + Northern + Western \n                             0.27654380                              0.03971491 \n                   rcNorthern + Toronto \n                             0.01682979 \n```\n\n\n:::\n\n```{.r .cell-code}\npar(mfrow = c(2, 2))\nplot(bothstepz, ask = FALSE, which = 1:4)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-33.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\nlibrary(sjPlot)\nsjPlot::plot_model(\n  bothstepz,\n  title = \"Variables selected in Stepwise Regression Model (treatment ~ sg + ac + a1 + a4 + a7 + rc)\"\n)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-34.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nmodz <- matchit(\n  treat ~ sg + ac + a1 + a4 + a7 + rc,\n  data = orcmatch_temp,\n  distance = \"cbps\",\n  estimand = \"ATC\",\n  distance.options = list(method = \"exact\"),\n  replace = TRUE\n)\nsummary(modz)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nmatchit(formula = treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcmatch_temp, \n    distance = \"cbps\", distance.options = list(method = \"exact\"), \n    estimand = \"ATC\", replace = TRUE)\n\nSummary of Balance for All Data:\n                                        Means Treated Means Control\ndistance                                       0.0000        1.0000\nsgM                                            0.8986        0.8986\nsgF                                            0.1014        0.1014\nac                                             2.2164        1.0000\na1                                            17.9529        6.0704\na4                                             5.4539        1.6624\na7                                             2.1215        0.1784\nrcCentral                                      0.2646        0.2753\nrcCentral + Eastern                            0.0117        0.0051\nrcCentral + Eastern + Toronto                  0.0034        0.0003\nrcCentral + Eastern + Toronto + Western        0.0004        0.0000\nrcCentral + Eastern + Western                  0.0012        0.0003\nrcCentral + Northern                           0.0028        0.0008\nrcCentral + Northern + Toronto                 0.0003        0.0001\nrcCentral + Northern + Western                 0.0007        0.0000\nrcCentral + Toronto                            0.0274        0.0085\nrcCentral + Toronto + Western                  0.0010        0.0003\nrcCentral + Western                            0.0131        0.0073\nrcEastern                                      0.2519        0.2528\nrcEastern + Northern                           0.0019        0.0010\nrcEastern + Northern + Toronto                 0.0004        0.0000\nrcEastern + Northern + Western                 0.0001        0.0000\nrcEastern + Toronto                            0.0174        0.0070\nrcEastern + Toronto + Western                  0.0003        0.0003\nrcEastern + Western                            0.0050        0.0011\nrcNorthern                                     0.1303        0.1204\nrcNorthern + Toronto                           0.0048        0.0017\nrcNorthern + Western                           0.0030        0.0012\nrcToronto                                      0.1321        0.1522\nrcToronto + Western                            0.0037        0.0012\nrcWestern                                      0.1225        0.1631\n                                             Std. Mean Diff.\ndistance                                -10877574058277.4844\nsgM                                                   0.0000\nsgF                                                   0.0000\nac                                                    3.3528\na1                                                    0.4306\na4                                                    0.2616\na7                                                    0.5093\nrcCentral                                            -0.0241\nrcCentral + Eastern                                   0.0928\nrcCentral + Eastern + Toronto                         0.1909\nrcCentral + Eastern + Toronto + Western               0.0288\nrcCentral + Eastern + Western                         0.0581\nrcCentral + Northern                                  0.0671\nrcCentral + Northern + Toronto                        0.0117\nrcCentral + Northern + Western                        0.0371\nrcCentral + Toronto                                   0.2051\nrcCentral + Toronto + Western                         0.0415\nrcCentral + Western                                   0.0680\nrcEastern                                            -0.0019\nrcEastern + Northern                                  0.0311\nrcEastern + Northern + Toronto                        0.0288\nrcEastern + Northern + Western                        0.0166\nrcEastern + Toronto                                   0.1237\nrcEastern + Toronto + Western                         0.0000\nrcEastern + Western                                   0.1162\nrcNorthern                                            0.0305\nrcNorthern + Toronto                                  0.0780\nrcNorthern + Western                                  0.0509\nrcToronto                                            -0.0560\nrcToronto + Western                                   0.0705\nrcWestern                                            -0.1100\n                                                              Var. Ratio\ndistance                                                          0.0000\nsgM                                                                    .\nsgF                                                                    .\nac                                      341692012766349154532196352.0000\na1                                                                2.1188\na4                                                                2.4738\na7                                                                6.3246\nrcCentral                                                              .\nrcCentral + Eastern                                                    .\nrcCentral + Eastern + Toronto                                          .\nrcCentral + Eastern + Toronto + Western                                .\nrcCentral + Eastern + Western                                          .\nrcCentral + Northern                                                   .\nrcCentral + Northern + Toronto                                         .\nrcCentral + Northern + Western                                         .\nrcCentral + Toronto                                                    .\nrcCentral + Toronto + Western                                          .\nrcCentral + Western                                                    .\nrcEastern                                                              .\nrcEastern + Northern                                                   .\nrcEastern + Northern + Toronto                                         .\nrcEastern + Northern + Western                                         .\nrcEastern + Toronto                                                    .\nrcEastern + Toronto + Western                                          .\nrcEastern + Western                                                    .\nrcNorthern                                                             .\nrcNorthern + Toronto                                                   .\nrcNorthern + Western                                                   .\nrcToronto                                                              .\nrcToronto + Western                                                    .\nrcWestern                                                              .\n                                        eCDF Mean eCDF Max\ndistance                                   0.5000   1.0000\nsgM                                        0.0000   0.0000\nsgF                                        0.0000   0.0000\nac                                         0.2027   1.0000\na1                                         0.0434   0.3814\na4                                         0.0188   0.1782\na7                                         0.0189   0.2579\nrcCentral                                  0.0107   0.0107\nrcCentral + Eastern                        0.0066   0.0066\nrcCentral + Eastern + Toronto              0.0032   0.0032\nrcCentral + Eastern + Toronto + Western    0.0004   0.0004\nrcCentral + Eastern + Western              0.0010   0.0010\nrcCentral + Northern                       0.0019   0.0019\nrcCentral + Northern + Toronto             0.0001   0.0001\nrcCentral + Northern + Western             0.0007   0.0007\nrcCentral + Toronto                        0.0189   0.0189\nrcCentral + Toronto + Western              0.0007   0.0007\nrcCentral + Western                        0.0058   0.0058\nrcEastern                                  0.0008   0.0008\nrcEastern + Northern                       0.0010   0.0010\nrcEastern + Northern + Toronto             0.0004   0.0004\nrcEastern + Northern + Western             0.0001   0.0001\nrcEastern + Toronto                        0.0103   0.0103\nrcEastern + Toronto + Western              0.0000   0.0000\nrcEastern + Western                        0.0039   0.0039\nrcNorthern                                 0.0099   0.0099\nrcNorthern + Toronto                       0.0032   0.0032\nrcNorthern + Western                       0.0018   0.0018\nrcToronto                                  0.0201   0.0201\nrcToronto + Western                        0.0025   0.0025\nrcWestern                                  0.0406   0.0406\n\nSummary of Balance for Matched Data:\n                                        Means Treated Means Control\ndistance                                            0        1.0000\nsgM                                                 0        0.8986\nsgF                                                 1        0.1014\nac                                                  2        1.0000\na1                                                  0        6.0704\na4                                                  0        1.6624\na7                                                  0        0.1784\nrcCentral                                           0        0.2753\nrcCentral + Eastern                                 0        0.0051\nrcCentral + Eastern + Toronto                       0        0.0003\nrcCentral + Eastern + Toronto + Western             0        0.0000\nrcCentral + Eastern + Western                       0        0.0003\nrcCentral + Northern                                0        0.0008\nrcCentral + Northern + Toronto                      0        0.0001\nrcCentral + Northern + Western                      0        0.0000\nrcCentral + Toronto                                 0        0.0085\nrcCentral + Toronto + Western                       0        0.0003\nrcCentral + Western                                 0        0.0073\nrcEastern                                           1        0.2528\nrcEastern + Northern                                0        0.0010\nrcEastern + Northern + Toronto                      0        0.0000\nrcEastern + Northern + Western                      0        0.0000\nrcEastern + Toronto                                 0        0.0070\nrcEastern + Toronto + Western                       0        0.0003\nrcEastern + Western                                 0        0.0011\nrcNorthern                                          0        0.1204\nrcNorthern + Toronto                                0        0.0017\nrcNorthern + Western                                0        0.0012\nrcToronto                                           0        0.1522\nrcToronto + Western                                 0        0.0012\nrcWestern                                           0        0.1631\n                                             Std. Mean Diff. Var. Ratio\ndistance                                -10877574058277.4844          .\nsgM                                                  -2.9773          .\nsgF                                                   2.9773          .\nac                                                    2.7563          .\na1                                                   -0.2200          .\na4                                                   -0.1147          .\na7                                                   -0.0467          .\nrcCentral                                            -0.6164          .\nrcCentral + Eastern                                  -0.0716          .\nrcCentral + Eastern + Toronto                        -0.0166          .\nrcCentral + Eastern + Toronto + Western               0.0000          .\nrcCentral + Eastern + Western                        -0.0166          .\nrcCentral + Northern                                 -0.0288          .\nrcCentral + Northern + Toronto                       -0.0117          .\nrcCentral + Northern + Western                        0.0000          .\nrcCentral + Toronto                                  -0.0928          .\nrcCentral + Toronto + Western                        -0.0166          .\nrcCentral + Western                                  -0.0858          .\nrcEastern                                             1.7194          .\nrcEastern + Northern                                 -0.0311          .\nrcEastern + Northern + Toronto                        0.0000          .\nrcEastern + Northern + Western                        0.0000          .\nrcEastern + Toronto                                  -0.0841          .\nrcEastern + Toronto + Western                        -0.0166          .\nrcEastern + Western                                  -0.0332          .\nrcNorthern                                           -0.3699          .\nrcNorthern + Toronto                                 -0.0407          .\nrcNorthern + Western                                 -0.0352          .\nrcToronto                                            -0.4237          .\nrcToronto + Western                                  -0.0352          .\nrcWestern                                            -0.4414          .\n                                        eCDF Mean eCDF Max     Std. Pair Dist.\ndistance                                   0.5000   1.0000 10877574058278.9004\nsgM                                        0.8986   0.8986              2.9773\nsgF                                        0.8986   0.8986              2.9773\nac                                         0.1667   1.0000              2.7563\na1                                         0.0216   0.1682              0.2200\na4                                         0.0078   0.0486              0.1147\na7                                         0.0015   0.0076              0.0467\nrcCentral                                  0.2753   0.2753              0.6164\nrcCentral + Eastern                        0.0051   0.0051              0.0716\nrcCentral + Eastern + Toronto              0.0003   0.0003              0.0166\nrcCentral + Eastern + Toronto + Western    0.0000   0.0000              0.0000\nrcCentral + Eastern + Western              0.0003   0.0003              0.0166\nrcCentral + Northern                       0.0008   0.0008              0.0288\nrcCentral + Northern + Toronto             0.0001   0.0001              0.0117\nrcCentral + Northern + Western             0.0000   0.0000              0.0000\nrcCentral + Toronto                        0.0085   0.0085              0.0928\nrcCentral + Toronto + Western              0.0003   0.0003              0.0166\nrcCentral + Western                        0.0073   0.0073              0.0858\nrcEastern                                  0.7472   0.7472              1.7194\nrcEastern + Northern                       0.0010   0.0010              0.0311\nrcEastern + Northern + Toronto             0.0000   0.0000              0.0000\nrcEastern + Northern + Western             0.0000   0.0000              0.0000\nrcEastern + Toronto                        0.0070   0.0070              0.0841\nrcEastern + Toronto + Western              0.0003   0.0003              0.0166\nrcEastern + Western                        0.0011   0.0011              0.0332\nrcNorthern                                 0.1204   0.1204              0.3699\nrcNorthern + Toronto                       0.0017   0.0017              0.0407\nrcNorthern + Western                       0.0012   0.0012              0.0352\nrcToronto                                  0.1522   0.1522              0.4237\nrcToronto + Western                        0.0012   0.0012              0.0352\nrcWestern                                  0.1631   0.1631              0.4414\n\nSample Sizes:\n          Control Treated\nAll          7260    7260\nMatched      7260       1\nUnmatched       0    7259\nDiscarded       0       0\n```\n\n\n:::\n\n```{.r .cell-code}\nmodz1a <- match.data(modz)\n\nlibrary(sjmisc)\norcm <- copy(orcmatch_temp)\norcm <- to_factor(orcm, sg, rc, treat)\nmorc <- lm(treat ~ sg + ac + a1 + a4 + a7 + rc, data = orcm)\nsjPlot::plot_model(\n  morc,\n  type = \"pred\",\n  terms = c(\"rc\", \"ac\", \"sg\"),\n  title = \"Stepwise Regression Prediction of Treatment\",\n) +\n  coord_flip() +\n  theme(plot.title = element_text(hjust = 0.5, face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-35.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nsjPlot::plot_model(\n  morc,\n  title = \"Stepwise Regression Prediction of Treatment\",\n  type = \"pred\",\n  terms = c(\"rc\", \"ac\", \"sg\")\n) +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\"),\n    axis.text.x = element_text(\n      angle = 45, \n      hjust = 1, \n      vjust = 1,  \n      size = 9   \n    )\n  )  \n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-36.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nplot(bothstep, which = 1:4, ask = FALSE)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-37.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-38.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-39.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-40.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nplot(bothstepz, which = 1:4, ask = FALSE)\n```\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-41.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-42.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-43.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](notez1a_files/figure-pdf/unnamed-chunk-1-44.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"normalem\"]},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}